<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>offset vs. position</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="http://code.jquery.com/jquery-1.6.4.js"></script>
    <script>
        $(document).ready(function () {
            $('.op').hover(
                    function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        $(this).css('background', 'pink');
                    },

                    function (e) {
                        /*e.preventDefault();
                         e.stopPropagation();
                         e.stopImmediatePropagation();*/
                        $(this).css('background', 'blue');
                        $(this).trigger('mouseenter');
                    }
            );

            var $dragging = null;
            var $draggingX, $draggingY;
            var $draggingWidth, $draggingHeight;
            var $draggingParentWidth, $draggingParentHeight;

            $(document.body).bind("mousemove", function (e) {
                if ($dragging) {
                    var minX = $dragging.parent().offset().left;
                    var minY = $dragging.parent().offset().top;
                    var maxX = $dragging.parent().offset().left + $draggingParentWidth - $draggingWidth;
                    var maxY = $dragging.parent().offset().top + $draggingParentHeight - $draggingHeight;

                    var newX = e.pageX - $draggingX;
                    var newY = e.pageY - $draggingY;

                    console.log(newX, newY);

                    newX = Math.min(Math.max(minX, newX), maxX);
                    newY = Math.min(Math.max(minY, newY), maxY);

                    console.log(newX, newY);

                    $dragging.offset({
                        top  : newY,//e.pageY - $draggingY,
                        left : newX//e.pageX - $draggingX
                    });

                    console.log('move');
                }
            });

            $(document.body).bind("mousedown", "div", function (e) {
                if ($(e.target).css('position') === 'static') {
                    return;
                }

                $dragging = $(e.target);
                $dragging.addClass('drag');
                $draggingY = e.pageY - $(e.target).offset().top;
                $draggingX = e.pageX - $(e.target).offset().left;
                $draggingWidth = $(e.target).width();
                $draggingHeight = $(e.target).height();
                $draggingParentWidth = $(e.target).parent().width();
                $draggingParentHeight = $(e.target).parent().height();

                console.log($draggingY, $draggingX)
            });

            $(document.body).bind("mouseup", function (e) {
                $dragging.removeClass('drag');
                $dragging = null;
            });
        });
    </script>
</head>
<body>
ololol*o/ololol
<!--<div class="red large-square static hidden">-->
<!--<div class="green small-square relative"></div>-->
<!--</div>-->
<div class="green large-square relative hidden">
    <div class="red small-square relative"></div>
</div>
<!--<div class="blue large-square absolute hidden">-->
<!--<div class="green small-square relative"></div>-->
<!--</div>-->
<!--<div class="red large-square fixed hidden">-->
<!--<div class="green small-square relative"></div>-->
<!--</div>-->
<div class="main red large-square hidden relative">
    <!--<div class="blue small-square relative"></div>-->
    <!--<div class="blue small-square relative"></div>-->
    <!--<div class="blue small-square relative"></div>-->
    <div class="main blue medium-square hidden absolute right-top">
        <div class="op absolute left-top right-bottom">
            <div class="green tiny-square hidden static"></div>
            <div class="green tiny-square hidden static"></div>
            <div class="green tiny-square hidden static"></div>
            <div class="green tiny-square hidden static"></div>
            <div style="clear: both;"></div>
        </div>
    </div>
    <div class="main blue medium-square hidden absolute right-bottom">
        <div class="op absolute left-top right-bottom">
            <div class="green tiny-square hidden static"></div>
            <div class="green tiny-square hidden static"></div>
            <div class="green tiny-square hidden static"></div>
            <div class="green tiny-square hidden static"></div>
            <div style="clear: both;"></div>
        </div>
    </div>
    <div class="op absolute left-top right-bottom">
        <div class="green tiny-square hidden static"></div>
        <div class="green tiny-square hidden static"></div>
        <div class="green tiny-square hidden static"></div>
        <div class="green tiny-square hidden static"></div>
        <div style="clear: both;"></div>
    </div>
</div>
</body>
</html>