(function(){Raphael.el.popup=function(m,r,q,n){var p=this.paper||this[0].paper,o,k,i,l;if(p){switch(this.type){case"text":case"circle":case"ellipse":k=!0;break;default:k=!1;}m=null==m?"up":m;r=r||5;o=this.getBBox();q="number"==typeof q?q:k?o.x+o.width/2:o.x;n="number"==typeof n?n:k?o.y+o.height/2:o.y;i=Math.max(o.width/2-r,0);l=Math.max(o.height/2-r,0);this.translate(q-o.x-(k?o.width/2:0),n-o.y-(k?o.height/2:0));o=this.getBBox();q={up:["M",q,n,"l",-r,-r,-i,0,"a",r,r,0,0,1,-r,-r,"l",0,-o.height,"a",r,r,0,0,1,r,-r,"l",2*r+2*i,0,"a",r,r,0,0,1,r,r,"l",0,o.height,"a",r,r,0,0,1,-r,r,"l",-i,0,"z"].join(),down:["M",q,n,"l",r,r,i,0,"a",r,r,0,0,1,r,r,"l",0,o.height,"a",r,r,0,0,1,-r,r,"l",-(2*r+2*i),0,"a",r,r,0,0,1,-r,-r,"l",0,-o.height,"a",r,r,0,0,1,r,-r,"l",i,0,"z"].join(),left:["M",q,n,"l",-r,r,0,l,"a",r,r,0,0,1,-r,r,"l",-o.width,0,"a",r,r,0,0,1,-r,-r,"l",0,-(2*r+2*l),"a",r,r,0,0,1,r,-r,"l",o.width,0,"a",r,r,0,0,1,r,r,"l",0,l,"z"].join(),right:["M",q,n,"l",r,-r,0,-l,"a",r,r,0,0,1,r,-r,"l",o.width,0,"a",r,r,0,0,1,r,r,"l",0,2*r+2*l,"a",r,r,0,0,1,-r,r,"l",-o.width,0,"a",r,r,0,0,1,-r,-r,"l",0,-l,"z"].join()};r={up:{x:-!k*(o.width/2),y:2*-r-(k?o.height/2:o.height)},down:{x:-!k*(o.width/2),y:2*r+(k?o.height/2:o.height)},left:{x:2*-r-(k?o.width/2:o.width),y:-!k*(o.height/2)},right:{x:2*r+(k?o.width/2:o.width),y:-!k*(o.height/2)}}[m];this.translate(r.x,r.y);return p.path(q[m]).attr({fill:"#000",stroke:"none"}).insertBefore(this.node?this:this[0]);}};Raphael.el.tag=function(m,r,q,n){var p=this.paper||this[0].paper;if(p){var p=p.path().attr({fill:"#000",stroke:"#000"}),o=this.getBBox(),k,i,l;switch(this.type){case"text":case"circle":case"ellipse":l=!0;break;default:l=!1;}m=m||0;q="number"==typeof q?q:l?o.x+o.width/2:o.x;n="number"==typeof n?n:l?o.y+o.height/2:o.y;r=null==r?5:r;i=0.5522*r;o.height>=2*r?p.attr({path:["M",q,n+r,"a",r,r,0,1,1,0,2*-r,r,r,0,1,1,0,2*r,"m",0,2*-r-3,"a",r+3,r+3,0,1,0,0,2*(r+3),"L",q+r+3,n+o.height/2+3,"l",o.width+6,0,0,-o.height-6,-o.width-6,0,"L",q,n-r-3].join()}):(k=Math.sqrt(Math.pow(r+3,2)-Math.pow(o.height/2+3,2)),p.attr({path:["M",q,n+r,"c",-i,0,-r,i-r,-r,-r,0,-i,r-i,-r,r,-r,i,0,r,r-i,r,r,0,i,i-r,r,-r,r,"M",q+k,n-o.height/2-3,"a",r+3,r+3,0,1,0,0,o.height+6,"l",r+3-k+o.width+6,0,0,-o.height-6,"L",q+k,n-o.height/2-3].join()}));m=360-m;p.rotate(m,q,n);this.attrs?(this.attr(this.attrs.x?"x":"cx",q+r+3+(!l?"text"==this.type?o.width:0:o.width/2)).attr("y",l?n:n-o.height/2),this.rotate(m,q,n),90<m&&270>m&&this.attr(this.attrs.x?"x":"cx",q-r-3-(!l?o.width:o.width/2)).rotate(180,q,n)):90<m&&270>m?(this.translate(q-o.x-o.width-r-3,n-o.y-o.height/2),this.rotate(m-180,o.x+o.width+r+3,o.y+o.height/2)):(this.translate(q-o.x+r+3,n-o.y-o.height/2),this.rotate(m,o.x-r-3,o.y+o.height/2));return p.insertBefore(this.node?this:this[0]);}};Raphael.el.drop=function(k,i,g){var l=this.getBBox(),n=this.paper||this[0].paper,m,j;if(n){switch(this.type){case"text":case"circle":case"ellipse":m=!0;break;default:m=!1;}k=k||0;i="number"==typeof i?i:m?l.x+l.width/2:l.x;g="number"==typeof g?g:m?l.y+l.height/2:l.y;j=Math.max(l.width,l.height)+Math.min(l.width,l.height);n=n.path(["M",i,g,"l",j,0,"A",0.4*j,0.4*j,0,1,0,i+0.7*j,g-0.7*j,"z"]).attr({fill:"#000",stroke:"none"}).rotate(22.5-k,i,g);k=(k+90)*Math.PI/180;i=i+j*Math.sin(k)-(m?0:l.width/2);k=g+j*Math.cos(k)-(m?0:l.height/2);this.attrs?this.attr(this.attrs.x?"x":"cx",i).attr(this.attrs.y?"y":"cy",k):this.translate(i-l.x,k-l.y);return n.insertBefore(this.node?this:this[0]);}};Raphael.el.flag=function(k,i,g){var l=this.paper||this[0].paper;if(l){var l=l.path().attr({fill:"#000",stroke:"#000"}),n=this.getBBox(),m=n.height/2,j;switch(this.type){case"text":case"circle":case"ellipse":j=!0;break;default:j=!1;}k=k||0;i="number"==typeof i?i:j?n.x+n.width/2:n.x;g="number"==typeof g?g:j?n.y+n.height/2:n.y;l.attr({path:["M",i,g,"l",m+3,-m-3,n.width+6,0,0,n.height+6,-n.width-6,0,"z"].join()});k=360-k;l.rotate(k,i,g);this.attrs?(this.attr(this.attrs.x?"x":"cx",i+m+3+(!j?"text"==this.type?n.width:0:n.width/2)).attr("y",j?g:g-n.height/2),this.rotate(k,i,g),90<k&&270>k&&this.attr(this.attrs.x?"x":"cx",i-m-3-(!j?n.width:n.width/2)).rotate(180,i,g)):90<k&&270>k?(this.translate(i-n.x-n.width-m-3,g-n.y-n.height/2),this.rotate(k-180,n.x+n.width+m+3,n.y+n.height/2)):(this.translate(i-n.x+m+3,g-n.y-n.height/2),this.rotate(k,n.x-m-3,n.y+n.height/2));return l.insertBefore(this.node?this:this[0]);}};Raphael.el.label=function(){var h=this.getBBox(),g=this.paper||this[0].paper,e=Math.min(20,h.width+10,h.height+10)/2;if(g){return g.rect(h.x-e/2,h.y-e/2,h.width+e,h.height+e,e).attr({stroke:"none",fill:"#000"}).insertBefore(this.node?this:this[0]);}};Raphael.el.blob=function(u,z,y){var v=this.getBBox(),x=Math.PI/180,w=this.paper||this[0].paper,s,r;if(w){switch(this.type){case"text":case"circle":case"ellipse":s=!0;break;default:s=!1;}w=w.path().attr({fill:"#000",stroke:"none"});u=(+u+1?u:45)+90;r=Math.min(v.height,v.width);z="number"==typeof z?z:s?v.x+v.width/2:v.x;y="number"==typeof y?y:s?v.y+v.height/2:v.y;var t=Math.max(v.width+r,25*r/12),p=Math.max(v.height+r,25*r/12);s=z+r*Math.sin((u-22.5)*x);var q=y+r*Math.cos((u-22.5)*x),o=z+r*Math.sin((u+22.5)*x);u=y+r*Math.cos((u+22.5)*x);x=(o-s)/2;r=(u-q)/2;var t=t/2,p=p/2,i=-Math.sqrt(Math.abs(t*t*p*p-t*t*r*r-p*p*x*x)/(t*t*r*r+p*p*x*x));r=i*t*r/p+(o+s)/2;x=i*-p*x/t+(u+q)/2;w.attr({x:r,y:x,path:["M",z,y,"L",o,u,"A",t,p,0,1,1,s,q,"z"].join()});this.translate(r-v.x-v.width/2,x-v.y-v.height/2);return w.insertBefore(this.node?this:this[0]);}};Raphael.fn.label=function(i,h,g){var j=this.set();g=this.text(i,h,g).attr(Raphael.g.txtattr);return j.push(g.label(),g);};Raphael.fn.popup=function(i,h,g,j,l){var k=this.set();g=this.text(i,h,g).attr(Raphael.g.txtattr);return k.push(g.popup(j,l),g);};Raphael.fn.tag=function(i,h,g,j,l){var k=this.set();g=this.text(i,h,g).attr(Raphael.g.txtattr);return k.push(g.tag(j,l),g);};Raphael.fn.flag=function(i,h,g,j){var k=this.set();g=this.text(i,h,g).attr(Raphael.g.txtattr);return k.push(g.flag(j),g);};Raphael.fn.drop=function(i,h,g,j){var k=this.set();g=this.text(i,h,g).attr(Raphael.g.txtattr);return k.push(g.drop(j),g);};Raphael.fn.blob=function(i,h,g,j){var k=this.set();g=this.text(i,h,g).attr(Raphael.g.txtattr);return k.push(g.blob(j),g);};Raphael.el.lighter=function(g){g=g||2;var e=[this.attrs.fill,this.attrs.stroke];this.fs=this.fs||[e[0],e[1]];e[0]=Raphael.rgb2hsb(Raphael.getRGB(e[0]).hex);e[1]=Raphael.rgb2hsb(Raphael.getRGB(e[1]).hex);e[0].b=Math.min(e[0].b*g,1);e[0].s/=g;e[1].b=Math.min(e[1].b*g,1);e[1].s/=g;this.attr({fill:"hsb("+[e[0].h,e[0].s,e[0].b]+")",stroke:"hsb("+[e[1].h,e[1].s,e[1].b]+")"});return this;};Raphael.el.darker=function(g){g=g||2;var e=[this.attrs.fill,this.attrs.stroke];this.fs=this.fs||[e[0],e[1]];e[0]=Raphael.rgb2hsb(Raphael.getRGB(e[0]).hex);e[1]=Raphael.rgb2hsb(Raphael.getRGB(e[1]).hex);e[0].s=Math.min(e[0].s*g,1);e[0].b/=g;e[1].s=Math.min(e[1].s*g,1);e[1].b/=g;this.attr({fill:"hsb("+[e[0].h,e[0].s,e[0].b]+")",stroke:"hsb("+[e[1].h,e[1].s,e[1].b]+")"});return this;};Raphael.el.resetBrightness=function(){this.fs&&(this.attr({fill:this.fs[0],stroke:this.fs[1]}),delete this.fs);return this;};var a=["lighter","darker","resetBrightness"],c="popup tag flag label drop blob".split(" "),d;for(d in c){(function(e){Raphael.st[e]=function(){return Raphael.el[e].apply(this,arguments);};})(c[d]);}for(d in a){(function(e){Raphael.st[e]=function(){for(var f=0;f<this.length;f++){this[f][e].apply(this[f],arguments);}return this;};})(a[d]);}a=Raphael;c=[0.6,0.2,0.05,0.1333,0.75,0];d=[];for(var b=0;10>b;b++){b<c.length?d.push("hsb("+c[b]+",.75, .75)"):d.push("hsb("+c[b-c.length]+", 1, .5)");}a.g={shim:{stroke:"none",fill:"#000","fill-opacity":0},txtattr:{font:"12px Arial, sans-serif",fill:"#fff"},colors:d,snapEnds:function(k,i,g){function l(e){return 0.25>Math.abs(e-0.5)?~~e+0.5:Math.round(e);}var n=k,m=i;if(n==m){return{from:n,to:m,power:0};}var n=(m-n)/g,j=m=~~n;g=0;if(m){for(;j;){g--,j=~~(n*Math.pow(10,g))/Math.pow(10,g);}g++;}else{for(;!m;){g=g||1,m=~~(n*Math.pow(10,g))/Math.pow(10,g),g++;}g&&g--;}m=l(i*Math.pow(10,g))/Math.pow(10,g);m<i&&(m=l((i+0.5)*Math.pow(10,g))/Math.pow(10,g));n=l((k-(0<g?0:0.5))*Math.pow(10,g))/Math.pow(10,g);return{from:n,to:m,power:g};},axis:function(O,T,S,P,R,Q,M,L,N,J,K){J=null==J?2:J;N=N||"t";Q=Q||10;K=arguments[arguments.length-1];var I="|"==N||" "==N?["M",O+0.5,T,"l",0,0.001]:1==M||3==M?["M",O+0.5,T,"l",0,-S]:["M",O,T+0.5,"l",S,0],H=this.snapEnds(P,R,Q),B=H.from,E=H.to,C=H.power,x=0,G={font:"11px 'Fontin Sans', Fontin-Sans, sans-serif"},H=K.set(),E=(E-B)/Q,D=B,u=0<C?C:0,i=S/Q;if(1==+M||3==+M){C=T;for(B=(M-1?1:-1)*(J+3+!!(M-1));C>=T-S;){"-"!=N&&" "!=N&&(I=I.concat(["M",O-("+"==N||"|"==N?J:2*!(M-1)*J),C+0.5,"l",2*J+1,0])),H.push(K.text(O+B,C,L&&L[x++]||(Math.round(D)==D?D:+D.toFixed(u))).attr(G).attr({"text-anchor":M-1?"start":"end"})),D+=E,C-=i;}Math.round(C+i-(T-S))&&("-"!=N&&" "!=N&&(I=I.concat(["M",O-("+"==N||"|"==N?J:2*!(M-1)*J),T-S+0.5,"l",2*J+1,0])),H.push(K.text(O+B,T-S,L&&L[x]||(Math.round(D)==D?D:+D.toFixed(u))).attr(G).attr({"text-anchor":M-1?"start":"end"})));}else{for(var D=B,u=(0<C)*C,B=(M?-1:1)*(J+9+!M),C=O,i=S/Q,o=0,F=0;C<=O+S;){"-"!=N&&" "!=N&&(I=I.concat(["M",C+0.5,T-("+"==N?J:2*!!M*J),"l",0,2*J+1])),H.push(o=K.text(C,T+B,L&&L[x++]||(Math.round(D)==D?D:+D.toFixed(u))).attr(G)),o=o.getBBox(),F>=o.x-5?H.pop(H.length-1).remove():F=o.x+o.width,D+=E,C+=i;}Math.round(C-i-O-S)&&("-"!=N&&" "!=N&&(I=I.concat(["M",O+S+0.5,T-("+"==N?J:2*!!M*J),"l",0,2*J+1])),H.push(K.text(O+S,T+B,L&&L[x]||(Math.round(D)==D?D:+D.toFixed(u))).attr(G)));}I=K.path(I);I.text=H;I.all=K.set([I,H]);I.remove=function(){this.text.remove();this.constructor.prototype.remove.call(this);};return I;},labelise:function(h,g,e){return h?(h+"").replace(/(##+(?:\.#+)?)|(%%+(?:\.%+)?)/g,function(i,k,j){if(k){return(+g).toFixed(k.replace(/^#+\.?/g,"").length);}if(j){return(100*g/e).toFixed(j.replace(/^%+\.?/g,"").length)+"%";}}):(+g).toFixed(0);}};})();(function(){function a(i,o){var t=i.length,s,p=[],r=0,q=o.maxSlices||100,m=parseFloat(o.minPercent)||1,l=Boolean(m);if(1===t){s=i[0],p[0]={value:i[0],order:0,valueOf:function(){return this.value;}};}else{for(var n=s=0;n<t;n++){s+=i[n],p[n]={value:i[n],order:n,valueOf:function(){return this.value;}};}p.sort(function(e,d){return d.value-e.value;});for(n=0;n<t;n++){l&&100*p[n].value/s<m&&(q=n,l=!1),n>q&&(l=!1,p[q].value+=p[n],p[q].others=!0,r=p[q].value);}t=Math.min(q+1,p.length);r&&p.splice(t)&&(p[q].others=!0);}return{total:s,values:p};}function b(G,K,P,O,L,N){function M(Q,w,u,s,t){var v=Math.PI/180,r=Q+u*Math.cos(-s*v),q=Q+u*Math.cos(-t*v),p=Q+u/2*Math.cos(-(s+(t-s)/2)*v),n=w+u*Math.sin(-s*v),m=w+u*Math.sin(-t*v),v=w+u/2*Math.sin(-(s+(t-s)/2)*v);Q=["M",Q,w,"L",r,n,"A",u,u,0,+(180<Math.abs(t-s)),1,q,m,"z"];Q.middle={x:p,y:v};return Q;}N=N||{};var I=[],H=G.set(),J=G.set(),F=G.set(),B,E,D=0,y;L=a(L,N);E=L.values;y=L.total;B=E.length;J.covers=H;if(1==B){F.push(G.circle(K,P,O).attr({fill:N.colors&&N.colors[0]||this.colors[0],stroke:N.stroke||"#fff","stroke-width":null==N.strokewidth?1:N.strokewidth})),H.push(G.circle(K,P,O).attr(this.shim)),N.href&&N.href[0]&&H[0].attr({href:N.href[0]}),F[0].middle={x:K,y:P},F[0].mangle=180;}else{for(L=0;L<B;L++){var x=D-360*E[L]/y/2;L||(D=90-x,x=D-360*E[L]/y/2);if(N.init){var z=M(K,P,1,D,D-360*E[L]/y).join(",");}var o=M(K,P,O,D,D-=360*E[L]/y),C=N.matchColors&&!0==N.matchColors?E[L].order:L,C=G.path(N.init?z:o).attr({fill:N.colors&&N.colors[C]||this.colors[C]||"#666",stroke:N.stroke||"#fff","stroke-width":null==N.strokewidth?1:N.strokewidth,"stroke-linejoin":"round"});C.value=E[L];C.middle=o.middle;C.mangle=x;I.push(C);F.push(C);N.init&&C.animate({path:o.join(",")},+N.init-1||1000,">");}for(L=0;L<B;L++){C=G.path(I[L].attr("path")).attr(this.shim),N.href&&N.href[L]&&C.attr({href:N.href[L]}),C.attr=function(){},H.push(C),F.push(C);}}J.hover=function(j,h){h=h||function(){};for(var k=this,f=0;f<B;f++){(function(m,l,e){var d={sector:m,cover:l,cx:K,cy:P,mx:m.middle.x,my:m.middle.y,mangle:m.mangle,r:O,value:E[e],total:y,label:k.labels&&k.labels[e]};l.mouseover(function(){j.call(d);}).mouseout(function(){h.call(d);});})(F[f],H[f],f);}return this;};J.each=function(g){for(var f=0;f<B;f++){var h=F[f];g.call({sector:h,cover:H[f],cx:K,cy:P,x:h.middle.x,y:h.middle.y,mangle:h.mangle,r:O,value:E[f],total:y,label:this.labels&&this.labels[f]});}return this;};J.click=function(g){for(var f=this,h=0;h<B;h++){(function(l,k,e){var d={sector:l,cover:k,cx:K,cy:P,mx:l.middle.x,my:l.middle.y,mangle:l.mangle,r:O,value:E[e],total:y,label:f.labels&&f.labels[e]};k.click(function(){g.call(d);});})(F[h],H[h],h);}return this;};J.inject=function(d){d.insertBefore(H[0]);};if(N.legend){D=N.legend;z=N.legendothers;L=N.legendmark;I=N.legendpos;x=K+O+O/5;o=P+10;D=D||[];I=I&&I.toLowerCase&&I.toLowerCase()||"east";L=G[L&&L.toLowerCase()]||"circle";J.labels=G.set();for(C=0;C<B;C++){var A=F[C].attr("fill"),i=E[C].order;E[C].others&&(D[i]=z||"Others");D[i]=this.labelise(D[i],E[C],y);J.labels.push(G.set());J.labels[C].push(G[L](x+5,o,5).attr({fill:A,stroke:"none"}));J.labels[C].push(A=G.text(x+20,o,D[i]||E[i]).attr(this.txtattr).attr({fill:N.legendcolor||"#000","text-anchor":"start"}));H[C].label=J.labels[C];o+=1.2*A.getBBox().height;}G=J.labels.getBBox();J.labels.translate.apply(J.labels,{east:[0,-G.height/2],west:[-G.width-2*O-20,-G.height/2],north:[-O-G.width/2,-O-G.height-10],south:[-O-G.width/2,O+10]}[I]);J.push(J.labels);}J.push(F,H);J.series=F;J.covers=H;return J;}var c=function(){};c.prototype=Raphael.g;b.prototype=new c;Raphael.fn.piechart=function(h,i,g,d,j){return new b(this,h,i,g,d,j);};Raphael.fn.piechartPrepareValues=a;})();