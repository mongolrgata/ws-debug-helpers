$ws._const.jqueryMenu={border:1};(function(h){var f=[],m=[],c=null,g=null,k=null,d=h('<div class="menu-div outerbox" style="position:absolute;top:0;left:0;display:none;"><div class="shadowbox1"></div><div class="shadowbox2"></div><div class="shadowbox3"></div></div>')[0],b=h('<ul class="menu-ul innerbox"></ul>')[0],l=h('<li style="position:relative;"><div class="menu-item"></div></li>')[0],j=h('<div id="root-menu-div" style="position:absolute;top:0;left:0;"></div>'),e={showDelay:200,hideDelay:200,hoverOpenDelay:0,offsetTop:0,offsetLeft:0,minWidth:0,onOpen:null,onClose:null,onClick:null,arrowSrc:null,addExpando:false,copyClassAttr:false};h(function(){j.appendTo("body");});h.extend({MenuCollection:function(n){this.menus=[];this.init(n);}});h.extend(h.MenuCollection,{prototype:{init:function(n){if(n&&n.length){for(var o=0;o<n.length;o++){this.addMenu(n[o]);n[o].menuCollection=this;}}},addMenu:function(o){if(o instanceof h.Menu){this.menus.push(o);}o.menuCollection=this;var n=this;h(o.target).hover(function(){if(o.visible||(h(this).hasClass("menumain")&&!h(this).hasClass("enable"))){return;}for(var p=0;p<n.menus.length;p++){if(n.menus[p].visible){n.menus[p].hide();o.show();return;}}},function(){});}}});h.extend({Menu:function(p,n,o,q){if(!h(p).hasClass("ws-menu")){j.append(p);}this.menuItems=[];this.itemMap={};this.subMenus=[];this.visible=false;this.active=false;this.parentMenuItem=null;this.settings=h.extend({},e,o);this.target=q||p;this.$eDIV=null;this.$eUL=null;this.timer=null;this.menuCollection=null;this.openTimer=null;this.type=null;this.id=o.id;this.settings.level=o.level!==undefined?o.level+1:0;this.itemsWithImage=0;this.init();if(n&&n.constructor==Array){this.addItems(n);}}});h.extend(h.Menu,{checkMouse:function(p){var o=p.target,q=h(o).closest("[data-menu-id]").data("menu-id");for(var n=0;n<m.length;++n){if(m[n].id===q){return;}}if(m.length&&o==m[0].target){return;}while(o.parentNode&&o.parentNode!=j[0]){o=o.parentNode;}if(!h(m).filter(function(){return this.$eDIV[0]==o;}).length){h.Menu.closeAll();}},checkKey:function(t){switch(t.keyCode){case 13:if(g){g.click(t,g.$eLI[0]);}break;case 27:h.Menu.closeAll();break;case 37:if(!k){k=m[0];}if(k&&k.parentMenuItem){var r=k.parentMenuItem;r.$eLI.unbind("mouseout").unbind("mouseover");k.hide();r.hoverIn(true);setTimeout(function(){r.bindHover();},0);}else{if(k&&k.menuCollection){var p,q=k.menuCollection.menus;if((p=h.inArray(k,q))>-1){if(--p<0){p=q.length-1;}h.Menu.closeAll();q[p].show();q[p].setActive();if(q[p].menuItems.length){q[p].menuItems[0].hoverIn(true);}}}}break;case 38:if(k){k.selectNextItem(-1);}break;case 39:if(!k){k=m[0];}var n=k,s=g?g.subMenu:null;if(n){if(s&&s.menuItems.length){s.show();s.menuItems[0].hoverIn();}else{if((n=n.inMenuCollection())){var u,o=n.menuCollection.menus;if((u=h.inArray(n,o))>-1){if(++u>=o.length){u=0;}h.Menu.closeAll();o[u].show();o[u].setActive();if(o[u].menuItems.length){o[u].menuItems[0].hoverIn(true);}}}}}break;case 40:if(!k){if(m.length&&m[0].menuItems.length){m[0].menuItems[0].hoverIn();}}else{k.selectNextItem();}break;}if(t.keyCode>36&&t.keyCode<41){return false;}},closeAll:function(){while(m.length){m[0].hide();}},setDefaults:function(n){h.extend(e,n);},prototype:{init:function(){var n=this;if(!this.target){return;}else{if(this.target instanceof h.MenuItem){this.parentMenuItem=this.target;this.target.addSubMenu(this);this.target=this.target.$eLI;}}f.push(this);this.$eDIV=h(d.cloneNode(1));this.$eUL=h(b.cloneNode(1));this.$eDIV[0].appendChild(this.$eUL[0]);j[0].appendChild(this.$eDIV[0]);this._initHoverEvents();if(!this.parentMenuItem){h(this.target).click(function(o){n.onClick(o);}).hover(function(o){n.setActive();if(n.settings.hoverOpenDelay){n.openTimer=setTimeout(function(){if(!n.visible){n.onClick(o);}},n.settings.hoverOpenDelay);}},function(){if(!n.visible){h(this).removeClass("activetarget");}if(n.openTimer){clearTimeout(n.openTimer);}});}else{this.$eDIV.hover(function(){n.setActive();},function(){});}},_initHoverEvents:function(){var n=this;this.$eDIV.hover(function(){if(n.settings.onMouseEnter){n.settings.onMouseEnter();}},function(){if(n.settings.onMouseLeave){n.settings.onMouseLeave();}});},setActive:function(){if(!this.parentMenuItem){h(this.target).addClass("activetarget");}else{this.active=true;}},addItem:function(n){this.insertItem(n);},addItems:function(n){for(var o=0;o<n.length;o++){this.addItem(n[o]);}},removeItem:function(o){var p=h.inArray(o,this.menuItems);if(p>-1){this.menuItems.splice(p,1);if(o.imgSrc){if(--this.itemsWithImage===0){for(var n=0;n<this.menuItems.length;++n){this.menuItems[n].$eLI.removeClass("ws-hasImg");}}}delete this.itemMap[o.id];}o.parentMenu=null;},insertItem:function(o,p){if(o instanceof h.MenuItem){if(h.inArray(o,this.menuItems)==-1){var q=p?h.inArray(this.itemMap[p],this.menuItems):-1;this.itemMap[o.id]=o;if(o.imgSrc){if(++this.itemsWithImage===1){for(var n=0;n<this.menuItems.length;++n){this.menuItems[n].$eLI.addClass("ws-hasImg");}}}if(p===$ws._const.Menu.insertItemBeforeAll){this.$eUL.prepend(o.$eLI);this.menuItems.unshift(o);}else{if(q==-1){this.$eUL.append(o.$eLI);this.menuItems.push(o);}else{o.$eLI.insertBefore(this.itemMap[p].$eLI);this.menuItems.splice(q,0,o);}}o.parentMenu=this;if(o.subMenu){if(q==-1){this.subMenus.push(o.subMenu);}else{this.subMenus.splice(q,0,o.subMenu);}}}}else{this.insertItem(new h.MenuItem(o,this.settings),p);}},item:function(n){return this.itemMap[n];},hide:function(){if(!this.visible){return;}var n,o=h.inArray(this,m);this.$eDIV.hide();if(o>=0){m.splice(o,1);}this.visible=this.active=false;h(this.target).removeClass("activetarget");for(n=0;n<this.subMenus.length;n++){this.subMenus[n].hide();}for(n=0;n<this.menuItems.length;n++){if(this.menuItems[n].active){this.menuItems[n].setInactive();}}if(!m.length){h(document).unbind("mousedown",h.Menu.checkMouse).unbind("keydown",h.Menu.checkKey);}if(k==this){k=null;}if(this.settings.onClose){this.settings.onClose.call(this,this.settings.level);}},show:function(r,o,s,n){if(this.visible||(r&&h(r.currentTarget).hasClass("menumain")&&!h(r.currentTarget).hasClass("enable"))){return;}var q,p=this.parentMenuItem;if(this.menuItems.length){if(p){q=parseInt(p.parentMenu.$eDIV.css("z-index"));this.$eDIV.css("z-index",(isNaN(q)?1:q+1));}this.$eDIV.css({visibility:"hidden",display:"block"});if(this.settings.minWidth){if(this.$eDIV.width()<this.settings.minWidth){this.$eDIV.css("width",this.settings.minWidth);}}this.setPosition(r,o,s,n);this.$eDIV.css({display:"none",visibility:""}).show();if(h.browser.msie){this.$eUL.css("min-width",parseInt(h.browser.version)==6?this.$eDIV.width()-7:this.$eUL.width());}if(this.settings.onOpen){this.settings.onOpen.call(this);}}if(m.length===0){h(document).bind("mousedown",h.Menu.checkMouse).bind("keydown",h.Menu.checkKey);}this.visible=true;m.push(this);},setPosition:function(F,H,n,u){if(n){var t=u?9:5;this.$eDIV.css({left:n.left-9,top:n.top-t});return;}var C,x,r,q,B,v,A,G=h(window).width(),p=h(window).height(),D=this.parentMenuItem,w=this.$eDIV[0].clientHeight,z=this.$eDIV[0].clientWidth,s;if(H){r=F.clientX-8;q=F.clientY-8;}else{if(D){var E=D.$eLI.closest(".menu-div").get(0);r=E.offsetLeft+h(E).width()+this.settings.offsetLeft;q=E.offsetTop+D.$eLI[0].offsetTop+this.settings.offsetTop-1;if((jQuery.browser.msie)&&(parseInt(jQuery.browser.version)<7)){q+=10;}}else{C=h(this.target);x=C.offset();r=x.left+this.settings.offsetLeft;q=x.top+C[0].offsetHeight+this.settings.offsetTop;if((jQuery.browser.msie)&&(parseInt(jQuery.browser.version)<7)){q+=10;}}}if(h.fn.scrollTop){v=h(window).scrollTop();if(p<w){q=v;}else{if(p+v<q+w){if(D){B=D.parentMenu.$eDIV.offset();s=D.parentMenu.$eDIV[0].clientHeight;if(w<=s){q=B.top+s-w;}else{q=B.top;}if(p+v<q+w){q-=q+w-(p+v);}}else{q-=q+w-(p+v)+2*$ws._const.jqueryMenu.border;}}}}if(h.fn.scrollLeft){A=h(window).scrollLeft();if(G+A<r+z){if(D){r-=D.$eLI.width()+z;if(r<A){r=A;}}else{r-=r+z-(G+A)+2*$ws._const.jqueryMenu.border;}}}this.$eDIV.css({left:r,top:q});},onClick:function(p,o,q,n){if(this.visible){this.hide();this.setActive();}else{h.Menu.closeAll();this.show(p,o,q,n);}},addTimer:function(p,o){var n=this;this.timer=setTimeout(function(){p.call(n);n.timer=null;},o);},removeTimer:function(){if(this.timer){clearTimeout(this.timer);this.timer=null;}},selectNextItem:function(r){var n,s=0,p=this.menuItems.length,q=r||1;for(n=0;n<p;n++){if(this.menuItems[n].active){s=n;break;}}this.menuItems[s].hoverOut();do{s+=q;if(s>=p){s=0;}else{if(s<0){s=p-1;}}}while(this.menuItems[s].separator);this.menuItems[s].hoverIn(true);},inMenuCollection:function(){var n=this;while(n.parentMenuItem){n=n.parentMenuItem.parentMenu;}return n.menuCollection?n:null;},destroy:function(){var o,n;this.hide();if(this.parentMenuItem){this.$eDIV.unbind("mouseover").unbind("mouseout");}else{h(this.target).unbind("click").unbind("mouseover").unbind("mouseout");}while(this.menuItems.length){n=this.menuItems[0];n.destroy();}this.menuItems=undefined;this.itemMap=undefined;if((o=h.inArray(this,f))>-1){f.splice(o,1);}if(this.menuCollection){if((o=h.inArray(this,this.menuCollection.menus))>-1){this.menuCollection.menus.splice(o,1);}}this.$eDIV.remove();}}});h.extend({MenuItem:function(o,n){if(typeof o=="string"){o={caption:o};}this.caption=o.caption||"";this.id=o.id||"";this.imgSrc=o.imgSrc||"";this.itemFloat=o.itemFloat||"";this.url=o.url||null;this.urlTarget=o.target||null;this.addClass=o.addClass||null;this.data=o.data||null;this.$eLI=null;this.parentMenu=null;this.subMenu=null;this.settings=h.extend({},e,n);this.active=false;this.enabled=o.enable===undefined?true:o.enable;this.separator=false;this.init(o.hasSubMenu||!!o.subMenu);if(o.subMenu){new h.Menu(this,o.subMenu,n);}}});h.extend(h.MenuItem,{prototype:{init:function(n){var q,s,u=this.caption,t=this.imgSrc,o=this.id,r=this.enabled,v=this;this.$eLI=h(l.cloneNode(1));if(!r){this.$eLI.addClass("inactive");}this.initClass(n);if(this.addClass){this.$eLI[0].className=this.addClass;}if(this.settings.addExpando&&this.data){this.$eLI[0].menuData=this.data;}if(u===""&&t===""){this.$eLI.addClass("menu-separator");this.separator=true;}else{s=typeof u=="string";if(s&&this.url){u=h('<a href="'+this.url+'"'+(this.urlTarget?'target="'+this.urlTarget+'"':"")+">"+u+"</a>");}else{if(s||!u.length){u=[u];}}t=t==="none"?"":t;if(o!==""){h(this.$eLI[0]).attr("id",o);}for(q=0;q<u.length;q++){if(typeof u[q]=="string"){var p=document.createElement("span");p.innerHTML=u[q];this.$eLI[0].firstChild.appendChild(p);}else{this.$eLI[0].firstChild.appendChild(u[q].cloneNode(1));}}}this.$eLI.click(function(w){v.click(w,this);});this.bindHover();},initClass:function(n){if(this.addClass){this.addClass+=" ws-menu-item";}else{this.addClass="ws-menu-item";}if(this.imgSrc){this.addClass+=" ws-hasImg";}if(n){this.addClass+=" ws-with-submenu";}if(this.caption){this.addClass+=" ws-with-caption";}else{if(n){this.addClass+=" ws-icon-with-submenu";}else{this.addClass+=" ws-icon-only";}}if(n&&!this.caption){this.caption="&nbsp;";}},click:function(p,o){var n=true;if(this.$eLI.closest(".menu-div").hasClass("ws-operations-panel-menu")&&this.subMenu!==null){n=false;}p.stopPropagation();if(this.enabled&&this.settings.onClick&&n){this.settings.onClick.call(o,this.id,this);}},bindHover:function(){var n=this;this.$eLI.hover(function(o){if(n.enabled&&n.settings.onHoverIn){n.settings.onHoverIn.call(o,n.id,n);}n.hoverIn();},function(o){if(n.enabled&&n.settings.onHoverOut){n.settings.onHoverOut.call(o,n.id,n);}n.hoverOut();});},hoverIn:function(n){this.removeTimer();var o,q=this.parentMenu.subMenus,p=this.parentMenu.menuItems;if(this.parentMenu.timer){this.parentMenu.removeTimer();}if(!this.enabled){return;}for(o=0;o<p.length;o++){if(p[o].active){p[o].setInactive();}}this.setActive();k=this.parentMenu;for(o=0;o<q.length;o++){if(q[o].visible&&q[o]!=this.subMenu&&!q[o].timer){q[o].addTimer(function(){this.hide();},q[o].settings.hideDelay);}}if(this.subMenu&&!n){this.subMenu.addTimer(function(){this.show();},this.subMenu.settings.showDelay);}},hoverOut:function(){this.removeTimer();if(!this.enabled){return;}if(!this.subMenu||!this.subMenu.visible){this.setInactive();}},removeTimer:function(){if(this.subMenu){this.subMenu.removeTimer();}},setActive:function(){this.active=true;this.$eLI.addClass("active");var n=this.parentMenu.parentMenuItem;if(n&&!n.active){n.setActive();}g=this;},setInactive:function(){this.active=false;this.$eLI.removeClass("active");if(this==g){g=null;}},enable:function(){this.$eLI.removeClass("disabled");this.enabled=true;},disable:function(){this.$eLI.addClass("disabled");this.enabled=false;},destroy:function(){this.removeTimer();this.$eLI.remove();this.$eLI.unbind("mouseover").unbind("mouseout").unbind("click");if(this.subMenu){this.subMenu.destroy();delete this.subMenu;}this.parentMenu.removeItem(this);},addSubMenu:function(o){var n;if(this.subMenu){return;}this.subMenu=o;if(this.parentMenu&&h.inArray(o,this.parentMenu.subMenus)==-1){this.parentMenu.subMenus.push(o);}if(this.settings.arrowSrc){n=h(this.$eLI[0].firstChild);n.css({"background-repeat":"no-repeat","background-position":"99% 50%"});$ws.helpers.makeBackground(n,this.settings.arrowSrc);}},setText:function(n){this.$eLI.find("span").text(n);},setIcon:function(n){this.$eLI.css("background-image","url("+n+")");}}});h.extend(h.fn,{menuFromElement:function(o,q,p){var n=function(A){var t=[],x,s,D,B,w,C,z,v,u,y,r=null;D=i(A,"LI");for(w=0;w<D.length;w++){x=[];if(!D[w].childNodes.length){t.push(new h.MenuItem("",o));continue;}if((C=a(D[w],"UL"))){x=n(C);h(C).remove();}B=h(D[w]);if(B[0].childNodes.length==1&&B[0].childNodes[0].nodeType==3){z=B[0].childNodes[0].nodeValue;}else{z=B[0].childNodes;}if(o&&o.copyClassAttr){r=B.attr("class");}v=B.css("background-image");v=v=="none"?"":v;u=B.attr("id");y=B.hasClass("enable");s=new h.MenuItem({caption:z,id:u,addClass:r,imgSrc:v,enable:y,hasSubMenu:!!x.length},o);t.push(s);if(x.length){new h.Menu(s,x,o);}}return t;};return this.each(function(){var t,r;if(q||(t=a(this,"UL"))){t=q?h(q).clone(true)[0]:t;var s=n(t);if(s.length){r=new h.Menu(t,s,o,this);if(p){p.addMenu(r);}}h(this).click(function(){var w=this.childNodes[0].nodeValue,x=h(this).attr("class"),u=h(this).css("background-image"),y=h(this).attr("id"),v=new h.MenuItem({caption:w,id:y,addClass:x,imgSrc:u},o);if(h(this).hasClass("enable")&&o.onClick){o.onClick.call(this,v.id,v);}}).hover(function(u){if(h(this).hasClass("enable")&&o.onHoverIn){o.onHoverIn.call(u,h(this).attr("id"),this);}},function(u){if(h(this).hasClass("enable")&&o.onHoverOut){o.onHoverOut.call(u,h(this).attr("id"),this);}});h(t).hide();}else{h(this).click(function(){var w=this.childNodes[0].nodeValue,x=h(this).attr("class"),u=h(this).css("background-image"),y=h(this).attr("id"),v=new h.MenuItem({caption:w,id:y,addClass:x,imgSrc:u},o);if(h(this).hasClass("enable")&&o.onClick){o.onClick.call(this,v.id,v);}}).hover(function(u){if(h(this).hasClass("enable")&&o.onHoverIn){o.onHoverIn.call(u,h(this).attr("id"),this);}h.Menu.closeAll();if(typeof(this.show)==="function"){this.show(u);}},function(u){if(h(this).hasClass("enable")&&o.onHoverOut){o.onHoverOut.call(u,h(this).attr("id"),this);}});}});},menuBarFromUL:function(n){return this.each(function(){var p,o=i(this,"LI");if(o.length){var q=new h.MenuCollection();for(p=0;p<o.length;p++){h(o[p]).menuFromElement(n,null,q);}}});},menu:function(p,o){var n=this;return this.each(function(){if(o&&o.constructor===Array){c=n.Menu=new h.Menu(this,o,p);}else{if(this.nodeName.toUpperCase()=="UL"){n.Menu=h(this).menuBarFromUL(p);}else{n.Menu=h(this).menuFromElement(p,o);}}});},showMenu:function(o,p,n){this.Menu.onClick(o,true,p,n);},hideMenu:function(){this.Menu.hide();},getDefaultSettings:function(){return e;},getSubMenu:function(p){var n=null;for(var o in f){if(f.hasOwnProperty(o)){if(f[o].parentMenuItem===null&&f[o].target==p){n=f[o];}}}return n;},setEnabledById:function(r,n){var o;for(var q in f){if(f.hasOwnProperty(q)){o=f[q].menuItems;for(var p in o){if(o.hasOwnProperty(p)&&o[p].id===r){if(n){o[p].enable();}else{o[p].disable();}break;}}}}},addSubMenu:function(s,o,q){var n;for(var r in f){if(f.hasOwnProperty(r)){n=f[r].menuItems;for(var p in n){if(n.hasOwnProperty(p)&&n[p].id===s){new h.Menu(n[p],o,q);break;}}}}},hasSubMenu:function(q){var n;for(var p in f){if(f.hasOwnProperty(p)){n=f[p].menuItems;for(var o in n){if(n.hasOwnProperty(o)&&n[o].id===q){return n[o].subMenu!==null&&n[o].subMenu!==undefined&&n[o].subMenu.menuItems.length!==0;}}}}},destroySubMenu:function(u){var p;for(var r in f){if(f.hasOwnProperty(r)){p=f[r].menuItems;for(var q in p){if(p.hasOwnProperty(q)&&p[q].id===u){if(p[q].subMenu){var n=[];for(var t=0,o=p[q].subMenu.menuItems.length;t<o;t++){n.push(p[q].subMenu.menuItems[t].id);}p[q].subMenu.destroy();p[q].$eLI.find("div:first").css({background:"none"});delete p[q].subMenu;return n;}}}}}},isVisible:function(){if(this.Menu!==undefined){return this.Menu.visible;}return false;}});var a=function(p,o){if(!p){return null;}var q=p.firstChild;for(;q;q=q.nextSibling){if(q.nodeType==1&&q.nodeName.toUpperCase()==o){return q;}}return null;};var i=function(q,o){if(!q){return[];}var p=[],s=q.firstChild;for(;s;s=s.nextSibling){if(s.nodeType==1&&s.nodeName.toUpperCase()==o){p[p.length]=s;}}return p;};})(jQuery);