if(typeof(window)=="undefined"){window=undefined;}if(typeof(document)=="undefined"){document=undefined;}if(typeof(navigator)=="undefined"){navigator=undefined;}var nop=function(a){},retTrue=function(){return true;};if(typeof(window)=="undefined"||window.BOOMR===undefined){var dummySpan={stop:nop};BOOMR={page_ready:nop,plugins:{WS:{startSpan:function(a){return dummySpan;},reportError:nop,reportMessage:nop,reportEvent:function(d,c){return;}}},version:false};}(function(){var global=(function(){return this||(0,eval)("this");}());global.SBIS3={};global.SBIS3.CORE={};}());$ws=(function(){return{_const:{fasttemplate:true,nostyle:false,moscowTimeOffset:4*60,javaStartTimeout:60000,IDENTITY_SPLITTER:",",userConfigSupport:false,theme:"",appRoot:"/",resourceRoot:"/resources/",wsRoot:"/ws/",defaultServiceUrl:"/service/sbis-rpc-service300.dll",debug:window&&window.location.hash.indexOf("dbg")>0,compatibility:{placeholder:document&&!!("placeholder" in document.createElement("input")),fileupload:document&&(function(){var a=document.createElement("input");a.setAttribute("type","file");return !a.disabled;}()),correctKeyEvents:window&&(!window.opera||parseFloat(window.opera.version())>=12.1),cssAnimations:document&&(function(){var a=document.createElement("div").style;return a.transition!==undefined||a.mozTransition!==undefined||a.webkitTransition!==undefined;})(),fullScreen:document&&(function(){var a=document.createElement("div");return a.requestFullscreen!==undefined||a.mozRequestFullScreen!==undefined||a.webkitRequestFullscreen!==undefined;})(),wheel:document&&(function(){var a=document.createElement("div");return(a.onwheel!==undefined||document.documentMode>=9)?"wheel":a.onmousewheel!==undefined?"mousewheel":"DOMMouseScroll";})(),cssTransform:document&&(function(){var a=document.createElement("div");return a.style.transform!==undefined||a.style.msTransform!==undefined||a.style.oTransform!==undefined||a.style.mozTransform!==undefined||a.style.webkitTransform!==undefined;})()},browser:{isMobileSafari:navigator&&/(iPod|iPhone|iPad)/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&/Mobile\//.test(navigator.userAgent),isIE:navigator&&navigator.appVersion.indexOf("MSIE")!==-1,isIE7:navigator&&navigator.appVersion.indexOf("MSIE 7.")!==-1,isIE8:navigator&&navigator.appVersion.indexOf("MSIE 8.")!==-1,isIE9:navigator&&navigator.appVersion.indexOf("MSIE 9.")!==-1,isModernIE:!("\v"=="v")},buildnumber:"",resizeDelay:40,xmlPackages:{},jsPackages:{},xmlContents:{},htmlNames:{},hdlBindings:{},hosts:[],services:{},modules:{},jsCoreModules:{"SBIS3.CORE.Marker":"lib/Marker/Marker.module.js","SBIS3.CORE.NavigationController":"lib/NavigationController/NavigationController.module.js","SBIS3.CORE.Control":"lib/Control/Control.module.js","SBIS3.CORE.FileBrowse":"lib/Control/FileBrowse/FileBrowse.module.js","SBIS3.CORE.FileButton":"lib/Control/FileButton/FileButton.module.js","SBIS3.CORE.FileScaner":"lib/Control/FileScaner/FileScaner.module.js","SBIS3.CORE.Button":"lib/Control/Button/Button.module.js","SBIS3.CORE.Infobox":"lib/Control/Infobox/Infobox.module.js","SBIS3.CORE.InfoboxTrigger":"lib/Control/InfoboxTrigger/InfoboxTrigger.module.js","SBIS3.CORE.LoadingIndicator":"lib/Control/LoadingIndicator/LoadingIndicator.module.js","SBIS3.CORE.Paging":"lib/Control/Paging/Paging.module.js","SBIS3.CORE.PathSelector":"lib/Control/PathSelector/PathSelector.module.js","SBIS3.CORE.HierarchyView":"lib/Control/HierarchyView/HierarchyView.module.js","SBIS3.CORE.HierarchyCustomView":"lib/Control/HierarchyCustomView/HierarchyCustomView.module.js","SBIS3.CORE.TreeView":"lib/Control/TreeView/TreeView.module.js","SBIS3.CORE.HierarchyViewAbstract":"lib/Control/HierarchyViewAbstract/HierarchyViewAbstract.module.js","SBIS3.CORE.CustomView":"lib/Control/CustomView/CustomView.module.js","SBIS3.CORE.TableView":"lib/Control/TableView/TableView.module.js","SBIS3.CORE.DataViewAbstract":"lib/Control/DataViewAbstract/DataViewAbstract.module.js","SBIS3.CORE.Browser":"lib/Control/Browser/Browser.module.js","SBIS3.CORE.DataView":"lib/Control/DataView/DataView.module.js","SBIS3.CORE.ListView":"lib/Control/ListView/ListView.module.js","SBIS3.CORE.Suggest":"lib/Control/Suggest/Suggest.module.js","SBIS3.CORE.SwitcherAbstract":"lib/Control/SwitcherAbstract/SwitcherAbstract.module.js","SBIS3.CORE.Switcher":"lib/Control/Switcher/Switcher.module.js","SBIS3.CORE.SwitcherDouble":"lib/Control/SwitcherDouble/SwitcherDouble.module.js","SBIS3.CORE.Slider":"lib/Control/Slider/Slider.module.js","SBIS3.CORE.FieldDropdown":"lib/Control/FieldDropdown/FieldDropdown.module.js","SBIS3.CORE.FieldLabel":"lib/Control/FieldLabel/FieldLabel.module.js","SBIS3.CORE.FieldFormatAbstract":"lib/Control/FieldFormatAbstract/FieldFormatAbstract.module.js","SBIS3.CORE.FieldMonth":"lib/Control/FieldMonth/FieldMonth.module.js","SBIS3.CORE.FieldAbstract":"lib/Control/FieldAbstract/FieldAbstract.module.js","SBIS3.CORE.FieldString":"lib/Control/FieldString/FieldString.module.js","SBIS3.CORE.FieldText":"lib/Control/FieldText/FieldText.module.js","SBIS3.CORE.Menu":"lib/Control/Menu/Menu.module.js","SBIS3.CORE.FieldDate":"lib/Control/FieldDate/FieldDate.module.js","SBIS3.CORE.FieldDatePicker":"lib/Control/FieldDatePicker/FieldDatePicker.module.js","SBIS3.CORE.FiltersArea":"lib/Control/FiltersArea/FiltersArea.module.js","SBIS3.CORE.FiltersDialog":"lib/Control/FiltersDialog/FiltersDialog.module.js","SBIS3.CORE.FiltersWindow":"lib/Control/FiltersWindow/FiltersWindow.module.js","SBIS3.CORE.FloatArea":"lib/Control/FloatArea/FloatArea.module.js","SBIS3.CORE.RecordFloatArea":"lib/Control/RecordFloatArea/RecordFloatArea.module.js","SBIS3.CORE.FilterFloatArea":"lib/Control/FilterFloatArea/FilterFloatArea.module.js","SBIS3.CORE.FilterButton":"lib/Control/FilterButton/FilterButton.module.js","SBIS3.CORE.Master":"lib/Control/Master/Master.module.js","SBIS3.CORE.SchemeEditor":"lib/Control/SchemeEditor/SchemeEditor.module.js","SBIS3.CORE.TabTemplatedArea":"lib/Control/TabTemplatedArea/TabTemplatedArea.module.js","SBIS3.CORE.Tabs":"lib/Control/Tabs/Tabs.module.js","SBIS3.CORE.Grid":"lib/Control/Grid/Grid.module.js","SBIS3.CORE.RelativeGrid":"lib/Control/RelativeGrid/RelativeGrid.module.js","SBIS3.CORE.StackPanel":"lib/Control/StackPanel/StackPanel.module.js","SBIS3.CORE.Table":"lib/Control/Table/Table.module.js","SBIS3.CORE.Accordion":"lib/Control/Accordion/Accordion.module.js","SBIS3.CORE.NavigationPanel":"lib/Control/NavigationPanel/NavigationPanel.module.js","SBIS3.CORE.ToolBar":"lib/Control/ToolBar/ToolBar.module.js","SBIS3.CORE.FieldImage":"lib/Control/FieldImage/FieldImage.module.js","SBIS3.CORE.FieldLink":"lib/Control/FieldLink/FieldLink.module.js","SBIS3.CORE.FieldNumeric":"lib/Control/FieldNumeric/FieldNumeric.module.js","SBIS3.CORE.FieldInteger":"lib/Control/FieldInteger/FieldInteger.module.js","SBIS3.CORE.FieldMoney":"lib/Control/FieldMoney/FieldMoney.module.js","SBIS3.CORE.FieldRadio":"lib/Control/FieldRadio/FieldRadio.module.js","SBIS3.CORE.ProgressBar":"lib/Control/ProgressBar/ProgressBar.module.js","SBIS3.CORE.HTMLChunk":"lib/Control/HTMLChunk/HTMLChunk.module.js","SBIS3.CORE.MasterProgress":"lib/Control/MasterProgress/MasterProgress.module.js","SBIS3.CORE.GroupCheckBox":"lib/Control/GroupCheckBox/GroupCheckBox.module.js","SBIS3.CORE.OperationsPanel":"lib/Control/OperationsPanel/OperationsPanel.module.js","SBIS3.CORE.HTMLView":"lib/Control/HTMLView/HTMLView.module.js","SBIS3.CORE.DateRange":"lib/Control/DateRange/DateRange.module.js","SBIS3.CORE.FieldCheckbox":"lib/Control/FieldCheckbox/FieldCheckbox.module.js","SBIS3.CORE.ScheduleEditor":"lib/Control/ScheduleEditor/ScheduleEditor.module.js","SBIS3.CORE.ScheduleCalendar":"lib/Control/ScheduleCalendar/ScheduleCalendar.module.js","SBIS3.CORE.RecordArea":"lib/Control/RecordArea/RecordArea.module.js","SBIS3.CORE.GridAbstract":"lib/Control/GridAbstract/GridAbstract.module.js","SBIS3.CORE.Dialog":"lib/Control/Dialog/Dialog.module.js","SBIS3.CORE.DialogAlert":"lib/Control/DialogAlert/DialogAlert.module.js","SBIS3.CORE.DialogConfirm":"lib/Control/DialogConfirm/DialogConfirm.module.js","SBIS3.CORE.DialogRecord":"lib/Control/DialogRecord/DialogRecord.module.js","SBIS3.CORE.DialogSelector":"lib/Control/DialogSelector/DialogSelector.module.js","SBIS3.CORE.SimpleDialogAbstract":"lib/Control/SimpleDialogAbstract/SimpleDialogAbstract.module.js","SBIS3.CORE.Window":"lib/Control/Window/Window.module.js","SBIS3.CORE.ModalOverlay":"lib/Control/ModalOverlay/ModalOverlay.module.js","SBIS3.CORE.TemplatedArea":"lib/Control/TemplatedArea/TemplatedArea.module.js","SBIS3.CORE.TemplatedAreaAbstract":"lib/Control/TemplatedAreaAbstract/TemplatedAreaAbstract.module.js","SBIS3.CORE.AreaAbstract":"lib/Control/AreaAbstract/AreaAbstract.module.js","SBIS3.CORE.RaphaelMultiGraph":"lib/Control/RaphaelDrawer/RaphaelMultiGraph.module.js","SBIS3.CORE.RaphaelPieGraph":"lib/Control/RaphaelDrawer/RaphaelPieGraph.module.js","SBIS3.CORE.RaphaelChartGraph":"lib/Control/RaphaelDrawer/RaphaelChartGraph.module.js","SBIS3.CORE.RaphaelDrawerInternal":"lib/Control/RaphaelDrawer/RaphaelDrawerInternal.module.js","SBIS3.CORE.DragAndDropPlugin":"lib/Control/Plugins/ControlDragAndDrop-plugin.js","SBIS3.CORE.PLUGINS.ColorMarkPlugin":"lib/Control/Plugins/ColorMark-plugin.js"},jsModules:{},classLoaderMappings:{},startDragDistance:4},_handlers:{},core:{},helpers:{},java:{},proto:{},single:{},render:{defaultColumn:{leadZero:function(c,a){var b=""+Math.floor(c);if(b.length<a){b="00000000000000000000000000000000".substr(0,a-b.length)+b;}return b;},integer:function(g,b){try{g=String.trim(""+g);}catch(d){g="";}var a=/^-?([0]*)(\d+)\.?\d*\D*$/,c;if(!g.match(a)){return"0";}c=g.replace(a,"$2");return(g.substr(0,1)=="-"?"-":"")+(b?c:String.trim(c.replace(/(?=(\d{3})+$)/g," ")));},logic:function(c,a){var b='<span class="ws-browser-checkbox-logic '+(c+"")+'"></span>';return a?b:$(b);},money:function(a){return $ws.render.defaultColumn.real(a,2,true);},real:function(g,c,f){c=c===undefined?0:c;var e=(g=(g+"")).indexOf(".");if(c===0){return $ws.render.defaultColumn.integer(g,!f);}var d=g;if(e!=-1){d=g.substring(0,e);}var b=e!=-1?g.substr(e):0,h;if(b=="."){b=".0";}h=parseFloat(b).toFixed(c);if(h==1){d=parseInt(d,10)+1;}h=h.replace(/.+\./,"");var a=[];a.push($ws.render.defaultColumn.integer(d,!f));a.push(".");a.push(h);return a.join("");},timer:function(a){return Math.floor(a/1000)+"."+$ws.render.defaultColumn.leadZero(a%1000,3);},timestamp:function(c,g,a){var b="",h,f,i,j,e,k,d;if(c instanceof Date){h=c.getFullYear()%100;f=c.getMonth()+1;i=c.getDate();j=c.getHours();e=c.getMinutes();k=c.getSeconds();d=c.getMilliseconds();if(g!=="time"&&g!=="Время"){b=((i<10?"0":"")+i)+"."+((f<10?"0":"")+f)+"."+((h<10?"0":"")+h);}if(g in {timestamp:0,"Дата и время":0,time:0,"Время":0}){b+=g in {time:0,"Время":0}?"":" ";b+=((j<10?"0":"")+j)+":"+((e<10?"0":"")+e);b+=":"+(k<10?"0":"")+k;if(a===true){if(d>0){if(d<10){b+=".00"+d;}else{if(d<100){b+=".0"+d;}else{b+="."+d;}}}else{b+=".000";}}}}else{b="&minus;";}return b;},enumType:function(b){if(b instanceof $ws.proto.Enum){var a=b.getCurrentValue();if(a===null){return"";}return b.getValues()[b.getCurrentValue()];}return"";},flags:function(a){var b=[];a.each(function(d,c){if(c){b.push(d);}});if(b.length){return b.join(", ");}return"&minus;";},isNumeric:function(b){var a={xid:0,oid:0,int2:0,int4:0,int8:0,float4:0,float8:0};return a[b]===0;},isText:function(a){return a.indexOf("char")!==-1||a=="text";}}}};})();$ws._const.applets={fileSystemApplet:function(){if($ws._const.browser.isIE){var a=navigator.platform=="Win32"?"x86":"x64";return{type:"activex",classid:"clsid:0D00709F-ED6D-4A2F-B1C0-77A0019E4429",archive:[$ws._const.resourceRoot+"/FileChooser-"+a+".cab#version=1,0,4,3"],width:0,height:0};}else{if(navigator.platform.indexOf("Win")!=-1){return{type:"npapi",appletname:"SbisPlugin",mimetype:"application/x-sbis-plugin",width:0,height:0};}else{return{type:"java",codebase_lookup:"false",code:"ru.tensor.fileapi.FileSystemAPI",archive:["res/jar/file.jar"],width:0,height:0};}}},fileUploadApplet:function(){if($ws._const.browser.isIE){var a=navigator.platform=="Win32"?"x86":"x64";return{type:"activex",alias:"fileSystemApplet",classid:"clsid:0D00709F-ED6D-4A2F-B1C0-77A0019E4429",archive:[$ws._const.resourceRoot+"/FileChooser-"+a+".cab#version=1,0,4,3"],width:0,height:0};}else{if(navigator.platform.indexOf("Win")!=-1){return{type:"npapi",appletname:"SbisPlugin",mimetype:"application/x-sbis-plugin",alias:"fileSystemApplet",width:0,height:0};}else{return{type:"java",codebase_lookup:"false",code:"ru.tensor.uploader.Upload",archive:["res/jar/uploader.jar"],width:0,height:0,postName:"file1"};}}},fileChooserApplet:function(){if($ws._const.browser.isIE){var a=navigator.platform=="Win32"?"x86":"x64";return{type:"activex",alias:"fileSystemApplet",classid:"clsid:0D00709F-ED6D-4A2F-B1C0-77A0019E4429",archive:[$ws._const.resourceRoot+"/FileChooser-"+a+".cab#version=1,0,4,3"],width:0,height:0};}else{if(navigator.platform.indexOf("Win")!=-1){return{type:"npapi",mimetype:"application/x-sbis-plugin",appletname:"SbisPlugin",alias:"fileSystemApplet",width:0,height:0};}else{return{type:"java",codebase_lookup:"false",code:"ru.tensor.uploader.Chooser",archive:["res/jar/uploader.jar"],width:0,height:0};}}},scannerApplet:function(){if($ws._const.browser.isIE){var a=navigator.platform=="Win32"?"x86":"x64";return{type:"activex",classid:"CLSID:B461F8A3-7F40-4282-ABE4-C9408EB1824B",archive:[$ws._const.resourceRoot+"/scan-activex-"+a+".cab#version=1,0,2,8"],width:"100%",height:"99%"};}else{return{codebase_lookup:"false",code:"ru.tensor.webscan.scanner.ScannerUI",archive:["res/jar/scanner.jar","res/jar/scannerutils.jar"],width:"100%",height:"99%"};}},scannerAppletHidden:function(){if($ws._const.browser.isIE){var a=navigator.platform=="Win32"?"x86":"x64";return{type:"activex",classid:"CLSID:B461F8A3-7F40-4282-ABE4-C9408EB1824B",archive:[$ws._const.resourceRoot+"/scan-activex-"+a+".cab#version=1,0,2,8"],position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px"};}else{return{codebase_lookup:"false",code:"ru.tensor.webscan.scanner.ScannerUI",archive:["res/jar/scanner.jar","res/jar/scannerutils.jar"],position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px"};}}};$ws.single.ioc=(function(){var b={},a={};return{bind:function(c,d){b[c]={implementation:d,isSingle:0};},bindSingle:function(d,e,c){b[d]={implementation:e,isSingle:1,config:c||{}};a[d]="";},resolve:function(e,d){if(e in b){var g=b[e],c=g.implementation,f=g.isSingle;if(f&&a[e]){return a[e];}if(typeof c=="function"){return c(d);}if(typeof($ws.proto[c])=="function"){if(f){return a[e]=new $ws.proto[c](g.config);}else{return new $ws.proto[c](d);}}else{throw new TypeError("Implementation "+c+" is not defined");}}else{throw new ReferenceError("No mappings defined for "+e);}}};})();$ws.core={merge:function(d,b,a){if(a===undefined){a={};}a.preferSource=a.preferSource!==undefined?a.preferSource:false;a.rec=a.rec!==undefined?a.rec:true;a.clone=a.clone!==undefined?a.clone:false;a.create=a.create!==undefined?a.create:true;a.noOverrideByNull=a.noOverrideByNull!==undefined?a.noOverrideByNull:false;var e=function(f){if((typeof(b[f])=="object"&&b[f]!==null)&&a.clone){d[f]=$ws.core.merge(b[f] instanceof Array?[]:{},b[f],a);}else{if(!(b[f]===null&&a.noOverrideByNull)){d[f]=b[f];}}};if(typeof(d)=="object"&&d!==null&&typeof(b)=="object"&&b!==null){for(var c in b){if(b.hasOwnProperty(c)){if(d[c]===undefined){if(a.create){if(b[c]===null){d[c]=null;}else{e(c);}}}else{if(!a.preferSource){if(d[c]&&typeof d[c]=="object"&&typeof b[c]=="object"){if(d[c] instanceof Date){if(b[c] instanceof Date){d[c]=a.clone?new Date(+b[c]):b[c];continue;}d[c]=b[c] instanceof Array?[]:{};}else{if(b[c] instanceof Date){d[c]=a.clone?new Date(+b[c]):b[c];continue;}}d[c]=a.rec?$ws.core.merge(d[c],b[c],a):b[c];}else{e(c);}}else{if(typeof d[c]=="object"&&typeof b[c]=="object"&&a.rec){d[c]=$ws.core.merge(d[c],b[c],a);}}}}}}else{if(!(b===null&&a.noOverrideByNull)&&!a.preferSource){d=b;}}return d;},clone:function(b){b={v:b};var a=$ws.core.merge({},b,{clone:true});return a.v;},extend:function(b,h){var k=h.$protected,g=Object.prototype.toString;if(!k){k=h.$protected={};}var l=b.prototype&&b.prototype.$protected;if(!("_needOptionsOverrideData" in k)&&l&&("_needOptionsOverrideData" in l)){k._needOptionsOverrideData=l._needOptionsOverrideData;}function a(m,i){function n(p,r){if(m&&p in m){for(var q in m[p]){if(m[p].hasOwnProperty(q)&&q in i){var o=m[p][q];this._options[q]=$ws.core.merge(o instanceof Array?[]:{},o,{clone:true});this._options[q]=$ws.core.merge(this._options[q],i[q],{noOverrideByNull:!r});delete i[q];}}}}n.call(this,"_options",false);n.call(this,"_nullable",true);}function c(p,o){function m(q){return(typeof(q)==="object")&&(g.call(q)==="[object Object]");}function n(q,s,r){q[r]=s;if(m(s)){for(var t in s){if(s.hasOwnProperty(t)){q=n(q,s[t],r+"."+t);}}}return q;}function i(w,z,u,A,t){var r,x,s,q,y;for(r in u){if(u.hasOwnProperty(r)){q=z&&(r in z)&&!(r in w);y=q?z:w;x=u[r];if(x!==null){if(r in y){s=y[r];if(A===null){A={};}if(q){A=n(A,s,t+r);}else{if(m(x)){A[t+r]=s;if(m(s)){A=i(s,null,x,A,t+r+".");}}else{A=n(A,s,t+r);}}}}else{if(q){if(A===null){A={};}A=n(A,z[r],t+r);}}}}return A;}return p&&p._options&&i(p._options,p._nullable,o,null,"");}h.$constructor=(function(o,n){var p={parent:o.prototype?o.prototype.$constructor:null,child:n.$constructor},i=n.$protected;return function m(s,q){q=q||i._needOptionsOverrideData;this._goUp=this._goUp||1;$ws.core.merge(this,i,{clone:true,preferSource:true});if(i&&i._nullable){if(!("_options" in this)){this._options={};}$ws.core.merge(this._options,i._nullable,{clone:true,preferSource:true});}delete this._nullable;if(s){if(q){var w=c(i,s),u,t;if(w){t=this["_optionsOverriden"];if(!t){this["_optionsOverriden"]=w;}else{for(u in w){if(w.hasOwnProperty(u)){t[u]=w[u];}}}}}a.call(this,i,s);}if(p.parent){this._goUp++;p.parent.call(this,s,q);}if(p.child){var v=p.child.call(this,s);if(v){return v;}}--this._goUp;if(this._goUp===0&&"_allowEvents" in this){this._allowEvents();}return undefined;};})(b,h);var d=function(){},e=h.$constructor;d.prototype=b.prototype;e.prototype=new d();for(var f in h){if(h.hasOwnProperty(f)&&f!="$constructor"){e.prototype[f]=h[f];}}if("\v"=="v"){var j=["valueOf","toString"];for(f=0;f<j.length;f++){if(h.hasOwnProperty(j[f])){e.prototype[j[f]]=h[j[f]];}}}e.prototype.$constructor=h.$constructor;e.extend=function(i){return $ws.core.extend(this,i);};e.extendPlugin=function(i){return $ws.core.extendPlugin(this,i);};e.superclass=b.prototype;return e;},extendPlugin:function(b,g){if(!Object.isEmpty(g.$protected)){$ws.core.merge(b.prototype.$protected,g.$protected,{clone:true,preferSource:true});}g.$withoutCondition=$ws.core.hash(g.$withoutCondition||[]);function c(i,k){var l;if(b.prototype.hasOwnProperty(i)){l=b.prototype[i];}else{if(b.superclass){l=function(){var m=b.superclass[i];if(m){return m.apply(this,arguments);}};}}if(l){if(g.$condition&&g.$withoutCondition[i]===undefined){b.prototype[i]=l.callNextWithCondition(k,g.$condition);}else{b.prototype[i]=l.callNext(k);}}}function d(k,i){if(b.prototype[k]){c(k,i);}else{if(g.$condition){b.prototype[k]=g.$withoutCondition[k]===undefined?i.callIf(g.$condition):i;}else{b.prototype[k]=i;}}}for(var e in g){if(g.hasOwnProperty(e)&&!(e in {"$constructor":true,"$protected":true,init:true,"$condition":true,"$withoutCondition":true})){d(e,g[e]);}}if("\v"=="v"){var h=["valueOf","toString"];for(e=0;e<h.length;e++){if(g.hasOwnProperty(h[e])){d(h[e],g[h[e]]);}}}if(g.$constructor){c("init",g.$constructor);var f=g.$constructor,j=$ws.single.ControlStorage.getControls();for(var a in j){if(j.hasOwnProperty(a)){if(j[a] instanceof b){f.apply(j[a]);}}}}},hash:function(){var b=arguments.length>1?Array.prototype.slice.call(arguments):arguments[0],c={};if(b instanceof Array||b instanceof Object){for(var a in b){if(b.hasOwnProperty(a)){if(typeof b[a] in {"boolean":null,number:null,string:null}){c[""+b[a]]=a;}}}}return c;},unpack:function(c){var e=[c],b=$ws.core.hash(arguments[1]!==undefined?arguments[1]:["array","object","function"]),f;do{var l=[];f=true;for(var d=0,h=e.length;d<h;d++){var k=e[d],a,g;f=false;if(k instanceof Function&&"function" in b){l.push(k());}else{if(k instanceof Array&&"array" in b){for(a=0,g=k.length;a<g;a++){l.push(k[a]);}}else{if(k instanceof Object&&!(k instanceof Function)&&!(k instanceof Array)&&"object" in b){for(a in k){l.push(k[a]);}}else{f=true;l.push(k);}}}}e=l;}while(!f);return e;},extractComponentPath:function(b){var a;b=$ws.single.ClassMapper.getClassMapping(b);if(b.indexOf(":")==-1){b=b.split("/");b.push(a=b.pop());if(a.indexOf("@")!=-1){a=a.split("@").pop();}}else{b=b.split(":");a=b.pop();b=b.pop().split("/");}return{component:b.join("/"),className:a};},dependenciesResolve:function(d,a){function c(e,h){var g=$ws.core.extractComponentPath(h),f=$ws._const.jsCoreModules[g.className]?g.className:"SBIS3.CORE."+g.className;if($ws._const.jsCoreModules[f]){e.push($ws.requireModule(f));}else{if(h.charAt(0)=="/"){e.push($ws.core.attach($ws._const.wsRoot+h.substring(1)).addCallback(function(i){return b($ws.single.DependencyResolver.resolve(i,a));}.bind(undefined,h)));}else{e.push($ws.core.attachComponent($ws.core.extractComponentPath(h).component).addCallback(function(i){return b($ws.single.DependencyResolver.resolve(i,a));}.bind(undefined,h)));}}}function b(f){var e=new $ws.proto.ParallelDeferred();$ws.helpers.forEach(f,c.bind(undefined,e));return e.done().getResult();}return b($ws.single.DependencyResolver.resolve(d,a));},attachInstance:function(e,b,g){function c(j,i){if(typeof j=="function"){var h=new j(i);if(h instanceof $ws.proto.Abstract){h.init();}return h;}else{return false;}}var f=$ws.core.extractComponentPath(e);var a=f.className,d=$ws._const.jsCoreModules[a]?a:"SBIS3.CORE."+a;if($ws._const.jsCoreModules[d]){e=d;return $ws.requireModule(e).createDependent().addCallback(function(h){return $ws.core.dependenciesResolve(e,b).addCallback(function(){return c(h[0],b)||new Error("Module "+d+" didn't exports any class");});});}return $ws.core.attachComponent(f.component).createDependent().addCallback(function(){return $ws.core.dependenciesResolve(e,b);}).addCallback(function(){var i=$ws.proto;var h=f.className;if(h.indexOf(".")!=-1){var j=h.split(".");while(j.length){i=i[j.shift()];}}else{i=i[h];}return c(i,b)||new Error("Can't instantiate class '"+h+"'. Class is not exists");});},attachComponent:function(b,c){var a;if(!c){c="";a=$ws._const.resourceRoot;}else{a="/";}return $ws.single.Storage.store(b,function(g){var d=b.split("/"),f=new $ws.proto.CodeChain(d.length),e=d.length-1;while(d.length>0){(function(m,j){var l,h;if(m.indexOf("@")!=-1){m=m.split("@");var k=m.shift();if(k in $ws._const.modules){k=$ws._const.modules[k];}l=c+a+k+"/";}else{l=c+$ws._const.wsRoot;}h=$ws.core.checkPackages(l+"lib/"+m+".js");var i=$ws.single.Storage.isStored(h);$ws.single.Storage.store(h,function(n){n.dependOn($ws.single.ioc.resolve("ITransport",{url:$ws.core.urlWithHost(h)}).execute(null));}).addCallback(function(n){if(f.setCode(j,i?"":n)){g.callback();}return"";}).addErrback(function(n){g.errback(new Error("Building failed. Reason: "+n.message+". Component: "+b+". File: "+h));return n;});})(d.join("/"),e--);d.pop();}return g;});},getHandlerInfo:function(a){var j=a.substring(0,1),k=a.split("/"),f=k.pop(),g=k.pop(),b=(j=="."||j=="/")?"":($ws._const.wsRoot+"res/hdl/"),c=".hdl",i=false,e,h,d;h=k.pop();if(h||h===""){k.push(h);}if(h!="render"){h="_handlers";}if(g in $ws._const.jsCoreModules||g in $ws._const.jsModules){k.push($ws._const.jsCoreModules[g]||$ws._const.jsModules[g]);if($ws._const.jsModules[g]){b="/resources/";}else{b=$ws._const.wsRoot;}e=d=g;i=true;}else{k.push(g+c);e=b+k.join("/");k.pop();k.push(g+c);d=b+k.join("/");}if(e.indexOf("/resources/")===0){e=e.replace("/resources/",$ws._const.resourceRoot);}if(d.indexOf("/resources/")===0){d=d.replace("/resources/",$ws._const.resourceRoot);}if(c&&$ws._const.buildnumber&&d.indexOf(".v"+$ws._const.buildnumber)==-1){d=d.replace(c,".v"+$ws._const.buildnumber+c);}return{type:h,name:f,"package":e,url:d,isModule:i};},getHandlerPackage:function(name){var urlSpec=$ws.core.getHandlerInfo(name),url=urlSpec.url;return $ws.single.Storage.store("hdlpack://"+url,function(dResult){(function(){if(urlSpec.isModule){return $ws.requireModule(url).addCallback(function(mods){return mods[0];});}else{return $ws.single.ioc.resolve("ITransport",{url:url}).execute(null).addCallback(function(data){var hdl=null;if(!$ws._const.browser.isIE){var sourceURL=url.substr(url.lastIndexOf("/")+1);data+="\n//# sourceURL="+sourceURL;if(data.indexOf("//@ sourceURL")!==-1){data=data.replace(/\/\/@ sourceURL[^\n]+/,"");}data+="\n//@ sourceURL="+sourceURL;}eval(data);return hdl;});}}()).addCallbacks(function(hdl){for(var f in hdl){if(hdl.hasOwnProperty(f)&&typeof hdl[f]=="function"){hdl[f].wsHandlerPath=urlSpec["package"].replace(".hdl","")+"/"+f;}}$ws[urlSpec.type][urlSpec["package"]]=hdl;dResult.callback(hdl);},function(res){res.message="getHandler failed ("+name+"). Reason: "+res.message;dResult.errback(res);});});},getHandler:function(d){var g=$ws.core.getHandlerInfo(d),e=g.type,f=new $ws.proto.Deferred(),c=g.name,a=g["package"],b=function(i,h,j){return $ws[i][h]&&typeof($ws[i][h][j])=="function";};if(typeof($ws[e][a])=="object"){if(b(e,a,c)){f.callback($ws[e][a][c]);}else{f.errback(new Error("getHandler failed: package is loaded but function is not present ("+d+")"));}}else{$ws[e][a]="";f.dependOn($ws.core.getHandlerPackage(d)).addCallback(function(){if(b(e,a,c)){return $ws[e][a][c];}else{throw new Error("getHandler failed: package is loaded but function is not present ("+d+")");}});}return f;},checkPackages:function(b){var a=b.replace($ws._const.wsRoot,"/");var c=$ws._const.jsPackages;return c[a]?($ws._const.wsRoot+c[a]):b;},urlWithHost:function(b){var a=$ws._const.hosts.length,c="";if(a>0){c=$ws._const.hosts[Math.floor(Math.random()*a)];if(b.substring(0,1)=="."){var d=window.location.pathname;d=d.substring(0,d.lastIndexOf("/")+1);b=c+d+b.substring(2);}else{b=c+(b.substring(0,1)=="/"?"":"/")+b;}}if($ws._const.buildnumber&&b.indexOf(".v"+$ws._const.buildnumber)==-1){b=b.replace(/(\.js|\.css|\.xml)/,".v"+$ws._const.buildnumber+"$1");}return b;},attach:function(a,b){a=$ws.core.checkPackages(a);if(a.charAt(0)!=="/"){a=$ws._const.wsRoot+a;}a=$ws.core.urlWithHost(a);return $ws.single.Storage.store(a,function(c){$ws.single.ioc.resolve("IAttachLoader").attach(a,c,b);});},attachSequentally:function(c){c=c||[];c=c instanceof Array?c:[c];var b=new $ws.proto.Deferred();(function a(){if(c.length){$ws.core.attach(c.shift()).addCallbacks(a,function(d){b.errback(d);});}else{b.callback();}})();return b;},withComponents:function(){var a=$ws.core.unpack(Array.prototype.slice.call(arguments));return $ws.core.ready.addCallback(function(){var f=new $ws.proto.ParallelDeferred();for(var e=0,b=a.length;e<b;e++){var g=$ws.core.extractComponentPath(a[e]);var c=g.className,d=$ws._const.jsCoreModules[c]?c:"SBIS3.CORE."+c;(function(h){if($ws._const.jsCoreModules[h]){f.push($ws.requireModule(h).createDependent().addCallback(function(){return $ws.core.dependenciesResolve(h,null);}));}else{f.push($ws.core.attachComponent(a[e]));}})(d);}return f.done().getResult();});},alert:function(e,d,c){var b=new $ws.proto.Deferred(),a={error:0,success:0,info:0};if(arguments.length==2&&d in a){c=d;d="";}$ws.core.attachInstance("SBIS3.CORE.DialogAlert",{message:e,detail:d,type:c,handlers:{onAfterClose:function(){b.callback();}}});return b;},getNamedContents:function(a){var b=a.lastIndexOf("/");if(b!=-1){a=a.substring(b+1);}return $ws._const.hdlBindings[a]||[];},setCursor:function(a){$("body").toggleClass("ws-progress",!a);},getServiceByName:function(a){return $ws._const.services[a]||$ws._const.defaultServiceUrl;},loadContents:function(d,c){if(c===undefined){c=false;}if(c){$ws._const.hosts=[];$ws._const.jsPackages={};$ws._const.xmlPackages={};$ws._const.xmlContents={};$ws._const.hdlBindings={};$ws._const.services={};$ws._const.modules={};$ws._const.htmlNames={};$ws._const.jsModules={};}if(d){if(d.jsModules){$ws._const.jsModules=$ws.core.merge($ws._const.jsModules,d.jsModules);}if(d.services){$ws._const.services=d.services;}if(d.modules){$ws._const.modules=d.modules;}if(d.hosts){if(d.hosts instanceof Array){$ws._const.hosts=d.hosts;}else{throw new Error("window.contents.hosts has an illegal format");}}var h=["xmlPackages","jsPackages","htmlNames"];for(var b=0,a=h.length;b<a;b++){var g=h[b];if(g in d){$ws._const[g]=$ws._const[g]||{};for(var e in d[g]){if(d[g].hasOwnProperty(e)){$ws._const[g][e]=d[g][e];}}}}$ws._const.xmlContents=d.xmlContents||{};$ws._const.hdlBindings=d.hdlBindings||{};}},classicExtend:function(b,a){var c=function(){};c.prototype=a.prototype;b.prototype=new c();b.prototype.constructor=b;b.superclass=a.prototype;},appendAuthError:function(a){if(typeof a=="function"){$ws.core._authError=a;}},appAdminIsInstalled:(function(){var a;return function(){if($ws._const.appAdminInstall===undefined){return $ws.core.withComponents("Source").addCallback(function(){if(!a){a=new $ws.proto.BLObject("Платформа");}return a.call("СервисУправленияПриложениемУстановлен",{},$ws.proto.BLObject.RETURN_TYPE_ASIS).addCallback(function(b){$ws._const.appAdminInstall=b;return b;});});}else{return new $ws.proto.Deferred().callback($ws._const.appAdminInstall);}};})()};$ws.single.ClassMapper={_mapping:{},setClassMapping:function(c,b){if(typeof c=="string"){this._mapping[c]=b;}else{if(c!==null&&Object.isValid(c)){for(var a in c){if(c.hasOwnProperty(a)){this._mapping[a]=c[a];}}}}},getClassMapping:function(a){return this._mapping[a]||a;},resetClassMapping:function(a){delete this._mapping[a];},restoreDefaultClassMapping:function(){this._mapping={};}};$ws.single.BackgroundMapper={_imageCounter:0,_imageMapping:{},imageClass:function(a){return this._imageMapping[a];},addImage:function(a){return this._imageMapping[a]=("ws-background-"+(this._imageCounter++));},hasImage:function(a){return this._imageMapping[a]!==undefined;}};$ws.java={installed:null,applets:{},attrs:{id:0,"class":0,title:0,style:0,width:0,height:0},axOuterAttrs:{width:0,height:0},axSkipAttrs:{guui:0,mayscript:0,id:0,java_arguments:0,classid:0,archive:0,element:0},types:{java:"_writeAppletTag",activex:"_writeActiveXTag",npapi:"_writeNPPluginTag"},checker:{npapi:"_checkNPApi"},canStartComponent:function(b){var a,c;if(b in $ws._const.applets){a=typeof $ws._const.applets[b]=="function"?$ws._const.applets[b]():$ws._const.applets[b];c=a.type||"java";return(this[this.checker[c]]||retTrue)(a.appletname);}else{return false;}},_checkNPApi:function(a){navigator.plugins.refresh();var c=false;switch(a){case"fileSystemApplet":case"SbisPlugin":for(var b=9;b<=10;b++){if(c){break;}c=!!navigator.plugins["SbisPluginv1.0.0."+b];}break;default:c=!!navigator.plugins[a];break;}return c;},_processArchives:function(b,e,c){if(b){if(!(b instanceof Array)){b=[b];}for(var d=0,a=b.length;d<a;d++){if(c&&b[d].charAt(0)!="/"){b[d]=$ws._const.wsRoot+b[d];}if(b[d].indexOf("#")==-1){b[d]+=$ws.helpers.randomId("?"+e+"_");}}}},runApplet:function(o,i,g){if($ws._const.browser.isMobileSafari){j=new Error("На данном устройстве невозможен запуск Java");j.notSupportedByDevice=true;return new $ws.proto.Deferred().errback(j);}var f=new $ws.proto.Deferred(),b=typeof o=="object"&&"code" in o?o.code:o,c=typeof o=="object"&&"id" in o?o.id:new Date().getTime(),m,j;if(arguments.length==2&&typeof i=="boolean"){g=i;}if(typeof o=="string"){if(o in $ws._const.applets){o=typeof $ws._const.applets[o]=="function"?$ws._const.applets[o]():$ws._const.applets[o];this._processArchives(o.archive,c,true);}else{$ws.single.ioc.resolve("ILogger").error("runApplet","invalid attributes for the applet");return;}}else{if(o.archive){this._processArchives(o.archive,c);}}if(g===false){var h=$ws.java.getByName(o.alias||b,true);if(h instanceof $ws.proto.Deferred){return h;}}m=o.type||"java";delete o.type;if(!(this[this.checker[m]]||retTrue)(o.appletname)){j=new Error("Запуск запрошенного компонента невозможен. Требуется плагин.");j.noPluginInstalled=true;return new $ws.proto.Deferred().errback(j);}o.id=o.appletId=c;o.guui=c;o.width=o.width||0;o.height=o.height||0;o.mayscript="true";o.java_arguments="-Xms64m -Xmx256m -Xss<128M>";var n=BOOMR.plugins.WS.startSpan("runApplet:"+o.code);f.addCallback(function(d){n.stop();return d;});var a=setTimeout(function(){BOOMR.plugins.WS.reportMessage(o.code+" start timeout");if(!f.isReady()){f.errback("Java-апплет не смог запуститься за разумное время ("+($ws._const.javaStartTimeout/1000)+" сек.)");}},$ws._const.javaStartTimeout);$ws.java.applets[c]={name:b,def:f,timeout:a};try{var l=document.createElement("div");l.className="ws-object-holder";$(l).css({width:o.width?o.width:0,height:o.height?o.height:0});if(o.position){$(l).css({position:o.position,top:o.top,left:o.left});}$((i&&i.element)||"html").get(0).appendChild(l);l.innerHTML=this[this.types[m]](o,i);}catch(k){$ws.single.ioc.resolve("ILogger").error("runApplet",k.message);}$(window).unload(function(){$ws.java.destroy(c);});return f.createDependent();},runAppletWithJsVersionCheck:function(a,e,f,b){var c=this,d=arguments;if(!(a instanceof Array)){a=[a];}return $ws.helpers.checkJavaVersionNotLessThan(a).addCallback(function(g){if(g){throw new Error(g);}else{return c.runApplet.apply(c,Array.prototype.slice.call(d,1));}});},destroy:function(c){var b=this.applets[c];if(b&&c){$("#Obj"+c).empty().remove();$("#Emb"+c).empty().remove();$("#AcX"+c).empty().remove();}delete this.applets[c];},getByName:function(a,f){for(var c in this.applets){if(this.applets.hasOwnProperty(c)){if(this.applets[c].name==a){var g=document.getElementById("Obj"+c);if(!g||!("ping" in g)){g=document.getElementById("Emb"+c);if((!g||!("ping" in g))&&$.browser.msie){g=document.getElementById("AcX"+c);}}if(!g){this.destroy(c);return false;}var d="";try{if((!g||!("ping" in g))&&f){return this.applets[c].def.createDependent().addCallback(function(){return $ws.java.getByName(a);});}d=g.ping();if(d=="pong"){if(f){return this.applets[c].def.createDependent().addCallback(function(){return $ws.java.getByName(a);});}else{return g;}}else{this.destroy(c);return false;}}catch(b){this.destroy(c);return false;}}}}return false;},init:function(){if(window){window.___ws_java_callback=this._callback.bind(this);if($ws._const.browser.isIE){window.___ws_java_callback=window.___ws_java_callback.debounce(42);}}},_callback:function(c){var b=this.applets[c.substring(3)];if(b){if(b.timeout){clearTimeout(b.timeout);}if(b.def&&(b.def instanceof $ws.proto.Deferred)){if(!b.def.isReady()){b.def.callback(document.getElementById(c));}else{$ws.single.ioc.resolve("ILogger").log("Java","Java-апплет ответил позднее отведенного ему времени");}}}},_writeActiveXTag:function(c,d){var b=this;d=d||{};if(!(c.archive instanceof Array)){c.archive=[c.archive];}var a=["<object ",'classid="',c.classid,'" ','id="AcX',c.id,'" ','CODEBASE="',c.archive[0],'" '];$ws.helpers.forEach(c,function(f,e){if(!(e in b.axSkipAttrs)){if(e in b.axOuterAttrs){a.push(e,'="',f,'" ');}else{d[e]=f;}}});a.push(">");$ws.helpers.forEach(d,function(f,e){if(e=="appletId"){f="AcX"+f;}a.push(['<param name = "',e,'" value="',f,'" ',"/>"].join(""));});a.push("</object>");return a.join("");},_writeNPPluginTag:function(c,g){var b=['<param name="onload" value="___ws_java_callback" />'],e="</object>",f=[],a='<object type="'+c.mimetype+'"';function d(j,i){var h;if(j instanceof Array){h=j.join(", ");}else{h=j;}if(!(i in $ws.java.attrs)){if(i=="id"||i=="guui"||i=="appletId"){b.push(['<param name="',i,'" value="',"Obj"+h,'"/>'].join(""));}else{b.push(['<param name="',i,'" value="',h,'"/>'].join(""));}}else{if(i=="id"||i=="guui"||i=="appletId"){f.push([i,'="',"Obj"+h,'" '].join(""));}else{f.push([i,'="',h,'" '].join(""));}}}$ws.helpers.forEach(c,d);$ws.helpers.forEach(g,d);return[a,f.join(""),">",b.join(""),e].join("");},_writeAppletTag:function(f,j){var c="application/x-java-applet;version=1.6",k='<object codetype="application/java" classid="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93" ',a="</object>",d=['<embed type="',c,'" '].join(""),e="</embed>",i=[],b=[],h=[];h.push(['<param name="type" value="',c,'"/>'].join(""));function g(n,m){var l;if(n instanceof Array){l=n.join(", ");}else{l=n;}if(!(m in $ws.java.attrs)){if(m=="id"||m=="guui"||m=="appletId"){h.push(['<param name="',m,'" value="',"Obj"+l,'"/>'].join(""));}else{h.push(['<param name="',m,'" value="',l,'"/>'].join(""));}}else{if(m=="id"||m=="guui"||m=="appletId"){i.push([m,'="',"Obj"+l,'" '].join(""));}else{i.push([m,'="',l,'" '].join(""));}}if(m=="id"||m=="guui"||m=="appletId"){b.push([m,'="',"Emb"+l,'" '].join(""));}else{b.push([m,'="',l,'" '].join(""));}}$ws.helpers.forEach(f,g);$ws.helpers.forEach(j,g);return[k,i.join(""),">",h.join(""),"<comment>",[d,b.join(""),">",e].join(""),"</comment>",a].join("");},isJavaInstalled:function(){if(this.installed!==null){return this.installed;}else{return(this.installed=!!this._isPluginInstalled());}},installJavaDialog:function(){return $ws.core.alert("На Вашем компьютере не установлена JAVA","Для установки java перейдите по <a target='_blank' href='http://www.java.com/download'>ссылке</a>");},_isPluginInstalled:function(){if($.browser.msie){return navigator.javaEnabled();}if(navigator.mimeTypes!==null){var a;for(a=0;a<navigator.mimeTypes.length;a++){if(navigator.mimeTypes[a].type=="application/x-java-applet"){return navigator.mimeTypes[a].enabledPlugin;}}}return false;}};$ws.helpers={generateURL:function(a,h,n,l,o,j,m,q,f,d,k,i){BOOMR.plugins.WS.reportEvent("ws.helpers","generateURL");if(o&&($ws._const.htmlNames[o]||$ws._const.xmlContents[o])){var c=!!(h),p=k&&Object.prototype.toString.call(k)=="[object Object]",r={id:j,hierMode:c,pk:a,copy:l||false,readOnly:m||false,obj:q.readerParams.linkedObject,_events:{}},e,g;if($ws._const.htmlNames[o]){var b=$ws._const.htmlNames[o].split("/");g=b[b.length-1];}else{e=$ws._const.xmlContents[o].split("/");g=$ws._const.appRoot+e[e.length-1]+".html";}if(q.readerParams.format!==undefined){r.format=q.readerParams.format;}if(q.readerType&&q.readerType!=="ReaderUnifiedSBIS"){r.type=q.readerType;}if(q.readerParams.otherURL&&q.readerParams.otherURL!==$ws._const.defaultServiceUrl){r.url=q.readerParams.otherURL;}if(q.readerParams.dbScheme){r.db=q.readerParams.dbScheme;}if(q.readerParams.queryName&&q.readerParams.queryName!=="Список"){r.method=q.readerParams.queryName;}if(c){r.branch=h;r.pId=n;if(i){r.pIdCol=i;}}if(a===undefined){r.filter=f;r._events.onBeforeCreate=p&&k.onBeforeCreate||[];r._events.onBeforeInsert=p&&k.onBeforeInsert||[];}r._events.onBeforeRead=p&&k.onBeforeRead||[];r._events.onBeforeUpdate=p&&k.onBeforeUpdate||[];r._events.onBeforeShowRecord=p&&k.onBeforeShowRecord||[];r._events.onLoadError=p&&k.onLoadError||[];if(d&&!(Object.isEmpty(d))){r.reports=d;r._events.onBeforeShowPrintReports=p&&k.onBeforeShowPrintReports||[];r._events.onPrepareReportData=p&&k.onPrepareReportData||[];r._events.onSelectReportTransform=p&&k.onSelectReportTransform||[];}g+="?editParams="+encodeURIComponent($ws.helpers.serializeURLData(r));return g;}else{if(!$ws._const.htmlNames[o]&&!$ws._const.xmlContents[o]){$ws.single.ioc.resolve("ILogger").log("$ws.helpers.generateURL",'ВНИМАНИЕ! Диалог "'+o+'" отсутствует в оглавлении!');}return false;}},escapeTagsFromStr:function(b,a){BOOMR.plugins.WS.reportEvent("ws.helpers","escapeTagsFromStr");if(typeof a=="string"){a=[a];}if(typeof b=="string"&&a instanceof Array){b=b.replace(new RegExp("<(?=/*(?:"+a.join("|")+"))[^>]+>","g"),"");}return b;},escapeHtml:function(a){BOOMR.plugins.WS.reportEvent("ws.helpers","escapeHtml");if(typeof a=="string"){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;");}else{return a;}},unEscapeHtml:function(a){BOOMR.plugins.WS.reportEvent("ws.helpers","unEscapeHtml");if(typeof a=="string"){return a.replace(/&lt;/g,"<").replace(/&gt;/g,">");}else{return a;}},unEscapeHtmlSpecialChars:function(c){BOOMR.plugins.WS.reportEvent("ws.helpers","unEscapeHtmlSpecialChars");if(typeof c=="string"){var b={"&minus;":"-","&nbsp;":" ","&#92;":"\\"},a;for(a in b){c=c.replace(new RegExp(a,"g"),b[a]);}}return c;},proxy:function(c,b,a){BOOMR.plugins.WS.reportEvent("ws.helpers","proxy");if(arguments.length===2){if(typeof b==="string"){a=c;c=a[b];b=undefined;}else{if(b&&typeof b!=="function"){a=b;b=undefined;}}}if(!b&&c){b=function(){return c.apply(a,arguments);};}return b;},prepareSorting:function(d){if(!d||d.sorting===undefined){return null;}var b={s:[{n:"n",t:"Строка"},{n:"o",t:"Логическое"},{n:"l",t:"Логическое"}],d:[]};for(var a=d.sorting.length,c=0;c<a;++c){b.d.push([d.sorting[c][0],d.sorting[c][1],!d.sorting[c][1]]);}return b;},prepareFilter:function(c){var a={d:[],s:[]};if(c){for(var b in c){if(b=="pageNum"||b=="pageCount"||b=="usePages"||b=="sorting"){continue;}if(c.hasOwnProperty(b)&&c[b]!==undefined){var d=$ws.proto.ReaderSBIS.serializeParameter(b,c[b]);if(c[b] instanceof Object&&c[b].hasOwnProperty("hierarchy")){a.d=a.d.concat(d.d);a.s=a.s.concat(d.s);}else{a.d.push(d.d);a.s.push({n:b,t:d.s});}}}}return a;},getScrollOffset:function(){BOOMR.plugins.WS.reportEvent("ws.helpers","getScrollOffset");return{left:window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,top:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop};},processImagePath:function(a){BOOMR.plugins.WS.reportEvent("ws.helpers","processImagePath");if(a&&typeof a=="string"&&a.indexOf("ws:/")===0){a=a.replace("ws:",$ws._const.wsRoot+"img/themes/"+$ws._const.theme);if($ws._const.buildnumber&&a.indexOf("v"+$ws._const.buildnumber)==-1){a=a.replace(/(jpg|png|gif)$/,"v"+$ws._const.buildnumber+".$1");}}return a;},serializeURLData:function(b){BOOMR.plugins.WS.reportEvent("ws.helpers","serializeURLData");var a=JSON.stringify(b);if(a.indexOf("\\u")!=-1){a=unescape(a.replace(/\\u/g,"%u"));}return $ws.single.base64.encode(a);},deserializeURLData:function(b){BOOMR.plugins.WS.reportEvent("ws.helpers","deserializeURLData");var a=JSON&&JSON.parse?JSON.parse:$.parseJSON;return a($ws.single.base64.decode(b));},forEach:function(e,f,d){BOOMR.plugins.WS.reportEvent("ws.helpers","forEach");if(e===null||e===undefined){return;}if(e.length===+e.length){for(var c=0,a=e.length;c<a;c++){if(c in e){f.call(d,e[c],c,e);}}}else{for(var b in e){if(e.hasOwnProperty(b)){f.call(d,e[b],b,e);}}}},map:function(c,d,b){BOOMR.plugins.WS.reportEvent("ws.helpers","map");var a=[];if(c===null||c===undefined){return a;}$ws.helpers.forEach(c,function(g,e,f){a[a.length]=d.call(b,g,e,f);},b);if(c.length===+c.length){a.length=c.length;}return a;},filter:function(c,d,b){BOOMR.plugins.WS.reportEvent("ws.helpers","filter");var a=[];if(c===null||c===undefined){return a;}$ws.helpers.forEach(c,function(g,e,f){if(d){if(d.call(b,g,e,f)){a[a.length]=g;}}else{if(g){a[a.length]=g;}}},b);return a;},find:function(f,g,e){BOOMR.plugins.WS.reportEvent("ws.helpers","find");var a=undefined;if(f===null||f===undefined){return a;}var d,b,c;if(f.length===+f.length){if(g){for(d=0,b=f.length;d<b;d++){if(d in f){if(g.call(e,f[d],d,f)){a=f[d];break;}}}}else{for(d=0,b=f.length;d<b;d++){if(d in f){if(!!f[d]){a=f[d];break;}}}}}else{if(g){for(c in f){if(f.hasOwnProperty(c)){if(g.call(e,f[c],c,f)){a=f[c];break;}}}}else{for(c in f){if(f.hasOwnProperty(c)){if(!!f[c]){a=f[c];break;}}}}}return a;},reduce:function(f,e,a,d){BOOMR.plugins.WS.reportEvent("ws.helpers","reduce");var c=arguments.length>2,b=a;if(f===null||f===undefined){f=[];}$ws.helpers.forEach(f,function(i,g,h){if(!c){b=i;c=true;}else{b=e.call(d,b,i,g,h);}});if(!c){throw new TypeError("Reduce of empty array with no initial value");}return b;},isScrollable:function(c,e){BOOMR.plugins.WS.reportEvent("ws.helpers","isScrollable");var d=$(c),f=d.css("overflow"),b,a;return(f==="scroll"||f==="auto")||((e===undefined||e==="y")&&((a=d.css("overflow-y"))==="auto"||a==="scroll"))||((e===undefined||e==="x")&&((b=d.css("overflow-x"))==="auto"||b==="scroll"));},hasScrollbar:function(d,f){BOOMR.plugins.WS.reportEvent("ws.helpers","hasScrollbar");var a=true,e,b,c;if(a){a=false;d=$(d);if(d.size()>0){e=d.get(0);if(f===undefined||f==="y"){a=(e.scrollHeight!==e.clientHeight);if(!a&&$ws._const.browser.isIE7){b=d.scrollTop();c=b===0?1:b-1;d.scrollTop(c);a=(d.scrollTop()===c);if(a){d.scrollTop(b);}}}if(!a&&(f===undefined||f==="x")){a=(e.scrollWidth!==e.clientWidth);if(!a&&$ws._const.browser.isIE7){b=d.scrollLeft();c=b===0?1:b-1;d.scrollLeft(c);a=(d.scrollLeft()===c);if(a){d.scrollLeft(b);}}}}}return a;},hasVerticalScrollbar:function(a){BOOMR.plugins.WS.reportEvent("ws.helpers","hasVerticalScrollbar");return this.hasScrollbar(a,"y");},hasHorizontalScrollbar:function(a){BOOMR.plugins.WS.reportEvent("ws.helpers","hasHorizontalScrollbar");return this.hasScrollbar(a,"x");},randomId:function(a){BOOMR.plugins.WS.reportEvent("ws.helpers","randomId");return(a||"ws-")+(""+Math.random()).substr(2);},createGUID:function(){BOOMR.plugins.WS.reportEvent("ws.helpers","createGUID");var a=0,b=0,d=new Date().getTime().toString(16);d="000000000000".substr(0,12-d.length)+d;var c=function(){return(d.substring(b,b+=(a++%2?2:1))+(((1+Math.random())*65536)|0).toString(16)).substring(0,4);};return(c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c());},parseComplexKey:function(a){if(typeof a=="string"){var b=a.indexOf($ws._const.IDENTITY_SPLITTER);if(b!=-1){return{objName:a.substr(b+1),objKey:a.substr(0,b)};}}return{objName:"",objKey:a};},prepareGetRPCInvocationURL:function(d,a,i,b,j){BOOMR.plugins.WS.reportEvent("ws.helpers","prepareGetRPCInvocationURL");var h=j||$ws._const.defaultServiceUrl,l=encodeURIComponent(d+"."+a),e=$ws.core.merge({},i);for(var g in e){if(e.hasOwnProperty(g)){var c=e[g];if(c!==null&&typeof c=="object"&&"fieldName" in c){e[g]=(b||$ws.single.GlobalContext).getValue(c.fieldName);}if(g=="ИдО"){var k=e[g];if(!k){return"";}if(typeof k=="string"){var f=$ws.helpers.parseComplexKey(k).objName||d;e[g]=parseInt(e[g],10);l=encodeURIComponent(f+"."+a);}}}}return h+"?id="+(""+Math.random()).substr(2)+"&method="+l+"&protocol=3&params="+encodeURIComponent($ws.helpers.serializeURLData(e));},fetchFile:function(c,a,b){BOOMR.plugins.WS.reportEvent("ws.helpers","fetchFile");return $ws.single.ioc.resolve("ITransport",{method:"GET",dataType:"text",url:$ws.helpers.prepareGetRPCInvocationURL(c,a,b)}).execute();},newRecordSet:function(d,a,c,g,e,b,f,h){BOOMR.plugins.WS.reportEvent("ws.helpers","newRecordSet");var i=new $ws.proto.Deferred();e=((e===undefined)?true:!!e);f=(f===undefined?"":f);h=$ws.core.merge({otherUrl:b,dbScheme:"",linkedObject:d,queryName:a},(!!h&&h.constructor===Object)?h:{});$ws.core.attachInstance("Source:RecordSet",{hierarchyField:f,firstRequest:e&&!!a,filterParams:c,readerType:g||"ReaderUnifiedSBIS",readerParams:h,handlers:{onAfterLoad:function(m,l,j,k){l.unsubscribe("onAfterLoad",arguments.callee);if(e){if(j){i.callback(l);}else{i.errback(k);}}}}}).addCallbacks(function(j){if(!e){i.callback(j);}},function(j){i.errback(j);});return i;},keyDown:function(a,b){BOOMR.plugins.WS.reportEvent("ws.helpers","keyDown");a[$ws._const.compatibility.correctKeyEvents?"keydown":"keypress"](function(c){if(!$ws._const.compatibility.correctKeyEvents){if(c.which===c.keyCode){if(c.which>=97&&c.which<=122){c.which=c.keyCode-32;}else{if(c.which in $ws._const.operaKeys){c.which=$ws._const.key[$ws._const.operaKeys[c.which]];}}}if(c.which===0){c.which=c.keyCode;}c.keyCode=c.which;}b(c);});},showDatePicker:function(e,b,a){BOOMR.plugins.WS.reportEvent("ws.helpers","showDatePicker");var d="#"+e,c=new $ws.proto.Deferred();$ws.core.ready.addCallback(function(){$ws.core.attach("ext/jquery-ui/jquery-ui-1.8.5.custom.min.js").addCallback(function(){$ws.core.attach("css/datepicker/jquery-ui-1.8.5.custom.css");$ws.core.attach("ext/datepicker/jquery.ui.datepicker-ru.js",{charset:"UTF-8"}).addCallback(function(){$(d).datepicker({beforeShowDay:b,defaultDate:a});c.callback();});});});return c;},numToWritten:function(a,d){BOOMR.plugins.WS.reportEvent("ws.helpers","numToWritten");function e(m,n){var l={"0":"","1":"один","2":"два","3":"три","4":"четыре","5":"пять","6":"шесть","7":"семь","8":"восемь","9":"девять","10":"десять","11":"одиннадцать","12":"двенадцать","13":"тринадцать","14":"четырнадцать","15":"пятнадцать","16":"шестнадцать","17":"семнадцать","18":"восемнадцать","19":"девятнадцать"},j={"2":"двадцать","3":"тридцать","4":"сорок","5":"пятьдесят","6":"шестьдесят","7":"семьдесят","8":"восемьдесят","9":"девяносто"},i={"0":"","1":"сто","2":"двести","3":"триста","4":"четыреста","5":"пятьсот","6":"шестьсот","7":"семьсот","8":"восемьсот","9":"девятьсот"},g,k,o;if(n===true){l["1"]="одна";l["2"]="две";}o=m%100;o=o<=19?l[o]:j[Math.floor(o/10)]+(o%10?" ":"")+l[o%10];k=i[Math.floor(m/100)];if(k&&o){k+=" ";}g=k+o;return g;}function c(i){BOOMR.plugins.WS.reportEvent("ws.helpers","chooseNumericEndingType");var g=Math.abs(i%10),h=Math.abs(i%100);if(g===0||g>=5||h>=11&&h<=19){return 0;}if(g===1){return 1;}return 2;}function b(m,k,h){BOOMR.plugins.WS.reportEvent("ws.helpers","numberToWritten");h=h||true;var q="",n=0,p={0:{"0":"","1":"","2":""},1:{"0":"тысяч","1":"тысяча","2":"тысячи"},2:{"0":"миллионов","1":"миллион","2":"миллиона"},3:{"0":"миллиардов","1":"миллиард","2":"миллиарда"},4:{"0":"триллионов","1":"триллион","2":"триллиона"},5:{"0":"квадриллионов","1":"квадриллион","2":"квадриллиона"},6:{"0":"квинтиллионов","1":"квинтиллион","2":"квинтиллиона"},7:{"0":"секстиллионов","1":"секстиллион","2":"секстиллиона"},8:{"0":"септиллионов","1":"септиллион","2":"септиллиона"},9:{"0":"октиллионов","1":"октиллион","2":"октиллиона"},10:{"0":"нониллионов","1":"нониллион","2":"нониллиона"},11:{"0":"дециллионов","1":"дециллион","2":"дециллиона"}},g,j,l;if(m.charAt(0)==="-"){if(h){l=true;m=m.slice(1);}else{return"ОШИБКА";}}if(parseInt(m,10)===0){return"ноль";}if(isNaN(m)){return"ОШИБКА";}if(""===m){return"";}while(m.length>0){g=parseInt(m.substr(Math.max(m.length-3,0),3),10);var o=c(g);j=p[n]&&p[n][o]?" "+p[n][o]:"";if(g>0){if(n&&j===""){return"ОШИБКА";}q=e(g,n===1||k)+j+(q?" "+q:"");}m=m.slice(0,-3);n++;}if(l){q="минус "+q;}return q;}function f(k,j){BOOMR.plugins.WS.reportEvent("ws.helpers","moneyToWritten");k=(k+"").replace(/\s/g,"");if(isNaN(k)||!k.match(/^[-0-9.]*$/)){return"ОШИБКА";}if(""===k){return"";}var l=(k+"").split("."),r=l[0]||"0",q=l[1]||"00",m={"0":"рублей","1":"рубль","2":"рубля"},o={"0":"копеек","1":"копейка","2":"копейки"},g,n,s;if(r==="-"){r="-0";}if(q.length===1){q+="0";}if(q.length>2){var i=q.charAt(2);q=q.substr(0,2);if(i>="5"){q=parseInt(q,10)+1+"";if(q.length===1){q="0"+q;}if(q==="100"){q="00";if(r===""){r=1;}var p=r.length-1,h="";while(true){if(p<0||isNaN(parseInt(r.charAt(p),10))){h=(p>=0?r.substr(0,p+1):"")+"1"+h;break;}else{if(r.charAt(p)==="9"){h="0"+h;p--;}else{h=r.substr(0,p)+(parseInt(r.charAt(p),10)+1)+h;break;}}}r=h;}}}g=b(r);if(g==="ОШИБКА"){return"ОШИБКА";}g=g||"ноль";g+=" "+(j?"руб":m[c(parseInt(r.substr(Math.max(0,r.length-2),2),10))]);n=" "+q+" "+(j?"коп":o[c(parseInt(q,10))]);if(parseInt(q.substr(0,2),10)>0&&r.charAt(0)==="-"&&g.charAt(0)!=="м"){g="минус "+g;}s=g+n;s=s.charAt(0).toUpperCase()+s.substr(1);return s;}return f(a,d);},parseMargins:function(b){BOOMR.plugins.WS.reportEvent("ws.helpers","parseMargins");b=$(b);if(b){var a=b.attr("alignmargin");if(a){var c=a.split(",");return{top:parseInt(c[0],10)||0,right:parseInt(c[1],10)||0,bottom:parseInt(c[2],10)||0,left:parseInt(c[3],10)||0};}else{return{top:0,right:0,bottom:0,left:0};}}},NON_CTRL:".ws-non-control",getNonControlSize:function(f,k){BOOMR.plugins.WS.reportEvent("ws.helpers","getNonControlSize");var l=0,m=0,e,h=(f&&f.length)||0,a,d;if(h>0){a=jQuery.expr.filters.hidden,d=k.toLowerCase();for(e=0;e<h;e++){var b=f[e],c;if(!a(b)){c=$(b);var g=b.getAttribute("orig"+k);if(g===null||g==="auto"||g==="Auto"){m=c["getNative"+k]();}else{m=parseFloat(g);var j=b.getAttribute("alignmargin");if(j!==null){j=j.split(",");if(k==="Height"){m+=((parseInt(j[0],10)+parseInt(j[2],10))||0);}else{m+=((parseInt(j[1],10)+parseInt(j[3],10))||0);}}m+=c["outer"+k]()-c[d]();}l=(m>l)?m:l;}}}return l;},checkCapsLock:function(a){BOOMR.plugins.WS.reportEvent("ws.helpers","checkCapsLock");if(!a||!a.which){return undefined;}var f=a.which;var e=String.fromCharCode(f);var d=e.toUpperCase();var b=e.toLowerCase();var c=a.shiftKey;if(d!==b){if(e===d&&!c){return true;}else{if(e===b&&!c){return false;}else{if(e===b&&c){return true;}else{if(e===d&&c){if(navigator.platform.toLowerCase().indexOf("win")!==-1){return false;}else{if(navigator.platform.toLowerCase().indexOf("mac")!==-1){return false;}else{return undefined;}}}else{return undefined;}}}}}else{return undefined;}},format:function(a,b){BOOMR.plugins.WS.reportEvent("ws.helpers","format");if(typeof b!=="string"){return"";}return b.replace(/\$([а-яА-Яa-zA-Z0-9_ .]+)\$(?:([sdD])|([t])\$([\s\S]*?)|([fF])(?:\$([0-9]+))?)\$/g,function(i,g,f,e,d,c,j){var h=a instanceof $ws.proto.Record&&a.hasColumn(g)?a.get(g):a&&a.getValue?a.getValue(g):null;if(e){f=e;}if(c){f=c;}if(f==="t"){return h?h.strftime(d):"";}if(f==="d"||f==="D"){return $ws.render.defaultColumn.integer(h,!!(f==="d"));}if(f==="f"||f==="F"){return $ws.render.defaultColumn.real(h,j?j:2,f!=="f");}if(h instanceof $ws.proto.Enum){return $ws.render.defaultColumn.enumType(h);}else{return h?h:"";}});},question:function(d,a){BOOMR.plugins.WS.reportEvent("ws.helpers","question");var c=new $ws.proto.Deferred(),b=false;$ws.core.attachInstance("SBIS3.CORE.DialogConfirm",$ws.core.merge({message:d,handlers:{onKeyPressed:function(f,e){if(e.keyCode==$ws._const.key.esc){b=true;}},onConfirm:function(f,e){if(b){c.callback(undefined);}else{c.callback(e);}}}},a||{})).addErrback(function(e){c.errback(e);});return c;},newContextMenu:function(c,e){BOOMR.plugins.WS.reportEvent("ws.helpers","newContextMenu");var d=[];for(var b=0,a=c.length;b<a;b++){d[b]={caption:c[b],id:c[b],handlers:{}};if(typeof(e)=="function"){d[b].handlers.onActivated=e;}}return $ws.core.attachInstance("Control/Menu",{data:d});},showHTMLForPrint:function(c,b,a){BOOMR.plugins.WS.reportEvent("ws.helpers","showHTMLForPrint");return $ws.core.attachInstance("SBIS3.CORE.Dialog",{template:"printDialog",resizable:true,top:b,left:a,handlers:{onAfterShow:function(){var e=this.getChildControlByName("ws-dataview-print-report"),d=this,f=function(){this.unsubscribe("onContentSet",f);if(b===undefined&&a===undefined){d.moveWindowToCenter();}};e.subscribe("onContentSet",f);e.setHTML(c);}}});},getScrollWidth:function(){BOOMR.plugins.WS.reportEvent("ws.helpers","getScrollWidth");if(document&&document.body){var d=document.createElement("div");d.style.cssText="position:absolute;height:50px;overflow-y:hidden;width:50px;visibility:hidden";d.innerHTML='<div style="height:100px"></div>';var c=d.firstChild;document.body.appendChild(d);var a=c.offsetWidth;d.style.overflowY="scroll";var b=a-c.offsetWidth;document.body.removeChild(d);$ws.helpers.getScrollWidth=function(){return b;};return b;}else{if(!document){throw new Error("Ошибка: функция $ws.helpers.getScrollWidth вызвана на сервере. Она должна вызываться только в клиентском браузере.");}else{throw new Error("Ошибка: функция $ws.helpers.getScrollWidth вызвана на клиентском браузере, однако body ещё не готово.");}}},getOffsetRect:function(d){BOOMR.plugins.WS.reportEvent("ws.helpers","getOffsetRect");var g=d.getBoundingClientRect(),h=document.body,b=document.documentElement,a=window.pageYOffset||b.scrollTop||h.scrollTop,e=window.pageXOffset||b.scrollLeft||h.scrollLeft,f=b.clientTop||h.clientTop||0,i=b.clientLeft||h.clientLeft||0,j=g.top+a-f,c=g.left+e-i;return{top:Math.round(j),left:Math.round(c)};},wordCaseByNumber:function(a,d,c,b){BOOMR.plugins.WS.reportEvent("ws.helpers","wordCaseByNumber");a=Math.abs(a);if(a%1>0){return b;}a=a%100;if(a>=11&&a<=19){return d;}a=a%10;if(a==1){return c;}if(a==2||a==3||a==4){return b;}else{return d;}},addXmlLog:function(a){BOOMR.plugins.WS.reportEvent("ws.helpers","addXmlLog");var b=$("#xmlContent");if(!b.length){b=$('<div id="xmlContent" style="display:none; visibility: hidden;"></div>');$("body").append(b);}if(!b.data(a)){b.data(a,true);b.append('<div name="'+a+'">');}},callbackWrapper:function(a,b){BOOMR.plugins.WS.reportEvent("ws.helpers","callbackWrapper");if(a&&a instanceof $ws.proto.Deferred){return a.addCallback(b);}else{return b(a);}},insertCss:function(b,g){BOOMR.plugins.WS.reportEvent("ws.helpers","insertCss");function h(){var r;if("getElementsByClassName" in document){r=document.getElementsByClassName("ws-style-holder-current")[0];}else{var u=document.getElementsByTagName("style");for(var t=0,s=u.length;t<s;t++){if(k(u[t],"ws-style-holder-current")){r=u[t];break;}}}r=r||d();return r;}function d(){var s=document.createElement("style");var r=document.getElementsByTagName("head")[0];s.setAttribute("type","text/css");s.setAttribute("media","all");s.className="ws-style-holder ws-style-holder-current";r.appendChild(s);return s;}function k(v,t){var w=" "+v.className+" ",r=t.split(" ");for(var u=0,s=r.length;u<s;u++){if(w.indexOf(" "+r[u]+" ")==-1){return false;}}return true;}var q=null,j="";if(g){var o=$ws.helpers.randomId("cssReady-");q=$('<div id="'+o+'" style="display: none;" />').appendTo($("body"));j="#"+o+" { position: absolute; }";}var c=h();if(!$ws._const.browser.isIE){var i=document.createTextNode(b+j);c.appendChild(i);}else{b=b+j;var f=c.styleSheet.cssText,m=(f.match(/\{|,/g)||[]).length,n=(b.match(/\{|,/g)||[]).length;if(m+n>4000){c.className="ws-style-holder";c=d();}c.styleSheet.cssText+=b;}var p=null;if(g){var e=null,l=null;var a=function(){var s=q.css("position"),r=(s==="absolute");if(r){q.remove();if(e){clearInterval(e);p.callback();}}return r;};if(!a()){p=new $ws.proto.Deferred();e=setInterval(a,1);}}return p;},clearBackground:function(b){BOOMR.plugins.WS.reportEvent("ws.helpers","clearBackground");var a=b.attr("ws-background");if(a){b.removeClass(a);}return b;},makeBackground:function(a,c){BOOMR.plugins.WS.reportEvent("ws.helpers","makeBackground");$ws.helpers.clearBackground(a);var b=$ws.single.BackgroundMapper.imageClass(c);if(b===undefined){b=$ws.single.BackgroundMapper.addImage(c);this.insertCss("."+b+'{background-image: url("'+c+'");}');}a.addClass(b);a.attr("ws-background",b);return a;},getTextSelection:function(){BOOMR.plugins.WS.reportEvent("ws.helpers","getTextSelection");var a;if(window.getSelection){a=window.getSelection().toString();}else{if(document.getSelection){a=document.getSelection().toString();}else{if(document.selection){a=document.selection.createRange().text;}}}return a;},toggleIndicator:(function(){var a;return function(b){BOOMR.plugins.WS.reportEvent("ws.helpers","toggleIndicator");$ws.requireModule("SBIS3.CORE.LoadingIndicator").addCallback(function(c){var d=c[0];if(!a){a=new d({message:"Пожалуйста, подождите&hellip;"});}if(!!b){if(b instanceof $ws.proto.Deferred){if(!b.isReady()){a.show();b.addBoth(function(e){a.hide();return e;});}}else{a.show();}}else{a.hide();}return c;});};})(),getJavaVersionFromJS:function(){BOOMR.plugins.WS.reportEvent("ws.helpers","getJavaVersionFromJS");return $ws.core.attach("ext/pluginDetect/pluginDetect_java_v0.7.8.js").addCallback(function(){return PluginDetect.getVersion("java");});},checkJavaVersionNotLessThan:function(a){BOOMR.plugins.WS.reportEvent("ws.helpers","checkJavaVersionNotLessThan");return $ws.helpers.getJavaVersionFromJS().addCallback(function(n){var g="",c=false,m;for(var f in a){if(g){g+=" или ";}g+=a[f];}g="Для корректной работы необходима установленная Java не ниже версии(й) "+g+".";if(n===null){return"Не обнаружена Java. "+g;}n=n.replace(",",".","g");m=n.split(".");m.forEach(function(j,i,k){k[i]=parseInt(j,10);});for(var e in a){var b=a[f].split("."),h=Math.max(m.length,b.length),l=false;b.forEach(function(j,i,k){k[i]=parseInt(j,10);});for(var d=0;d<h&&!l;++d){if(isNaN(m[d])||m[d]<b[d]){l=true;}}if(!l){c=true;break;}}if(!c){return"Обнаружена устаревшая Java версии "+n+". "+g;}else{return"";}});},showFloatArea:function(c){BOOMR.plugins.WS.reportEvent("ws.helpers","showFloatArea");var g=c.id,b=c.name,f=$ws.helpers.showFloatArea.storage,e;if(!f){$ws.helpers.showFloatArea.storage=f={id:{},name:{}};}var d="Control/Area/FloatArea";if(c.filter){d+=":FilterFloatArea";}if((e=f.id[g]||f.name[b])!==undefined){return e.addCallback(function(h){if(h.isCorrect()){if(c.hoverTarget){h.setHoverTarget(c.hoverTarget,true);}if(c.autoShow||c.autoShow===undefined||!c.hoverTarget){h.show();}}else{return $ws.core.attachInstance(d,c);}return h;});}else{var a=$ws.core.attachInstance(d,c);if(g!==undefined){f.id[g]=a;}if(b!==undefined){f.name[b]=a;}return a;}},showHoverFloatArea:function(c,b,a){BOOMR.plugins.WS.reportEvent("ws.helpers","showHoverFloatArea");var d=b||false,e=$(c).bind("mouseenter.wsShowHoverFloatArea",function(){d=true;}).bind("mouseleave.wsShowHoverFloatArea",function(){d=false;});a.autoShow=false;a.hoverTarget=c;return $ws.helpers.showFloatArea(a).addCallback(function(f){e.unbind(".wsShowHoverFloatArea");if(d){f.show();}return f;});},clearSelection:function(){BOOMR.plugins.WS.reportEvent("ws.helpers","clearSelection");if(window.getSelection){var a=window.getSelection();if(a&&a.collapseToStart){try{a.collapseToStart();}catch(b){}}}else{if(document.selection&&document.selection.empty){try{document.selection.empty();}catch(b){}}}},positionInWindow:function(g,b,a){BOOMR.plugins.WS.reportEvent("ws.helpers","positionInWindow");var e=$ws._const.$win.scrollTop(),f=$ws._const.$win.scrollLeft(),d=$ws._const.$win.width(),c=$ws._const.$win.height();g.top-=e;g.left-=f;if(g.left+b>d){g.left=d-b;}if(g.left<0){g.left=0;}if(a!==undefined&&g.top+a>c){g.top=c-a;}if(g.top<0){g.top=0;}g.top+=e;g.left+=f;return g;},showDialogSelector:function showDialogSelector(c,e,b){var a=new $ws.proto.Deferred(),d=false;$ws.core.attachInstance("SBIS3.CORE.DialogSelector",$ws.core.merge({context:new $ws.proto.Context().setPrevious(b),handlers:{onChange:function(h,f){if(f&&f[0]){var g=new $ws.proto.ParallelDeferred({stopOnFirstError:false});$ws.helpers.forEach(f,function(){var i=e.apply(this,arguments);d|=i instanceof $ws.proto.Deferred;g.push(i);});if(d){$ws.helpers.toggleIndicator(true);}this.close(g.done().getResult());}},onAfterClose:function(g,f){if(f&&f instanceof $ws.proto.Deferred){a.dependOn(f);}else{a.callback(f);}}}},c)).addErrback(function(f){a.errback(f);return f;});a.addBoth(function(f){if(d){$ws.helpers.toggleIndicator(false);}return f;});return a;},jQueryToString:function(d){var c=[];for(var b=0,a=d.length;b<a;b++){c.push(d.get(b).outerHTML);}return c.join("");},parseIdentity:function(a){if(a instanceof Array){if(a.length===1&&a[0]===null){return null;}return a.join($ws._const.IDENTITY_SPLITTER);}else{return a;}},wrapURLs:function(b,h){h=h==undefined?true:h;var c="(https?|ftp|file)://([-A-Za-z0-9+&@#/%?=~_|!:,.;]*[-A-Za-z0-9+&@#/%=~_|])",f="[-a-z0-9!#$%&'*+/=?^_`{|}~]+(?:\\.[-a-z0-9!#$%&'*+/=?^_`{|}~]+)*@(?:[a-z0-9]([-a-z0-9]{0,61}[a-z0-9])?\\.)*(?:aero|arpa|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|[a-z][a-z])",d="<[\\s]*a[\\s\\S]*?>[\\s\\S]*?</a>|",e=new RegExp(c,"gi"),a=new RegExp(d+c,"gi"),g=new RegExp(d+f,"gi");b=b.replace(a,function(i){if(i.charAt(0)!="<"){e.lastIndex=0;var j=e.exec(i)[2];if(j.search("/")+1==j.length){j=j.substr(0,j.length-1);}return"<a"+(h?' target="_blank"':"")+' href="'+i+'">'+j+"</a>";}else{return i;}});b=b.replace(g,function(i){if(i.charAt(0)!="<"){return'<a href="mailto:'+i+'">'+i+"</a>";}else{return i;}});return b;},wheel:function(a,c){var b=$ws._const.compatibility.wheel;return a.bind(b,function(e){var d=e.originalEvent;if(b==="wheel"){e.wheelDelta=-d.deltaY;if(d.deltaMode===1){e.wheelDelta*=40;}}else{if(b==="DOMMouseScroll"){e.wheelDelta=-d.detail*40;}}c.call(this,e);});},invertedInput:function(q,d){var r=["q","w","e","r","t","y","u","i","o","p","[","]","a","s","d","f","g","h","j","k","l",";","'","z","x","c","v","b","n","m",",",".","/","Q","W","E","R","T","Y","U","I","O","P","{","}","A","S","D","F","G","H","J","K","L",":",'"',"Z","X","C","V","B","N","M","<",">","?"],c=["й","ц","у","к","е","н","г","ш","щ","з","х","ъ","ф","ы","в","а","п","р","о","л","д","ж","э","я","ч","с","м","и","т","ь","б","ю",".","Й","Ц","У","К","Е","Н","Г","Ш","Щ","З","Х","Ъ","Ф","Ы","В","А","П","Р","О","Л","Д","Ж","Э","Я","Ч","С","М","И","Т","Ь","Б","Ю",","],p="",n,m,h,g,f,e;function a(x){var t=false,w=false,v,u,s,k;for(v=0,s=x.length;v<s;v++){if(w){break;}for(u=0,k=r.length;u<k;u++){if(x.charAt(v)===r[u]){t=true;w=true;break;}}for(u=0,k=c.length;u<k;u++){if(x.charAt(v)===c[u]){t=false;w=true;break;}}}return t;}var o=a(q);for(n=0,g=q.length;n<g;n++){var b=null;if(d===true){if(o){for(m=0,f=c.length;m<f;m++){if(q.charAt(n)===r[m]){b=c[m];break;}}}else{for(m=0,f=r.length;m<f;m++){if(q.charAt(n)===c[m]){b=r[m];break;}}}if(!b){b=q[n];}}else{for(m=0,f=c.length;m<f;m++){if(q.charAt(n)===r[m]){b=c[m];break;}}if(!b){for(m=0,f=r.length;m<f;m++){if(q.charAt(n)===c[m]){b=r[m];break;}}}if(!b){b=q[n];}}p+=b;}return p;},hasFunctionProperty:function(a,b){return a&&typeof(a)==="object"&&b in a&&typeof(a[b])==="function";},transliterate:(function(){var b={"а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"e","ж":"j","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"ts","ч":"ch","ш":"sh","щ":"sch","ъ":"","ы":"y","ь":"","э":"e","ю":"yu","я":"ya"," ":"_"};for(var a in b){if(b.hasOwnProperty(a)){b[a.toUpperCase()]=b[a].toUpperCase();}}return function(f){var d=[],h,g,e;for(g=0,e=f.length;g<e;g++){h=f.charAt(g);d[g]=(h in b)?b[h]:h;}return d.join("");};})(),checkMimeSupport:function(g){var e,f;if(navigator.plugins){navigator.plugins.refresh();for(var d=0,b=navigator.plugins.length;d<b;d++){e=navigator.plugins[d];for(var c=0,a=e.length;c<a;c++){f=e[c];if(f.type==g){return true;}}}return false;}else{return true;}}};$ws.single.Storage={_storage:{},store:function(a,b){if(!(a in this._storage)){if(typeof(b)!="function"){throw new Error("Constructor is not specified for newly created async resource");}this._storage[a]=new $ws.proto.Deferred();b(this._storage[a]);}return new $ws.proto.Deferred().dependOn(this._storage[a]);},isStored:function(a){return a in this._storage;}};$ws.proto.RPCJSON=$ws.core.extend({},{$protected:{_transport:null,_options:{serviceUrl:""}},$constructor:function(){this._transport=$ws.single.ioc.resolve("ITransport",{url:this._options.serviceUrl||$ws._const.defaultServiceUrl,method:"POST",dataType:"json",contentType:"application/json; charset=utf-8"});},_handleRPCError:function(d,e,c,a){var b=a.error;d.errback(new TransportError(b.message,"",b.code,e,b.details||"",this._options.serviceUrl||$ws._const.defaultServiceUrl));},_handleHTTPError:function(d,a,g,h){var i;if(h instanceof HTTPError){var k=h.message,b="",c=0;try{var j=JSON.parse(h.payload);if(j.error){k=j.error.message||k;b=j.error.details;c=j.error.code;}}catch(f){}i=new TransportError(k,h.httpError,c,a,b,h.url);}else{i=h;}d.errback(i);if(i.processed){h.processed=true;}},callMethod:function(f,b){var c=new $ws.proto.Deferred(),d=this._handleRPCError.bind(this,c,f,b),e=this._handleHTTPError.bind(this,c,f,b),a;a=this._transport.execute(JSON.stringify({jsonrpc:"2.0",protocol:3,method:f,params:b,id:1}),{"X-CalledMethod":$ws.helpers.transliterate(""+f),"X-OriginalMethodName":$ws.single.base64.encode(""+f)});if($ws._const.debug){a.addCallbacks(function(g){$ws.single.ioc.resolve("ILogger").info(f,"(args:",b,") =","error" in g?g.error:g.result);return g;},function(g){$ws.single.ioc.resolve("ILogger").info(f,"(args:",b,") =",g?g.details||g:g);return g;});}a.addCallbacks(function(g){g=g||{error:{message:"Получен пустой ответ от сервиса",code:"",details:""}};if("error" in g){d(g);}else{c.callback(g.result);}return g;},function(g){e(g);return g;});return c;},abort:function(){this._transport.abort();}});$ws.single.WindowManager={_windows:[],_tabEventEnable:true,_focusIn:undefined,_focusOut:undefined,_focusControlled:false,_floatAreas:{},_floatAreasTemplates:{},_acquireIndex:1000,_acquiredIndexes:[],_modalIndexes:[],_visibleIndexes:[],acquireZIndex:function(b){this._acquireIndex+=10;var a=this._acquireIndex;this._acquiredIndexes.push(a);if(b){this._modalIndexes.push(a);}return a;},setVisible:function(a){if(Array.indexOf(this._visibleIndexes,a)==-1){this._visibleIndexes.push(a);}},setHidden:function(a){var b=Array.indexOf(this._visibleIndexes,a);if(b>=0){this._visibleIndexes.splice(b,1);}},releaseZIndex:function(a){var b=Array.indexOf(this._acquiredIndexes,a);if(b>=0){this._acquiredIndexes.splice(b,1);}b=Array.indexOf(this._visibleIndexes,a);if(b>=0){this._visibleIndexes.splice(b,1);}b=Array.indexOf(this._modalIndexes,a);if(b>=0){this._modalIndexes.splice(b,1);}this._acquireIndex=Math.max.apply(Math,[1000].concat(this._acquiredIndexes));},getMaxVisibleZIndex:function(){var a=0;$ws.helpers.forEach(this._visibleIndexes,function(b){if(b>a&&Array.indexOf(this._modalIndexes,b)!=-1){a=b;}},this);return a;},init:function(){var a=this;$(function(){a._createFirstElementToFocus();a._createLastElementToFocus();});},_createFirstElementToFocus:function(){if(this._focusIn){this._focusIn.remove();}var a=this,b=function(){if(!a._focusControlled){var c=$ws.single.WindowManager.getActiveWindow();if(c){c=c.getTopParent();c.activateFirstControl();}}};this._focusIn=$('<a class="ws-focus-in" tabindex="0"></a>').prependTo("body").bind("focusin",b);},_createLastElementToFocus:function(){if(this._focusOut){this._focusOut.remove();}var a=this;this._focusOut=$('<a class="ws-focus-out" tabindex="0"></a>').appendTo("body").bind("focusin",function(){if(!a._focusControlled){var b=$ws.single.WindowManager.getActiveWindow();if(b){b=b.getTopParent();b.activateLastControl();}}});},focusToFirstElement:function(){this._focusControlled=true;this._focusIn.focus();this._focusControlled=false;},focusToLastElement:function(){this._focusControlled=true;$("body").append(this._focusOut);this._focusOut.focus();this._focusControlled=false;},_findWindowIndex:function(c){var a,d=this._windows,b=d.length;for(a=0;a!==b;a++){if(d[a]===c){return a;}}return -1;},_checkRegisterBatchUpdaterActions:function(){this._checkRegisterBatchUpdaterActions=function(){};var a=this;$ws.single.ControlBatchUpdater.registerDelayedAction("WindowManager.activateControl",function(){a.activateControl();},true);},addWindow:function(b){if(this._findWindowIndex(b)===-1){var a=this;this._checkRegisterBatchUpdaterActions();this._windows.push(b);if(b instanceof SBIS3.CORE.AreaAbstract){b.subscribe("onActivate",function(){a.onActivateWindow(this);});}if($ws.proto.FloatArea&&b instanceof $ws.proto.FloatArea){this._floatAreas[b.getId()]=b;}}},removeWindow:function(b){var a=this._findWindowIndex(b);if(a!==-1){this._windows.splice(a,1);if($ws.proto.FloatArea&&b instanceof $ws.proto.FloatArea){delete this._floatAreas[b.getId()];delete this._floatAreasTemplates[b.getTemplateName()];}$ws.single.ControlBatchUpdater.runBatchedDelayedAction("WindowManager.activateControl");}},activateControl:function(){var a=this.getLastActiveWindow();if(a){a.onBringToFront();}},onActivateWindow:function(c){this._activeWindow=c;if(c){c.setActivationIndex(this.getMaxActivisionIndex()+1);for(var a in this._floatAreas){if(this._floatAreas.hasOwnProperty(a)&&this._floatAreas[a].isVisible()&&this._floatAreas[a].isAutoHide()){var b=c,d=false;do{if(b===this._floatAreas[a]){d=true;break;}b=b.getParent()||(b.getOpener&&b.getOpener());}while(b);if(!d){this._floatAreas[a].hide();}}}}},getActiveWindow:function(){return this._activeWindow;},disableTabEvent:function(){this._tabEventEnable=false;},enableTabEvent:function(){this._tabEventEnable=true;},getTabEvent:function(){return this._tabEventEnable;},getMaxZWindow:function(f){var d=-1,a,b,h,e=this._windows,c=e.length,g;for(b=0;b!==c;b++){g=e[b];if((!f||f(g))&&g.isShow()){h=g.getZIndex();if(h>d){d=h;a=g;}}}return a;},getMaxZModalWindow:function(){return this.getMaxZWindow(function(a){return a.isModal();});},getMaxZIndex:function(){var a=this.getMaxZWindow();return a&&a.getZIndex()||1000;},_isWindowAcceptFocus:function(b){var a=b;while(a){if(!a.canAcceptFocus()){return false;}a=a.getParent();}return true;},getLastActiveWindow:function(){var b=-1,c,a,g,e=undefined,f=this._windows,d=f.length;for(c=0;c!==d;c++){g=f[c];a=g.getActivationIndex();if(a>b&&this._isWindowAcceptFocus(g)){b=a;e=g;}}return e;},getMaxActivisionIndex:function(){var a=this.getLastActiveWindow();return a&&a.getActivationIndex()||0;},disableLastActiveControl:function(c){var a=this._activeWindow;if(a){var b=a.getActiveChildControl();if(b&&b.getParent()===a){b.setActive(false,undefined,undefined,c);}}}};$ws.proto.ITransport=$ws.core.extend({},{execute:function(a,b){throw new Error("Method not implemented");}});$ws.proto.ILogger=$ws.core.extend({},{log:function(a,b){throw new Error("ILogger::log method is not implemented");},error:function(a,b){throw new Error("ILogger::error method is not implemented");},info:function(){}});$ws.proto.IAttachLoader=$ws.core.extend({},{attach:function(a,c,b){throw new Error("IAttachLoader::attach method not implemented");}});$ws.proto.ConsoleLogger=$ws.proto.ILogger.extend({$protected:{_con:null},$constructor:function(){if("jstestdriver" in window){this._con=window.jstestdriver["console"];}else{if("console" in window&&window.console["log"]){this._con=window.console;}}},log:function(a,b){BOOMR.plugins.WS.reportMessage(a+": "+b);if(this._con&&typeof(this._con)==="object"&&"log" in this._con&&typeof(this._con.log)=="function"){this._con.log(a+": "+b+"\n");}else{try{this._con.log(a+": "+b+"\n");}catch(c){}}},error:function(a,c,b){if(b&&b instanceof Error){BOOMR.plugins.WS.reportError(b,a+": "+c);}else{BOOMR.plugins.WS.reportMessage(a+": "+c);}c=c+(b&&b.stack?"\nStack: "+b.stack:"");if(this._con&&typeof(this._con)==="object"&&"error" in this._con&&typeof(this._con.error)==="function"){this._con.error(a+": "+c);}else{try{this._con.error(a+": "+c+"\n");}catch(d){this.log(a,c);}}},info:function(){if(this._con&&typeof(this._con)==="object"&&"info" in this._con&&typeof(this._con.info)==="function"){this._con.info.apply(this._con,arguments);}else{try{this._con.info.apply(this._con,arguments);}catch(a){}}}});$ws.proto.WindowAttachLoader=$ws.proto.IAttachLoader.extend({attach:function(f,b,k){var d=f.replace(/^.*\.([^\.]+)(\?.*)?$/ig,"$1").toLowerCase(),g=f,c={css:{tag:"LINK",rel:"stylesheet",type:"text/css",href:g},js:{tag:"SCRIPT",charset:k&&k.charset||"UTF-8",type:"text/javascript",src:g}}[d];if(c!==undefined){var h=document.getElementsByTagName("head")[0],a=document.createElement(c.tag),j=false;delete c.tag;for(var e in c){a.setAttribute(e,c[e]);}a.onerror=function(){b.errback(new Error("attach: cannot load resource: "+g));};switch(a.tagName.toUpperCase()){case"LINK":b.dependOn($ws.single.ioc.resolve("ITransport",{url:g}).execute(null).addCallback(function(){j=true;h.appendChild(a);}));break;case"SCRIPT":a.onload=a.onreadystatechange=function(){var i=this.readyState;if(!j&&(!i||i=="loaded"||i=="complete")){j=true;a.onload=a.onreadystatechange=null;b.callback("");}};h.appendChild(a);break;}}else{b.errback(new Error("attach: Unknown resource type specified: "+f));}}});$ws.proto.EventObject=function(a){this._eventName=a;};$ws.proto.EventObject.prototype={_isBubbling:true,_result:undefined,_eventName:null,cancelBubble:function(){this._isBubbling=false;},isBubbling:function(){return this._isBubbling;},getResult:function(){return this._result;},setResult:function(a){this._result=a;}};$ws.proto.Abstract=$ws.core.extend({},{$protected:{_eventQueue:[],_eventsAllowed:false,_isDestroyed:false,_handlers:{},_events:{}},$constructor:function(a){if(a!==undefined&&typeof a.handlers=="object"){this._handlers=a.handlers;}this._publish("onInit","onReady","onDestroy");},init:function(){this._initComplete();},_initComplete:function(){this._notify("onInit");},describe:function(){return"Abstract";},_publish:function(){var c=$ws.core.unpack(Array.prototype.slice.call(arguments));for(var b=0,a=c.length;b<a;b++){var d=c[b];this._events[d]=this._events[d]||[];if(this._handlers[d]!==undefined){this.subscribe(d,this._handlers[d]);delete this._handlers[d];}}},_notify:function(f){var h,j,a=undefined;if(!this._eventsAllowed){h=Array.prototype.slice.call(arguments);this._eventQueue.push(h);}else{if(this._events){var b=this._events[f],d;if(b){d=b.length;if(d){j=new $ws.proto.EventObject(f);h=Array.prototype.slice.call(arguments);h[0]=j;for(var c=0;c<d;c++){try{var g=b[c];if(g){g.apply(this,h);}if(!j.isBubbling()||!this._events){break;}}catch(g){$ws.single.ioc.resolve("ILogger").error(this.describe?this.describe():"Unknown Object","Event handler for '"+f+"' returned error: "+g.message,g);}}a=j.getResult();}}else{$ws.single.ioc.resolve("ILogger").error("Abstract","Event '"+f+"' have not published yet");}}}return a;},_allowEvents:function(){if(this._eventsAllowed===false){this._eventsAllowed=true;for(var b=0,a=this._eventQueue.length;b<a;b++){this._notify.apply(this,this._eventQueue[b]);}this._eventQueue=[];}},once:function(b,a){this.subscribe(b,function(){a.apply(this,arguments);this.unsubscribe(b,arguments.callee);});},subscribe:function(e,b){if(this._events[e]===undefined){throw new Error("Event '"+e+"' is not registered");}else{var d=$ws.core.unpack(b,["object","array"]);for(var c=0,a=d.length;c<a;c++){if(d[c]){if(typeof d[c]=="function"){this._events[e].push(d[c]);}else{throw new TypeError("Event '"+e+"' has unexpected handler");}}}}return this;},unsubscribe:function(g,c){var a=this._events[g];if(a){var f,b,e,d;for(b=0,d=a.length;b!==d;b++){if(a[b]===c){f=a.slice(0,b);b++;e=b;for(;b!==d;b++){if(a[b]===c){if(e!==b){f=f.concat(a.slice(e,b));}e=b+1;}}if(e!==d){f=f.concat(a.slice(e,d));}this._events[g]=f;break;}}}return this;},unbind:function(a){this._events[a]=[];return this;},destroy:function(){this._notify("onDestroy");this._events=null;this._handlers=null;this._isDestroyed=true;},hasEvent:function(a){return this._events&&!!this._events[a];},hasHandlersForEvent:function(a){return this.hasEvent(a)&&(this._events[a].length>0);},_isOptionDefault:function(a){return !(("_optionsOverriden" in this)&&(a in this["_optionsOverriden"]));},_getOverridenOptionDefaultValue:function(a){return this._isOptionDefault(a)?undefined:this["_optionsOverriden"][a];},_hasOverridenOptions:function(){return !!this["_optionsOverriden"];}});$ws.proto.Deferred=$ws.core.extend({},{$protected:{_chained:false,_chain:[],_fired:-1,_paused:0,_results:[null,null],_running:false,_logger:null},_resback:function(a){this._fired=((a instanceof Error)?1:0);this._results[this._fired]=a;this._fire();},_check:function(a,b){if(b===undefined){b=false;}if(this._fired!=-1){throw new Error("Deferred is already fired with state '"+(this._fired==1?"error":"success")+"'");}if(a instanceof $ws.proto.Deferred){throw new Error("Deferred instances can only be chained if they are the result of a callback");}if(b&&!(a instanceof Error)){a=new Error(a);if(!isNaN(a.number)&&!a.message){a.message=""+a.number;}}return a;},callback:function(a){this._resback(this._check(a));return this;},errback:function(a){this._resback(this._check(a,true));return this;},addBoth:function(a){if(arguments.length!=1){throw new Error("No extra args supported");}return this.addCallbacks(a,a);},addCallback:function(a){if(this._fired<=0){if(arguments.length!=1){throw new Error("No extra args supported");}return this.addCallbacks(a,null);}else{return this;}},addErrback:function(a){if(arguments.length!=1){throw new Error("No extra args supported");}return this.addCallbacks(null,a);},addCallbacks:function(a,b){if(this._chained){throw new Error("Chained Deferreds can not be re-used");}if((a!==null&&typeof(a)!="function")||(b!==null&&typeof(b)!="function")){throw new Error("Both arguments required in addCallbacks");}this._chain.push([a,b]);if(this._fired>=0&&!this._running){this._fire();}return this;},_fire:function(){var d=this._chain;var h=this._fired;var c=this._results[h];var b=this;var a=null;while(d.length>0&&this._paused===0){var i=d.shift();var g=i[h];if(g===null){continue;}try{this._running=true;c=g(c);h=((c instanceof Error)?1:0);if(c instanceof $ws.proto.Deferred){a=function(f){b._resback(f);b._paused--;if((b._paused===0)&&(b._fired>=0)){b._fire();}};this._paused++;}}catch(e){h=1;if(!(e instanceof Error)){e=new Error(e);}c=e;$ws.single.ioc.resolve("ILogger").error("Deferred","Callback function throwing an error: "+e.message,e);}finally{this._running=false;}}this._fired=h;this._results[h]=c;if(a&&this._paused){c.addBoth(a);c._chained=true;}},dependOn:function(b){var a=this;b.addCallbacks(function(c){a.callback(c);return c;},function(c){a.errback(c);return c;});return this;},createDependent:function(){var a=new $ws.proto.Deferred();return a.dependOn(this);},isReady:function(){return this._fired!=-1;},isCallbacksLocked:function(){return this._chained;},isSuccessful:function(){return this._fired===0;},getResult:function(){if(this.isReady()){return this._results[this._fired];}else{throw new Error("No result at this moment. Deferred is still not ready");}}});$ws.proto.ParallelDeferred=$ws.core.extend({},{$protected:{_successResult:undefined,_ready:false,_stepsCount:0,_stepsFinish:0,_stepsSuccess:0,_successHandler:null,_errorHandler:null,_dResult:null,_errors:[],_hasError:false,_options:{stopOnFirstError:true}},$constructor:function(b){this._successHandler=(function(){var d=this;return function(e){if(!d._hasError){d._stepsFinish++;d._stepsSuccess++;d._check();}return e;};}).apply(this);this._errorHandler=(function(){var d=this;return function(e){if(d._fired===1||d._hasError){return e;}if(d._options.stopOnFirstError){d._hasError=true;}d._stepsFinish++;d._errors.push(e.message);d._check();return e;};}).apply(this);this._dResult=new $ws.proto.Deferred();if(b&&b.steps&&b.steps instanceof Array){for(var c=0,a=b.steps.length;c<a;c++){this.push(b.steps[c]);}}},push:function(a){if(this._ready){return this;}if(a instanceof $ws.proto.Deferred){this._stepsCount++;a.addCallbacks(this._successHandler,this._errorHandler);}return this;},done:function(a){this._ready=true;this._successResult=a;this._check();return this;},_check:function(){if(!this._ready){return;}if(this._stepsFinish==this._stepsCount||this._hasError){if(this._stepsSuccess==this._stepsCount&&!this._hasError){this._dResult.callback(this._successResult);}else{this._dResult.errback(this._errors.join("\n"));}}},getResult:function(){return this._dResult;},getStepsCount:function(){return this._stepsCount;},getStepsDone:function(){return this._stepsFinish;},getStepsSuccess:function(){return this._stepsSuccess;}});$ws.proto.CodeChain=$ws.core.extend({},{$protected:{_chain:[],_length:0},$constructor:function(b){this._length=b;for(var a=0;a<b;a++){this._chain[a]=0;}},setCode:function(a,b){if(a>=this._length||a<0){throw new RangeError("Setting chain element above the range: Idx: "+a+", Len: "+this._length);}if(this._chain[a]!==0){throw new Error("Setting chain element what is already processed! Erroneous usage detected! Idx: "+a);}this._chain[a]=b;return this._check();},_check:function(){for(var i=0,l=this._length;i<l;i++){if(typeof this._chain[i]=="string"){if(this._chain[i]!==""){try{var span=BOOMR.plugins.WS.startSpan("eval");eval(this._chain[i]);span.stop();this._chain[i]="";}catch(e){throw new EvalError("Chain failed due to erroneous code: "+e.message);}}}else{return false;}}return true;}});$ws.proto.XHRTransport=$ws.proto.ITransport.extend({$protected:{_options:{method:"GET",dataType:"text",contentType:"application/x-www-form-urlencoded",url:""},_xhr:undefined},$constructor:function(){if(this._options.url===""){throw new Error("Request with no URL is ambiguous");}},execute:function(d,h){var b=this._boomrStartSpan(d),g=BOOMR.plugins.WS.startSpan("AllTime",{stacked:true}),c=new $ws.proto.Deferred(),a=this;try{this._xhr=$.ajax({type:this._options.method,dataType:this._options.dataType,contentType:this._options.contentType,url:this._options.url,headers:h||{},data:d,success:function(e){b.stop();a._validateCookies();c.callback(e);g.stop();return e;},error:function(k,l){b.stop();a._validateCookies();var e={timeout:"Таймаут запроса",error:"Неизвестная ошибка",parsererror:"Ошибка разбора документа",abort:"Запрос был прерван",403:"У вас недостаточно прав для выполнения данного действия.",404:"Документ не найден",423:"Действие заблокировано лицензией",500:"Внутренняя ошибка сервера",502:"Сервис недоступен. Повторите попытку позже.",503:"Сервис недоступен. Повторите попытку позже.",504:"Сервис недоступен. Повторите попытку позже."},j=((k.status in e)?e[k.status]:((l in e)?e[l]:e.error)),i;if(k.status===0&&k.getAllResponseHeaders()===""){j="Запрос был прерван пользователем";}if(k.status=="401"){if(typeof $ws.core._authError=="function"){$ws.core._authError();g.stop();return;}}i=new HTTPError(j,k.status,a._options.url,k.responseText);if(k.status=="403"||k.status=="423"){c.errback(i);if(!i.processed){$ws.core.alert(j,"error");}}else{c.errback(i);}g.stop();}});}catch(f){c.errback("JavaScript exception while trying to execute request: "+f.message);g.stop();}return c;},abort:function(){if(this._xhr){this._xhr.abort();}},_validateCookies:function(){var c=$ws.single.GlobalContext.getValue("sid"),b;if("jQuery" in window&&"cookie" in window.jQuery){b=$.cookie("sid");if(c&&b){var a=c.split("-"),d=b.split("-");if(a[0]!==d[0]||a[1]!==d[1]){if(typeof $ws.core._authError=="function"){$ws.core._authError();}}}else{$ws.single.GlobalContext.setValue("sid",b);}}},_boomrStartSpan:function(b){var a=this._options.url;if(BOOMR.version){if(/.*\.dll$/.test(a)){var c=$.parseJSON(b);if(c&&c.method){a=[a,c.method].join("?");}}}return BOOMR.plugins.WS.startSpan(a);}});$ws.proto.ContextObject=$ws.core.extend({},{$protected:{_options:{objectData:false},_record:null,_isEmpty:true,_contextObject:{}},$constructor:function(){this._contextObject={};if(this._options.objectData!==false){if(typeof(this._options.objectData)!=="object"){return;}var c=("get" in this._options.objectData&&"hasColumn" in this._options.objectData),a=c?this._options.objectData.toObject():this._options.objectData;if(c){this._record=this._options.objectData;}for(var b in a){if(a.hasOwnProperty(b)){this._contextObject[b]={value:a[b],isRecord:c};this._isEmpty=false;}}}},isEmpty:function(){return this._isEmpty;},getRecord:function(){return this._record;},toObject:function(){var a={};for(var b in this._contextObject){if(this._contextObject.hasOwnProperty(b)){a[b]=this._contextObject[b].value;}}return a;},set:function(d,a){var b=this._contextObject[d],c=b?b.isRecord:false;this._contextObject[d]={value:a,isRecord:c};if(c){this._record.set(d,a);}this._isEmpty=false;},get:function(a){return this._contextObject[a]!==undefined?this._contextObject[a].value:undefined;},remove:function(d){var a=false,c,b;if(this._contextObject[d]){a=true;c=this._contextObject[d]["isRecord"];b=c?this.get(d):this._contextObject[d].value;if(c){if(b instanceof $ws.proto.Enum){b.set(null);}else{this.set(d,null);}}else{this._contextObject[d].value=undefined;}}return a;}});$ws.proto.Context=$ws.proto.Abstract.extend({$protected:{_options:{isGlobal:false},_previousContext:null,_context:{},_parentContextUpdateHandler:null,_parentContextFieldUpdateHandler:null},$constructor:function(){var a=this;this._parentContextUpdateHandler=function(){a._notify("onDataBind");};this._parentContextFieldUpdateHandler=function(b,d,c){if(a._context.get(d)===undefined){a._notify("onFieldChange",d,c);}};if(this._options.isGlobal===false){this._previousContext=$ws.single.GlobalContext;}this._subscribeOnParentUpdates();this._context=new $ws.proto.ContextObject();this._publish("onDataBind","onFieldChange");},_subscribeOnParentUpdates:function(){if(this._previousContext){this._previousContext.subscribe("onDataBind",this._parentContextUpdateHandler);this._previousContext.subscribe("onFieldChange",this._parentContextFieldUpdateHandler);}},_unsubscribeOnParentUpdates:function(){if(this._previousContext){this._previousContext.unsubscribe("onDataBind",this._parentContextUpdateHandler);this._previousContext.unsubscribe("onFieldChange",this._parentContextFieldUpdateHandler);}},setPrevious:function(a){if(a!==null&&a instanceof $ws.proto.Context){this._unsubscribeOnParentUpdates();this._previousContext=a;this._subscribeOnParentUpdates();}return this;},getPrevious:function(){return this._previousContext;},setContextData:function(a){this._context=new $ws.proto.ContextObject({objectData:a});this._notify("onDataBind");},isGlobal:function(){return this._options.isGlobal;},isEmpty:function(){return this._context.isEmpty();},getRecord:function(){return this._context.getRecord();},getValue:function(c,b){var a=this._context.get(c);return(typeof b==="function"?b(a):a===undefined)?this._getValueUp(c,b):a;},getValueSelf:function(a){return this._context.get(a);},getFieldOrigin:function(b){var a=this._context.get(b);if(a===undefined&&this._previousContext){a=this._previousContext.getFieldOrigin(b);}else{if(a!==undefined){a=this;}}return a;},_getValueUp:function(b,a){if(this._previousContext!==null&&this._previousContext instanceof $ws.proto.Context){return this._previousContext.getValue(b,a);}else{return undefined;}},setValue:function(g,f,b,e){var c=this;function a(i,k,l,j){var h=(!!l)?c:(c.getFieldOrigin(i)||c);h._updateValue(i,k,j);}if(typeof(g)=="object"){for(var d in g){a(d,g[d],f,b);}}else{a(g,f,b,e);}},_updateValue:function(e,d,c){var b=this._context.get(e),a;if(b&&b.equals){a=b.equals(d);}else{a=(b===d);}if(!a){this._context.set(e,d);if(c!==true){this._notify("onFieldChange",e,d);}}},removeValue:function(c,b){var a=this._context.remove(c);if(!a&&!b&&this._previousContext!==null&&this._previousContext instanceof $ws.proto.Context){return this._previousContext.removeValue(c,b);}else{return a;}},setValueSelf:function(c,b,a){this.setValue(c,b,true,a);},insert:function(a,b){this._multiOperation(a,b,"insert");},remove:function(a,b){this._multiOperation(a,b,"remove");},_multiOperation:function(c,f,e){f=typeof f==="string"?f+".":"";if(c instanceof $ws.proto.Record){c=c.toObject();}if(c instanceof Object){for(var d in c){if(c.hasOwnProperty(d)){if(e=="remove"){this.removeValue(f+d,true);}if(e=="insert"){this.setValueSelf(f+d,c[d]);}}}}else{if(c===false||c===null||c===undefined){var a=this._context.getRecord()||this._context.toObject();for(var b in a){if(a.hasOwnProperty(b)&&b.indexOf(f)===0){this.removeValue(b,true);}}}}this._notify("onDataBind");},destroy:function(){this._unsubscribeOnParentUpdates();},toObject:function(b){var a=(this._context&&this._context.toObject())||{};if(b){var d=this.getPrevious();if(d){var e=d.toObject(true);for(var c in e){if(e.hasOwnProperty(c)&&!(c in a)){a[c]=e[c];}}}}return a;}});$ws.single.GlobalContext=new $ws.proto.Context({isGlobal:true});$ws.single.CommandDispatcher=new ($ws.core.extend({},{$protected:{commandsHash:{}},$constructor:function(){},declareCommand:function(d,b,c){var a=d.getId();if(!(b in this.commandsHash)){this.commandsHash[b]={};}this.commandsHash[b][a]=$ws.helpers.proxy(c,d);},deleteCommandsForObject:function(a){if(this.commandsHash&&a.getId()){var d=a.getId();for(var b in this.commandsHash){if(this.commandsHash.hasOwnProperty(b)){var c=this.commandsHash[b];if(c[d]){delete (c[d]);}}}}},sendCommand:function(c,b){var h=Array.prototype.slice.call(arguments,2),f,d;if(c){if(c.getOwnerId&&c.getOwnerId()!==null){try{f=c.getOwner();d=this._getCommand(f.getId(),b);if(d!==null){d.apply(f,h);return true;}else{return false;}}catch(g){$ws.single.ioc.resolve("ILogger").log("CommandDispatcher","Trying to send a command to an element which is not exists");}return false;}var a=false;f=c;do{d=this._getCommand(f.getId(),b);if(d!==null){a=true;if(d.apply(f,h)){return true;}}f=f.getParent();}while(f!==null);return a;}else{return false;}},_getCommand:function(a,c){var b=this.commandsHash[c];if(b&&(a in b)){return b[a];}return null;}}))();$ws.proto.Enum=function(a){return $ws.single.ioc.resolve("IEnum",a);};$ws.proto.ClientEnum=$ws.core.extend($ws.proto.Enum,{$protected:{_options:{availableValues:null},_nullable:{currentValue:undefined},_curValIndex:undefined,_availableValues:{},_hashCode:"",_fallbackVal:undefined,_initialValue:undefined},$constructor:function(){var b=this._options.availableValues,e=this._options.currentValue;e=(e===null||e==="null")?"null":parseInt(e,10);if(b&&typeof(b)=="object"){var a=true;for(var d in b){if(!b.hasOwnProperty(d)){continue;}if(typeof(b[d])!=="function"&&!(typeof(b[d])=="object"&&b[d]!==null)){var c=(d===null||d==="null")?"null":parseInt(d,10);if(a){this._fallbackVal=c;a=false;}this._availableValues[d]=b[d];this._curValIndex=(c===e)?c:this._curValIndex;}}}else{throw new Error("Class Enum. Option availableValues must be set to object");}if(this._curValIndex===undefined){if(this._fallbackVal===undefined){throw new Error("Class Enum. No values to build");}else{this._curValIndex=c;}}this._initialValue=this._curValIndex;},valueOf:function(){return this.getCurrentValue();},getCurrentValue:function(){return this._curValIndex=="null"?null:this._curValIndex;},getValues:function(){return this._availableValues;},get:function(){return{values:this._availableValues,current:this._curValIndex};},set:function(a){a=(a===null)?"null":a;if(a in this._availableValues){this._hashCode="";this._curValIndex=a;}else{if(a==="null"){this.set(this._initialValue);}else{throw new Error("Class Enum. Unsupported index: "+a);}}},toObject:function(){return{availableValues:this.getValues(),currentValue:this.getCurrentValue()};},hashCode:function(){if(this._hashCode===""){this._hashCode=17+31*Object.keys(this._availableValues).length;for(var b in this._availableValues){if(this._availableValues.hasOwnProperty(b)&&b!==undefined){var a=parseInt(b,10);this._hashCode+=31*(isNaN(a)?-1:a);}}}return this._hashCode;},equals:function(a){return a instanceof $ws.proto.Enum&&this.hashCode()==a.hashCode()&&this.getCurrentValue()==a.getCurrentValue();},rollback:function(a){this.set(a);},toString:function(){return""+this._availableValues[this._curValIndex];},clone:function(){return new $ws.proto.ClientEnum({currentValue:this.getCurrentValue(),availableValues:this.getValues()});}});$ws.single.MicroSession={_available:true,_userData:false,_ms:{},_msid:null,_storage:null,_sessionsLimit:5,init:function(){var a=this;this._userData=$.browser.msie&&$.browser.version<8;return this._prepareStorage().addCallback(function(){if(!a._available){return false;}a._msid=a.getId();a._ms=a._get(a._msid);if(a._ms){try{a._ms=$.parseJSON(a._ms);}catch(d){throw new Error("microsession : parse json error");}}else{var b=a._get("ws-msid"),c=b?a._get(b):false;a._ms={};if(c){c=$.parseJSON(c);$.extend(true,a._ms,c);}}a._prepareHash(a._msid);a._set("ws-msid","");a._set(a._msid,JSON.stringify(a._ms));a._garbageCollector();$(window).unload(function(f){a._set("ws-msid",a._msid);});(function(e){window.open=function(){a._set("ws-msid",a._msid);var f;switch(arguments.length){case 1:f=e(arguments[0]);break;case 2:f=e(arguments[0],arguments[1]);break;case 3:f=e(arguments[0],arguments[1],arguments[2]);break;}return f;};})(window.open);});},_prepareStorage:function(){var a=this,c=new $ws.proto.Deferred(),b=BOOMR.plugins.WS.startSpan("IE7 prepare userData behavior");if(this._userData){$(document).ready(function(){var d=$("<span id='ws-storage-element'></span>");$("body").append(d);a._storage=d[0];a._storage.load("microSessions");c.callback();});}else{if("localStorage" in window&&window.localStorage!==null){this._storage=window.localStorage;c.callback();}else{this._available=false;c.callback();}}return c;},_prepareHash:function(a){$ws.single.HashManager.set("msid",a,true);},_get:function(b){var a;if(this._userData){try{a=this._storage.getAttribute(b);}catch(c){a=null;}}else{a=this._storage.getItem(b);a=a==="undefined"?undefined:a;}return a?a.toString():undefined;},_set:function(a,b){if(this._userData){this._storage.setAttribute(a,b);this._storage.save("microSessions");}else{this._storage.setItem(a,b);}},_garbageCollector:function(){var f=[];if(this._userData){var d=this._storage.XMLDocument.documentElement.attributes;for(var e=0,a=d.length;e<a;e++){if(/s\d+/.exec(d[e].name)){f.push(d[e].name);}}}else{for(e in this._storage){if(/s\d+/.exec(e)){f.push(e);}}}var b=false,c;while(!b){b=true;for(e=0,a=f.length-1;e<a;e++){if(parseInt(f[e].substr(1),10)>parseInt(f[e+1].substr(1),10)){c=f[e];f[e]=f[e+1];f[e+1]=c;b=false;}}}while(f.length>this._sessionsLimit){if(this._userData){this._storage.removeAttribute(f[0]);}else{this._storage.removeItem(f[0]);}f.splice(0,1);}},_clear:function(){if(this._userData){var a=this._storage.XMLDocument.documentElement.attributes;while(a.length){this._storage.removeAttribute(a[a.length-1].name);}}else{this._storage.clear();}},clearCurrentSession:function(){if(this._available){this._ms={};this._set(this._msid,"{}");}else{return false;}},isEmpty:function(){return Object.isEmpty(this.toObject());},getId:function(){if(this._available){return $ws.single.HashManager.get("msid")||["s",(""+new Date().getTime())].join("");}else{return false;}},set:function(a,b){if(this._available){this._ms[a]=b;this._set(this._msid,JSON.stringify(this._ms));}else{return false;}},get:function(a){if(this._available){return this._ms[a];}else{return false;}},setPermanently:function(a,b){this._set(a,b);},getPermanently:function(a){return this._get(a);},remove:function(a){if(this._available){delete this._ms[a];this._set(this._msid,JSON.stringify(this._ms));}else{return false;}},toObject:function(){return this._ms;}};$ws.single.HashManager=new ($ws.proto.Abstract.extend({$constructor:function(){if(window){var a=this;this._publish("onChange");if(navigator.userAgent.match(/MSIE 7/)){var b=decodeURI(window.location.hash);setInterval(function(){if(b!==decodeURI(window.location.hash)){b=decodeURI(window.location.hash);a._notify("onChange");}},100);}else{window.onhashchange=function(){a._notify("onChange");};}}},_getLocWithoutHash:function(){var b=window.location.toString(),a=b.indexOf("#");if(a!==-1){b=b.substring(0,a);}return b;},get:function(b){var a="";if(window){var d=decodeURI(window.location.hash),c=new RegExp(b+"=[^&]+$|"+b+"=[^&]+(?=&)","");a=d.match(c);}return a?(a[0].replace(b+"=","")).replace(/:a:/g,"&"):undefined;},set:function(a,h,c){if(window&&a){if(h===undefined||!String.trim(""+h)){this.remove(a);}else{var i=(h+"").replace(/&/g,":a:"),e=decodeURI(window.location.hash),b=new RegExp(a+"=[^&]+$|"+a+"=[^&]+(?=&)",""),d=[a,i].join("="),f,g=this._getLocWithoutHash();if(e.length){f=e.match(b)?e.replace(b,d):[e,d].join("&");}else{f=d;}if(f.indexOf("#")===0){f=f.substring(1);}if(c){window.location.replace(g+"#"+f);}else{window.location=g+"#"+f;}}}},remove:function(b){if(window){var d=decodeURI(window.location.hash),c=new RegExp("&?"+b+"=[^&]+$|"+b+"=[^&]+&","g"),a=this._getLocWithoutHash();if(d.indexOf("#")===0){d=d.substring(1);}window.location=a+"#"+d.replace(c,"");}}}))();Date.prototype.toSQL=function(d){if(d===null){d=this._serializeMode;}var a=new Date(this);if(d!==undefined){a.setMinutes(a.getMinutes()+a.getTimezoneOffset()+$ws._const.moscowTimeOffset);}var f=a.getFullYear(),e=a.getMonth()+1,g=a.getDate(),h=a.getHours(),b=a.getMinutes(),i=a.getSeconds(),c="";if(d!==false){c=f+"-"+((e<10?"0":"")+e)+"-"+((g<10?"0":"")+g);}if(d!==undefined){if(d===true){c+=" ";}c+=((h<10?"0":"")+h)+":"+((b<10?"0":"")+b);c+=":"+((i<10?"0":"")+i);}return c;};Date.prototype.equals=function(b){var a=false;if(b instanceof Date){a=this.getTime()==b.getTime();}return a;};Date.prototype.setSQLSerializationMode=function(a){this._serializeMode=a;};$ws._const.Date={days:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],daysSmall:["вс","пн","вт","ср","чт","пт","сб"],longDays:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],months:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],monthsSmall:["янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"],monthsBig:["ЯНВ","ФЕВ","МАР","АПР","МАЙ","ИЮН","ИЮЛ","АВГ","СЕН","ОКТ","НОЯ","ДЕК"],longMonths:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],longMonthsSmall:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],monthsWithDays:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"]};Date.prototype.rollback=function(a){this.setTime(a);};Date.prototype.strftime=function(e){var b=function(f,h,g){if(typeof g==="undefined"){g=10;}for(;parseInt(f,10)<g&&g>1;g/=10){f=(""+h)+f;}return""+f;},d={a:function(f){return $ws._const.Date.days[f.getDay()];},A:function(f){return $ws._const.Date.longDays[f.getDay()];},b:function(f){return $ws._const.Date.months[f.getMonth()];},B:function(f){return $ws._const.Date.longMonths[f.getMonth()];},q:function(f){return $ws._const.Date.monthsWithDays[f.getMonth()];},f:function(f){return $ws._const.Date.longMonthsSmall[f.getMonth()];},C:function(f){return b(parseInt(f.getFullYear()/100,10),0);},d:["getDate","0"],e:["getDate"," "],g:function(f){return b(parseInt(d.G(f)%100,10),0);},G:function(h){var i=h.getFullYear();var g=parseInt(d.V(h),10);var f=parseInt(d.W(h),10);if(f>g){i++;}else{if(f===0&&g>=52){i--;}}return i;},H:["getHours","0"],I:function(g){var f=g.getHours()%12;return b(f===0?12:f,0);},j:function(h){var f=h-new Date(""+h.getFullYear()+"/1/1 GMT");f+=h.getTimezoneOffset()*60000;var g=parseInt(f/60000/60/24,10)+1;return b(g,0,100);},k:["getHours","0"],l:function(g){var f=g.getHours()%12;return b(f===0?12:f," ");},m:function(f){return b(f.getMonth()+1,0);},M:["getMinutes","0"],p:function(f){return["AM","PM"][f.getHours()>=12?1:0];},P:function(f){return["am","pm"][f.getHours()>=12?1:0];},Q:function(f){return["I","II","III","IV"][parseInt(f.getMonth()/3,10)];},s:function(f){return Date.parse(f)/1000;},S:["getSeconds","0"],u:function(f){var g=f.getDay();return((g===0)?7:g);},U:function(i){var f=parseInt(d.j(i),10);var h=6-i.getDay();var g=parseInt((f+h)/7,10);return b(g,0);},V:function(i){var h=parseInt(d.W(i),10);var f=(new Date(""+i.getFullYear()+"/1/1")).getDay();var g=h+(f>4||f<=1?0:1);if(g===53&&(new Date(""+i.getFullYear()+"/12/31")).getDay()<4){g=1;}else{if(g===0){g=d.V(new Date(""+(i.getFullYear()-1)+"/12/31"));}}return b(g,0);},w:"getDay",W:function(i){var f=parseInt(d.j(i),10);var h=7-d.u(i);var g=parseInt((f+h)/7,10);return b(g,0,10);},y:function(f){return b(f.getFullYear()%100,0);},Y:"getFullYear",z:function(h){var g=h.getTimezoneOffset();var f=b(parseInt(Math.abs(g/60),10),0);var i=b(g%60,0);return(g>0?"-":"+")+f+i;},Z:function(f){return f.toString().replace(/^.*\(([^)]+)\)$/,"$1");},"%":function(f){return"%";}},a=this,c={c:"%a %d %b %Y %r %Z",D:"%d/%m/%y",F:"%y-%m-%d",h:"%b",n:"\n",r:"%I:%M:%S %p",R:"%H:%M",t:"\t",T:"%H:%M:%S",x:"%d/%m/%Y",X:"%r"};while(e.match(/%[cDFhnrRtTxX]/)){e=e.replace(/%([cDFhnrRtTxX])/g,function(g,f){return c[f];});}return e.replace(/%([aAbBCdefgGHIjklmMpPsqQSuUVwWyYzZ%])/g,function(h,g){var i=d[g];if(typeof i==="string"){return a[i]();}else{if(typeof i==="function"){return i(a);}else{if(typeof i==="object"&&typeof(i[0])==="string"){return b(a[i[0]](),i[1]);}else{return g;}}}});};Date.fromSQL=function(g){var f=g.indexOf("-"),d=g.indexOf(":"),a=g.indexOf("."),b=new Date(),c=null,e;b.setHours(0,0,0,0);if(d===-1&&f===-1){return b;}if(a!==-1){e=g.substr(a+1,3);c=parseInt(e,10);if(e.length<3){c*=(e.length===2?10:100);}}if(f!==-1){b.setFullYear(parseInt(g.substr(f-4,4),10),parseInt(g.substr(f+1,2),10)-1,parseInt(g.substr(f+4,2),10));}if(d!==-1){b.setHours(parseInt(g.substr(d-2,2),10),parseInt(g.substr(d+1,2),10),parseInt(g.substr(d+4,2),10),c);b.setMinutes(b.getMinutes()-$ws._const.moscowTimeOffset-b.getTimezoneOffset());}return b;};Date.prototype.toServerTime=function(){this.setMinutes(this.getMinutes()+this.getTimezoneOffset()+$ws._const.moscowTimeOffset);return this;};Date.prototype.setLastMonthDay=function(a){a=a===undefined?this.getMonth():parseInt(a,10);this.setDate(1);this.setMonth(a+1);this.setDate(0);return this;};Object.isEmpty=function(b){if(typeof(b)!=="object"||b===null){return false;}if(b instanceof Object){for(var a in b){return false;}}return true;};Object.isValid=function(a){return a!==null&&!(a instanceof Date)&&typeof(a)=="object"&&!Object.isEmpty(a);};Object.sortedPairs=function(e,g){var n=Object.keys(e),m=[],a,b=function(j,i){var q=parseFloat(j),l=parseFloat(i),p=q+""===j,o=l+""===i;if(p&&o){return q>l?1:q<l?-1:0;}else{if(p&&!o){return 1;}else{if(!p&&o){return -1;}}}return j>i?1:j<i?-1:0;};g=g||false;for(var f=0,c=n.length;f<c;f++){m.push(e[n[f]]);}for(f=m.length-2;f>=0;f--){for(var d=0;d<=f;d++){var k=g?m:n;var h=b(k[d+1],k[d]);if(h<0){a=m[d];m[d]=m[d+1];m[d+1]=a;a=n[d];n[d]=n[d+1];n[d+1]=a;}}}return{keys:n,values:m};};if(Object.keys===undefined){Object.keys=function(b){var c=[];for(var a in b){if(b.hasOwnProperty(a)){c.push(a);}}return c;};}if(!Function.prototype.bind){Function.prototype.bind=function(a){var c=this,b=Array.prototype.slice.call(arguments,1);return function(){var d;if(b.concat){d=b.concat(Array.prototype.slice.call(arguments));}else{d=[];Array.prototype.push.apply(d,b);Array.prototype.push.apply(d,Array.prototype.slice.call(arguments));}return c.apply(a,d);};};}Function.prototype.debounce=function(a,c){var b=this,d;return function(){if(c&&!d){b.apply(this,arguments);}if(d){clearTimeout(d);}var e=Array.prototype.slice.call(arguments);e.unshift(this);d=setTimeout(b.bind.apply(b,e),a);};};Function.prototype.throttle=function(a,c){var e=this,b=e,d=1;return function(){if(d){b.apply(this,arguments);d=0;setTimeout(function(){d=1;},a);}else{b=e.bind(this,arguments);}};};Function.prototype.callNext=function(a){var b=this;return function(){var c=b.apply(this,arguments),d=c;if(a){Array.prototype.push.call(arguments,c);c=a.apply(this,arguments);}return c===undefined?d:c;};};Function.prototype.callNextWithCondition=function(a,b){if(a){return this.callNext(function(){if(b&&b.apply(this,[])){return a.apply(this,arguments);}});}else{return this;}};Function.prototype.callIf=function(b){var a=this;return function(){if(b&&b.apply(this,[])){return a.apply(this,arguments);}};};if(String.prototype.trim===undefined){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}if(String.trim===undefined){String.trim=function(a){return a.trim();};}if(!Object.create){Object.create=(function(){function a(){}return function(b){if(arguments.length!=1){throw new Error("Object.create implementation only accepts one parameter.");}a.prototype=b;return new a();};})();}Array.indexOf=function(b,c){if(!(b instanceof Array)){throw new TypeError("Incorrect type of the first arguments. Array expected");}if([].indexOf){return b.indexOf(c,arguments[2]);}var a=b.length;var d=Number(arguments[2])||0;d=(d<0)?Math.ceil(d):Math.floor(d);if(d<0){d+=a;}for(;d<a;d++){if(b[d]===c){return d;}}return -1;};Array.remove=function(a,b,c){var d=c?c:1;if(!(a instanceof Array)){throw new TypeError("Incorrect type of the first arguments. Array expected");}return a.splice(b,d);};Array.insert=function(a,b){if(!(a instanceof Array)){throw new TypeError("Incorrect type of the first arguments. Array expected");}if(typeof(b)=="undefined"){throw new TypeError("Index must be defined");}var d=b;for(var c=2;c<=arguments.length;c++){if(arguments.hasOwnProperty(c)){a.splice(d++,0,arguments[c]);}}return[];};function TransportError(f,c,e,a,d,b){this.message=f;this.httpError=c===undefined?"":c;this.code=e||0;this.name="Transport error";this.methodName=a||"";this.details=d||"";this.url=b||"";}function HTTPError(c,b,a,d){this.message=c||"";this.name="HTTP error";this.httpError=b===undefined?"":b;this.url=a||"";this.payload=d||"";this.processed=false;}$ws.core.classicExtend(HTTPError,Error);$ws.core.classicExtend(TransportError,HTTPError);TransportError.prototype.toString=function(){return[this.name,": ",this.message,"; method: ",this.methodName,"; code: ",this.code,"; httpError: ",this.httpError,"; details: ",this.details].join("");};HTTPError.prototype.toString=function(){return[this.name,": ",this.message,"; httpError: ",this.httpError,"; url: ",this.url].join("");};$ws._const.key={left:37,up:38,right:39,down:40,insert:45,del:46,space:32,backspace:8,minus:109,plus:107,enter:13,esc:27,f1:112,f3:114,f4:115,f5:116,f7:118,f12:123,meta:157,underscore:95,pageUp:33,pageDown:34,end:35,home:36,tab:9,ctrl:17,b:66,h:72,v:86,q:81,p:80,m:77,n:78,o:79};$ws._const.modifiers={nothing:0,shift:2,control:4,alt:8};$ws._const.operaKeys={43:"plus",45:"minus"};$ws.context={};$ws.single.base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",utf8:"UTF-8",win1251:"WINDOWS-1251",auto:"AUTO",encode:function(c,d){var a="";var l,j,g,k,h,f,e;var b=0;if(!d||d===this.utf8||(typeof d=="string"&&d.toUpperCase()===this.utf8)){c=$ws.single.iconv.unicode2utf(c);}else{if(d===this.auto||(typeof d=="string"&&d.toUpperCase()===this.auto)){c=$ws.single.iconv.unicode2utf(c);}else{if(d===this.win1251||(typeof d=="string"&&d.toUpperCase()===this.win1251)){c=$ws.single.iconv.unicode2win(c);}else{c=unescape(encodeURIComponent(c));}}}while(b<c.length){l=c.charCodeAt(b++);j=c.charCodeAt(b++);g=c.charCodeAt(b++);k=l>>2;h=((l&3)<<4)|(j>>4);f=((j&15)<<2)|(g>>6);e=g&63;if(isNaN(j)){f=e=64;}else{if(isNaN(g)){e=64;}}a=a+this._keyStr.charAt(k)+this._keyStr.charAt(h)+this._keyStr.charAt(f)+this._keyStr.charAt(e);}return a;},decode:function(c,d){var a="";var l,j,g;var k,h,f,e;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(b<c.length){k=this._keyStr.indexOf(c.charAt(b++));h=this._keyStr.indexOf(c.charAt(b++));f=this._keyStr.indexOf(c.charAt(b++));e=this._keyStr.indexOf(c.charAt(b++));l=(k<<2)|(h>>4);j=((h&15)<<4)|(f>>2);g=((f&3)<<6)|e;a=a+String.fromCharCode(l);if(f!=64){a=a+String.fromCharCode(j);}if(e!=64){a=a+String.fromCharCode(g);}}if(!d||d===this.utf8||(typeof d=="string"&&d.toUpperCase()===this.utf8)){a=$ws.single.iconv.utf2unicode(a);}else{if(d===this.win1251||(typeof d=="string"&&d.toUpperCase()===this.win1251)){a=$ws.single.iconv.win2unicode(a);}else{if(d===this.auto||(typeof d=="string"&&d.toUpperCase()===this.auto)){a=$ws.single.iconv.autoDetect(a);}else{a=decodeURIComponent(escape(c));}}}return a;}};$ws.single.iconv={_CP1251ToUnicode:{128:1026,129:1027,130:8218,131:1107,132:8222,133:8230,134:8224,135:8225,136:8364,137:8240,138:1033,139:8249,140:1034,141:1036,142:1035,143:1039,144:1106,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:65533,153:8482,154:1113,155:8250,156:1114,157:1116,158:1115,159:1119,160:160,161:1038,162:1118,163:1032,164:164,165:1168,166:166,167:167,168:1025,169:169,170:1028,171:171,172:172,173:173,174:174,175:1031,176:176,177:177,178:1030,179:1110,180:1169,181:181,182:182,183:183,184:1105,185:8470,186:1108,187:187,188:1112,189:1029,190:1109,191:1111},_UnicodeToCP1251:{1026:128,1027:129,8218:130,1107:131,8222:132,8230:133,8224:134,8225:135,8364:136,8240:137,1033:138,8249:139,1034:140,1036:141,1035:142,1039:143,1106:144,8216:145,8217:146,8220:147,8221:148,8226:149,8211:150,8212:151,65533:152,8482:153,1113:154,8250:155,1114:156,1116:157,1115:158,1119:159,160:160,1038:161,1118:162,1032:163,164:164,1168:165,166:166,167:167,1025:168,169:169,1028:170,171:171,172:172,173:173,174:174,1031:175,176:176,177:177,1030:178,1110:179,1169:180,181:181,182:182,183:183,1105:184,8470:185,1108:186,187:187,1112:188,1029:189,1109:190,1111:191},unicode2win:function(c){var b="";for(var d=0;d<c.length;d++){var a=c.charCodeAt(d);if(a<128){b+=String.fromCharCode(a);}else{if(a>=1040&&a<=1103){b+=String.fromCharCode(a-848);}else{if(a in this._UnicodeToCP1251){b+=String.fromCharCode(this._UnicodeToCP1251[a]);}else{return"";}}}}return b;},win2unicode:function(c){var b="";for(var d=0;d<c.length;d++){var a=c.charCodeAt(d);if(a<128){b+=String.fromCharCode(a);}else{if(a>=192&&a<=255){b+=String.fromCharCode(a+848);}else{if(a in this._CP1251ToUnicode){b+=String.fromCharCode(this._CP1251ToUnicode[a]);}else{return"";}}}}return b;},unicode2utf:function(b){var a="";b=b.replace(/\r\n/g,"\n");for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d);}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128);}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128);}}}return a;},utf2unicode:function(b){var a="";var f=0,g=0,e=0,d=0;while(f<b.length){g=b.charCodeAt(f);if(g<128){a+=String.fromCharCode(g);f+=1;}else{if((g>191)&&(g<224)){e=b.charCodeAt(f+1);a+=String.fromCharCode(((g&31)<<6)|(e&63));f+=2;}else{e=b.charCodeAt(f+1);d=b.charCodeAt(f+2);a+=String.fromCharCode(((g&15)<<12)|((e&63)<<6)|(d&63));f+=3;}}}return a;},autoDetect:function(c){var d,e;var f,a;var b=$ws.single.iconv.utf2unicode(c);for(f=0,d=0;d<b.length;d++){e=b.charCodeAt(d);if(e>=1040&&e<=1103){f++;}}for(a=0,d=0;d<c.length;d++){e=c.charCodeAt(d);if(e>192&&e<255){a++;}}if(f>=a){return b;}else{return $ws.single.iconv.win2unicode(c);}}};$ws.proto.AbstractConfig=$ws.proto.Abstract.extend({$protected:{_blo:null},$constructor:function(){this._publish("onChange");},_getObjectName:function(){throw new Error("AbstractConfig:_getObjectName must be implemented in child classes");},_getBLObject:function(){var b=new $ws.proto.Deferred(),a=this;if(this._blo===null){return b.dependOn($ws.core.attachComponent("Source").addCallback(function(){a._blo=new $ws.proto.BLObject(a._getObjectName());return a._blo;}));}else{b.callback(this._blo);}return b;},_processingParam:function(a,b,c){switch(a){case"update":$ws.single.GlobalContext.setValue(b,c);break;case"delete":$ws.single.GlobalContext.removeValue(b);break;}this._notify("onChange",b,c);},getParam:function(b){var a=this;return this._getBLObject().addCallback(function(c){return c.call("ПолучитьЗначение",{"Путь":b},$ws.proto.BLObject.RETURN_TYPE_ASIS).addCallback(function(d){a._processingParam("update",b,d);return d;});});},getParams:function(){var a=this;return this._getBLObject().addCallback(function(b){return b.call("ПолучитьПараметры",{},$ws.proto.BLObject.RETURN_TYPE_RECORDSET).addCallback(function(c){var d;c.rewind();while((d=c.next())!==false){a._processingParam("update",d.get("Название"),d.get("Значение"));}return c;});});},setParam:function(b,c){var a=this;return this._getBLObject().addCallback(function(d){return d.call("ВставитьЗначение",{"Путь":b,"ЗначениеПараметра":c},$ws.proto.BLObject.RETURN_TYPE_ASIS).addCallback(function(e){a._processingParam("update",b,c);return e;});});},removeParam:function(b){var a=this;return this._getBLObject().addCallback(function(c){return c.call("УдалитьПараметр",{"Путь":b},$ws.proto.BLObject.RETURN_TYPE_ASIS).addCallback(function(d){a._processingParam("delete",b);return d;});});}});$ws.single.ClientsGlobalConfig=new ($ws.proto.AbstractConfig.extend({_getObjectName:function(){return"ГлобальныеПараметрыКлиента";}}))();$ws.single.UserConfig=new ($ws.proto.AbstractConfig.extend({_getObjectName:function(){return"ПользовательскиеПараметры";},_processingParam:function(b,a,c){switch(b){case"update":$ws.single.MicroSession.set(a,c);$ws.single.MicroSession.set("userParamsDefined",true);break;case"delete":$ws.single.MicroSession.remove(a);break;}$ws.proto.AbstractConfig.prototype._processingParam.apply(this,arguments);}}))();$ws.proto.OrderedHashMap=$ws.core.extend({},{$protected:{_keys:[],_values:[],_reading:false,_helperHash:{}},put:function(a,b){this._checkConcurent();a=a+"";if(!this.contains(a)){this._keys.push(a);this._values.push(b);this._helperHash[a]=null;return true;}return false;},insert:function(b,c,d){this._checkConcurent();b=b+"";if(!this.contains(b)){var a;if(d!==undefined){d=d+"";if(!this.contains(d)){return false;}a=Array.indexOf(this._keys,d)+1;}else{a=0;}this._keys.splice(a,0,b);this._values.splice(a,0,c);this._helperHash[b]=null;return true;}return false;},get:function(b){var a=this._getKeyIndex(b);return a==-1?undefined:this._values[a];},remove:function(b){this._checkConcurent();var a=this._getKeyIndex(b);if(a!==-1){this._keys.splice(a,1);this._values.splice(a,1);delete this._helperHash[b];return true;}return false;},removeAll:function(d){if(d instanceof Array){var c=true;for(var b=0,a=d.length;b<a;b++){c&=this.remove(d[b]);}return !!c;}return false;},each:function(c){this._reading=true;try{for(var b=0,a=this._keys.length;b<a;b++){if(c.apply(this,[this._keys[b],this._values[b]])===false){break;}}}finally{this._reading=false;}},clear:function(){this._checkConcurent();this._keys=[];this._values=[];this._helperHash={};},destroy:function(){this._keys=null;this._values=null;this._helperHash=null;},contains:function(a){return this._helperHash[a]!==undefined;},_checkConcurent:function(){if(this._reading){throw new ReferenceError("Конкурентная модификация объекта. Попытка изменения при переборе");}},_getKeyIndex:function(a){return Array.indexOf(this._keys,a+"");}});(function(){var doT={version:"0.2.0",templateSettings:{evaluate:/\{\{([\s\S]+?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:true,append:true,selfcontained:false},template:undefined,compile:undefined};var global=(function(){return this||(0,eval)("this");}());if(typeof module!=="undefined"&&module.exports){module.exports=doT;}else{if(typeof define==="function"&&define.amd){define(function(){return doT;});}else{global.doT=doT;}}function encodeHTMLSource(){var encodeHTMLRules={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},matchHTML=/&(?!#?\w+;)|<|>|"|'|\//g;return function(code){return code?code.toString().replace(matchHTML,function(m){return encodeHTMLRules[m]||m;}):code;};}global.encodeHTML=encodeHTMLSource();var startend={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},skip=/$^/;function resolveDefs(c,block,def){return((typeof block==="string")?block:block.toString()).replace(c.define||skip,function(m,code,assign,value){if(code.indexOf("def.")===0){code=code.substring(4);}if(!(code in def)){if(assign===":"){def[code]=value;}else{eval("def['"+code+"']="+value);}}return"";}).replace(c.use||skip,function(m,code){var v=eval(code);return v?resolveDefs(c,v,def):v;});}function unescape(code){return code.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ");}doT.template=function(tmpl,c,def){c=c||doT.templateSettings;var cse=c.append?startend.append:startend.split,str,needhtmlencode,sid=0,indv;if(c.use||c.define){var olddef=global.def;global.def=def||{};str=resolveDefs(c,tmpl,global.def);global.def=olddef;}else{str=tmpl;}str=("var out='"+(c.strip?str.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):str).replace(/'|\\/g,"\\$&").replace(c.interpolate||skip,function(m,code){return cse.start+unescape(code)+cse.end;}).replace(c.encode||skip,function(m,code){needhtmlencode=true;return cse.startencode+unescape(code)+cse.end;}).replace(c.conditional||skip,function(m,elsecase,code){return elsecase?(code?"';}else if("+unescape(code)+"){out+='":"';}else{out+='"):(code?"';if("+unescape(code)+"){out+='":"';}out+='");}).replace(c.iterate||skip,function(m,iterate,vname,iname){if(!iterate){return"';} } out+='";}sid+=1;indv=iname||"i"+sid;iterate=unescape(iterate);return"';var arr"+sid+"="+iterate+";if(arr"+sid+"){var "+vname+","+indv+"=-1,l"+sid+"=arr"+sid+".length-1;while("+indv+"<l"+sid+"){"+vname+"=arr"+sid+"["+indv+"+=1];out+='";}).replace(c.evaluate||skip,function(m,code){return"';"+unescape(code)+"out+='";})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|}|^|{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|}|^|{)out\+=''\+/g,"$1out+=");if(needhtmlencode&&c.selfcontained){str="var encodeHTML=("+encodeHTMLSource.toString()+"());"+str;}try{return new Function(c.varname,str);}catch(e){$ws.single.ioc.resolve("ILogger").log("doT","Could not create a template function: "+str);throw e;}};doT.compile=function(tmpl,def){return doT.template(tmpl,null,def);};}());(function(){var global=(function(){return this||(0,eval)("this");}()),_loading={},_test_module_map={};function _construct(name,namespace,imports,constructor){var nsComp=namespace.split(".");var root=global;var fullName=[namespace,name].join(".");for(var i=0,l=nsComp.length;i<l;i++){var current=nsComp[i];if(!root[current]){root[current]={};}root=root[current];}root[name]=constructor.apply(global,imports);(_loading[fullName]=_loading[fullName]||new $ws.proto.Deferred()).callback();}function _getMod(name){var root=global;var nComp=name.split(".");for(var i=0,l=nComp.length;i<l;i++){if(!root[nComp[i]]){return false;}root=root[nComp[i]];}return root;}function _require(mods){var pdR=new $ws.proto.ParallelDeferred(),result=[];if(!(mods instanceof Array)){mods=[mods];}$ws.helpers.forEach(mods,function(m,i){var _m=_getMod(m);if(_m){result[i]=_m;}else{(function(i){var url="";if($ws._const.jsModules[m]){url=$ws._const.resourceRoot+$ws._const.jsModules[m];}else{if($ws._const.jsCoreModules[m]){url=$ws._const.jsCoreModules[m];}}if(!url){throw new Error("Неизвестный модуль "+m);}if(!_loading[m]){_loading[m]=new $ws.proto.Deferred();$ws.core.attach(url);}_loading[m].addCallback(function(){result[i]=_getMod(m);});pdR.push(_loading[m]);})(i);}});return pdR.done(result).getResult();}$ws.proto.IDeclareModule=$ws.core.extend({},{declare:function(config,constructor){throw new Error("IDeclareModule::declare method is not implemented");}});$ws.proto.DeclareModule=$ws.core.extend($ws.proto.IDeclareModule,{declare:function(config,constructor){if(!config){throw new Error("Не задана конфигурация модуля");}if(!config.name){throw new Error("На задано имя модуля");}if(!config.namespace){throw new Error("Не задано пространство имен модуля");}if(_getMod([config.namespace,config.name].join("."))!==false){return;}_require(config.imports||[]).addCallback(function(imports){_construct(config.name,config.namespace,imports,constructor);});}});$ws.proto.TestDeclareModule=$ws.core.extend($ws.proto.IDeclareModule,{declare:function(config,constructor){var module_name=[config.namespace,config.name].join(".");_test_module_map[module_name]={config:config,constructor:constructor};}});$ws.testModule=function(module_name,mocks){var global=(function(){return this||(0,eval)("this");}());function _construct(module,test){var imports=[];for(var i in module.config.imports){var name=module.config.imports[i];imports.push(mocks&&mocks[name]||_construct(_test_module_map[name]));}if(test){imports.push(test);}return module.constructor.apply(global,imports);}return _construct(_test_module_map[module_name],mocks.test);};$ws.requireModule=_require;$ws.declareModule=function(config,constructor){return $ws.single.ioc.resolve("IDeclareModule").declare(config,constructor);};}());$ws.single.DependencyResolver={_store:{},_parents:{},register:function(c,b,a){this._store[c]=b;this._parents[c]=a;},resolve:function(e,c){var a=[],d=e.split("/"),b=this._parents[e]?this._parents[e].split("/"):[];while(d.length){this._addDependency(a,d.join("/"),c,true);d.pop();}while(b.length){this._addDependency(a,b.pop(),c,true);}return a.sort();},_addDependency:function(c,e,d,f){var b=this;e=$ws.single.ClassMapper.getClassMapping(e);if(Array.indexOf(c,e)==-1){if(!f){c.push(e);}if(this._store[e]){var a=typeof this._store[e]=="function"?this._store[e](d):this._store[e];if(a&&a instanceof Array){$ws.helpers.forEach(a,function(g){b._addDependency(c,g);});}}}}};$ws.single.Indicator={_container:undefined,_ready:false,_dReady:undefined,_init:function(a){var b=this;if(!a){a={};}a.handlers={onReady:function(){b._ready=true;}};if(!this._dReady){this._dReady=$ws.core.attachInstance("SBIS3.CORE.LoadingIndicator",a).addCallback(function(c){b._container=c;return c;});}return this._dReady;},show:function(){if(!this._ready){this._init().addCallback(function(a){a.show();return a;});}else{this._container.show();}return this;},setMessage:function(a){if(!this._ready){this._init().addCallback(function(b){b.setMessage(a);b.subscribe("onReady",function(){this.setMessage(a);});return b;});}else{this._container.setMessage(a);this._container.show();}return this;},hide:function(){if(this._ready){this._container.hide();}else{this._init().addCallback(function(a){a.hide();return a;});}return this;},progressBar:function(b){var a=this;if(!this._ready){a=this.destroy();a._init({progressBar:b});}else{if(!(this._container._myProgressBar&&b)){a=this.destroy();a._init({progressBar:b});}}return a;},setProgress:function(a){if(!this._ready){this._init().addCallback(function(b){b.setProgress(a);b.subscribe("onReady",function(){this.setProgress(a);});return b;});}else{this._container.setProgress(a);}return this;},destroy:function(){if(this._ready){this._container.destroy();}else{this._init().addCallback(function(a){a.destroy();return a;});}this._container=undefined;this._ready=false;this._dReady=undefined;return this;}};(function(){var global=(function(){return this||(1,eval)("this");}());var bindings=$ws.core.merge({IRecord:"ClientRecord",IRecordSet:"ClientRecordSet",ITransport:"XHRTransport",IXMLDocument:"ClientXMLDocument",IBLObject:"ClientBLObject",IEnum:"ClientEnum",IAttachLoader:{name:"WindowAttachLoader",single:true},ILogger:{name:"ConsoleLogger",single:true},IDeclareModule:{name:"DeclareModule",single:true}},global.wsBindings||{},{rec:false});$ws.single.Storage.store("Source/FastSource",function(def){def.callback();return def;});$ws.helpers.forEach(bindings,function(target,iface){var single=false;if(target.single){target=target.name;single=true;}if(single){$ws.single.ioc.bindSingle(iface,target);}else{$ws.single.ioc.bind(iface,target);}});$ws.single.ClassMapper.setClassMapping({"Control/Field:FieldImage":"Control/FieldImage","Control/Field:FieldDropdown":"Control/FieldDropdown","Control/Field:FieldCheckbox":"Control/FieldCheckbox","Control/Field:FieldRadio":"Control/FieldRadio","Control/Field:FieldNumeric":"Control/FieldNumeric","Control/Field:FieldInteger":"Control/FieldInteger","Control/Field:FieldMoney":"Control/FieldMoney","Control/Field:FieldLabel":"Control/FieldLabel","Control/Field:FieldFormatAbstract":"Control/FieldFormatAbstract","Control/Field:FieldDate":"Control/FieldDate","Control/Field:FieldLinkNew":"Control/FieldLink","Control/Field:FieldMonth":"Control/FieldMonth","Control/Field:FieldButton":"Control/Button","Control/Field:FileScaner":"Control/FileScaner","Control/Field:FileBrowse":"Control/FileBrowse","Control/Field:FieldDatePicker":"Control/FieldDatePicker","Control/Area:ToolBar":"Control/ToolBar","Control/Area:OperationsPanel":"Control/Area/OperationsPanel","Control/Area:GroupCheckBox":"Control/GroupCheckBox","Control/Area:Tabs":"Control/Tabs","Control/Area:HTMLView":"Control/HTMLView","Control/Area:FiltersArea":"Control/FiltersArea","Control/Area:FiltersDialog":"Control/FiltersDialog","Control/Area:FiltersWindow":"Control/FiltersWindow","Control/DataView/TableView":"Control/TableView","Control/DataViewAbstract/TableView/TreeView":"Control/TreeView","Source/FastSource:FastRecordSet":"Source:RecordSet","Source/FastSource:FastRecord":"Source:Record"});if("WSRootPath" in global){$ws._const.wsRoot=global.WSRootPath;}if("ResourcePath" in global){$ws._const.resourceRoot=global.ResourcePath;}if("ServicesPath" in global){$ws._const.defaultServiceUrl=global.ServicesPath;}if("WSTheme" in global){$ws._const.theme=global.WSTheme;}$ws.core.merge($ws._const,global.wsConfig||{},{rec:false});global.TransportError=TransportError;global.HTTPError=HTTPError;}());$ws.java.init();$ws.core.ready=new $ws.proto.Deferred().callback();if(window){var spanAllTime=BOOMR.plugins.WS.startSpan("AllTime",{stacked:true});$ws.core.ready.addCallback(function(){var a=new $ws.proto.Deferred().addCallback(function(){if(!$ws._const.nostyle){return $ws.core.attach("css/core.css").addErrback(function(){$ws.single.ioc.resolve("ILogger").log("Core","Core style loading failed");return"";});}});if(!("jQuery" in window&&"proxy" in jQuery&&parseFloat(window.jQuery.fn.jquery)>=1.6)){a.dependOn($ws.core.attach("ext/jquery-min.js"));}else{a.callback();}return a;}).addCallback(function(){(function(b){b.fn.wsFixedLiveClick=function(d,c){var e=this.context;this.live("click",function(g){var f=this;g.stopPropagation();if("\v"=="v"){g.stopPropagation=g.stopImmediatePropagation=g.preventDefault=g.originalEvent.stopPropagation=g.originalEvent.preventDefault=function(){};}setTimeout(function(){var i=parseInt(f.getAttribute("wsFixedClick"),10);if(i>0){f.setAttribute("wsFixedClick",--i);}else{d.apply(f,[g]);if(!g.isPropagationStopped()){var h;if(document.createEvent){h=document.createEvent("MouseEvents");h.initMouseEvent("click",true,true,document.defaultView,1,0,0,0,0,false,false,false,false,0,null);e.dispatchEvent(h);}else{if(document.createEventObject){h=document.createEventObject();h.type="click";e.fireEvent("onclick",h);}}}}},300);}).live("dblclick",function(f){this.setAttribute("wsFixedClick",("\v"=="v")?1:2);c.apply(this,[f]);});};b.fn.wsFixedLiveClick2=function(d,c){return this.live("click",function(g){var e=b(this),h=e.data("wsClickTime"),f=new Date().getTime();if(h&&Math.abs(f-h)<=300){e.data("wsClickTime",undefined);}else{e.data("wsClickTime",f);d.call(this,g);}}).live("dblclick",function(e){c.call(this,e);});};})(jQuery);$ws._const.$win=$(window);$ws._const.$doc=$(document);var a=new $ws.proto.ParallelDeferred();if(!jQuery.dtLayoutEngine){a.push($ws.core.attach("ext/layout/dt_layout.js"));}if(!("JSON" in window)){a.push($ws.core.attach("ext/json-min.js"));}if(!("cookie" in jQuery)){a.push($ws.core.attach("ext/jquery-cookie-min.js"));}if($ws._const.theme!==""&&!$ws._const.nostyle){a.push($ws.core.attach("css/themes/"+$ws._const.theme+".css").addErrback(function(){$ws.single.ioc.resolve("ILogger").log("Core","Theme '"+$ws._const.theme+"' is not found. Continue with default.");return"";}));}return a.done().getResult();}).addCallback(function(){if(window.contents&&!Object.isEmpty(window.contents)){$ws.core.loadContents(window.contents);}else{var spanAllTime2=BOOMR.plugins.WS.startSpan("AllTime",{stacked:true});return $ws.single.ioc.resolve("ITransport",{url:$ws._const.resourceRoot+"contents"+($ws._const.buildnumber?(".v"+$ws._const.buildnumber):"")+".js",dataType:"text"}).execute(null).addCallback(function(response){var contents={};eval(response);$ws.core.loadContents(window.contents?$ws.core.merge(contents,window.contents):contents);spanAllTime2.stop();return contents;}).addErrback(function(){$ws.core.loadContents(false);spanAllTime2.stop();return"";});}}).addCallback(function(){var d=location.search;if(d.indexOf("?")===0){var b=d.substr(1).split("&");for(var e=0,a=b.length;e<a;e++){var c=b[e].indexOf("=");$ws.single.GlobalContext.setValue(decodeURIComponent(b[e].substring(0,c)),decodeURIComponent(b[e].substring(c+1)));}}}).addCallback(function(){if(window){return $ws.single.MicroSession.init();}}).addCallback(function(){if(window){var e=$ws.single.MicroSession.get("previousUrl"),d=$ws.single.MicroSession.get("previousUrlHelper");if(e!=window.location.toString()){$ws.single.MicroSession.set("previousUrlHelper",e);}else{e=d;}window.previousPageURL=e;$ws.single.MicroSession.set("previousUrl",window.location.toString());$ws.single.HashManager.subscribe("onChange",function(){$ws.single.MicroSession.set("previousUrl",window.location.toString());});$ws.single.WindowManager.init();}var a=new $ws.proto.ParallelDeferred();if($ws._const.userConfigSupport){if(!$ws.single.MicroSession.get("userParamsDefined")){a.push($ws.single.UserConfig.getParams());}else{var c=$ws.single.MicroSession.toObject();for(var b in c){if(c.hasOwnProperty(b)){$ws.single.GlobalContext.setValue(b,c[b]);}}}}a.push($ws.single.ClientsGlobalConfig.getParams());return a.done().getResult().addErrback(function(f){$ws.single.ioc.resolve("ILogger").error("Ошибка при загрузке параметров",f.message,f);return"";});}).addBoth(function(a){spanAllTime.stop();if(a instanceof Error){$ws.single.ioc.resolve("ILogger").error("Ошибка инициализации ядра",a.message,a);}return a;});}