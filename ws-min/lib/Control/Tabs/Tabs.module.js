$ws.declareModule({namespace:"SBIS3.CORE",name:"Tabs",imports:["SBIS3.CORE.TemplatedAreaAbstract"]},function(a){$ws._const.Tabs={animationSpeed:4,animationTimer:30,animationLimit:4,scrollButtonsVerticalTextHeight:36,scrollButtonsWidth:52,tabScrollButtonsHeight:18,tabSheetBorder:2,firstHorizontalScrollButtonPadding:0,secondHorizontalScrollButtonPadding:26,iconPadding:18,verticalTextFirstScrollPadding:0,scrollDisabledOpacity:0.5,scrollEnabledOpacity:1,scrollButtonsBonusWidth:10};$ws.proto.Tabs=a.extend({$protected:{_options:{tabs:[],scrollable:true,position:"top",width:"auto",height:"120px",instantLoad:false,showLabels:true,verticalText:false,labelsWidth:"auto",hasBorder:true,defaultTab:"",align:"left"},_tabsSheets:{},_tabsLabels:{},_loaded:{},_templates:{},_block:undefined,_header:undefined,_body:undefined,_fullWidth:0,_minWidth:0,_previousLabelsWidths:{},_labelsWidths:{},_labelsIconPosition:"left",_scrollButtons:{},_isScrollButtonsShowed:false,_scrollButtonsDisabled:{left:true,right:false},_controls:{},_currentId:undefined,_scrollWidth:"outerWidth",_scrollMargin:"marginLeft",_isScrollVertical:false,_scrollButtonsWidth:35,_scrollShadows:{},_currentMargin:0,_isScrollAnimation:false,_scrollToMargin:0,_bodyPadding:undefined,_tabsLabelOuterH:undefined,_tabsLabelOuterV:undefined,_spacing:undefined,_hiddenTabs:{},_disabledTabs:{},_firstTabReady:null,_allLabelsShowed:true,_prevWidth:0,_builded:false,_defaultTab:0,_scrollBarWidth:0,_headerScrolled:false,_ready:undefined,_animationDisabled:false},$constructor:function(){this._firstTabReady=new $ws.proto.Deferred();this._ready=new $ws.proto.Deferred();this._publish("onTabChange","onTabLoaded","onBeforeShowFirstTab");this._scrollBarWidth=$ws.helpers.getScrollWidth();this._block=$('<div class="ws-tabs"></div>').width(this._horizontalAlignment==="Stretch"?"auto":this._options.width).height(this._verticalAlignment==="Stretch"?"auto":this._options.height);if(this._options.showLabels){if(this._options.position!=="top"&&!this._options.scrollable){this._options.scrollable=true;}if((this._options.position!=="top"&&this._options.position!=="bottom")||!this._options.scrollable){this._options.align="left";}this._header=$('<div class="ws-tabs-header'+(this._options.scrollable?" scrollable":"")+'"></div>');}this._defaultTab=parseInt(this._options.defaultTab,10)||0;},_getControlsToBuild:function(f,g){var b=$ws.proto.Tabs.superclass._getControlsToBuild.apply(this,arguments);var e=this._notify("onBeforeShowFirstTab",this._options.defaultTab);if(e&&typeof(e)==="string"){for(var d=0;d<this._options.tabs.length;++d){if(this._options.tabs[d].title===e){e=d;break;}}}this._defaultTab=parseInt(e||this._options.defaultTab,10)||0;if(this._options.instantLoad){return b;}else{if(b&&b.length){var c=this._container.children(":not(.r)").eq(this._defaultTab);if(c.attr("wsControl")){return $ws.helpers.filter(b,function(h){return h.id==c.attr("id");});}else{return[];}}else{return[];}}},_childrenLoadCallback:function(){return this._runInBatchUpdate("Tabs._childrenLoadCallback",function(){var b=this;this._block.get(0).onscroll=function(){b._block.scrollTop(0).scrollLeft(0);};this._container.get(0).onscroll=function(){b._container.scrollTop(0).scrollLeft(0);};this._initBody();this._initPosition();this._build();this._initResizers();this._addEventListeners();this._calculateFullWidth();this._prevWidth=this._block.width();$ws.single.ControlStorage.waitChildByName(this.getName()).addCallback(function(){b._notify("onStateChanged");b.subscribe("onTabChange",function(d,f,c){b._notify("onStateChanged",f,!c);});});this._notifyOnSizeChanged(this,this,true);this._container.scrollTop(0);this._container.scrollLeft(0);this._notify("onReady");this._notify("onBeforeShow");return this._firstTabReady.createDependent().addBoth(function(){b._isReady=true;b._showControls();b._notifyBatchDelayed("onAfterShow");b._ready.callback();});});},_initBody:function(){this._body=$('<div class="ws-tabs-body"></div>');var b=this;this._container.children(":not(.r)").each(function(c){var d=$(this);if(d.attr("wsControl")!==undefined){d.addClass("ws-hidden");var h=b._options.tabs[c],f=h.id||c;b._tabsSheets[f]=d;try{b._controls[f]=b.getChildControlById(d.attr("id"));b._loaded[f]=true;}catch(g){b._loaded[f]=false;}d.addClass("ws-tabs-div").appendTo(b._body);if(b._defaultTab===c||b._options.instantLoad){b._notifyBatchDelayed("onTabLoaded",f+"");}else{if(!d.attr("hasMarkup")){d.empty();}}}});if(!this._options.hasBorder){this._body.css("border","none");}else{if(this._options.isRelative&&!this._options.autoWidth){this._body.find(".ws-tabs-div").addClass("ws-tabs-div-relative");}}this._bodyPadding=$("<div></div>").addClass("ws-tabs-body-pad");if(this._verticalAlignment!="Stretch"){this._container.addClass("ws-control-relative");}},_templateInnerCallback:function(){},getReadyDeferred:function(){return this._ready;},applyState:function(b){this.setCurrentTab(b,undefined,true);},_updateResizer:function(){var d=this.getCurrentTabArea();if(d&&this._resizer){var c=d.getMinSize(),e=(c.minWidth>this._container.width())?this._scrollBarWidth:0,b=(c.minHeight>this._container.height())?this._scrollBarWidth:0;if(this._horizontalAlignment==="Stretch"&&!this._options.autoWidth){c.minWidth=0;c.minHeight+=e;}if(this._verticalAlignment==="Stretch"&&!this._options.autoHeight){c.minHeight=0;c.minWidth+=b;}if(this._options.showLabels){if(this._options.position==="left"||this._options.position==="right"){c.minWidth+=this._header.height()+1;}else{c.minHeight+=this._header.height()+1;c.minWidth=Math.max(c.minWidth,this._minWidth+1);}}if(this._options.hasBorder){c.minWidth+=2;c.minHeight+=2;}if(c.minWidth<this._options.minWidth){c.minWidth=this._options.minWidth;}if(c.minHeight<this._options.minHeight){c.minHeight=this._options.minHeight;}this._resizer.height(c.minHeight).width(c.minWidth);}},_initPosition:function(){if(this._options.showLabels&&this._options.position!=="bottom"){this._header.appendTo(this._block);}this._bodyPadding.appendTo(this._block);this._body.appendTo(this._bodyPadding);if(this._options.position==="bottom"&&this._options.showLabels){this._header.appendTo(this._block);}if(!this._options.showLabels){this._bodyPadding.css("padding",0);}else{this._header.addClass((this._options.position=="left"||this._options.position=="right")?"vertical":"horizontal");if((this._options.position==="top"||this._options.position==="bottom")&&this._options.scrollable){this._header.addClass(this._options.align);this._scrollMargin="margin"+(this._options.align==="left"?"Left":"Right");}}this._block.appendTo(this._container);if(this._options.showLabels){if(this._options.position==="left"||this._options.position==="right"){if(!this._options.verticalText||$.browser.msie){this._scrollWidth="outerHeight";}this._header.addClass(this._options.position);if(this._options.verticalText){this._header.css({"padding-top":0});this._bodyPadding.css("padding-"+this._options.position,this._header.height()).css({position:"relative",top:"0px"});}this._scrollMargin="marginTop";this._isScrollVertical=true;}else{this._body.addClass(this._options.position);this._header.addClass(this._options.position);this._options.verticalText=false;}this._scrollButtonsWidth=this._isScrollVertical?(this._options.verticalText?$ws._const.Tabs.scrollButtonsVerticalTextHeight:$ws._const.Tabs.tabScrollButtonsHeight):$ws._const.Tabs.scrollButtonsWidth;}this._body.height(this._bodyPadding.height()-(this._options.hasBorder?$ws._const.Tabs.tabSheetBorder:0));this._block.addClass(this._isScrollVertical?"vertical":"horizontal").addClass(this._options.verticalText?"verticalText":"horizontalText");if(!this._isScrollVertical){this._bodyPadding.css("padding-"+this._options.position,(this._options.showLabels?this._header.outerHeight():0)+"px");}},_getHeaderLimit:function(){if(!this._isScrollVertical){return this._block.width()-this._getScrollButtonsWidth();}var c=this._block.height(),b=this._isScrollButtonsShowed?(this._scrollButtonsWidth+((this._isScrollVertical&&!this._options.verticalText&&c<this._fullWidth)?$ws._const.Tabs.tabScrollButtonsHeight:0)):0;return c-b;},_getScrollButtonsWidth:function(){return(this._isScrollButtonsShowed?this._scrollButtonsWidth:0);},_isOverflow:function(){if(!this._isScrollVertical){return this._fullWidth>this._block.width();}return this._fullWidth>this._block.height();},_calculateFullWidth:function(){this._fullWidth=0;if(!this._options.showLabels||!this._body.get(0).offsetWidth){return;}var e=null,d,c=undefined,b=this._header.width();this._header.scrollTop(0);if($.browser.msie){this._header.width(32767);}d=this._forEachVisibleTabLabels(function(h,g){if(c===undefined){c=h;}this._tabsLabels[h].width(this._options.labelsWidth);this._labelsWidths[h]=this._tabsLabels[h].outerWidth();if(this._tabsLabelOuterH===undefined){this._tabsLabelOuterH=this._labelsWidths[h]-this._tabsLabels[h].width();}if(this._tabsLabelOuterV===undefined){this._tabsLabelOuterV=this._tabsLabels[h].outerHeight()-this._tabsLabels[h].height();}if(this._options.verticalText&&!$.browser.msie){if(this._labelsWidths[h]%2!==0){this._tabsLabels[h].width(this._labelsWidths[h]+1-this._tabsLabelOuterH);++this._labelsWidths[h];}}var f=this._tabsLabels[h][this._scrollWidth]();this._previousLabelsWidths[h]=(e?this._previousLabelsWidths[e]:0)+f+this._spacing;if(this._options.verticalText){if($.browser.msie){this._tabsLabels[h].width("auto");this._tabsLabels[h].css({top:(this._previousLabelsWidths[h]-f)+"px",left:"0px"}).width(f-this._tabsLabelOuterH).height(f).css("margin-"+(this._options.position==="left"?"right":"left"),(-f+b-this._tabsLabelOuterV)+"px");}else{if(this._options.position==="left"){this._tabsLabels[h].css({top:this._previousLabelsWidths[h]+"px",left:"0"});}else{this._tabsLabels[h].css({top:(this._previousLabelsWidths[h]-this._labelsWidths[h]-this._tabsLabels[h].outerHeight())+"px",left:"0"});}}}if(e){this._fullWidth+=this._spacing;}e=h;return g+1;},0);if($.browser.msie&&this._options.verticalText){this._header.width(b);}this._fullWidth=this._previousLabelsWidths[e];this._calculateMinWidth(d,c);},_forEachVisibleTabLabels:function(c,b){return $ws.helpers.reduce(this._tabsLabels,function(d,e,f){return(f in this._hiddenTabs)?d:c.call(this,f,d);},b,this);},_calculateMinWidth:function(d,c){this._minWidth=0;if(this._fullWidth===0||!this._options.showLabels){return;}if(d===undefined||c===undefined){d=this._forEachVisibleTabLabels(function(f,e){if(c===undefined){c=f;}return e+1;},0);}var b=this._currentId;if(b===null||b===undefined){b=c;}if(d>0&&this._labelsWidths[b]){this._minWidth=this._labelsWidths[b];if(d>1&&this._options.scrollable){this._minWidth+=this._scrollButtonsWidth;}}},_animateHeader:function(d){var b=this,c=function(){if(Math.abs(b._scrollToMargin-b._currentMargin)<=$ws._const.Tabs.animationLimit){b._currentMargin=b._scrollToMargin;b._isScrollAnimation=false;}else{b._currentMargin+=Math.ceil((b._scrollToMargin-b._currentMargin)/$ws._const.Tabs.animationSpeed);if(b._currentMargin%2!==0){--b._currentMargin;}setTimeout(c,$ws._const.Tabs.animationTimer);}b._header.css(b._scrollMargin,b._currentMargin+"px");};this._scrollToMargin=d;if(this._headerScrolled&&!this._animationDisabled){if(!this._isScrollAnimation){this._isScrollAnimation=true;c();}}else{this._header.css(this._scrollMargin,this._currentMargin=d);}},_growTopLabels:function(){var k,g,c=0,h=[],d=0,b=0,f=true,l=this,e=function(){b=d*(((k-c)/d)-Math.floor((k-c)/d));for(var i=0;i<d;++i){var m=h[i];l._tabsLabels[m].width(l._labelsWidths[m]+Math.floor((k-c)/d)-l._tabsLabelOuterH+b-l._spacing+(i+1==d?l._spacing:0));if(f){l._tabsLabels[m].addClass(l._options.position);}else{l._tabsLabels[m].removeClass(l._options.position);}if(i+1==d){l._tabsLabels[m].css("margin","0");}else{l._setTabMargin(m);}b=0;}f=false;h=[];d=0;c=0;};k=this._block.width()-(this._header.outerWidth()-this._header.width());for(g in this._tabsLabels){if(g in this._hiddenTabs){continue;}if(!this._tabsLabels.hasOwnProperty(g)){continue;}var j=this._labelsWidths[g];if(c+j>k){e();}h.push(g);c+=this._labelsWidths[g];++d;}e();this._header.width(k);},_setSideLabelsWidth:function(){var d=0,c,b=this._block.width()/2;for(c in this._labelsWidths){if(!this._labelsWidths.hasOwnProperty(c)){continue;}if(this._labelsWidths[c]>d){d=this._labelsWidths[c];}}if(d>b){d=b;}for(c in this._tabsLabels){if(!this._tabsLabels.hasOwnProperty(c)){continue;}this._tabsLabels[c].width(d-this._tabsLabelOuterH);}for(c in this._scrollButtons){if(!this._scrollButtons.hasOwnProperty(c)){continue;}this._scrollButtons[c].width(d-$ws._const.Tabs.scrollButtonsBonusWidth);}for(c in this._scrollShadows){if(!this._scrollShadows.hasOwnProperty(c)){continue;}this._scrollShadows[c].width(d);}this._header.width(d);this._bodyPadding.css("padding-"+this._options.position,this._header.outerWidth()+"px");},_resizeHeaderAndBodyForContainer:function(){if(!this._fullWidth){this._calculateFullWidth();}var d=null,f=0;if(this._options.showLabels){if(!this._options.scrollable){this._growTopLabels();}if(this._isScrollVertical&&!this._options.verticalText){this._setSideLabelsWidth();}if(this._options.align==="right"){f=this._block.width();this._currentMargin+=f-this._prevWidth;this._header.css(this._scrollMargin,this._currentMargin+"px");}if(this._isOverflow()){if(this._options.scrollable){if(!this._isScrollButtonsShowed){for(d in this._scrollButtons){if(!this._scrollButtons.hasOwnProperty(d)){continue;}this._scrollButtons[d].removeClass("ws-hidden");if(this._scrollShadows[d]){this._scrollShadows[d].removeClass("ws-hidden");}}this._isScrollButtonsShowed=true;}var g=parseInt(this._header.css(this._scrollMargin),10);if(isNaN(g)){g=0;}if(this._options.align==="right"){if(this._allLabelsShowed){this._header.css(this._scrollMargin,this._currentMargin=(this._getHeaderLimit()-this._fullWidth+this._getScrollButtonsWidth()));}else{var c=this._getScrollButtonsWidth();if(g>c){this._animateHeader(c);}}}else{var e=this._getHeaderLimit()-this._fullWidth;if(g<e){this._animateHeader(e);}}if(this._options.align==="right"){this._checkDisabled(this._currentMargin);}else{this._checkDisabled(Math.max(e,g));}}}else{this._allLabelsShowed=true;if(this._isScrollButtonsShowed){for(d in this._scrollButtons){if(!this._scrollButtons.hasOwnProperty(d)){continue;}this._scrollButtons[d].addClass("ws-hidden");if(this._scrollShadows[d]){this._scrollShadows[d].addClass("ws-hidden");}}this._animateHeader(0);this._isScrollButtonsShowed=false;}else{this._header.css(this._scrollMargin,this._currentMargin=0);}}if(this._options.align==="right"){this._prevWidth=f;}}var b=this._options.showLabels?this._header.outerHeight():0,h=this._block.outerHeight(),j=Math.max(0,h-(!this._isScrollVertical?b:0));if(this._options.position==="top"&&!this._options.scrollable){this._bodyPadding.css("padding-top",b+"px");}this._bodyPadding.height(j);this._body.height(j-(this._options.hasBorder?$ws._const.Tabs.tabSheetBorder:0));if(this._options.showLabels){this._header.css("padding-top",(this._isScrollVertical&&!this._options.verticalText&&h<this._fullWidth)?$ws._const.Tabs.tabScrollButtonsHeight:0);if(this._currentId!==null){this._animationDisabled=true;this.scrollToTab(this._currentId);this._animationDisabled=false;}}},_onResizeHandler:function(){if(!this._isReady){return;}this._resizeHeaderAndBodyForContainer();var b=this.getCurrentTabArea();if(b){b._onResizeHandler();}this._calcStretchPosition();},_getBlockId:function(b){return"ws-tabs-"+this.getId()+"-"+b;},scrollToTab:function(h){if(this._hiddenTabs[h]!==undefined){return;}var g=parseInt(this._header.css(this._scrollMargin),10),d=this._tabsLabels[h][this._scrollWidth](),e=0,f=this._getHeaderLimit(),c=this._previousLabelsWidths[h]-d;if(isNaN(g)){g=0;}if(this._options.align==="right"){e=this._block.width();g=e-this._fullWidth-g;}var b=false;if(-g>=c){g=Math.min(0,-c);b=true;}else{if(f-g<this._previousLabelsWidths[h]){g=Math.min(0,(f-this._previousLabelsWidths[h]));if(-g>=c){g=-c;}b=true;}}if(b){if(this._options.align==="right"){g=e-(this._fullWidth+g);}if(!this._animationDisabled){this._headerScrolled=true;}this._animateHeader(g);this._checkDisabled(g);}},setCurrentTab:function(e,d,c){var b=this;return this._runInBatchUpdate("setCurrentTab",function(){function l(){if(d){var i=$ws.single.WindowManager.getActiveWindow();while(i&&i.getParent){if(i.getId()!==this.getId()){i=i.getParent();}else{d=false;break;}}}if(!d){var n=$ws.single.WindowManager.getActiveWindow(),o=n&&n.getActiveChildControl(),m=false;if(o){while(o){if(o===b){m=true;break;}o=o.getParent();}}else{m=true;}if(m){this.setActive(true,false);}}}d=d||false;if(!this._builded){for(var h=0,j=this._options.tabs.length;h<j;++h){if(this._options.tabs[h].id===e||h==e){this._defaultTab=h;break;}}}if(this._currentId==e||this._tabsSheets[e]===undefined||this._disabledTabs[e]){l.apply(this);if(!this._firstTabReady.isReady()){this._firstTabReady.callback();}return new $ws.proto.Deferred().callback();}this._body.scrollTop(0).scrollLeft(0);var g=this.getCurrentTabArea(),k=this.getCurrentTab();if(g){g.hide();}if(k){k.addClass("ws-hidden");}this._tabsSheets[e].removeClass("ws-hidden");if(this._options.showLabels){if(this._tabsLabels[this._currentId]){this._tabsLabels[this._currentId].toggleClass("ws-tabs-button-inactive",true).toggleClass("ws-tabs-button-active",false);}this._tabsLabels[e].toggleClass("ws-tabs-button-active",true).toggleClass("ws-tabs-button-inactive",false);}this._currentId=e;if(e){this._activeChildControl=e;}var f=this._loadContent(e).addCallback(function(i){var n=b.getTabArea(e),m;if(n){n.show();m=$ws.single.ControlBatchUpdater;if(m._needDelayedRecalk(n)){m._doDelayedRecalk(n);}}b._notifyOnSizeChanged(b,b,true);b._runBatchDelayedFunc("setCurrentTab.active",function(){if(b.isActive()&&!d){b.setActive(true,false);}b._body.scrollTop(0).scrollLeft(0);});if(b._options.showLabels&&b._options.scrollable){b.scrollToTab(e);}b._calculateMinWidth();b._notifyBatchDelayed("onTabChange",""+e,c);return i;});l.apply(this);return f;});},_loadContent:function(b){return this._runInBatchUpdate("tabs:_loadContent",function(){var f=this,d=new $ws.proto.Deferred();function h(){if(!f._firstTabReady.isReady()){f._firstTabReady.callback();}d.callback();}if(!this._loaded[b]){this._loaded[b]=true;if(this._templates[b]!==undefined){var g=new $ws.proto.Deferred(),c=new $ws.proto.Deferred(),e=new $ws.proto.ParallelDeferred({steps:[g,c]});$ws.core.attachInstance("SBIS3.CORE.TabTemplatedArea",{autoHeight:true,autoWidth:true,template:this._templates[b],element:this._tabsSheets[b],tabindex:1,parent:this,keepSize:false,name:"mytabarea"+b,context:new $ws.proto.Context().setPrevious(this.getLinkedContext()),owner:this.getId(),handlers:{onAfterLoad:function(){c.callback();}}}).addCallback(function(i){f._controls[b]=i;if(!f._options.enable){i.setEnabled(false);}g.callback();});e.done().getResult().addCallback(function(){f._notifyBatchDelayed("onTabLoaded",b+"");h();});}else{h();}}else{h();}return d;});},_onSizeChangedBatch:function(c){var d=this.getCurrentTabArea(),e=$ws.helpers.find(c,function(f){return f===d;},this),b=!!e;if(b&&this._haveAutoSize()){this._updateResizer();this._resizeHeaderAndBodyForContainer();}return b;},_setTabMargin:function(b,c){if(this._spacing){if(c){this._tabsLabels[b].css("margin","0");}else{this._tabsLabels[b].css("margin","0 "+(this._isScrollVertical?"0 ":"1px ")+(this._isScrollVertical?"1px ":"0 ")+"0");}}},_build:function(){var c=this._options.tabs,e=c.length;if(this._options.align==="left"){for(var b=0;b<e;++b){this._buildTab(c[b],b+1===e,b);}}else{for(b=e-1;b>=0;--b){this._buildTab(c[b],b+1===e,b);}}if(this._options.showLabels){this._buildScrollButtons();}this._builded=true;var d=c[this._defaultTab];if(d&&d.hidden){for(b=1;b<=e;b++){d=c[(this._defaultTab+b)%e];if(!d.hidden){break;}}}this.setCurrentTab((d&&d.id)||this._defaultTab,true,true);},_addEventListeners:function(){var b=this;if(this._header){$(".ws-tabs-button",this._header.get(0)).live("click mouseenter mouseleave",function(d){var e=$(this);var c=e.data("name");switch(d.type){case"click":b._isControlActive=true;b.setCurrentTab(c,undefined,true);return false;break;case"mouseenter":if(b._labelsWidths[c]>b._tabsLabels[c].width()+b._tabsLabelOuterH){e.children().animate({"margin-left":(b._tabsLabels[c].width()+b._tabsLabelOuterH-b._labelsWidths[c])+"px"},5000);}break;case"mouseleave":e.children().stop().css("margin-left","0px");break;default:}});}},_buildTab:function(f,h,d){var c=(f.id!==undefined)?f.id:d,b,g,e;if(this._options.showLabels){this._tabsLabels[c]=$('<div data-name="'+c+'" class="ws-tabs-button ws-tabs-button-inactive '+(" ws-tabs-align-"+this._options.align)+" "+(this._options.verticalText?"top":this._options.position)+'"><div class="ws-tabs-button-inside">'+f.title+"</div></div>").appendTo(this._header).width(this._options.labelsWidth);if(this._spacing===undefined){this._spacing=parseInt(this._tabsLabels[c].css("margin-right"),10);}this._setTabMargin(c,h);if(f.icon!==undefined){b=this._tabsLabels[c].find(".ws-tabs-button-inside");g=parseInt(b.css("padding-"+this._labelsIconPosition),10);e={"background-image":"url('"+f.icon+"')","background-position":g+"px 0"};e["padding-"+this._labelsIconPosition]=(g+$ws._const.Tabs.iconPadding)+"px";b.css(e);}if(this._options.verticalText){this._tabsLabels[c].addClass("ws-tabs-button-rotate ws-rotate-"+this._options.position);}}this._createTabSheet(c,f);this._templates[c]=f.template;if(f.hidden){this.hideTab(c);}return c;},_mousewheelHandler:function(b){b.stopPropagation();return true;},_createTabSheet:function(b,c){if(!(b in this._tabsSheets)){this._tabsSheets[b]=$('<div class="ws-tabs-div ws-hidden" id="'+this._getBlockId(b)+'">'+((c.text!==undefined)?c.text:"")+"</div>").appendTo(this._body).bind("mousewheel",this._mousewheelHandler);}},_onClickScrollButtons:function(g){var d=g.data.self;if(d._scrollButtonsDisabled[g.data.side]){return;}var h=d._currentMargin,i=undefined,f=d._block.width(),b=d._block.height();if(isNaN(h)){h=0;}if(d._options.align==="right"){h=f-d._fullWidth-h;}for(var e in d._previousLabelsWidths){if(!d._previousLabelsWidths.hasOwnProperty(e)){continue;}if(d._options.position=="left"&&d._options.verticalText){if(g.data.side=="right"){if(-h+b-d._scrollButtonsWidth<d._previousLabelsWidths[e]){i=e;break;}}else{if(-h+b-d._scrollButtonsWidth>d._previousLabelsWidths[e]){i=e;}}}else{if(-h<d._previousLabelsWidths[e]||(g.data.side==="left"&&(-h==d._previousLabelsWidths[e]))){if(g.data.side==="right"){i=e;}break;}if(g.data.side==="left"){i=e;}}}var c=d._getHeaderLimit()-d._fullWidth;if(d._options.position=="left"&&d._options.verticalText){h=Math.min(0,Math.max(c,-(i!==undefined?d._previousLabelsWidths[i]-b+d._scrollButtonsWidth:0)));}else{h=Math.min(0,Math.max(c,-(i!==undefined?d._previousLabelsWidths[i]:0)));}if(d._options.align==="right"){h=f-(d._fullWidth+h);}d._headerScrolled=true;d._animateHeader(h);d._checkDisabled(h);return false;},_buildScrollButtons:function(){if(this._options.scrollable){var e=(this._options.position=="left")?"left":"right";for(var d in this._scrollButtonsDisabled){if(!this._scrollButtonsDisabled.hasOwnProperty(d)){continue;}this._scrollButtons[d]=$('<div class="ws-hidden ws-tabs-scroll'+(this._scrollButtonsDisabled[d]?"-disabled":"")+" "+d+'"></div>').appendTo(this._block).css(e,((this._options.verticalText)?($ws._const.Tabs.verticalTextFirstScrollPadding):((this._isScrollVertical&&!this._options.verticalText)?0:(("right"==d)?$ws._const.Tabs.firstHorizontalScrollButtonPadding:$ws._const.Tabs.secondHorizontalScrollButtonPadding)))).append($('<div class="ws-tabs-scroll-image '+((this._isScrollVertical)?(d==="left"?"top":"bottom"):d)+'"></div>').css("opacity",(this._scrollButtonsDisabled[d]?$ws._const.Tabs.scrollDisabledOpacity:$ws._const.Tabs.scrollEnabledOpacity))).bind("click",{side:d,self:this},this._onClickScrollButtons);if(!this._isScrollVertical){this._scrollButtons[d].addClass("horizontal");}}var b=(this._options.position=="bottom"||this._options.verticalText?"bottom":"top"),c=(this._options.verticalText||this._options.position!="top"?"bottom":"top");this._scrollButtons.left.css(b,(this._options.verticalText?$ws._const.Tabs.tabScrollButtonsHeight:0)+"px");this._scrollButtons.right.css(c,"0px");if(!$.browser.msie){if(this._isScrollVertical&&!this._options.verticalText){this._scrollShadows.left=$('<div class="ws-tabs-shadow-v top '+this._options.position+'"></div>').appendTo(this._block).css("visibility","hidden");}this._scrollShadows.right=$('<div class="ws-tabs-shadow-'+(this._isScrollVertical?"v":"h")+" "+(this._isScrollVertical?"bottom":"right")+" "+this._options.position+'"></div>').appendTo(this._block);if(this._isScrollVertical&&this._options.verticalText){this._scrollShadows.right.css("bottom","36px");}}}},validate:function(){var g=this._options.tabs,b=true,j,f,e;for(var h=0,c=g.length;h<c;h++){e=g[h].id||h;if(this._hiddenTabs[e]===true){continue;}j=this.getTabArea(e);if(j&&j.validate(false,true)===false){f=e;b=false;break;}}if(f!==undefined){var d=this;this.setCurrentTab(f,undefined,true).addCallback(function(){d._moveFailValidatedToFocus();});}return b;},getCurrentId:function(){return""+this._currentId;},getBody:function(){return this._body;},getCurrentTab:function(){return this._tabsSheets[this._currentId];},getCurrentTabArea:function(){return this._controls[this._currentId];},setActive:function(d,b){this._isControlActive=d;if(this._currentId!==undefined){this._activeChildControl=b?2:0;var c=this.getCurrentTabArea();if(c&&d){c.setActive(d,b);}else{if(d){this._moveFocusToSelf();}}}},getTab:function(b){return this._tabsSheets[b];},getTabChilds:function(c){var b=this.getTabArea(c);return b?b.getChildControls():undefined;},setContent:function(d,c){var b=this._tabsSheets[d];if(b){b.html(c);}else{throw new Error("Нет такого таба: "+d);}},_checkDisabled:function(d){var e;if(this._options.align==="right"){var c=this._block.width();e={right:this._getScrollButtonsWidth(),left:c-this._fullWidth};}else{e={right:this._getHeaderLimit()-this._fullWidth,left:0};}for(var b in e){if(!e.hasOwnProperty(b)){continue;}if(this._scrollButtonsDisabled[b]!==(d===e[b])){this._scrollButtons[b].toggleClass("ws-tabs-scroll-disabled "+b).toggleClass("ws-tabs-scroll "+b);if(this._scrollShadows[b]){this._scrollShadows[b].css("visibility",(this._scrollShadows[b].css("visibility")=="hidden"?"visible":"hidden"));}this._scrollButtonsDisabled[b]=!this._scrollButtonsDisabled[b];this._scrollButtons[b].children().css("opacity",(this._scrollButtonsDisabled[b])?$ws._const.Tabs.scrollDisabledOpacity:$ws._const.Tabs.scrollEnabledOpacity);}}if(this._options.align==="right"){this._allLabelsShowed=this._scrollButtonsDisabled.left;}},_updateCurrentTab:function(){if(this._currentId===null||!(this._currentId in this._tabsSheets)||this._currentId in this._hiddenTabs||this._currentId in this._disabledTabs){for(var b in this._tabsSheets){if(!this._tabsSheets.hasOwnProperty(b)){continue;}if(!(b in this._hiddenTabs||b in this._disabledTabs)){this.setCurrentTab(b,undefined,true);return;}}this.setCurrentTab(undefined,undefined,true);}},_updateTabs:function(){this._fullWidth=0;this._updateCurrentTab();this._onResizeHandler();},getTabArea:function(b){return this._controls[b];},addTab:function(b){var c=this._buildTab(b,false,Math.random());this._updateTabs();return c;},removeTab:function(d){var c=this,b=function(){if(c._tabsSheets[d]){if(c._tabsLabels[d]){c._tabsLabels[d].empty().remove();}if(c._controls[d]){c._controls[d].destroy();}c._tabsSheets[d].empty().remove();delete c._loaded[d];delete c._templates[d];delete c._controls[d];delete c._tabsLabels[d];delete c._tabsSheets[d];c._updateTabs();}};if(this._ready.isReady()){b();}else{this._ready.addCallback(b);}},hideTab:function(d){var b=this,c=function(){if(d in b._tabsLabels){b._hiddenTabs[d]=true;delete b._labelsWidths[d];b._tabsLabels[d].addClass("ws-hidden");b._tabsSheets[d].addClass("ws-hidden");if(b._currentId==d){b._currentId=null;}b._calculateFullWidth();b._updateTabs();}};if(this._ready.isReady()){c();}else{this._ready.addCallback(c);}},showTab:function(d){var c=this,b=function(){if(d in c._tabsLabels){delete c._hiddenTabs[d];c._tabsLabels[d].removeClass("ws-hidden");c._calculateFullWidth();c._updateTabs();}};if(this._ready.isReady()){b();}else{this._ready.addCallback(b);}},renameTab:function(d,c){if(this._ready.isReady()){this._tabsLabels[d].find(".ws-tabs-button-inside").text(c);this._updateTabs();}else{for(var b=0;b<this._options.tabs.length;++b){if(this._options.tabs[b].id===d){this._options.tabs[b].title=c;break;}}}},enableTab:function(d){var b=this,c=function(){if(d in b._tabsLabels){delete b._disabledTabs[d];b._tabsLabels[d].addClass("ws-tabs-button-enabled").removeClass("ws-tabs-button-disabled");b._tabsSheets[d].removeClass("ws-hidden");b._updateTabs();}};if(this._ready.isReady()){c();}else{this._ready.addCallback(c);}},disableTab:function(d){var b=this,c=function(){if(d in b._tabsLabels){b._disabledTabs[d]=true;b._tabsLabels[d].addClass("ws-tabs-button-disabled").removeClass("ws-tabs-button-enabled").addClass("ws-tabs-button-inactive").removeClass("ws-tabs-button-active");b._tabsSheets[d].addClass("ws-hidden");b._updateTabs();}};if(this._ready.isReady()){c();}else{this._ready.addCallback(c);}},setEnabled:function(b){b=!!b;if(this._options.allowChangeEnable||b===this._options.enable){$ws.proto.Tabs.superclass.setEnabled.apply(this,arguments);$ws.helpers.forEach(this._controls,function(c){c.setEnabled(b);},this);}},getTabIdByControl:function(f){var b=this,c,e=f.findParent(function(g){return g.getParent()===b;});if(e){for(var d in this._controls){if(this._controls.hasOwnProperty(d)){if(this._controls[d]===e){c=d;break;}}}return c;}},_redraw:function(){}});return $ws.proto.Tabs;});