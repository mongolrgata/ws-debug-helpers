$ws.declareModule({namespace:"SBIS3.CORE",name:"FileButton",imports:["SBIS3.CORE.Button"]},function(a){$ws.proto.FileButton=a.extend({$protected:{_options:{filterParams:[],paramsMapping:{},queryFilter:{},method:"",otherUrl:""},_applet:null,_targetUrl:""},$constructor:function(){this._publish("onLoadStarted","onLoaded","onAppletReady");var b=this._options.otherUrl?this._options.otherUrl:$ws._const.defaultServiceUrl;var c=[window.location.protocol,window.location.hostname].join("//");if(window.location.port&&window.location.protocol=="http:"){c+=":"+window.location.port;}b=/^https?:/.test(b)?b:c+b;this._targetUrl=b;},setUploadParams:function(d){this._options.queryFilter={};this._options.paramsMapping={};this._options.filterParams=[];for(var b in d){if(d.hasOwnProperty(b)){var c=d[b];this._options.filterParams.push(b);if(c&&typeof(c)=="object"&&"fieldName" in c){this._options.paramsMapping[b]=c.fieldName;}else{this._options.queryFilter[b]=c;}}}},setTargetMethod:function(b){this._options.method=b;},_getRequestParameters:function(){var d={idControl:this.getId(),fileName:"",targetURL:this._targetUrl,method:this._options.method,postName:"file1",requestParams:{},fileParams:{}};if($.browser.webkit&&!window.chrome){d.cookie=document.cookie;}var e=this._prepareParams();for(var c in e){if(e.hasOwnProperty(c)){var b=$ws.proto.ReaderSBIS.serializeParameter(c,e[c]).d;if(typeof b=="object"){b=JSON.stringify(b);}if(c in {"Ид":0,"ИмяФайла":0,"Размер":0}){d.fileParams[c]=b;}else{d.requestParams[c]=b;}}}return d;},_prepareParams:function(){var e=$ws.core.merge({},this._options.queryFilter),d=this._options.filterParams;for(var c=0,b=d.length;c<b;c++){if(!(d[c] in e)){e[d[c]]=this.getLinkedContext().getValue(d[c] in this._options.paramsMapping?this._options.paramsMapping[d[c]]:d[c]);}}return e;},_upload:function(b){$ws.helpers.callbackWrapper(this._notify("onLoadStarted"),function(c){if(c!==false){b(c);}return c;});},_onContextValueReceived:function(){},getApplet:function(){return this._applet;}});return $ws.proto.FileButton;});