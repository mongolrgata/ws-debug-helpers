$ws.declareModule({namespace:"SBIS3.CORE",name:"DataView",imports:["SBIS3.CORE.Control"]},function(a){$ws.single.DependencyResolver.register("SBIS3.CORE.DataView",function(b){var c={};if(b){if(b.display.showToolbar){c["SBIS3.CORE.ToolBar"]=1;c["SBIS3.CORE.Button"]=1;c["SBIS3.CORE.Menu"]=1;}if(b.display.showPaging){c["SBIS3.CORE.Paging"]=1;}if(b.display.showRecordsCount){c["SBIS3.CORE.FieldDropdown"]=1;}if(b.rowOptions){c["SBIS3.CORE.Menu"]=1;}if(b.display.viewType==="hierarchy"&&b.display.showPathSelector){c["SBIS3.CORE.PathSelector"]=1;}}return Object.keys(c);});$ws._const.Browser={minHeight:24,iconWidth:16,tabWidth:16,defaultCellPadding:7,iconPadding:3,minColumnWidth:8,defColWidth:{"Логическое":"20px","Число целое":"40px","Деньги":"85px","Дата":"80px","Дата и время":"80px",another:"50px"},type2ClassMap:{"Деньги":"money","Число целое":"integer","Число вещественное":"integer"},hierarchyIcons:"img/browser/tree_icons.gif",printFrameWidth:"100%",recordsMoveOffset:{top:5,left:5},rowOptionsMenuOffset:{left:8,top:27},rowOptionsElementsOffset:{right:0,top:$ws._const.theme=="wi_scheme"?0:-2},loadingIndicatorDelay:200,rowOptionsOverflow:3,rowOptionsButtonWidth:34,rowOptionsActions:{addItem:true,addFolder:true,edit:true,"delete":true,printRecord:true,copy:true,history:true},editAtPlaceWait:350,pageSizes:[10,25,50,100,200],treeLevelAttribute:"treelevel",pathSelectorHeight:21,rowOptionBeforeAll:-1};$ws.proto.DataView=a.DataBoundControl.extend({$protected:{_options:{preprocessQuery:false,multiSelect:true,useCopyRecords:false,useSelection:true,useMergeRecords:false,allowAdd:true,allowEdit:true,allowDelete:true,allowMove:true,dataSource:false,printMode:"",editMode:"newDialog",editBranchMode:"newDialog",editDialogTemplate:"",editBranchDialogTemplate:"",filterDialogTemplate:"",filterParams:{},reports:{},reportsForList:{},selectionType:"all",setCursorOnLoad:true,useCurrentFilterOnMove:false,useHoverRowAsActive:false,markedRowOptions:{},display:{viewType:"",viewMode:"",readOnly:false,showHistory:false,hierColumn:"Раздел",titleColumn:"Название",showToolbar:false,showTiming:false,showRecordsCount:true,showPaging:true,usePaging:"",askConfirmSaving:false,recordsPerPage:25,displayValue:"",emptyHtml:"",emptyTableHtml:"",partiallyLoad:false,reload:true,rootNode:null,createInvisibleRows:false,hierarchyIcons:$ws._const.Browser.hierarchyIcons,fixedExpand:false,expand:"",showPathSelector:true,showSelectionCheckbox:false,allowHorizontalScroll:true,editAtThePlaceOnly:false,showRecordCountForEmptyData:true,usePageSizeSelect:true}},_hierColumnParentId:"Раздел",_hierColumnIsLeaf:"Раздел@",_hierColumnHasChild:"Раздел$",_rootElement:"",_headContainer:undefined,_head:"",_body:"",_foot:"",_data:"",_resizer:undefined,_browserContainer:undefined,_expanded:{},_activeElement:false,_bodyHeight:0,_bodyRealHeight:0,_wsBrowserContainer:false,_currentRecordSet:null,_initialSource:{},_initialFilter:{},_currentFilter:{},_count:0,_turn:"",_resizingColumn:null,_hovered:0,_loaded:{},_currentRootId:null,_sortingStack:[],_sortingMarkers:{},_paging:undefined,_toolbar:undefined,_toolbarReady:undefined,_pagingReady:undefined,_pagingFilter:{},_wayRS:undefined,_wayRSDeferred:undefined,_rootNode:null,_pathSelector:undefined,_selected:{},_selectedRecords:[],_selectMode:false,_dReady:undefined,_verticalScrollShowed:false,_printMenu:null,_printMenuIsShow:false,_pathReady:undefined,_useEditAtThePlace:false,_titleColumnIndex:-1,_isInsertOnFolderInTree:false,_reportPrinter:null,_isUpdatingRecords:false,_needResize:true,_actions:{},_emptyDataBlock:undefined,_emptyDataText:true,_needPrint:true,_isFakeDelete:false,_loadingIndicator:undefined,_footerDrawed:false,_applyingState:false,_savedPageNum:0,_firstLoadDeferred:undefined,_systemParams:{"ВидДерева":"",HierarchyField:"","Разворот":"","ПутьКУзлу":"","ЗаголовокИерархии":"","_ЕстьДочерние":false},_keysWeHandle:[$ws._const.key.enter,$ws._const.key.backspace,$ws._const.key.down,$ws._const.key.up,$ws._const.key.left,$ws._const.key.right,$ws._const.key.del,$ws._const.key.insert,$ws._const.key.f3,$ws._const.key.f4,$ws._const.key.f5,$ws._const.key.pageUp,$ws._const.key.pageDown,$ws._const.key.b,$ws._const.key.h,$ws._const.key.v,$ws._const.key.esc,$ws._const.key.space,$ws._const.key.minus,$ws._const.key.q,$ws._const.key.p,$ws._const.key.n,$ws._const.key.m,$ws._const.key.o],_dataBindHandler:null,_setDataHandler:null,_clickEventsQueue:[],_rowSelectionSetted:false,_methodName:"static",_minimized:false,_initialRecordSet:false,_isRenderedFootRowOptions:false,_pageOptions:[],_pageOptionsContainer:undefined,_pageOptionsDropdown:false,_useKeyboard:false,_scrollWidth:undefined,_containerHeightForRecalk:null,_inBeforeRenderActionCnt:0},$constructor:function(){var b=this;this._scrollWidth=$ws.helpers.getScrollWidth();this._toolbarReady=new $ws.proto.Deferred();this._pagingReady=new $ws.proto.Deferred();this._dReady=new $ws.proto.Deferred();this._pathReady=new $ws.proto.Deferred();this._firstLoadDeferred=new $ws.proto.Deferred();this._configChecking();this._publish("onBeforeCreate","onBeforeInsert","onBeforeUpdate","onDeleteStart","onBeforeDelete","onBeforeLoad","onAfterLoad","onAfterRender","onRowActivated","onFilterChange","onRowClick","onRowDoubleClick","onSetCursor","onChangeSelection","onSelectionConfirm","onLoadError","onPrepareReportData","onSelectReportTransform","onBeforeShowPrintReports","onBeforeCopy","onBeforeRead","onRecordsChanged","onBeforeOpenEditWindow");$ws.single.CommandDispatcher.declareCommand(this,"newItem",this._insertRecordItem);$ws.single.CommandDispatcher.declareCommand(this,"newFolder",this._insertRecordFolder);$ws.single.CommandDispatcher.declareCommand(this,"newChildItem",this._insertChildRecordItem);$ws.single.CommandDispatcher.declareCommand(this,"newChildFolder",this._insertChildRecordFolder);$ws.single.CommandDispatcher.declareCommand(this,"edit",this._editRecord);$ws.single.CommandDispatcher.declareCommand(this,"copy",this.copy);$ws.single.CommandDispatcher.declareCommand(this,"delete",this._deleteRecords);$ws.single.CommandDispatcher.declareCommand(this,"confirmSelection",this.confirmSelection);$ws.single.CommandDispatcher.declareCommand(this,"selectAll",this.selectAll);$ws.single.CommandDispatcher.declareCommand(this,"removeSelection",this.removeSelection);$ws.single.CommandDispatcher.declareCommand(this,"reload",this.reload);$ws.single.CommandDispatcher.declareCommand(this,"showSelection",this.showSelection);this._createContainer();this._setHeight();this._initActionsFlags();this._context=new $ws.proto.Context().setPrevious(this._context);if(this._options.saveState){$ws.single.ControlStorage.waitChildByName(this.getName()).addCallback(function(){b._notify("onStateChanged");}).addCallback(function(){b._initDataSource();});}else{b._initDataSource();}this._drawToolBar();this._initEvents();this._dataBindHandler=$.proxy(this._dataBind,this);if(this._parent){this._parent.subscribe("onReady",this._dataBindHandler);}else{this._dataBind();}if(this._options.markedRowOptions){this.subscribe("onChangeSelection",this._onChangeSelectionHandler);}},markControl:function(c){var b=$ws.proto.DataView.superclass.markControl.apply(this,arguments);this._onResizeHandler();return b;},clearMark:function(){var b=$ws.proto.DataView.superclass.clearMark.apply(this,arguments);this._onResizeHandler();return b;},_haveAutoWidth:function(){return this._options.autoWidth&&this._horizontalAlignment!=="Stretch";},_isHeightGrowable:function(){return this._options.autoHeight&&this._verticalAlignment!=="Stretch";},_isInBeforeRenderAction:function(){return this._inBeforeRenderActionCnt>0;},_onChangeSelectionHandler:function(){var b=this.getSelection(true).length;if(this._isRenderedFootRowOptions){if(!b){this._drawRowOptionsButtons();}}else{if(b){this._drawRowOptionsButtons(true);}}},isReadOnly:function(){return this._options.display.readOnly;},_getElementToFocus:function(){var b=this.getActiveElement();if(b){return b;}var c=this._browserContainer.find("tr:first");if(c.length){return c;}return this.getContainer();},show:function(){this._runInBatchUpdate("Browser.show",function(){this._setVisibility(true);this._heightChangedIfVisible();});},recalcBrowserOnDOMChange:function(){this._notifyOnSizeChangedWithVisible(false);},_isVisibleWithParents:function(){return this._container&&this._container.closest(".ws-hidden").length===0;},_onSizeChangedBatch:function(){this._contentHeightChanged();return true;},_notifyOnSizeChangedWithVisible:function(b){if(b===undefined){b=this._isVisibleWithParents();}this._notifyOnSizeChanged(this,this,!b);},_notifyOnSizeChanged:function(){this._setContainerHeightForRecalk();return $ws.proto.DataView.superclass._notifyOnSizeChanged.apply(this,arguments);},_setContainerHeightForRecalk:function(){if(this._isHeightGrowable()&&this._horizontalAlignment==="Stretch"){this._containerHeightForRecalk=this._container.get(0).offsetHeight;}},_checkContainerHeightForRecalk:function(){if(this._isHeightGrowable()&&this._horizontalAlignment==="Stretch"){var b=this._containerHeightForRecalk;this._setContainerHeightForRecalk();if(this._containerHeightForRecalk!==b){this._notifyOnSizeChanged(this,this);}}},setMultiSelect:function(b){this._options.multiSelect=!!b;this._options.display.showSelectionCheckbox=!!b;if(!b){this.removeSelection();}this.refresh();},_createContainer:function(){if(this._options.display.width>0){this._container.find(".ws-browser-container").width(this._options.display.width+"px");this._rootElement.width(this._options.display.width+"px");}this._container.click(function(b){b.stopImmediatePropagation();}).bind("mousewheel",function(b){if(!b.ctrlKey){b.stopPropagation();}return true;});this._resizer=this._container.find(".ws-browser-resizer");if(this._resizer.size()===0){this._resizer=null;}this._head=this._rootElement.find("thead");this._foot=this._rootElement.find("tfoot");this._headContainer=this._rootElement.find(".ws-browser-head-container");this._data=this._rootElement.find(".ws-browser");this._browserContainer=this._rootElement.find(".ws-browser-container");this._emptyDataBlock=$('<div class="ws-browser-empty">'+this._options.display.emptyHtml+"</div>").appendTo(this._browserContainer.parent()).hide();if(!this._options.display.allowHorizontalScroll){this._data.parent().css("overflow-x","hidden");}if(this._options.autoHeight){this._container.height("auto");this._data.parent().height("auto");}},_createPrintMenu:function(g,c){var f=this,e=[],j;if(!g||!(g instanceof Array)){g=[];j=c?this._options.reportsForList:this._options.reports;for(var h in j){if(j.hasOwnProperty(h)){g.push(h);}}}for(var d=0,b=g.length;d<b;d++){e[d]={caption:g[d],id:g[d],handlers:{onActivated:function(k,i){f.printReport(i.caption,c);}}};}if(f._printMenu!==null){f._printMenu.destroy();f._printMenu=null;}if(e.length>1){return $ws.core.attachInstance("Control/Menu",{data:e}).addCallback(function(i){f._printMenu=i;return i;});}else{return new $ws.proto.Deferred().callback();}},getReports:function(b){var c=[],e;e=b?this._options.reportsForList:this._options.reports;for(var d in e){if(e.hasOwnProperty(d)){c.push(d);}}return c;},_getDataSource:function(){var d=this._options.dataSource;d.filterParams=this.getQuery();d.filterParams.pageNum="";d.filterParams.usePages="";d.usePages="";d.firstRequest=true;if(!Object.isEmpty(this._expanded)){var b=[];for(var c in this._expanded){if(this._expanded.hasOwnProperty(c)){b.push(c);}}if(!this._expanded[this._rootNode]){b.push(this._rootNode);}d.filterParams[this._hierColumnParentId]=b;}return d;},_selectPrintPages:function(){var c=new $ws.proto.Deferred(),b=this,d;d=this._getDataSource();$ws.core.attachInstance("SBIS3.CORE.Dialog",{template:"selectPrintPages",handlers:{onBeforeClose:function(f,e){if(e===true){if(this.getChildControlByName("printPages").getStringValue()==="cur"){d.filterParams.pageNum=b.getRecordSet().getPageNumber();d.pageNum=d.filterParams.pageNum;d.filterParams.usePages="full";d.usePages="full";}c.callback(d);}else{c.errback(new Error("cancelled"));}}}}).addBoth(function(e){$ws.core.setCursor(true);return e;});return c;},_getData:function(c,b){return $ws.core.attachInstance("Source:RecordSet",$ws.core.merge({firstRequest:true},c)).addCallback(function(d){d.subscribe("onAfterLoad",function(){b.callback(d);});}).addErrback(function(d){$ws.core.setCursor(true);$ws.core.alert(d.message,"error");});},_collectDataSource:function(){var b=this._options.dataSource;b.filterParams=this.getQuery();b.filterParams.pageNum="";b.filterParams.usePages="";b.usePages="";b.firstRequest=true;return b;},_prepareReportDataForList:function(){var c=new $ws.proto.Deferred(),b=this;if(this._paging&&this._turn===""){b._selectPrintPages().addCallback(function(d){b._getData(d,c);$ws.core.setCursor(false);return d;}).addErrback(function(d){$ws.core.setCursor(true);});}else{b._getData(b._collectDataSource(),c);}return c;},printReport:function(c,d,h){var g=h?h:this.getSelection(),f="",e=this,b;$ws.core.setCursor(false);if(c===undefined){f="default-list-transform.xsl";}else{f=d?this._options.reportsForList[c]:this._options.reports[c];}if(e._options.printMode==="newWindow"){e._openPrintWindow(c,d,f,e.isHierarchyMode()?e._currentRootId:undefined);}else{b=d?this._prepareReportDataForList():this._notify("onPrepareReportData",c,g);if(b!==false){if(b instanceof $ws.proto.Deferred){b.addCallback(function(i){if(i instanceof $ws.proto.Record||i instanceof $ws.proto.RecordSet||i instanceof Array){e._showReport(c,i,f,d);}}).addErrback(function(i){$ws.core.setCursor(true);$ws.core.alert(i.message,"error");});}else{if(b instanceof $ws.proto.Record||b instanceof $ws.proto.RecordSet||b instanceof Array){g=b;}this._showReport(c,g,f,d);}}else{$ws.core.setCursor(true);}}if(e._printMenu!==null&&e._printMenuIsShow){e._printMenu.show();e._printMenuIsShow=false;}},_showReport:function(c,g,f,d){var b="",e=this;if(c===undefined){f=$ws._const.wsRoot+"res/xsl/"+f;}else{b=this._notify("onSelectReportTransform",c,g,f,d);if(typeof(b)==="string"){f=b;}f=$ws._const.resourceRoot+f;}this._useKeyboard=true;e._reportPrinter.prepareReport(g,f,e.isHierarchyMode()?e._currentRootId:undefined).addCallback(function(h){$ws.core.attachInstance("SBIS3.CORE.Dialog",{template:"printDialog",resizable:true,handlers:{onAfterLoad:function(){var i=this.getChildControlByName("ws-dataview-print-report");i.subscribe("onContentSet",function(){$ws.core.setCursor(true);e.removeSelection();});i.setHTML(h);},onAfterClose:$.proxy(e._mouseMonitor,e)}});}).addErrback(function(h){$ws.core.setCursor(true);$ws.core.alert(h.message,"error");});},_updateHierColumnParams:function(b){this._hierColumnParentId=b;this._hierColumnIsLeaf=b+"@";this._hierColumnHasChild=b+"$";},_configChecking:function(){if(!this.isHierarchyMode()){this._options.display.partiallyLoad=false;for(var c in this._systemParams){if(c!=="_Итоги"){delete this._systemParams[c];}}}if(this._options.display.useDrawingLines){this._options.display.useSeparating=false;this._options.display.hasZebra=false;}this._options.display.usePaging?this._options.display.partiallyLoad=true:this._options.display.showPaging=false;if(this._options.multiSelect===false){this._options.display.showSelectionCheckbox=false;}if(this._options.display.rootNode!==null&&typeof(this._options.display.rootNode)==="object"){var b=this.getLinkedContext(),e=this._options.display.rootNode.fieldName;if(b.getValue!==undefined&&b.getValue(e)!==undefined){this._rootNode=b.getValue(e);}}else{this._rootNode=this._options.display.rootNode;}if(this.isHierarchyMode()){this._updateHierColumnParams(this._options.display.hierColumn);this._systemParams["ВидДерева"]="С узлами и листьями";if(this._options.selectionType==="node"||this._options.display.viewMode=="foldersTree"){this._options.filterParams["ВидДерева"]="Только узлы";this._systemParams["ВидДерева"]="Только узлы";}if(this._options.filterParams.HierarchyField){this._systemParams.HierarchyField=this._options.filterParams.HierarchyField;}else{this._systemParams.HierarchyField=this._hierColumnParentId;}this._systemParams[this._hierColumnParentId]=this._rootNode;this._systemParams["Разворот"]=this._options.display.partiallyLoad?"Без разворота":"С разворотом";this._systemParams["ЗаголовокИерархии"]=this._options.display.titleColumn;if(this._options.display.viewType==="hierarchy"){this._systemParams["ПутьКУзлу"]=true;}}else{this._options.display.expand="";}this._initialFilter=this._options.filterParams?this._prepareFilter(this._options.filterParams):{};this._currentFilter=$ws.core.merge({},this._initialFilter);var d=this._options.dataSource?this._options.dataSource.readerParams||{}:{};if(!$.isEmptyObject(d)){this._methodName=[d.linkedObject,d.queryName].join(".");}},_initActionsFlags:function(){var h=this.isHierarchyMode()||this._turn!=="",f=this._options.editBranchDialogTemplate,g=this._options.editDialogTemplate,c=this._options.display.showHistory,b=this._options.useCopyRecords,e=this,d=function(i){var j;if(i instanceof Object&&"jquery" in i){if(e.isHierarchyMode()){j=i.attr("parentid");}}else{if(e._options.display.viewType=="tree"){j=e.getActiveElement()&&e.getActiveElement().attr("parentid");}}if(!j){j=e._currentRootId;}return j;};this._actions={addItem:this._options.allowAdd!==false&&!this._options.display.readOnly&&g&&function(j,k){var i=k===true&&j&&j.hasClass("ws-browser-folder")?j.attr("rowkey"):d(j);e._showRecordDialog(undefined,false,i,false);},addFolder:this._options.allowAdd!==false&&!this._options.display.readOnly&&h&&f&&function(j,k){var i=k===true&&j&&j.hasClass("ws-browser-folder")?j.attr("rowkey"):d(j);e._showRecordDialog(undefined,true,i,false);},edit:this._options.allowEdit!==false&&(g||(h&&f))&&function(j){var i=j instanceof Object&&"jquery" in j?j:e.getActiveElement();if(i&&i.attr("rowkey")!=="null"){e._elementActivated(i,true);}},copy:!this._options.display.readOnly&&(g||(h&&f))&&b&&function(j){var i=d(j);if(i!==undefined&&e._currentRecordSet.contains(i)){e.copy(e._currentRecordSet.getRecordByPrimaryKey(i));}else{e.copy();}},"delete":!this._options.display.readOnly&&this._options.allowDelete!==false&&function(j){var i=j instanceof Object&&"jquery" in j;if(i&&(!e._activeElement||e._activeElement.attr("rowkey")!==j.attr("rowkey"))){e.setActiveRow(j);}e._deleteRecords.apply(e,[i,i?j.attr("rowkey"):undefined]);},expand:this.isHierarchyMode()&&!this._options.display.fixedExpand&&this._options.selectionType!=="node"&&function(){e.applyTurn(false);},expandWithFolders:this.isHierarchyMode()&&!this._options.display.fixedExpand&&this._options.selectionType!=="node"&&function(){e.applyTurn(true);},filterParams:this._options.filterDialogTemplate&&function(){e.createFiltersDialog.apply(e,[]);},clearFilter:this._options.filterDialogTemplate&&function(){e.resetFilter();},history:c&&$.proxy(e.showHistoryForActiveRecord,e),refresh:$.proxy(e.reload,e)};},_changeRecordSetHandlers:function(b){if(b instanceof $ws.proto.RecordSet){this._currentRecordSet=b;b.subscribe("onRecordUpdated",$.proxy(this._onRecordUpdated,this));b.subscribe("onRecordDeleted",$.proxy(this._onRecordDeleted,this));if(this._paging&&this._paging!==true){this._paging.setRecordSet(b);}}},setData:function(d){if(!d){return;}if(!(d instanceof $ws.proto.RecordSet)){throw new Error("Аргументом функции setData должен быть RecordSet");}var b=this,c=function(){if(b._setDataHandler){b._parent.unsubscribe("onReady",b._setDataHandler);}if(b._options.display.viewType==="hierarchy"||b._options.display.viewType==="tree"){d.setHierarchyField(b._hierColumnParentId);}d.subscribe("onBeforeLoad",$.proxy(b._onDataLoadStarted,b));d.subscribe("onAfterLoad",$.proxy(b._onDataLoaded,b));b._changeRecordSetHandlers(d);b.setPageSize(d.getPageSize(),true);if(!b._dReady.isReady()){b._dReady.callback();}b._pathReady.addCallback(function(){b._pathSelector.setPath([]);});if(b._options.display.viewType==="hierarchy"){b._currentRootId=b._rootNode;}b.removeSelection();if(b._options.display.usePaging&&b._currentRecordSet.getPageNumber()!==0){b.setPage(0,true);}else{b._onDataLoaded({},d,true);}};if(d.getContext().isGlobal()){d.setContext(new $ws.proto.Context().setPrevious(b.getLinkedContext()));}if(this._parent){this._parent.unsubscribe("onReady",this._dataBindHandler);}if(this._setDataHandler){this._parent.unsubscribe("onReady",this._setDataHandler);}if(this._parent&&!this._parent.isReady()){this._parent.subscribe("onReady",this._setDataHandler=c);}else{c();}},recordSetReady:function(){return this._dReady;},setSource:function(b){if(b instanceof Object){if(this._parent){this._parent.unsubscribe("onReady",this._dataBindHandler);}if(this._setDataHandler){this._parent.unsubscribe("onReady",this._setDataHandler);}this._options.dataSource=b;this._dReady=new $ws.proto.Deferred();this._initDataSource();this._dataBind();}},setPage:function(b,d){b=parseInt(b,10);if(this._options.display.usePaging){var c=this;this._dReady.addCallback(function(){c._currentRecordSet.setPage(b,!d);});}},getPageNumber:function(){if(this._options.display.usePaging&&this._currentRecordSet){return this._currentRecordSet.getPageNumber();}return 0;},_setPageSize:function(d,b){if(this._options.display.recordsPerPage!==d){this._options.display.recordsPerPage=d;var c=this;this._dReady.addCallback(function(){c._currentRecordSet.setPageSize(d,b);});this.getPaging().addCallback(function(e){e.setPageSize(d);e.update(1);return e;});}},_insertPageCount:function(c){var e=-1;for(var d=0;d<this._pageOptions.length;++d){if(this._pageOptions[d]>=c){if(this._pageOptions[d]>c){this._pageOptions.splice(d,0,c);}e=d;break;}}if(e==-1){this._pageOptions.push(c);}if(this._pageOptionsDropdown){var b=this;this._pageOptionsDropdown.addCallback(function(h){var g={};for(var f in b._pageOptions){if(b._pageOptions.hasOwnProperty(f)){g[b._pageOptions[f]]=b._pageOptions[f];}}h.setData(g);h.setValue(c);return h;});}},setPageSize:function(c,b){if(this._options.display.usePaging&&c!==this._options.display.recordsPerPage){this._drawFooter();this._setPageSize(c,b);if(this._options.display.usePageSizeSelect){this._insertPageCount(c);}}},setQuery:function(e,d,g,f){var c=this,b=new $ws.proto.Deferred();this._dReady.addCallback(function(){var h=c._prepareFilter($ws.core.merge({},e));for(var j in h){if(h.hasOwnProperty(j)){if(h[j]===undefined){delete h[j];}else{if(j==c._hierColumnParentId){c._systemParams[j]=h[j];c._currentRootId=h[j];}else{if(j=="Разворот"&&e.hasOwnProperty(j)&&c._options.display.expand===""){c._systemParams[j]=h[j];if(c._options.display.viewType==="hierarchy"){if(h[j]=="С разворотом"&&c._turn===""){c._expandAll(h["ВидДерева"]=="С узлами и листьями",true);}else{if(h[j]=="Без разворота"){c._clearExpandAll(true);}}}}}}}}c._loaded={};if(h["Разворот"]!=="С разворотом"){var k=c._expanded[c._rootNode];c._expanded={};if(k){c._expanded[c._rootNode]=k;}}if(c._options.display.viewType==="tree"&&c._options.display.expand&&c._turn===""){h["Разворот"]="С разворотом";c._expanded[c._rootNode]=2;}if(!g){c._currentRecordSet.setPage(0,true);}else{if(typeof(g)==="number"){c._currentRecordSet.setPage(g,true);}}if(f!==undefined){c.setSorting(f,true);}b.dependOn(c._runQuery(h,d));});return b;},_runQuery:function(e,d){var c=this,b=new $ws.proto.Deferred();this._dReady.addCallback(function(){c._currentFilter=e;d=d===undefined?true:d;b.dependOn(c._currentRecordSet.setQuery(e,d));c._pathReady.addCallback(function(){var f=c._currentRecordSet.getQuery();delete f["_Итоги"];c._pathSelector.setQuery(f);});});return b;},resetFilter:function(b){this._currentFilter=$ws.core.merge({},this._initialFilter);var c=this;this._currentRecordSet.resetFilter(this._currentFilter,b);this._pathReady.addCallback(function(){var d=c._currentRecordSet.getQuery();delete d["_Итоги"];c._pathSelector.setQuery(d);});},getQuery:function(c){var d={},e=$ws.core.merge({},this._currentFilter);if(c){$ws.core.merge(e,this._prepareFilter(this._options.filterParams));}else{this._prepareSystemParams(e);}for(var b in e){if(e.hasOwnProperty(b)&&e[b]===undefined){delete e[b];}}if(c){if(this._currentRecordSet){d=this._currentRecordSet.getUpdatedQuery(this._initialSource.filterParams);}return $ws.core.merge(e,d,{rec:true});}else{if(this._currentRecordSet){d=this._currentRecordSet.getQuery();}return $ws.core.merge(e,d);}},_prepareSystemParams:function(d){var b=$ws.core.merge({},d)||{};for(var c in this._systemParams){if(this._systemParams.hasOwnProperty(c)&&!(c in b)){b[c]=this._systemParams[c];}}return b;},_prepareFilter:function(d){var b=this._prepareSystemParams(d);for(var c in b){if(b.hasOwnProperty(c)){if(b[c] instanceof Object&&b[c]["fieldName"]!==undefined){b[c]=this._context.getValue(b[c].fieldName);}else{if(typeof b[c]==="function"){b[c]=b[c].apply(this,[this._context,c]);}}}}return b;},_initDataSource:function(){var b=this,d=b._options.dataSource;if(!(d instanceof Object)){return false;}var c={filterParams:{},rowsPerPage:this._options.display.recordsPerPage,usePages:this._options.display.expand?"":this._options.display.usePaging,hierarchyField:b.isHierarchyMode()?this._options.display.hierColumn:"",handlers:{onBeforeLoad:$.proxy(b._onDataLoadStarted,b),onAfterLoad:$.proxy(b._onDataLoaded,b)}};if(this._options.display.expand){this._expandAll(this._options.display.expand==="folders",true);}b._options.dataSource.filterParams=$ws.core.merge(b._options.dataSource.filterParams||{},b._options.filterParams,{preferSource:true});b._options.dataSource.filterParams=b._prepareSystemParams(b._options.dataSource.filterParams);if(b._options.dataSource.filterParams[b._hierColumnParentId]===""){b._options.dataSource.filterParams[b._hierColumnParentId]=b._rootNode;}d=$ws.core.merge(d,c);this._initialSource=$ws.core.merge({},d,{clone:true});this._initialSource.context=this._context;b._currentRootId=b._rootNode;if(d.firstRequest){this._loaded[b._rootNode]=true;}this._drawPathSelector();},_dataBind:function(){var b=this,d=b._options.dataSource;if(!(d instanceof Object)){return false;}if(this._parent){this._parent.unsubscribe("onReady",this._dataBindHandler);}var c=$ws.core.merge({},d);c.context=this._context;if(this._savedPageNum){c.pageNum=this._savedPageNum;}$ws.core.attachInstance("Source:RecordSet",c).addCallback(function(e){b._changeRecordSetHandlers(e);b._dReady.callback();b._notify("onReady");if(b._options.display.columns&&b._options.display.columns.length){b._drawHead();b._heightChangedIfVisible();}});return true;},_hasFilterChanges:function(c){for(var b in c){if(c.hasOwnProperty(b)){if(b!=="pageNum"&&this._pagingFilter[b]!==c[b]){return true;}}}return false;},_onDataLoadStarted:function(e,d){var c=this;var b=c._container.find(".ws-browser-ajax-loader");b.removeClass("ws-hidden");this._notify("onFilterChange",d);if(this._paging&&this._paging instanceof Object&&this._hasFilterChanges(d)){this._paging.clearMaxPage();}this._pagingFilter=d;this._emptyDataBlock.hide();this._notify("onBeforeLoad");},_onDataLoaded:function(e,d,b,c){function f(){var j=this,h=undefined;if(b){this._currentRecordSet=d;if(this._onBeforeRenderActions()){this._processPaging();if(this._columnMap&&this._columnMap.length>0){this._mapColumns();}else{this._drawHead();}if(this._turn===""&&this._options.display.viewType==="hierarchy"&&this._pathSelector){this._findWay(this._currentRootId);}if(this.getActiveElement()){this._hovered=this.getActiveElement().attr("rowkey");}if(!this._reportPrinter){this._reportPrinter=new $ws.proto.ReportPrinter({columns:this._columnMap,titleColumn:this._options.display.titleColumn});}this._drawFooter();this._updateResults();this._drawBody();this._updateTiming();var g=function(k){try{j._notifyOnSizeChangedWithVisible();}finally{j._notifyBatchDelayed("onAfterLoad");}return k;};var i=this._updatePager();if(i){i.addCallback(g);h=i;}else{g();}if(!this._firstLoadDeferred.isReady()){this._firstLoadDeferred.callback();}this._changeState();}}else{this._hideLoadingIndicator();if(c instanceof HTTPError&&c.httpError!==0&&this._notify("onLoadError",c)!==true){if(c.httpError==403){this._body.empty();this._rootElement.find(".ws-browser-pager-text").empty();this._emptyDataBlock.html('<span class="ws-browser-deny">Недостаточно прав для просмотра информации</span>').show();this._emptyDataText=false;this._heightChangedIfVisible();}else{$ws.core.alert(c.message.replace(/\n/mg,"<br />"),"info");}c.processed=true;}}return h;}return this._runInBatchUpdate("_onDataLoaded",f,arguments);},_filterState:function(c){for(var b in c){if(c.hasOwnProperty(b)&&c[b] instanceof Date){c[b]=c[b].toSQL(null);}}},_changeState:function(c){if(!this._applyingState){var e;if(this._options.mode=="navigationMode"){var b=this.getActiveRecord();e=b?b.getKey():null;if(e){this._notify("onStateChanged",e,!c);}}else{var d=this.getQuery();this._filterState(d);e=JSON.stringify(d);if(e){this._notify("onStateChanged",e,true);}}}},applyState:function(d){var n=this;if(this._options.mode=="navigationMode"){var m=this.getActiveRecord(),h=m?m.getKey():null;if(d!=="null"&&d!=h){this._applyingState=true;this._firstLoadDeferred.addCallback(function(){$ws.helpers.callbackWrapper(n.showBranch(d),function(){n._applyingState=false;});});}else{this.setActiveElement(this._body.find('tr[rowkey="'+(this._rootNode===null?"null":this._rootNode.toString())+'"]'));}}else{var f;try{f=$.parseJSON(d);}catch(j){f={};}f=typeof f=="object"?f:{};this._dReady.addCallback(function(){n.setQuery(f);});var b=function(i,e){if(!i){return false;}if(i.hasChildControlByName(e)){return i.getChildControlByName(e);}else{return b(i.getParent(),e);}};for(var g in f){if(f.hasOwnProperty(g)&&!(g in {pageCount:0,usePages:0})){if(g!=="pageNum"){var k=this._initialFilter[g],c=k?k.fieldName:undefined,l=c!==undefined?b(this.getParent(),c):undefined;if(SBIS3.CORE.DataBoundControl&&l instanceof SBIS3.CORE.DataBoundControl){l.setValue(f[g]);}else{if(c!==undefined){this.getLinkedContext().setValue(c,f[g]);}}}else{if(f[g]){this._savedPageNum=f[g];}}}}}},_onBeforeRenderActions:function(){return true;},_hideLoadingIndicator:function(){if(this._loadingIndicatorTimer){clearTimeout(this._loadingIndicatorTimer);}this._container.find(".ws-browser-ajax-loader").addClass("ws-hidden");},_processPaging:function(){var b=this._currentRecordSet.hasNextPage();if(this._pageChangeDeferred){this._pageChangeDeferred.callback([this._currentRecordSet.getPageNumber()+1,b,b]);this._pageChangeDeferred=undefined;}else{if(this._paging&&this._paging instanceof Object){this._paging.update(undefined,b,b);}}},_findWay:function(g){var d=this._currentRecordSet.getWay(),c=[],b;while(g&&g!=this._rootNode&&d!==null){try{b=d.getRecordByPrimaryKey(g);}catch(f){b=this._currentRecordSet.getRecordByPrimaryKey(g);}c.unshift({title:b.get(this._options.display.titleColumn),id:b.getKey()});g=b.get(this._hierColumnParentId);}if(this._pathSelector&&(c.length>0)){this._pathSelector.setPath(c);}},_pathRecordSetLoaded:function(g,h,b){if(b){var k=this._wayRS.getWay(),f,c,d=[];if(this._rootNode&&k!==null&&!k.contains(this._rootNode)){return;}k.rewind();var e=!this._rootNode;while((f=k.next())!==false){var i=f.getKey();if(f.get(this._hierColumnIsLeaf)===false&&e){break;}if(this._rootNode==i){e=true;}if(e){d.push({title:f.get(this._options.display.titleColumn),id:i});}}this._currentRootId=c=(!d.length?this._rootNode:d[d.length-1].id);this._hovered=this._wayRS.getLoadingId();this._activeElement=undefined;this._systemParams[this._hierColumnParentId]=c;var j=this._currentRecordSet.loadNode(c);if(!this._wayRSDeferred.isReady()){this._wayRSDeferred.dependOn(j);}}},_createPathRecordSet:function(c){var d=$ws.core.merge({},this._initialSource),b=this;this._wayRSDeferred=new $ws.proto.Deferred();d.firstRequest=true;d.filterParams[this._hierColumnParentId]=c;d.filterParams["ПутьКУзлу"]=true;d.filterParams["ЗаголовокИерархии"]=this._options.display.titleColumn;d.handlers={onAfterLoad:$.proxy(b._pathRecordSetLoaded,b)};$ws.core.attachInstance("Source:RecordSet",d).addCallback(function(e){b._wayRS=e;});return this._wayRSDeferred;},showBranch:function(b,c){return this._runInBatchUpdate("Browser.showBranch",function(){if(this._turn!==""){this._clearExpandAll(true);}if(this._options.display.partiallyLoad&&b!=this._rootNode&&!this._currentRecordSet.contains(b)){this._showBranchAfterPathLoad(b,c);if(!this._wayRS){return this._createPathRecordSet(b);}else{return this._wayRS.loadNode(b,true);}}else{return this._showActiveFolderOrElement(b,c);}});},_showBranchAfterPathLoad:function(){},isShow:function(b){if(this._options.display.viewType=="hierarchy"){return b===this._currentRootId;}else{return false;}},_showActiveFolderOrElement:function(b,c){return this._runInBatchUpdate("Browser._showActiveFolderOrElement",function(){if(this._options.display.viewType==="hierarchy"){return this._showBranchHierarchy(b,c);}else{if(!c){this.setActiveElement(this._body.find('[rowkey="'+b+'"]'));}}return undefined;});},_showBranchHierarchy:function(b,c){return this._runInBatchUpdate("Browser._showBranchHierarchy",function(){var n=[],j=b,k,e=this._hierColumnIsLeaf,g=this._hierColumnParentId;this._systemParams[this._hierColumnParentId]=b;if(this._options.display.partiallyLoad){var m=b;if(this._rootNode!=m&&this._currentRecordSet.contains(m)){k=this._currentRecordSet.getRecordByPrimaryKey(m);if(!k.get(this._hierColumnIsLeaf)){m=k.get(this._hierColumnParentId)||null;}}if(!this._isIdEqual(this._currentRootId,m)){this._hovered=b;this._currentRootId=b;this._activeElement=undefined;return this._currentRecordSet.loadNode(m,!(this._currentRecordSet.contains(m)||this._isIdEqual(this._rootNode,m)));}else{if(!c){this.setActiveElement(this._body.find('[rowkey="'+b+'"]'));}}}else{var f=this._currentRecordSet.getWay(),o=this,d=function(i){if(o._currentRecordSet.contains(i)){return o._currentRecordSet.getRecordByPrimaryKey(i);}else{if(f.contains(i)){return f.getRecordByPrimaryKey(i);}}return undefined;};if(j&&j!=this._rootNode){if(!d(j)){return undefined;}k=this._currentRecordSet.getRecordByPrimaryKey(j);if(!k.get(e)){j=k.get(g)||null;}}this._currentRootId=j;var l=undefined;while(j&&j!=this._rootNode){k=d(j);n.unshift({title:k.get(this._options.display.titleColumn),id:j});if(k.get(this._hierColumnIsLeaf)===false){l=j;}j=k.get(g)||null;}if(l!==undefined){for(var h=0;h<n.length;++h){if(n[h].id===l){this._currentRootId=(h>0?n[h-1].id:this._rootNode);if(!c){this._hovered=n[h];}while(n.length!==h+1){n.pop();}break;}}}if(this._pathSelector){this._pathSelector.setPath(n);}this._hovered=b;this._drawBody();this._updatePager();}return undefined;});},_onRecordDeleted:function(f,d,h){if(h!==undefined){delete this._selectedRecords[this._selected[h]];delete this._selected[h];}if(this._isFakeDelete!==true&&this._options.display.reload){this._notify("onRecordsChanged");if(this._pathSelector){this._pathSelector.updateLast();}this._currentRecordSet.updatePages();if(this._options.display.viewMode=="foldersTree"){var c=d.length,b,g;for(var e=0;e<c;e++){if(this._currentRecordSet.contains(d[e])){b=this._currentRecordSet.getRecordByPrimaryKey(d[e]);g=b.get(this._hierColumnParentId);if(isNaN(parseInt(g,10))?g!=this._rootNode:g!==parseInt(this._rootNode,10)){d.push(g);}}}}this._currentRecordSet.loadNode(this._options.display.partiallyLoad?(d instanceof Array?d:this._currentRootId):this._rootNode,undefined,this._currentRecordSet.getPageNumber(),!this._options.display.partiallyLoad);}if(this._isFakeDelete===true){this._isFakeDelete=false;}},_isIdEqual:function(c,b){if(c=="null"){c=null;}if(b=="null"){b=null;}return c==b;},_onRecordUpdated:function(k,n){this._minimized=false;this._initialRecordSet=false;if(this._isUpdatingRecords){return;}this._notify("onRecordsChanged");if(this._pathSelector){this._pathSelector.updateLast();}if(this._options.display.viewMode=="foldersTree"&&n instanceof $ws.proto.Record){var h=n.get(this._hierColumnParentId);if(!this._isIdEqual(h,this._rootNode)&&this._currentRecordSet.contains(h)){this._currentRecordSet.getRecordByPrimaryKey(h).set(this._hierColumnHasChild,true);}this._expanded[h]=true;}if(this._turn!==""&&!this._options.display.fixedExpand){this._clearExpandAll();}else{if(this._options.display.reload){var d;if(this._options.display.partiallyLoad&&!this._fullTreeExpand){if(k===true){d=[];var b={},m={};for(var e=0,l=n.length;e<l;++e){if(!m[n[e]]){m[n[e]]=true;b[n[e]]=true;d.push(n[e]);}}for(var f in this._expanded){if(this._expanded.hasOwnProperty(f)){var c=f,g;while(true){if(c in b&&(this._expanded[c]||(c==this._rootNode&&!this._options.display.showRoot))&&m[f]===undefined){m[f]=true;d.push(f);break;}if(!c||c==this._rootNode){break;}g=this._currentRecordSet.contains(c)&&this._currentRecordSet.getRecordByPrimaryKey(c);if(!g){break;}c=g.get(this._hierColumnParentId);}}}if(d.length===0){return;}}else{if(this.isHierarchyMode()){d=this._getNodeForRecordUpdate(n);this._systemParams[this._hierColumnParentId]=d;}else{d=null;}}}else{d=this._rootNode||null;}this._currentRecordSet.loadNode(d,!this._options.display.partiallyLoad||this._options.display.viewType==="hierarchy",this._currentRecordSet.getPageNumber(),!this._options.display.partiallyLoad||this._fullTreeExpand);}else{this._drawBody();}}},_getNodeForRecordUpdate:function(){var b=this.getActiveRecord();if(b){return b.get(this._hierColumnParentId);}return null;},_initEvents:function(){var g=this._rootElement.find(".ws-browser-container"),b=this._headContainer.find(".ws-browser-head-scroller"),e=(this._resultBrowser?this._resultBrowser.parent():undefined),i=this;g.bind("scroll",function(){i._onScrollActions();b.scrollLeft(g.scrollLeft());if(e){e.scrollLeft(g.scrollLeft());}if(!Object.isEmpty(i._ladder)){var n=$(this).offset().top,p=$(this).find("tr:visible:first"),k=p.offset(),m,o,q;while(k.top<n){p=p.next("tr:visible");k=p.offset();}if(p!==i._previousTRWithLadder){i._toggleClassForLadder(p);if(i._previousTRWithLadder!==undefined){i._toggleClassForLadder(i._previousTRWithLadder);}i._previousTRWithLadder=p;}}});var c;function f(l){var q=$(this),s=q.closest("[rowkey]"),m=s.attr("rowkey"),k=s.hasClass("ws-browser-folder")?i._options.editBranchMode:i._options.editMode,n=m&&i._currentRecordSet.contains(m)?i._currentRecordSet.getRecordByPrimaryKey(m):undefined;if(i._printMenuIsShow){i._createPrintMenu([]);i._printMenuIsShow=false;}if(!i._options.useSelection||!i._options.useHoverRowAsActive){i._onClickHandler(l);}if(i._checkEditAtPlace(l)||m===""){return false;}if(i.isEnabled()){m=(m==="null"||!m)?null:m;var p=q[0].cellIndex,r=undefined,o=undefined;if(p!==undefined&&i._columnMap){r=i._columnMap[p].title;o=i._columnMap[p].field;}if(l.type==="dblclick"){i._dblClickHandler.apply(i,[l.type,false,s,m,n,r,o]);}else{i._notify("onRowClick",s,n,r,o);if(i._options.mode!=="navigationMode"||i._options.display.viewType!=="tree"){i._notifySetCursor(s,n);}}}return k=="thisWindow";}var j=$(SBIS3.CORE.Browser&&this instanceof SBIS3.CORE.Browser?"[rowkey] > td":"[rowkey]",i._body.parent()[0]).live("mousedown",function(k){if(!i._checkEditAtPlace(k)&&i.isEnabled()){i.setActiveElement(SBIS3.CORE.Browser&&i instanceof SBIS3.CORE.Browser?$(this).closest("tr"):$(this),false,true,true);}});if(this._options.mode==="navigationMode"&&this._options.display.viewType==="tree"){j.live("click",function(){var k=$(this),n=k.closest("[rowkey]"),m=n.attr("rowkey"),l=m&&i._currentRecordSet.contains(m)?i._currentRecordSet.getRecordByPrimaryKey(m):undefined;i._processElementClick(n,m,l);});}if(!this._options.useHoverRowAsActive){j.wsFixedLiveClick(f,f);}var h=this._body.parent()[0];function d(p){i._onClickHandler(p);if(i._checkEditAtPlace(p)){return false;}var q=$(this).closest("[rowkey]"),o=q.attr("rowkey");if(o!==i._hovered&&(!q.hasClass("ws-browser-folder")||i._options.display.viewType!=="tree"||!i._options.display.partiallyLoad)){i.setActiveElement(q,false);}if(i.isEnabled()){var m=undefined,r=$(this).closest("td"),n=r.length===0?undefined:r[0].cellIndex,l=undefined,k=undefined;if(i._currentRecordSet.contains(o)){m=i._currentRecordSet.getRecordByPrimaryKey(o);}if(n!==undefined&&i._columnMap){l=i._columnMap[n].title;k=i._columnMap[n].field;}i._dblClickHandler.apply(i,[p.type,true,q,o,m,l,k]);}p.stopPropagation();p.preventDefault();return false;}if(!this._options.useHoverRowAsActive){$(".ws-browser-edit-link, .ws-browser-folder-link",h).live("click dblclick",d);}if(this._options.useSelection){if(this._options.useHoverRowAsActive){this._data.addClass("ws-browser-active-hover");$("[rowkey]",h).live("mouseenter",function(){if(!i._useKeyboard){if(i._activeElement&&"jquery" in i._activeElement){i._activeElement.removeClass("ws-browser-item-over");}i._activeElement=$(this);i._hovered=i._activeElement.attr("rowkey")==="null"?null:i._activeElement.attr("rowkey");i._activeElement.addClass("ws-browser-item-over");}});$(this._container).live("mouseleave",function(){if(!i._useKeyboard&&i._activeElement&&"jquery" in i._activeElement){i._activeElement.removeClass("ws-browser-item-over");}});$("tr[rowkey] td",h).live("click",d);}else{this._data.addClass("ws-browser-hover");}}},_onScrollActions:function(){},_toggleClassForLadder:function(b){var f=b.find(".ws-browser-column-with-ladder");for(var e=0,c=f.length;e<c;e++){var d=f[e].getElementsByClassName("ws-browser-ladder-element")[0];if(d!==undefined){$(d).toggleClass(d.tagName==="DIV"?"ws-hidden":"ws-invisible");}}},_drawHead:function(){},_drawPathSelector:function(){if((this._options.display.viewType==="hierarchy"||this._turn!=="")&&this._options.display.showPathSelector){var c=this,b=$('<div class="ws-browser-path-selector"><div></div></div>'),d=$ws.core.merge({},this._initialSource);this._headContainer.prepend(b);this._pathSelector=false;d.context=this.getLinkedContext();delete d.filterParams["_Итоги"];$ws.core.attachInstance("Control/PathSelector",{element:b.find("div"),rootNodeCaption:this._options.display.rootName,rootNodeId:this._rootNode===null?-1:this._rootNode,dataSource:d,titleColumn:this._options.display.titleColumn,folderIcon:this._options.display.hierarchyIcons,handlers:{onPathChange:function(f,g){c._systemParams[c._hierColumnParentId]=g;var e=c._options.display.partiallyLoad;if(e){c.showBranch(g);}else{c._currentRootId=g;c._currentRecordSet.loadNode(e?c._currentRootId:c._rootNode,!e,0,!e);}c.setActive(true);}}}).addCallback(function(e){c._pathSelector=e;e.setEnabled(c.isEnabled());c._pathReady.callback();});}},_getToolbarButtons:function(){if(this._options.allowAdd===false){return[];}if(this._options.display.viewMode==="foldersTree"){return[["Добавить (Ctrl+Insert)","sprite:icon-16 icon-CreateFolder icon-primary","addFolder"]];}else{return[["Добавить запись (Insert)","sprite:icon-16 icon-Add icon-primary","addItem"],["Добавить папку (Ctrl+Insert)","sprite:icon-16 icon-CreateFolder icon-primary","addFolder"]];}},_getMenuButtons:function(){var b=[];if(!this._options.display.rowOptions&&!this._options.display.editAtThePlaceOnly){b.push([this._options.display.readOnly?"Просмотреть (F3)":"Редактировать (F3)","sprite:icon-16 icon-Edit icon-primary","edit"],["Копировать запись (Shift+F5)","sprite:icon-16 icon-Copy icon-primary","copy"]);}b.push(["Удалить (Delete)","sprite:icon-16 icon-Erase icon-error","delete"]);b.push(["Перечитать данные (Ctrl+N)","sprite:icon-16 icon-Refresh icon-primary","refresh"]);if(this._options.display.viewType!=="tree"||this._turn!==""){b.push(["Развернуть без папок (Ctrl+V)","sprite:icon-16 icon-ListView icon-primary","expand"]);}b.push([this._options.display.viewType==="tree"?"Раскрыть/закрыть дерево с вложенными папками (Ctrl+B)":"Развернуть с папками (Ctrl+B)","sprite:icon-16 icon-TreeView icon-primary","expandWithFolders"],["Параметры фильтрации (Ctrl+Q)","sprite:icon-16 icon-Document icon-primary","filterParams"],["Очистить фильтрацию","sprite:icon-16 icon-Close icon-primary","clearFilter"],["Показать историю изменений (Ctrl+Н)","sprite:icon-16 icon-History icon-primary","history"]);return b;},showHistoryForActiveRecord:function(){this.showHistory(this.getActiveRecord().getKey());},_drawToolBar:function(){if(this._options.display.showToolbar){var b=$('<div class="ws-browser-toolbar"><div class="ws-toolbar" id="'+this.getId()+'-toolbar"></div></div>');this._headContainer.prepend(b);var e=this._getToolbarButtons(),d=this._getMenuButtons(),c=this;$ws.core.attachInstance("SBIS3.CORE.ToolBar",{element:b.find(".ws-toolbar"),buttons:this._prepareButtonsList(e),subBtnCfg:this._prepareButtonsList(d),buttonsSide:"right",handlers:{onReady:function(){c._toolbar=this;if(c.getReports(true).length!==0||(!c._options.display.rowOptions&&c.getReports(false).length!==0)){var f=function(){this.getButton("menu").subscribe("onActivated",function(){c._addSubMenuForToolbarElement("print",this.getId()+"_print",true);if(!c._options.display.rowOptions){c._addSubMenuForToolbarElement("printRecord",this.getId()+"_printRecord",false);}});};try{f.apply(toolbar,[]);}catch(g){this.subscribe("onAfterLoad",f);}}this.setEnabled(c.isEnabled());c._toolbarReady.callback(this);}}});}},_addSubMenuForToolbarElement:function(c,e,g,f,d){var h=f?f:this._toolbar.getMenu();if(h.hasSubMenu(e)){h.destroySubMenu(e);}if(h.isVisible()){var b=this._prepareReports(g,g?false:(d?d:this.getActiveRecord()),c);if(b&&(b.constructor===Array||typeof(b)=="string")){h.showItem(c);if(b.constructor===Array){h.addSubMenu(c,b);this._needPrint=false;}else{this._needPrint=b;}}else{this._needPrint=false;if(!g){h.hideItem(c);}}}},_prepareReports:function(d,h,m){var e=null,f=Object.isEmpty(this._selected)?(h?h:this.getActiveRecord()):this.getSelection(),i=this._notify("onBeforeShowPrintReports",this.getReports(d),f,d),k=this;if(i===false){e=false;}else{var g;if(i instanceof Array){g=i;}else{g=this.getReports(d);}if(g.length==1){e=g[0];}else{e=[];for(var c=0,b=g.length;c<b;c++){e.push({caption:g[c],id:k.getId()+"_"+m+g[c],handlers:{onActivated:function(l,j){k.printReport(j.caption,d,k.getActiveRecord());}}});}}}return e;},_prepareMenuItem:function(b){return{imgSrc:$ws._const.wsRoot+b[1],id:b[2],caption:b[0],handlers:{onActivated:this._actions[b[2]]}};},_prepareButton:function(b){return{tooltip:b[0],img:$ws._const.wsRoot+b[1],name:b[2],handlers:{onActivated:this._actions[b[2]]}};},_prepareButtonsList:function(e){var f=[],c=true,g=function(){if(!Object.isEmpty(f[f.length-1])){f.push({});}};for(var d=0,b=e.length;d<b;d++){if(this._actions[e[d][2]]){if(e[d][0]===""){if(!c){g();c=true;}}else{f.push(this._prepareButton(e[d]));c=false;}}}return f;},addToolbarButton:function(f,d,c,e,b){if(d.indexOf($ws._const.resourceRoot)<0&&d.indexOf($ws._const.wsRoot)<0){d=$ws._const.resourceRoot+d;}this._toolbarReady.addCallback(function(g){g.addButton({tooltip:f,img:d,handlers:c,name:e,wsClassName:b});return g;});},getFiltersDialogName:function(){return this._options.filterDialogTemplate;},createFiltersDialog:function(e,f){var b=this,c={onAfterClose:$.proxy(b._mouseMonitor,b)},d={};if(f){d=b._columnMap[f];}if(!e){e=this._options.filterDialogTemplate;}else{c.onBeforeApplyFilter=function(j,h){var i={};if(!Object.isEmpty(d)){for(var g in h){if(g===d.title){i[g]=h[g];break;}}}i=$ws.core.merge(b.getQuery(),i);j.setResult(i);};}this._useKeyboard=true;$ws.core.attachInstance("SBIS3.CORE.FiltersWindow",{template:e,context:new $ws.proto.Context().setPrevious(b.getLinkedContext()),linkedBrowsers:[this.getId()],handlers:c});},applyTurn:function(b){return this._runInBatchUpdate("Browser.applyTurn",function(){if(this._options.display.fixedExpand||(b===false&&this._options.display.viewMode=="foldersTree")){return;}if(this._turn===""){this._expandAll(!!b);}else{this._clearExpandAll();}});},_drawBody:function(){var c=BOOMR.plugins.WS.startSpan(["DataView._drawBody",this._methodName].join("?")),b=this._currentRecordSet.getColumns();if(this._options.display.viewType=="hierarchy"&&!Object.isEmpty(b)&&!(this._options.display.titleColumn in b)){throw new Error("Trying to render hierarchy with unexistent titleColumn");}this._drawBodyCycle();if(this._options.useSelection===false){this._data.addClass("ws-browser-selection-none");}if(this._options.mode==="oneClickMode"){this._data.addClass("ws-one-click-browser");}if(this._options.display.viewType==="tree"&&this._turn===""){this._data.addClass("ws-tree-browser");}this._data.toggleClass("ws-browser-hasZebra",!!this._options.display.hasZebra);if(this._count===0&&this.isActive()){this._data.focus();}this._openNodeForNavigationMode();this._hideLoadingIndicator();if(this._currentRecordSet.isInit()){this._head.removeClass("ws-hidden");if(!this._emptyDataText){this._emptyDataText=true;if(this._currentRecordSet.isEmptyTable()){this._emptyDataBlock.html(this._options.display.emptyTableHtml);this._head.toggleClass("ws-hidden",this._count===0);}else{this._emptyDataBlock.html(this._options.display.emptyHtml);}}else{if(this._currentRecordSet.isEmptyTable()){this._emptyDataBlock.html(this._options.display.emptyTableHtml);this._head.toggleClass("ws-hidden",this._count===0);}}this._emptyDataBlock.toggle(this._count===0);this._foot.toggleClass("ws-hidden",this._count===0&&this._emptyDataBlock.html());}this._rootElement.height("auto").find(".ws-browser-container").show();this._heightChangedIfVisible();this._updateSelection();c.stop();this._runBatchDelayedFunc("drawBody.onAfterRender",function(){if(this._notify("onAfterRender")===true){this._heightChangedIfVisible();}this._afterDrawActions();});},_afterDrawActions:function(){},_openNodeForNavigationMode:function(){if(this._options.mode==="navigationMode"&&this._options.display.viewType==="tree"&&!this._applyingState){var b;if(this._currentRecordSet.contains(this._hovered)){b=this._currentRecordSet.getRecordByPrimaryKey(this._hovered);}else{b=this._currentRecordSet.at(0);}if(b){var c=b.getKey();if(b.get(this._hierColumnIsLeaf)&&this._expanded[c]===undefined&&this._body.find('tr[rowkey="'+c+'"]').length){this._processTreeClick(c,false);}}}},_heightChangedIfVisible:function(){var b=this._isVisibleWithParents()&&!this._isInBeforeRenderAction();if(b){this._contentHeightChanged();}this._notifyOnSizeChanged(this,this,!b);},_contentHeightChanged:function(){this._setHeight();},_drawBodyCycle:function(){throw new Error("DataView::_drawBodyCycle must be implemented in child classes");},_reloadBody:function(){if(this._turn===""&&this._pathSelector){this._pathSelector.setPath([]);}this._drawBody();},_updateSelection:function(){if(this._hovered||!this._hovered&&!this._options.useHoverRowAsActive&&this._options.setCursorOnLoad){var b=this._body.find(this._hovered?'[rowkey="'+this._hovered+'"]':":first");if(b.length!=1||b.hasClass("was-hidden")){b=this._body.find(":first");}if(b.length===0){this._activeElement=undefined;this._hovered=undefined;this._notifySetCursor(undefined,undefined);}else{this.setActiveElement(b);}}},_notifySetCursor:function(c,b){if(!this._rowSelectionSetted){this._notifyBatchDelayed("onSetCursor",c,b);}else{this._rowSelectionSetted=false;}},_drawFooter:function(){var e;if(!this._footerDrawed){this._footerDrawed=true;e=this._foot.find(".ws-browser-pager-cont");if(this._options.display.showPaging){e.prepend('<div class="ws-browser-paging"></div>');}if(this._options.display.showRecordsCount){e.prepend('<div class="ws-browser-pager"><span class="ws-browser-pager-text">&nbsp;</span></div>');if(this._options.display.usePaging&&this._options.display.usePageSizeSelect){this._pageOptions=this._pageOptions.concat($ws._const.Browser.pageSizes);var d=this,b=$('<div class = "ws-browser-pager-select"></div>'),c=this._foot.find(".ws-browser-pager");c.append(this._pageOptionsContainer=$([$('<span class="ws-browser-pager-select-text">&nbsp;(по&nbsp;</span>').get(0),b.get(0),$('<span class="ws-browser-pager-select-text">&nbsp;на странице)</span>').get(0)]));this._insertPageCount(this._options.display.recordsPerPage);(this._pageOptionsDropdown=new $ws.proto.Deferred()).dependOn($ws.core.attachInstance("Control/Field:FieldDropdown",{element:b,width:"100%",parent:this.getParent(),data:{keys:this._pageOptions,values:this._pageOptions},wordWrap:false,allowChangeEnable:false,context:new $ws.proto.Context().setPrevious(d.getLinkedContext()).setValue("page-select-dropdown"+d._id,d._options.display.recordsPerPage),name:"page-select-dropdown"+d._id,value:d._options.display.recordsPerPage,handlers:{onChange:function(){d._setPageSize(this.getValue());}}}));}}if(this._options.display.showTiming===true){this._foot.append('<tr><td class="ws-browser-timing">&nbsp;</td></tr>');}}},_drawRowOptionsButtons:function(d){if(!Object.isEmpty(this._options.markedRowOptions)){var f="ws-browser-block-options-"+this.getId();d=d||false;if(d){if(!this._foot.find("#"+f).length){var c=this._foot.find(".ws-browser-pager"),g=$('<div class="ws-browser-foot-row-options" id="'+f+'"></div>'),b,e=this;if(c){for(var h in this._options.markedRowOptions){var i=this._options.markedRowOptions[h];b=$('<div class="ws-browser-foot-row-option" id="'+h+'"></div>');if(typeof(i.action)==="function"){b.bind("click",function(j){e._options.markedRowOptions[j.currentTarget.id].action.apply(e,e.getSelection(true));});}g.append(b.append('<span class="ws-browser-foot-row-option-icon" style="background: '+["url(",$ws.helpers.processImagePath(i.image),") no-repeat scroll"].join("")+'"></span><span class="ws-browser-foot-row-option-button">'+h+"</span>"));}c.parent().append(g);}}else{if(!this._isRenderedFootRowOptions){this._foot.find("#"+f).removeClass("ws-hidden");}}this._isRenderedFootRowOptions=true;}else{if(this._isRenderedFootRowOptions){this._foot.find("#"+f).addClass("ws-hidden");this._isRenderedFootRowOptions=false;}}this._heightChangedIfVisible();}},_updateTiming:function(){if(this._options.display.showTiming===true){var c=(new Date()).valueOf()-this._currentRecordSet.getBeginTime()-this._currentRecordSet.getElapsedTime();var b="представление : "+$ws.render.defaultColumn.money(this._body.parent().html().length/1024)+"KB | получение данных от сервера : "+$ws.render.defaultColumn.timer(this._currentRecordSet.getElapsedTime())+"сек. | генерация отчета на клиенте : "+$ws.render.defaultColumn.timer(c)+"сек.";this._foot.find(".ws-browser-timing").html("<div>"+b+"</div>");}},_updateResults:function(){},isHierarchyMode:function(){return this._options.display.viewType==="hierarchy";},_elementActivated:function(e,f){var d=false,c=this.getActiveRecord(e);if(c instanceof $ws.proto.Record){f=f?f:false;if(this._selectMode&&!f){this.confirmSelection([c]);return;}if(this.isHierarchyMode()){d=c.get(this._hierColumnIsLeaf);}var b=this._notify("onRowActivated",e,c);if(b!==false){this._showRecordDialog(c.getKey(),d);}}},_clickOnFolder:function(d,c,b){this._systemParams[this._hierColumnParentId]=c;if(this._pathSelector&&b){this._pathSelector.append({id:c,title:b.get(this._options.display.titleColumn)});}if(this._options.display.partiallyLoad){this._currentRootId=c;this._systemParams[this._hierColumnParentId]=c;this._notify("onRowActivated",d,b);this._currentRecordSet.loadNode(c);}else{this._folderOpen(d);}},_dblClickHandler:function(g,h,i,f,e,c,b){$ws.helpers.clearSelection();var d=true;if(g==="click"){d=this._notify("onRowClick",i,e,c,b);}else{d=this._notify("onRowDoubleClick",i,e,c,b);}if(d!==false){if(i.hasClass("ws-browser-folder")&&(h&&(this._options.display.viewType!=="tree"||this._options.folderLinkAction!=="activate")||g==="dblclick"&&this._options.mode!=="oneClickMode"&&this._options.mode!=="navigationMode")){if(this._options.display.viewType=="hierarchy"){this._clickOnFolder(i,f,e);}else{this._processElementClick(i,f,e);}}else{this._notifySetCursor(i,e);if(i.hasClass("ws-browser-root")){this._notify("onRowActivated",i,null);this._notify("onChange");}else{this._elementActivated(i);}}}else{this._notifySetCursor(i,e);}},_checkEditAtPlace:function(b){if(this._editAtPlaceField){if(!this._editAtPlaceField.validate()){this._editAtPlaceField.setActive(true);b.stopImmediatePropagation();return true;}}if(this._editAtPlaceValidationErrors){return true;}return false;},_processElementClick:function(d,c,b){this._notifySetCursor(d,b);},_insertRecordItem:function(){var b=this._currentRootId;if(this._options.display.viewType==="tree"&&this.getActiveRecord()!==false){b=this.getActiveRecord().get(this._hierColumnParentId);}this._showRecordDialog(undefined,false,b);},_insertRecordFolder:function(){var b=this._currentRootId;if(this._options.display.viewType==="tree"&&this.getActiveRecord()!==false){b=this.getActiveRecord().get(this._hierColumnParentId);}this._showRecordDialog(undefined,true,b);},_insertChildRecordItem:function(){if(this._options.display.viewType==="tree"&&this.getActiveRecord()!==false&&this.getActiveRecord().get(this._hierColumnIsLeaf)===true){this._showRecordDialog(undefined,false,this.getActiveRecord().getKey());}},_insertChildRecordFolder:function(){if(this._options.display.viewType==="tree"&&this.getActiveRecord()!==false&&this.getActiveRecord().get(this._hierColumnIsLeaf)===true){this._showRecordDialog(undefined,true,this.getActiveRecord().getKey());}},_editRecord:function(){this._elementActivated(this.getActiveElement(),true);},_getHandlersForDeleteRecordDialog:function(f,c,e){var d={},b=this;d.onConfirm=function(h,t){if(t){var k=c.length,g=b._options.display.reload,n=new $ws.proto.ParallelDeferred(),r={},o=[],q=[],s={},p=false,j=[];b._options.display.reload=false;for(var m=0;m<k;m++){if(b._notify("onBeforeDelete",c[m])!==false){p=true;if(b.isHierarchyMode()){s[c[m].get(b._hierColumnParentId)]=true;}(function(i){n.push(c[m].destroy().addCallback(function(l){j.push(i);return l;}).addErrback(function(l){if(r[l.message]===undefined){r[l.message]=1;}else{r[l.message]++;}o.push(i);l.processed=true;return l;}));})(c[m].getKey());}else{o.push(c[m].getKey());}}n.done();n.getResult().addBoth(function(){b._options.display.reload=g;if(!Object.isEmpty(r)){var u="В процессе удаления возникли ошибки: \n ";for(var w in r){u+=w+(c.length===1?"":" ("+r[w]+")\n");}$ws.core.alert(u,"error");}if(o.length!==0){b._activeElement=b._body.find('[rowkey="'+o[0]+'"]');}else{var l=c[k-1]?b._body.find('[rowkey="'+c[k-1].getKey()+'"]'):null;if(c[k-1]&&l.next().length!==0){b._activeElement=l.next();}else{var x=b._body.find('[rowkey="'+c[0].getKey()+'"]');b._activeElement=x.prev();}}if(p){for(var v in s){if(s.hasOwnProperty(v)){q.push(v);}}b._onRecordDeleted({},q);b._showEmptyDataBlock();}b.clearSelection(j,true);});}};d.onAfterClose=function(){b._mouseMonitor.apply(b);var g=b.getActiveElement();if(g){g.focus();}};return d;},_deleteRecords:function(j,d){if(this._options.display.readOnly||this._options.allowDelete===false){return;}if((!Object.isEmpty(this._selected)||this.getActiveRecord()!==false)||d!==undefined){var k=this,f=!Object.isEmpty(this._selected)?k.getSelection(true).length:1,l=!j&&!Object.isEmpty(this._selected)?("Удалить "+(f==1?" отмеченную запись":" отмеченные записи")+"?"):"Удалить текущую запись?",h=!j&&!Object.isEmpty(this._selected)?((f>1?"отмечено ":"отмечена ")+f+" запис"+$ws.helpers.wordCaseByNumber(f,"ей","ь","и")):"",i=this._rootNode,g=false,c,b,e;if(Object.isEmpty(this._selected)||j===true){g=d===undefined?this.getActiveRecord():this._currentRecordSet.getRecordByPrimaryKey(d);if(this.isHierarchyMode()){i=g.get(this._hierColumnParentId);}}e=function(){$ws.core.setCursor(false);k._useKeyboard=true;$ws.core.attachInstance("SBIS3.CORE.DialogConfirm",{resizable:false,detail:h,message:l,context:new $ws.proto.Context().setPrevious(k.getLinkedContext()),handlers:k._getHandlersForDeleteRecordDialog(j,c,i)}).addBoth(function(m){$ws.core.setCursor(true);return m;});};c=j===true?[g?g:this.getActiveRecord()]:this.getSelection();b=this._notify("onDeleteStart",c);if(typeof b=="string"){l=b;e();}else{if(b instanceof $ws.proto.Deferred){b.addCallback(e);}else{if(b!==false){e();}}}}},_expandAll:function(c,b){if(this._options.display.viewType==="hierarchy"){var d=this.getQuery();this._expanded[this._currentRootId]=2;d[this._hierColumnParentId]=this._currentRootId;this._systemParams[this._hierColumnParentId]=this._currentRootId;d["Разворот"]="С разворотом";d.usePages="";this._systemParams["Разворот"]="С разворотом";if(c){this._turn="BranchesAndLeaves";this._options.display.viewType="tree";d["ВидДерева"]="С узлами и листьями";this._systemParams["ВидДерева"]="С узлами и листьями";}else{if(this._options.display.expand==="onlyFolders"){this._turn="OnlyFolders";d["ВидДерева"]="Только узлы";this._systemParams["ВидДерева"]="Только узлы";}else{this._turn="OnlyLeaves";d["ВидДерева"]="Только листья";this._systemParams["ВидДерева"]="Только листья";}}if(this._currentRecordSet){this._currentRecordSet.setUsePages("");}if(this._paging){this._paging.setEnabled(false);}if(!b){this._runQuery(d,true);}}},_clearExpandAll:function(b){var d=this._hierColumnParentId,e=this.getQuery();this._turn="";e["Разворот"]=this._options.display.partiallyLoad?"Без разворота":"С разворотом";this._systemParams["Разворот"]=e["Разворот"];e["ВидДерева"]="С узлами и листьями";this._systemParams["ВидДерева"]="С узлами и листьями";var c=this.getActiveRecord();if(c){this._currentRootId=c.get(d);}this._options.display.viewType="hierarchy";e[this._hierColumnParentId]=this._options.display.partiallyLoad?this._currentRootId:this._rootNode;this._systemParams[this._hierColumnParentId]=e[this._hierColumnParentId];this._currentRecordSet.setUsePages(this._options.display.usePaging);if(this._paging){this._paging.setEnabled(true);}if(this._pathSelector){this._pathSelector.setEnabled(true);}if(!b){this._runQuery(e,true);}},getItemParents:function(b){return this._getItemParents(b);},_getItemParents:function(d){var b=[d],c;while(d&&d!=this._rootNode&&this._currentRecordSet.contains(d)){c=this._currentRecordSet.getRecordByPrimaryKey(d);d=c.get(this._hierColumnParentId);b.push(d);}return b;},clearSorting:function(){if(!this._sortingStack.length){return;}this._head.find(".ws-browser-sortable").removeClass("asc").removeClass("desc").addClass("none");this._sortingStack=[];this._currentRecordSet.setPage(0,true);this._currentRecordSet.setSorting([],this.getQuery(),this._options.display.viewType==="hierarchy");},setSorting:function(f,c){this._head.find(".ws-browser-sortable").removeClass("asc desc").addClass("none");this._sortingStack=[];var d=[];for(var e=0;e<f.length;++e){var g=f[e].field,b=f[e].order;this._sortingStack.push({field:g,type:b==="asc"?0:1});d.push([g,b==="desc"]);if(this._sortingMarkers[g]){this._sortingMarkers[g].removeClass("none").addClass(b);}}if(this._currentRecordSet){this._currentRecordSet.setSorting(d,this.getQuery(),this._options.display.viewType==="hierarchy",c);}},move:function(m,l,p){if(!this._options.allowMove){return;}if(m==="null"){m=null;}var d=this.getSelection(),q=this,c,k=p||this._getItemParents(m),b={};l=l||[];l.push(m);for(var f=0,g=k.length;f<g;++f){b[k[f]]=true;}for(f=0,g=d.length;f<g;++f){var o=d[f].getKey();if(o==m||(o in b)){$ws.core.alert("Вы не можете переместить запись саму в себя!");return;}if(q._options.display.viewType==="tree"&&q._turn===""){l.push(d[f].get(q._hierColumnParentId));}}if(q._options.display.viewType==="tree"&&q._turn===""){if(!this._expanded[m]){this._expanded[m]=true;l.push(m);}}var n=function(){var s=new $ws.proto.ParallelDeferred(),u=[],t=function(){q.unsubscribe("onAfterRender",t);q._hovered=d[0].getKey();q.showBranch(m);};$ws.core.setCursor(false);for(var r=0,e=d.length;r<e;r++){d[r].set(q._hierColumnParentId,m);s.push(d[r].update().addErrback(function(i){u.push(i.message);}));}s.done();s.getResult().addBoth(function(){if(u.length!==0){$ws.core.alert("В процессе перемещения возникли ошибки: \n "+u.join(" ;\n "));}q._isUpdatingRecords=false;if(!q._expanded[m]&&(m!=q._rootNode||q._options.display.showRoot)){q._activeElement=undefined;q._hovered=m;}q.removeSelection();if(q._options.mode==="navigationMode"){q._closeOtherBranches(m);}if(q._options.display.viewType==="tree"){if(q._turn!==""){q._currentRootId=m;}}else{q.subscribe("onAfterRender",t);}q._onRecordUpdated(q._options.display.viewType==="tree"&&q._turn==="",l);$ws.core.setCursor(true);});},j=function(){if(c.get(q._hierColumnIsLeaf)!==true){$ws.core.alert("Вы не можете перемещать в лист! Выберите другую запись для перемещения!");}else{n();}};q._isUpdatingRecords=true;if(m===q._rootNode){n();}else{try{c=this._currentRecordSet.getRecordByPrimaryKey(m);j();}catch(h){this._currentRecordSet.readRecord(m).addCallback(function(e){c=e;j();});}}},_showReportsList:function(i,c,b,j){var h=null,g=this,f;if(!c){h=b?b:(Object.isEmpty(this._selected)?this.getActiveRecord():this.getSelection());}f=this._notify("onBeforeShowPrintReports",this.getReports(c),h,c);if(f!==false){var d;if(f instanceof Array){d=f;if(f.length==1){f=f[0];}}else{d=typeof(f)==="string"?[]:"";}this._createPrintMenu(d,c).addCallback(function(k){if(g._printMenu===null){if(!f||f===true){var o=g._options[c?"reportsForList":"reports"];for(var l in o){if(o.hasOwnProperty(l)){f=l;}}}f=f===true?undefined:f;g.printReport(f,c);}else{if(!i.clientX||!i.clientY){var n=j?j:(g._activeElement?g._activeElement:g._body.find("tr:first")),e=n.offset();i.clientX=e.left+9;i.clientY=e.top+n.height()+9;}else{i.clientY+=16;}try{g._printMenu.show(i);g._printMenuIsShow=true;}catch(m){g._printMenu.subscribe("onReady",function(){g._printMenu.show(i);g._printMenuIsShow=true;});}}return k;});}},showHistory:function(d,f){if(this._options.display.showHistory===true){$ws.core.setCursor(false);this._useKeyboard=true;var c=$ws.core.merge({},this._initialSource),e={readerType:c.readerType,filterParams:f?f:{},hierarchyField:"",readerParams:c.readerParams,firstRequest:true,usePages:"full",rowsPerPage:100},b=this;e.filterParams["ИдО"]=d;e.readerParams.queryName="История";$ws.core.attachInstance("Source:RecordSet",e).addCallback(function(g){$ws.core.attachInstance("SBIS3.CORE.Dialog",{template:"historyDialog",handlers:{onReady:function(){this.getChildControlByName("ws-browser-history").subscribe("onReady",function(){var h=this;if(g.getRecordCount()===0){g.subscribe("onAfterLoad",function(){h.setData(g);});}else{this.setData(g);}});},onAfterShow:function(){$ws.core.setCursor(true);},onAfterClose:$.proxy(b._mouseMonitor,b)}});}).addErrback(function(){$ws.core.setCursor(true);});}},copy:function(d){if(this._options.useCopyRecords&&!this._options.display.readOnly){var b=d?d:this.getActiveRecord(),c=null,e=null;if(b){if(this.isHierarchyMode()){c=b.get(this._hierColumnIsLeaf);e=b.get(this._hierColumnParentId);}this._showRecordDialog(b.getKey(),c,e,true);}}},_isCtrl:function(b){return b.ctrlKey&&!b.altKey&&!b.shiftKey;},_isNotModified:function(b){return !b.ctrlKey&&!b.altKey&&!b.shiftKey;},mergeSelectedRecords:function(){if(this._options.useMergeRecords&&!this._options.display.readOnly&&!Object.isEmpty(this._selected)){var e=this.getActiveRecord().getKey(),f=true,h=this._columnMap&&this._columnMap.length!==0?this._columnMap:this._currentRecordSet.getColumns(),g=this.getSelection(),c=this;for(var d=0,b=g.length;d<b;d++){if(g[d].getKey()===e){f=false;}}if(f){this._useKeyboard=true;$ws.core.setCursor(false);$ws.core.attachInstance("Source:RecordSetStatic",{defaultColumns:h,usePages:"full",rowsPerPage:100,records:g}).addCallback(function(i){$ws.core.attachInstance("SBIS3.CORE.Dialog",{template:"mergeRecordsDialog",context:new $ws.proto.Context().setPrevious(c.getLinkedContext()),handlers:{onReady:function(){var k=this.getChildControlByName("ws-browser-merge");k.recordSetReady().addCallback(function(){k.setData(i);k.setColumns(c.getColumns());});var j=this.getChildControlByName("ws-browser-merge-mainRow");$ws.core.attachInstance("Source:RecordSetStatic",{defaultColumns:h,records:[c.getActiveRecord()]}).addCallback(function(l){j.recordSetReady().addCallback(function(){j.setData(l);j.setColumns(c.getColumns());});});},onAfterClose:function(){c.removeSelection();c._mouseMonitor.apply(c);c.reload();},onAfterShow:function(){$ws.core.setCursor(true);}}});});}else{$ws.core.alert("Запись, с которой будет проведено объединение не должна входить в выбранные записи.");}}},_moveRecords:function(f){var i=this.getSelection(),g=true,c=this;if(i.length>0&&this._notify("onDragStart",i)!==false){if(c._options.display.viewType==="hierarchy"){var e=i[0].get(this._hierColumnParentId);for(var d=1,b=i.length;d<b;d++){if(i[d].get(this._hierColumnParentId)!==e){g=false;}}if(g&&!(f&&(e===f.get(this._hierColumnParentId)||e===f.getKey()||e===c._currentRootId))){g=false;}}if(g){$ws.core.setCursor(false);this._useKeyboard=true;var h=$ws.core.merge({},this._initialSource);h.firstRequest=false;h.usePages=h.filterParams.usePages="";h.handlers={};if(this._options.useCurrentFilterOnMove){h.filterParams=this.getQuery();}else{h.filterParams=$ws.core.merge({},this._initialFilter);}h.filterParams["ВидДерева"]="Только узлы";h.filterParams[this._hierColumnParentId]=c._rootNode;$ws.core.attachInstance("Source:RecordSet",h).addCallback(function(j){$ws.core.attachInstance("SBIS3.CORE.Dialog",{template:"replaceRecordsDialog",handlers:{onReady:function(){var m=this.getChildControlByName("ws-browser-replace"),l=this,k=function(p,n){var o=m.getItemParents(p);c.move(p,n,o);};m.subscribe("onReady",function(){m.setData(j);m.setHierarchyField(c._hierColumnParentId);m.setRootNode(c._rootNode);});m.subscribe("onRowDoubleClick",function(q,r,n){var p=n?n.get(c._hierColumnParentId):c._rootNode,o=[];while((p+"")!==(c._rootNode+"")&&c._options.display.viewType!=="hierarchy"){if(!c._expanded[p]){c._expanded[p]=true;o.push(p);}p=this.getRecordSet().getRecordByPrimaryKey(p).get(c._hierColumnParentId);}if(c._notify("onDragStop",i,n?n:c._rootNode,true)!==false){k(n?n.getKey():c._rootNode,o);}l.close();});m.subscribe("onSelectionConfirm",function(q,n){var p=n.length===0?c._rootNode:n[0].get(c._hierColumnParentId),o=[];while((p+"")!==(c._rootNode+"")&&c._options.display.viewType!=="hierarchy"){if(!c._expanded[p]){c._expanded[p]=true;o.push(p);}p=this.getRecordSet().getRecordByPrimaryKey(p).get(c._hierColumnParentId);}if(c._notify("onDragStop",i,n.length===0?c._rootNode:n[0],true)!==false){c.move(n.length===0?c._rootNode:n[0].getKey(),o);}l.close();});this.getChildControlByName("replace").subscribe("onActivated",function(){var o=m.getActiveRecord()?m.getActiveRecord().get(c._hierColumnParentId):c._rootNode,n=[],p;while((o+"")!==(c._rootNode+"")&&c._options.display.viewType!=="hierarchy"){if(!c._expanded[o]){c._expanded[o]=true;n.push(o);}o=m.getRecordSet().getRecordByPrimaryKey(o).get(c._hierColumnParentId);}p=m.getActiveRecord();if(c._notify("onDragStop",i,p?p:c._rootNode,true)!==false){k(p?p.getKey():c._rootNode,n);}l.close();});},onAfterShow:function(){$ws.core.setCursor(true);},onAfterClose:$.proxy(c._mouseMonitor,c)}});});}else{this._confirmMoveRecords(f);}}},_confirmMoveRecords:function(c){var b=this,d=this.getSelection();if(this._notify("onDragStart",d)!==false){$ws.core.setCursor(false);this._useKeyboard=true;$ws.core.attachInstance("SBIS3.CORE.DialogConfirm",{resizable:false,message:"Переместить выбранные записи ( "+d.length+" ) в текущий раздел?",handlers:{onConfirm:function(g,e){if(e===true){var f=b._currentRootId;if(c){if(c.get(b._hierColumnIsLeaf)){f=c;}else{f=c.get(b._hierColumnParentId);f=f===b._rootNode?f:b._currentRecordSet.getRecordByPrimaryKey(f);}}if(b._notify("onDragStop",d,f,true)!==false){var h=f instanceof $ws.proto.Record?f.getKey():f;b.move(f===b._rootNode?b._rootNode:h);}b._mouseMonitor.apply(b);b.removeSelection();}}}}).addBoth(function(e){$ws.core.setCursor(true);return e;});}},_mouseMonitor:function(){var b=this,c=function(){b._useKeyboard=false;$("[rowkey]",b._body.parent()[0]).die("mousemove",c);};$("[rowkey]",b._body.parent()[0]).live("mousemove",c);},_keyboardHover:function(h){var i=this._hierColumnParentId,j=false,q=this,c=true;if(!this._currentRecordSet||!this._currentRecordSet.isLoaded()){return j;}if(this._printMenuIsShow){this._printMenu.show(h);this._createPrintMenu([]);this._printMenuIsShow=false;c=h.which!==$ws._const.key.f4&&!(h.ctrlKey&&h.which===$ws._const.key.p);}if(this.isActive()){var n=this.getActiveElement(),l=n?n.next(".ws-visible:first"):[],p=n?n.prev(".ws-visible:first"):[],g=l.length>0?l:null,f=p.length>0?p:null;if(h.ctrlKey&&h.altKey&&h.shiftKey&&h.which===$ws._const.key.o){this.mergeSelectedRecords();}else{if(h.ctrlKey&&h.which===$ws._const.key.space){if(!this._minimized){this.showSelection(true);}else{this.showSelection(false);}}else{if(!h.ctrlKey&&!h.altKey&&h.shiftKey&&h.which===$ws._const.key.f5){this.copy();}else{if(this._isNotModified(h)&&(h.which===$ws._const.key.f5||h.which===$ws._const.key.pageUp||h.which===$ws._const.key.pageDown)){j=true;}else{if(this._isCtrl(h)&&h.which===$ws._const.key.n){this.reload();}else{if(this._isCtrl(h)&&h.which===$ws._const.key.h){this.showHistory(this.getActiveRecord().getKey());}else{if(this._isCtrl(h)&&h.which===$ws._const.key.m&&q.isHierarchyMode()&&!this._options.display.readOnly&&this._options.allowMove){this._moveRecords(this.getActiveRecord());}else{if(!h.altKey&&!h.shiftKey&&(!h.ctrlKey&&h.which===$ws._const.key.f4||(h.ctrlKey&&h.which===$ws._const.key.p))){if(c&&(!Object.isEmpty(this._options.reports)&&h.which===$ws._const.key.f4||h.which!==$ws._const.key.f4)){this._showReportsList(h,h.which!==$ws._const.key.f4);}}else{if((this._isCtrl(h)&&(h.which===$ws._const.key.b||h.which===$ws._const.key.v))&&this._turn!==""){this.applyTurn(false);}else{if(this._isNotModified(h)&&h.which===$ws._const.key.minus){this.removeSelection();}else{if(this._isCtrl(h)&&(h.which===$ws._const.key.b||h.which===$ws._const.key.v)){this.applyTurn(h.which===$ws._const.key.b);}else{if(this._isCtrl(h)&&h.which===$ws._const.key.q){if(this._options.filterDialogTemplate){this.createFiltersDialog();}}else{if(h.which===$ws._const.key.enter&&(this._selectMode||h.ctrlKey)&&!h.altKey&&!h.shiftKey){this.confirmSelection();}else{if(this._isCtrl(h)&&(h.which===$ws._const.key.pageDown||h.which===$ws._const.key.pageUp)){this.setActiveElement(this._body.find(".ws-visible:"+((h.which===$ws._const.key.pageDown)?"last":"first")));h.stopPropagation();}else{if(this._isNotModified(h)&&(h.which===$ws._const.key.down||h.which===$ws._const.key.up)){if(this._options.useHoverRowAsActive&&!this._useKeyboard){this._useKeyboard=true;this._mouseMonitor();}var d=(h.which===$ws._const.key.down)?g:f;if(d){this.setActiveElement(d);if(this._options.useHoverRowAsActive&&this._options.display.rowOptions){q._showRowOptions.apply(q,[d[0]]);}}}else{if(this._isNotModified(h)&&h.which===$ws._const.key.space){if(this._options.useSelection!==false&&!this._activeElement.hasClass("ws-browser-add-at-place-link-row")){if(!(this._options.multiSelect===false&&!Object.isEmpty(this._selected))||this._activeElement.hasClass("ws-browser-selected")){this._selectActiveElement();}this.setActiveElement(g);}}else{if(this._isNotModified(h)&&((h.which===$ws._const.key.enter)||(h.which===$ws._const.key.backspace&&this._options.display.viewType==="hierarchy")||h.which===$ws._const.key.f3)){if(this._options.display.viewType==="hierarchy"&&h.which===$ws._const.key.backspace){if(this._turn!==""||this._currentRootId===this._rootNode){return true;}if(n&&(n.attr("rowkey")==="null"||!n.attr("rowkey"))){return false;}var o=this._currentRootId,m=this._currentRecordSet.getWay();if(this._currentRecordSet.contains(o)){o=this._currentRecordSet.getRecordByPrimaryKey(o).get(i);}else{if(m&&m.contains(o)){o=m.getRecordByPrimaryKey(o).get(i);}else{throw new Error("Browser:_keyboardHover backspace error");}}if(this._pathSelector&&!this._pathSelector.isEmpty()){this._pathSelector.pop();}this._hovered=this._currentRootId;this.showBranch(o);this._updatePager();}else{if(!n){return false;}if(n.hasClass("ws-browser-folder")&&this._options.display.viewType==="hierarchy"&&h.which!==$ws._const.key.f3&&this._turn===""){this._currentRootId=n.attr("rowkey");this._currentRootId=this._currentRootId==="null"?null:this._currentRootId;var b=n.attr("rowkey")==="null"?null:n.attr("rowkey");if(this._pathSelector){this._pathSelector.append({id:b,title:this.getActiveRecord().get(this._options.display.titleColumn)});}this._systemParams[this._hierColumnParentId]=b;if(this._options.display.partiallyLoad){this._systemParams[this._hierColumnParentId]=b;this._currentRecordSet.loadNode(b);}else{this._folderOpen(n);}}else{if(n.length>0){this._elementActivated(n,true);}}}}else{if(this._isNotModified(h)&&h.which===$ws._const.key.esc){j=true;}else{if(!this._options.display.readOnly&&!h.shiftKey&&!h.altKey){if(h.which===$ws._const.key.del&&!h.ctrlKey){this._deleteRecords(false);}else{if(h.which===$ws._const.key.insert){if(h.ctrlKey||this._options.display.viewMode!=="foldersTree"){var k=this._actions[h.ctrlKey?"addFolder":"addItem"];if(k){k(this.getActiveElement(),false);}}}}}}}}}}}}}}}}}}}}}}}}else{j=true;}return j;},_readRecord:function(c,e,d,h){var j=this;if(c===undefined){var b=$ws.core.merge({},j.getQuery());if(j.isHierarchyMode()){b[j._hierColumnParentId]={hierarchy:[e,(d?true:null)]};}var g=j._notify("onBeforeCreate",e,d?true:null,b);if(g instanceof $ws.proto.Deferred){var f=new $ws.proto.Deferred();g.addCallbacks(function(k){if(k instanceof $ws.proto.Record){f.callback(k);}else{if(k&&Object.prototype.toString.call(k)=="[object Object]"){b=$ws.core.merge(b,k);}b["ВызовИзБраузера"]=true;j._currentRecordSet.createRecord(b).addCallbacks(function(l){f.callback(l);return l;},function(l){f.errback(l);return l;});}},function(k){f.errback(k);return k;});return f;}else{if(g instanceof $ws.proto.Record){return new $ws.proto.Deferred().callback(g);}else{if(g===false){return new $ws.proto.Deferred().callback(g);}else{if(g&&Object.prototype.toString.call(g)=="[object Object]"){b=$ws.core.merge(b,g);}b["ВызовИзБраузера"]=true;return j._currentRecordSet.createRecord(b);}}}}else{if(h===true){return j._currentRecordSet.copyRecord(c);}else{var i=j._notify("onBeforeRead",c);if(i instanceof $ws.proto.Deferred){return i;}else{if(i instanceof $ws.proto.Record){return new $ws.proto.Deferred().callback(i);}else{if(i===false){return new $ws.proto.Deferred().callback(i);}else{return j._currentRecordSet.readRecord(c);}}}}}},_showRecordDialog:function(e,g,h,k){if((this._options.display.readOnly&&(!e||k))||(e!==undefined&&this._options.display.editAtThePlaceOnly)||(e===undefined&&this._options.allowAdd===false)){return;}var j,c,o=this,l=false,m=null,b=g?this._options.editBranchMode:this._options.editMode,d=g?this._options.editBranchDialogTemplate:this._options.editDialogTemplate;k=k!==undefined?k:false;g=g!==undefined?g:false;h=h!==undefined?h:null;c=g?o._options.editBranchDialogTemplate:o._options.editDialogTemplate;if(k){var i=o._currentRecordSet.getRecordByPrimaryKey(e),f=o._notify("onBeforeCopy",i);}if(c!==""&&(!k||k&&f!==false)){if(b=="newWindow"||b=="thisWindow"){if(SBIS3.CORE.ListView&&o instanceof SBIS3.CORE.ListView||b=="newWindow"||e===undefined||k||o._options.useHoverRowAsActive===true){o._openEditWindow(e,g,h,k);}else{window.location.href=o._body.find('tr[rowkey="'+e+'"] .ws-browser-link:first').attr("href");}return;}else{if(b=="thisPage"){var n=this.getTopParent();$ws.single.GlobalContext.setValue("editParams",this.generateEditPageURL(e,g,h,k));if(n instanceof SBIS3.CORE.AreaAbstract){$ws.core.bootup(d,undefined,undefined,n.getTemplateName());}return;}}this._useKeyboard=true;$ws.core.setCursor(false);$ws.helpers.toggleIndicator(true);this._readRecord(e,h,g,k).addBoth(function(p){$ws.core.setCursor(true);return p;}).addCallback(function(p){if(p instanceof $ws.proto.Record){j=o._notify("onBefore"+(e===undefined?"Insert":"Update"),p);if(typeof(j)!=="boolean"){if(typeof(j)=="string"){c=j;}var q={onAfterClose:function(){o._mouseMonitor.apply(o);var t=o.getActiveElement();if(t){t.focus();}if(!l&&(e===undefined||k===true)&&p.getKey()!==null){o._isFakeDelete=true;p.destroy();}else{if(m!==null){var s=o.isHierarchyMode()?p.get(o._hierColumnParentId):o._currentRootId;var r=function(){o.unsubscribe("onAfterRender",r);var u=o._body.find('[rowkey="'+m+'"]');if(u.length!==0){o.setActiveElement(u);}if(o._options.display.viewType==="tree"&&!o._expanded[s]&&s!==o._rootNode){o.showBranch(m);}};if(o._body.find('[rowkey="'+m+'"]').length!==0){r();}else{o.subscribe("onAfterRender",r);}}}},onRecordUpdate:function(s,r){l=true;if(e===undefined||k===true){m=r;}},onReady:function(r){$ws.helpers.toggleIndicator(false);}};q.onBeforeShowPrintReports=o._events.onBeforeShowPrintReports;q.onPrepareReportData=o._events.onPrepareReportData;q.onSelectReportTransform=o._events.onSelectReportTransform;$ws.core.attachInstance("SBIS3.CORE.DialogRecord",{opener:o,template:c,record:p,context:new $ws.proto.Context().setPrevious(o.getLinkedContext()),readOnly:o._options.display.readOnly,isNewRecord:e===undefined,reports:o._options.reports,handlers:q});}else{$ws.helpers.toggleIndicator(false);if(e===undefined&&j===false&&p.getKey()!==null){o._isFakeDelete=true;p.destroy();}}}else{$ws.helpers.toggleIndicator(false);}}).addErrback(function(p){$ws.helpers.toggleIndicator(false);if(p&&p.message){$ws.core.alert(p.message,"error");}p.processed=true;return p;});}},openWindowRecord:function(e,c,f,b,d){this._openEditWindow(e,c,f,b,d);},_transmitParamsForPrintWindow:function(f,c){var d="printWindow",e=c?c:$ws._const.appRoot+d+".html",b;e+="?printParams="+encodeURIComponent($ws.helpers.serializeURLData(f));b=window.open(e,"_blank");if(b){b.focus();}},_openPrintWindow:function(q,p,e,k,d){var r=this,g={id:this.getId(),_events:{}},n=[];if(q!==undefined){g.idR=q;}if(p!==undefined){g.list=p;}if(e!==undefined){g.xsl=e;}if(k!==undefined){g.root=k;}if(!(Object.isEmpty(this._options.reports))){g.reports=this._options.reports;g._events.onBeforeShowPrintReports=this._handlersPath("onBeforeShowPrintReports");g._events.onPrepareReportData=this._handlersPath("onPrepareReportData");g._events.onSelectReportTransform=this._handlersPath("onSelectReportTransform");}if(r._columnMap!==undefined){for(var m=0,f=r._columnMap.length;m<f;m++){n.push({title:r._columnMap[m].title,field:r._columnMap[m].field});}g.cols=n;}if(r._options.titleColumn!==undefined){g.tCol=r._options.titleColumn;}$ws.core.setCursor(true);if(!q){if(r._paging&&r._turn===""){r._selectPrintPages().addCallback(function(i){if(i!==undefined){g.dS=this._prepareRecordSetForPrint(i);}r._transmitParamsForPrintWindow(g,d);return i;});}else{g.dS=this._prepareRecordSetForPrint(r._collectDataSource());r._transmitParamsForPrintWindow(g,d);}}else{var c=r._getDataSource(),b;if(c){g.dS=this._prepareRecordSetForPrint(c);}b=r.getSelection();g.keys=[];for(var h=0,o=b.length;h<o;h++){g.keys.push(b[h].getKey());}r._transmitParamsForPrintWindow(g,d);}},_prepareRecordSetForPrint:function(c){var b=$ws.core.merge({},c);delete b.handlers;delete b.context;if(b.readerType=="ReaderUnifiedSBIS"){delete b.readerType;}if(b.firstRequest===true){delete b.firstRequest;}if(!this.isHierarchyMode()){delete b.hierarchyField;}if(this._options.display.usePaging===""){delete b.rowsPerPage;delete b.usePages;}if(b.readerParams["dbScheme"]===""){delete b.readerParams["dbScheme"];}if(b.readerParams["queryName"]==="Список"){delete b.readerParams["queryName"];}if(b.readerParams["readMethodName"]==="Прочитать"){delete b.readerParams["readMethodName"];}if(b.readerParams["createMethodName"]==="Создать"){delete b.readerParams["createMethodName"];}if(b.readerParams["updateMethodName"]==="Записать"){delete b.readerParams["updateMethodName"];}if(b.readerParams["destroyMethodName"]==="Удалить"){delete b.readerParams["destroyMethodName"];}return b;},generateEditPageURL:function(e,g,i,j,c){if(!this.isHierarchyMode()&&this._options.editDialogTemplate||(g&&this._options.editBranchDialogTemplate||!g&&this._options.editDialogTemplate)){var f={id:this.getId(),hierMode:this.isHierarchyMode(),pk:e,copy:j||false,readOnly:this._options.display.readOnly||false,obj:this._options.dataSource.readerParams.linkedObject,_events:{}},d,l,k=c?c:undefined,m=g?this._options.editBranchDialogTemplate:this._options.editDialogTemplate,b=g?this._options.editBranchMode:this._options.editMode;if(k===undefined){if($ws._const.htmlNames[m]){var h=$ws._const.htmlNames[m].split("/");k=h[h.length-1];}else{d=$ws._const.xmlContents[m].split("/");k=$ws._const.appRoot+d[d.length-1]+".html";}}if(b==="thisWindow"){f.history=true;}l=this._options.dataSource.readerParams.format;if(l!==undefined){f.format=l;}l=this._options.dataSource.readerType;if(l&&l!=="ReaderUnifiedSBIS"){f.type=l;}l=this._options.dataSource.readerParams.otherURL;if(l&&l!==$ws._const.defaultServiceUrl){f.url=l;}l=this._options.dataSource.readerParams.dbScheme;if(l){f.db=l;}l=this._options.dataSource.readerParams.queryName;if(l&&l!=="Список"){f.method=l;}l=this._options.dataSource.readerParams.readMethodName;if(l&&l!=="Прочитать"){f.readMethod=l;}l=this._options.dataSource.readerParams.createMethodName;if(l&&l!=="Создать"){f.createMethod=l;}l=this._options.dataSource.readerParams.updateMethodName;if(l&&l!=="Записать"){f.updateMethod=l;}l=this._options.dataSource.readerParams.destroyMethodName;if(l&&l!=="Удалить"){f.destroyMethod=l;}if(this.isHierarchyMode()){f.pIdCol=this._hierColumnParentId;f.branch=g;f.pId=i;}if(e===undefined){f.filter=this.getQuery();f._events.onBeforeCreate=this._handlersPath("onBeforeCreate");f._events.onBeforeInsert=this._handlersPath("onBeforeInsert");}f._events.onBeforeRead=this._handlersPath("onBeforeRead");f._events.onBeforeUpdate=this._handlersPath("onBeforeUpdate");if(!(Object.isEmpty(this._options.reports))){f.reports=this._options.reports;f._events.onBeforeShowPrintReports=this._handlersPath("onBeforeShowPrintReports");f._events.onPrepareReportData=this._handlersPath("onPrepareReportData");f._events.onSelectReportTransform=this._handlersPath("onSelectReportTransform");}f=$ws.helpers.serializeURLData(f);k+="?editParams="+encodeURIComponent(f);return b!=="thisPage"?k:f;}else{return false;}},_openEditWindow:function(e,f,g,i,c){var j=this.generateEditPageURL(e,f,g,i,c),d=this._notify("onBeforeOpenEditWindow",j),h,b=f?this._options.editBranchMode:this._options.editMode;if(typeof(d)==="string"){j=d;}if(d!==false){if(b=="thisWindow"){window.location.href=j;}else{h=window.open(j,"_blank");if(h){h.focus();}}}},_handlersPath:function(d){var c=this._events[d],f=[];for(var e=0,b=c.length;e<b;e++){if(c[e].wsHandlerPath){f.push(c[e].wsHandlerPath);}}return f;},_folderOpen:function(b){return this._runInBatchUpdate("Browser._folderOpen",function(){var d=b.attr("rowkey"),c=null;if(d!==this._rootNode&&d!=="null"){try{c=this._currentRecordSet.getRecordByPrimaryKey(d);}catch(g){var f=this._currentRecordSet.getWay();c=f.getRecordByPrimaryKey(d);}}this._notifyBatchDelayed("onRowActivated",b,c);this._currentRootId=(d===""||d==="null")?null:d;this._drawBody();this._updatePager();});},scrollToActive:function(b){if(this._bodyHeight<this._bodyRealHeight&&b&&"jquery" in b){if(!this._wsBrowserContainer){this._wsBrowserContainer=this._data.parent();}var e=this._wsBrowserContainer.position().top,c=this._wsBrowserContainer[0].clientHeight,d=b.height(),f=this._wsBrowserContainer.scrollTop(),g=f+b.position().top-e;if(g+d>f+c){this._wsBrowserContainer.scrollTop(g+d-c);}else{if(g<f){this._wsBrowserContainer.scrollTop(g);}}}},refresh:function(){this._runInBatchUpdate("Browser.refresh",function(){if(this._dReady.isReady()&&this._currentRecordSet){this._rowSelectionSetted=false;if(this._onBeforeRenderActions()){if(!this._columnMap||this._columnMap.length===0){this._drawHead();}this._drawBody();}}});},reload:function(){this._useKeyboard=false;this._expanded={};if(this._options.display.showRoot){this._expanded[this._rootNode]=true;}this._loaded={};var b=this.getQuery(true);if(this.isHierarchyMode()){this._loaded[this._currentRootId]=true;b[this._hierColumnParentId]=this._currentRootId;}else{this._loaded[this._rootNode]=true;}return this._runQuery(b,true);},clear:function(){var c=this.getRecordSet();if(c.getRecordCount()!==0){c.clear();if(this.isHierarchyMode()){this.resetFilter(true);if(this._pathSelector&&SBIS3.CORE.PathSelector&&this._pathSelector instanceof SBIS3.CORE.PathSelector){this._pathSelector.setPath([]);}if(this._turn){if(this._turn=="BranchesAndLeaves"){this._options.display.viewType="hierarchy";}this._clearExpandAll(true);}if(this._options.display.viewType==="tree"){if(this._expanded){for(var b in this._expanded){delete this._expanded[b];}}}if(this._rootNode){this._currentRootId=this._rootNode;}}this.refresh();this.getPaging().addCallback(function(d){d.update(undefined,0);return d;});this._updatePager();this.removeSelection();}},performFunction:function(f){var g=this.getSelection(),e=new $ws.proto.ParallelDeferred(),c=this;c._isUpdatingRecords=true;for(var d=0,b=g.length;d<b;d++){e.push(f(g[d]));}e.done();e.getResult().addCallback(function(){c._isUpdatingRecords=false;c.reload();});},getActiveElement:function(){if(this._options.useHoverRowAsActive===true){var b=this._body.find("[rowkey].ws-browser-item-over");return b.length>0?b:false;}else{if(this._activeElement){return this._activeElement;}else{return false;}}},setActiveElement:function(f,c,b,e){if((f===null||f===undefined)&&this._activeElement&&!this._options.setCursorOnLoad){this._activeElement.removeClass("ws-browser-item-over");this._activeElement=undefined;this._hovered=undefined;}if(this._options.useSelection!==false&&f&&"jquery" in f&&f.length>0&&(this._activeElement&&this._activeElement[0]!==f||!this._activeElement)&&f.closest(".ws-browser")[0]==this._data[0]){if(this._activeElement){this._activeElement.removeClass("ws-browser-item-over");}f.addClass("ws-browser-item-over");this._setSelection(f);f.attr("tabindex","-1");if(c!==false){if(this.isActive()){f.focus();}this.scrollToActive(f);}this._activeElement=f;this._hovered=f.attr("rowKey")!=="null"?f.attr("rowKey"):null;var d=this._hovered?this.getActiveRecord():null;if(!b){this._notifySetCursor(this._activeElement,d);}this._changeState(e);}else{if(this._rowSelection instanceof Object&&"jquery" in this._rowSelection){this._rowSelection.css("display","none");}}},_setSelection:function(b){this._container.find(".ws-browser-row-selected").removeClass("ws-browser-row-selected");b.addClass("ws-browser-row-selected");},destroy:function(){if(this._pathSelector&&this._pathSelector.destroy){this._pathSelector.destroy();}if(this._paging&&this._paging.destroy){this._paging.destroy();}if(this._toolbar&&this._toolbar.destroy){this._toolbar.destroy();}if(this._parent){this._parent.unsubscribe("onReady",this._dataBindHandler);}if(this._setDataHandler){this._parent.unsubscribe("onReady",this._setDataHandler);}if(this._currentRecordSet!==null){this._currentRecordSet.abort();}this._reportPrinter=null;$ws.proto.DataView.superclass.destroy.apply(this,arguments);},setSelectionType:function(b){this._options.selectionType=b||"all";if(this._options.selectionType==="node"||this._options.display.viewMode=="foldersTree"){this._options.filterParams["ВидДерева"]="Только узлы";this._currentFilter["ВидДерева"]="Только узлы";this._systemParams["ВидДерева"]="Только узлы";}},_testSelectedRecord:function(b){if(b!==undefined){if(this.isHierarchyMode()){switch(this._options.selectionType){case"leaf":if(!b.get(this._hierColumnIsLeaf)){return true;}break;case"node":if(!!b.get(this._hierColumnIsLeaf)){return true;}break;case"all":default:return true;}}else{return true;}}return false;},_selectRow:function(f){if(this._isIdEqual(f,this._rootNode)&&!this._options.display.showRoot){this._head.find(".ws-browser-checkbox").closest("tr").addClass("ws-browser-selected");}else{var j=this._body.find('tr[rowkey="'+f+'"]');j.addClass("ws-browser-selected");if(!this._isIdEqual(f,this._rootNode)&&this._selected[f]===undefined){var c=this._currentRecordSet.contains(f)?this._currentRecordSet.getRecordByPrimaryKey(f):undefined;this._selected[f]=this._selectedRecords.length;this._selectedRecords.push(c);this._notifyBatchDelayed("onChangeSelection",c,true);}}var g=this._body.find(".ws-browser-table-row"),h=this._head.find(".ws-browser-checkbox").closest("tr"),d=true;for(var e=0,b=g.length-1;e<=b;e++){if(!$(g[e]).hasClass("ws-browser-selected")){d=false;break;}}if(d&&!h.hasClass("ws-browser-selected")){h.addClass("ws-browser-selected");}},_unselectRow:function(c){if(this._isIdEqual(c,this._rootNode)&&!this._options.display.showRoot){this._head.find(".ws-browser-checkbox").closest("tr").removeClass("ws-browser-selected");}else{var e=this._body.find('tr[rowkey="'+c+'"]');e.removeClass("ws-browser-selected");if(!this._isIdEqual(c,this._rootNode)&&this._selected[c]!==undefined){var b=this._currentRecordSet.contains(c)?this._currentRecordSet.getRecordByPrimaryKey(c):undefined;delete this._selectedRecords[this._selected[c]];delete this._selected[c];this._notifyBatchDelayed("onChangeSelection",b,false);}}var d=this._head.find(".ws-browser-selected");if(d.length!==0){d.removeClass("ws-browser-selected");}},_toggleRowSelection:function(b){if(this._selected[b]!==undefined){this._unselectRow(b);}else{this._selectRow(b);}},_selectActiveElement:function(e){var c=this,f=e||this.getActiveElement(),d=f.attr("rowkey");d=d==="null"?null:d;if(this._isIdEqual(d,this._rootNode)){if(e.hasClass("ws-browser-selected")){this.removeSelection();}else{this.selectAll();}}else{var b=this._currentRecordSet.getRecordByPrimaryKey(d);if(this.isHierarchyMode()){switch(this._options.selectionType){case"leaf":if(!b.get(this._hierColumnIsLeaf)){this._toggleRowSelection(d);}break;case"node":if(!!b.get(this._hierColumnIsLeaf)){this._toggleRowSelection(d);}break;case"all":default:this._toggleRowSelection(d);break;}}else{this._toggleRowSelection(d);}}this._updatePager();},getSelection:function(g){var d=[];g=g===undefined?false:g;if(Object.isEmpty(this._selected)&&g!==true){var b=this.getActiveRecord();}if(b){d.push(b);}else{for(var c in this._selected){if(this._selected.hasOwnProperty(c)){try{if(this._selectedRecords[this._selected[c]]!==undefined){d.push(this._selectedRecords[this._selected[c]]);}else{d.push(this._currentRecordSet.getRecordByPrimaryKey(c));}}catch(f){}}}}return d;},setSelection:function(f){var h=[];if(f instanceof Array){h=f;}else{if(typeof(f)==="string"||typeof(f)=="number"){h.push(f);}}if(h.length>=1){var d=[];for(var g=0,c=h.length;g<c;g++){this._selected[h[g]]=this._selectedRecords.length;try{var b=this._currentRecordSet.getRecordByPrimaryKey(h[g]);this._selectedRecords.push(b);d.push(b);}catch(j){this._selectedRecords.push(undefined);}this._body.find('tr[rowkey="'+h[g]+'"]').addClass("ws-browser-selected");}this._notifyBatchDelayed("onChangeSelection",d,true);}if(h[0]!==undefined){this.setActiveElement(this._body.find('tr[rowkey="'+h[0]+'"]'),false);}else{if(this._activeElement&&!this._options.setCursorOnLoad){this._activeElement.removeClass("ws-browser-item-over");this._hovered=undefined;}}this._updatePager();},clearSelection:function(k,h){var m,f,n=[];if(k instanceof Array){n=k;}else{if(typeof(k)==="string"||typeof(k)=="number"){n.push(k);}}if(n.length>=1){var b=[];for(var e=0,c=n.length;e<c;e++){delete this._selected[n[e]];for(var d=0,g=this._selectedRecords.length;d<g;d++){if(this._selectedRecords[d]!==undefined){m=this._selectedRecords[d].getKey();if(m==n[e]){b.push(this._selectedRecords[d]);f=d;break;}}}if(f!==undefined){this._selectedRecords.splice(f,1);}this._body.find('tr[rowkey="'+n[e]+'"]').removeClass("ws-browser-selected");}if(!h){this._notifyBatchDelayed("onChangeSelection",b,false);}}this._updatePager();},removeSelection:function(){this._selected={};this._selectedRecords=[];this._container.find(".ws-browser-selected").removeClass("ws-browser-selected");this._notifyBatchDelayed("onChangeSelection",null,false);if(this._options.markedRowOptions&&this._isRenderedFootRowOptions){this._drawRowOptionsButtons();}this._updatePager();},showSelection:function(g){var f=this.getSelection(),c=this;if(g===undefined){g=true;}if(g!==false){if(!this._minimized){this._initialRecordSet=this._initialRecordSet||this._currentRecordSet;$ws.core.setCursor(false);$ws.core.attachInstance("Source:RecordSet",$ws.core.merge(this._options.dataSource,{firstRequest:false})).addCallback(function(m){m.setColumns(c._currentRecordSet.getColumns());for(var k=0,j=f.length;k<j;k++){m.appendRecord(f[k].toObject());}$ws.core.setCursor(true);c.setData(m);c.removeSelection();}).addErrback(function(i){$ws.core.setCursor(true);$ws.core.alert(i.message,"error");});this._minimized=true;}}else{if(this._minimized){if(this._initialRecordSet instanceof $ws.proto.RecordSet){var e=[],h=this.getActiveRecord().getKey(),b=this._currentRecordSet.getRecords();for(var d=0;d<b.length;d++){e.push(b[d].getKey());}this.removeSelection();this.setData(this._initialRecordSet);this.setSelection(e);this.setActiveRow(this._body.find('tr[rowkey="'+h+'"]'));this._initialRecordSet=false;}this._minimized=false;}}},isMinimized:function(){return this._minimized;},confirmSelection:function(b){b=b||this.getSelection();var d=[];for(var c in b){if(b.hasOwnProperty(c)&&this._testSelectedRecord(b[c])){d.push(b[c]);}}if(d&&d.length>0){this._notifyBatchDelayed("onSelectionConfirm",d);}else{this._notifyBatchDelayed("onSelectionConfirm",[null]);}},selectAll:function(){this._selected=[];this._selectedRecords=[];var c=this,b=function(d){var g=d.find("tr");for(var f=0;f<g.length;++f){var e=g.eq(f).attr("rowkey");if(!c._isIdEqual(e,c._rootNode)){c._selected[e]=c._selectedRecords.length;if(c._currentRecordSet.contains(e)){c._selectedRecords.push(c._currentRecordSet.getRecordByPrimaryKey(e));}else{c._selectedRecords.push(undefined);}g.eq(f).addClass("ws-browser-selected");}}};b(this._body);this._notifyBatchDelayed("onChangeSelection",this._selectedRecords,true);if(this._options.markedRowOptions&&!this._isRenderedFootRowOptions){this._drawRowOptionsButtons(true);}this._updatePager();},getRootNode:function(){return this._rootNode;},getCurrentRootNode:function(){return this._currentRootId;},getActiveRecord:function(d){d=d||this.getActiveElement();if(!d){return false;}var b=false,c=d.attr("rowkey");if(c!==undefined&&this._currentRecordSet.contains(c)){b=this._currentRecordSet.getRecordByPrimaryKey(c);}if(this._addAtPlace&&c==this._addAtPlaceRecordId){b=this._addAtPlaceRecord;}return b;},getFolderKeyForActiveRecord:function(f){var b=this.getActiveRecord();if(b){var d;if(b.get(this._hierColumnIsLeaf)!==true||(b.get(this._hierColumnIsLeaf)===true&&!f)){d=b.get(this._hierColumnParentId);}else{this._isInsertOnFolderInTree=true;d=b.getKey();}return d;}else{var e=this.getActiveElement();if(e){var c=e.attr("rowkey");if(c==="null"){c=null;}return c;}}return this._currentRootId;},_updatePager:function(){if(this._currentRecordSet){var j=this._options.display.viewType==="hierarchy"?this._count:(this._count!==0?this._count:this._currentRecordSet.getRecordCount());if(this._options.display.showRoot){j--;}var d="";if(this._options.display.showRecordCountForEmptyData||(!this._options.display.showRecordCountForEmptyData&&this._currentRecordSet.getRecordCount()>0)){if(this._options.display.showRecordsCount){if(this._options.display.usePaging&&this._turn===""){var o=this._options.display.usePaging==="full"?(" из "+this._currentRecordSet.hasNextPage()):"",h=this._currentRecordSet.getPageNumber(),k=h*this._options.display.recordsPerPage+1;if(j===0){d="0 записей";}else{if(j===1&&h===0){d="1 запись";}else{d="Записи с "+k+" по "+(k+j-1)+o;}}}else{d+=d!==""?". Всего : ":"Всего : ";d+=j;}}}var c=0;for(var f=0,g=this._selectedRecords.length;f<g;++f){if(this._selectedRecords[f]){++c;}}if(c>0){d="Выбра"+$ws.helpers.wordCaseByNumber(c,"но","на","ны")+" "+c+" запис"+$ws.helpers.wordCaseByNumber(c,"ей","ь","и")+". "+d;}if(this._pageOptionsContainer){this._pageOptionsContainer.toggle(j>1||this._currentRecordSet.getPageNumber()!==0);}this._rootElement.find(".ws-browser-pager-text").text(d);if(!this._paging&&this._options.display.usePaging&&this._options.display.showPaging){var e=this._rootElement.find(".ws-browser-paging");if(e.length){this._rootElement.find(".ws-browser-pager-cont").addClass("ws-browser-has-paging");var b=this._currentRecordSet.hasNextPage()||(this._options.display.usePaging==="full"&&j),p=this,n=e.closest(".ws-browser-foot"),m=n.width(),l=n.height();p._paging=true;if(b===undefined){b=0;}return this._pagingReady.dependOn($ws.core.attachInstance("Control/Paging",{recordsPerPage:p._options.display.recordsPerPage,currentPage:this._currentRecordSet.getPageNumber()+1,recordsCount:b,onlyLeftSide:(p._options.display.usePaging==="parts")||(p._options.display.usePaging==="auto"&&typeof(b)=="boolean"),rightArrow:b,element:e,handlers:{onPageChange:function(i,r,q){p._pageChangeDeferred=q;p._currentRecordSet.setPage(r-1,false,p._options.display.partiallyLoad);}}})).addCallback(function(i){p._paging=i;if(p._turn!==""||!p.isEnabled()){i.setEnabled(false);}p._processPaging();i.setRecordSet(p._currentRecordSet);i.update(p._currentRecordSet.getPageNumber()+1);if(n.width()!==m||n.height()!==l){p._onResizeHandler();}return i;});}}}},_updateSizeVariables:function(){this._bodyHeight=this._data.parent().height();this._bodyRealHeight=this._body.height();var c=this._data.parent();this._verticalScrollShowed=$ws.helpers.hasVerticalScrollbar(c);this._horizontalScrollShowed=$ws.helpers.hasHorizontalScrollbar(c);var b=this._container.find("td.ws-browser-header-cell-scroll-placeholder");b[this._verticalScrollShowed?"show":"hide"]();},_setHeight:function(d){var e=this._data.parent(),c=this._getAdditionalHeight(),b=c+2;if(this._isHeightGrowable()){e.height("auto");this._container.height("auto");}else{e.height(Math.max(this._container.height()-b,0));}if(this._options.maxHeight!=Infinity){this._browserContainer.css("max-height",b>this._options.maxHeight?0:(this._options.maxHeight-b));}else{this._browserContainer.css("max-height","");}if(this._options.minHeight!==0&&b<=this._options.minHeight){this._browserContainer.css("min-height",this._options.minHeight-b);}else{this._browserContainer.css("min-height","");}this._updateSizeVariables();this._updateDataBlockSize();if(this._isHeightGrowable()){if(this._verticalScrollShowed&&this._horizontalScrollShowed){e.height(e.height()+this._scrollWidth);this._updateDataBlockSize();}e.height(e.outerHeight()+1);if(this._resizer){this._resizer.height(this._rootElement.height());}if(d){this._checkContainerHeightForRecalk();}}},_getAdditionalHeight:function(){var b=this._foot.height(),c=this._headContainer.height();return b+c;},_onResizeHandler:function(b,c){if(this!==c){this._setHeight(true);if(this._pathSelector){this._pathSelector._onResizeHandler();}}$ws.proto.DataView.superclass._onResizeHandler.apply(this,arguments);},getRecordSet:function(){return this._currentRecordSet;},setRootNode:function(e,c){var d=this,b=new $ws.proto.Deferred();this._dReady.addCallback(function(){d._rootNode=d._currentRootId=e;d._systemParams[d._hierColumnParentId]=d._rootNode;d._currentRecordSet.updateInitialParameter(d._hierColumnParentId,e+"");if(d._pathSelector!==undefined){d._pathReady.addCallback(function(){d._pathSelector.setRootNode(e,c);});}if(c){b.callback();}else{if(d._options.display.viewType==="tree"&&d._turn===""){b.dependOn(d.reload());}else{d._expanded={};d._expanded[e]=true;d._systemParams[d._hierColumnParentId]=e;b.dependOn(d._currentRecordSet.loadNode(e,true,0,!d._options.display.partiallyLoad||d._systemParams["Разворот"]==="С разворотом"));}}});return b;},setRootName:function(b){this._options.display.rootName=b;if(this._pathSelector&&this._pathSelector instanceof Object){this._pathSelector.setRootName(b);}if(this._rootName){this._rootName.text(b);}},setSelectionMode:function(b){this._selectMode=!!b;this._options.display.showSelectionCheckbox=!!b;},getSelectionMode:function(){return this._selectMode;},_rebuildActions:function(){this._initActionsFlags();var b=this;this._toolbarReady.addCallback(function(c){c.getMenuReady().addCallback(function(k){if(!b._actions.addItem){c.deleteButton("addItem");}if(!b._actions.addFolder){c.deleteButton("addFolder");}var j=b._prepareButtonsList(b._getToolbarButtons());for(var g=0,d=j.length;g<d;++g){if(!c.hasButton(j[g].name)){c.insertButton(j[g],"menu");}}var f=b._getMenuButtons();for(g=0,d=f.length;g<d;++g){h=f[g];if(!b._actions[h[2]]&&k.hasItem(h[2])){k.removeItem(h[2]);}}var e="menu";for(g=f.length-1;g>=0;--g){var h=f[g];if(k.hasItem(h[2])){e=h[2];}else{if(b._actions[h[2]]&&!k.hasItem(f[2])){k.insertItem(b._prepareMenuItem(h),e);}}}return k;});return c;});},setReadOnly:function(b){if(this._options.display.readOnly!=!!b){this._options.display.readOnly=!!b;this._rebuildActions();if(this._options.display.rowOptions){this._initRowOptionsDefaults();}if(this._addAtPlaceLinkRow){this._addAtPlaceLinkRow.toggle(!b);}}},setAllowAdd:function(b){if(this._options.allowAdd!=b){this._options.allowAdd=b;this._rebuildActions();}},setAllowEdit:function(b){if(this._options.allowEdit!=b){this._options.allowEdit=b;this._rebuildActions();}},setAllowDelete:function(b){if(this._options.allowDelete!=b){this._options.allowDelete=b;this._rebuildActions();}},print:function(c){var b=this._head.html();$ws.core.attachInstance("SBIS3.CORE.HTMLView",{string:'<table class="ws-browser" cellspacing="0"><colgroup>'+this._data.find("colgroup").html()+"</colgroup><thead>"+b.substring(0,b.length-20)+"</tr></thead><tbody>"+this._body.html()+"</tbody></table>",element:$("<div></div>").appendTo($(document.body))}).addCallback(function(d){d.getReadyDeferred().addCallback(function(){d.hideIframeContainer();var j=$(d.getIframeDocument()),h=j.find("table"),f=$(d.getIframe());if($.browser.opera){f.css("min-height",j[0].body.scrollHeight+"px");}f.width($.browser.opera?"100%":$ws._const.Browser.printFrameWidth);h.width($.browser.opera?"100%":$ws._const.Browser.printFrameWidth);var i=j.find("col"),g=h.width(),e=0;i.each(function(){e+=parseInt($(this).attr("width"),10);});i.each(function(){var k=$(this);k.attr("width",parseInt(k.attr("width"),10)+Math.floor((g-e)/i.length));});d.addStyle($ws._const.wsRoot+"css/print/browser.css").addCallback(function(){if(typeof(c)==="string"){d.addStyle(c).addCallback(function(){d.print();});}else{d.print();}});});});},getToolbar:function(){return this._toolbarReady;},getPaging:function(){return this._pagingReady;},setHierarchyField:function(d,c){if(c!==undefined){this._options.display.titleColumn=c;}if(this._options.display.hierColumn!==d){var b=this;this._dReady.addCallback(function(){var e=b.getRecordSet();if(e===null||e.checkHierColumn(d)===false){return;}e.setHierarchyField(d);b._options.display.hierColumn=d;b._updateHierColumnParams(d);});}},setEnabled:function(b){b=!!b;if(this._options.allowChangeEnable||b===this._options.enable){$ws.proto.DataView.superclass.setEnabled.apply(this,arguments);this._rootElement.find(".ws-browser-container").toggleClass("ws-disabled",!b);if(this._toolbar){this._toolbar.setEnabled(b);}if(this._paging&&this._paging instanceof Object&&!(b&&this._turn!=="")){this._paging.setEnabled(b);}if(this._pathSelector){this._pathSelector.setEnabled(b);}}},_updateDataBlockSize:function(){},validate:function(){return true;},_redraw:function(){}});return $ws.proto.DataView;});