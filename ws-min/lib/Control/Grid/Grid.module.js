$ws.declareModule({namespace:"SBIS3.CORE",name:"Grid",imports:["SBIS3.CORE.GridAbstract"]},function(e){$ws.proto.Grid=e.extend({$protected:{_divTable:null,_options:{isEmpty:false,rows:[],columns:[],display:[],cells:{},firstRender:true,minSizes:{}},_postFilterOptions:{dom:undefined},_haveBorders:false},$constructor:function(){this._checkInit();this._normalizeOptions();},_needResizer:function(){return !this._options.isEmpty;},_checkInit:function(){if(!this._isCorrectContainer()){$ws.single.ioc.resolve("ILogger").error("$ws.proto.Grid","Внимание! Неправильная вёрстка у старой сетки (id="+this.getId()+"). Или контейнера нет, или контейнер свёрстан для новой сетки (проверьте конвертор).");}},_normalizeOptions:function d(){var o,n,p,g,k=this._options||{},q=k.columns||[],m,u,l,t=k.rows||[],s=k.minSizes||{},r=s.columns||[],h=s.rows||[];for(o=0,p=q.length;o<p;o++){m=q[o]||[];if(m==="auto"){q[o]=[0,0];}else{for(n=0,g=m.length;n<g;n++){l=m[n];m[n]=parseFloat(l);if(isNaN(m[n])){m[n]=l;}}}}for(o=0,p=t.length;o<p;o++){u=t[o]||[];if(u==="auto"){t[o]=[0,0];}else{for(n=0,g=u.length;n<g;n++){l=u[n];u[n]=parseFloat(l);if(isNaN(u[n])){u[n]=l;}}}}for(o=0,p=r.length;o<p;o++){r[o]=parseFloat(r[o]);}for(o=0,p=h.length;o<p;o++){h[o]=parseFloat(h[o]);}},_templateInnerCallback:function(){this._postFilterOptions.dom=this._container;this._haveBorders=this._container.hasClass("dt_withBorder");this._initLayout(false);this._initResizers();$ws.proto.Grid.superclass._templateInnerCallback.apply(this,arguments);},_updateResizer:function b(){if(this._divTable){var h=this._divTable.getMaxWidth();var g=this._divTable.getMaxHeight();if(h<this._options.minWidth){h=this._options.minWidth;}if(g<this._options.minHeight){g=this._options.minHeight;}this._resizer.height(g).width(h);this._divTable.reset({resetResizer:true});this._container.css("min-width",h);}},_onResizeHandler:function c(g,h){if(this._skipOnResizeHandler()){return;}var i=this._options.isEmpty,j=i||this._divTable.refresh({resetContainer:true});if(j||this._needForceOnResizeHandler()){if(!i){this._divTable.reset({resetControls:true});}if(this!==h){this._resizeChilds();}$.dtPostFilter(this._postFilterOptions);this._calcStretchPosition();if(this._haveBorders){this._correctBorders();}}},_correctBorders:function a(){$("#"+this._container.attr("id")).each(function(){var m=$(this),l=m.parents(".dt_layout.dt_withBorder"),g=false,k=false,j=l.length,h;for(h=0;h<j;h++){$(l[h]).find("> table > tbody > tr > .td_grid,> .dt_cell").each(function(){if(m.parents("#"+$(this).attr("id")).length>0){if($(l[h]).hasClass("dt_withBorder")){var i=$(this)[0].getBoundingClientRect(),n=m[0].getBoundingClientRect();if(n.left==i.left){k=true;}if(n.top==i.top){g=true;}}}});}if(g||k){m.find("> table > tbody > tr > .td_grid,> .dt_cell").filter(function(){return this.className.match("dt_grid_cell_.*_1")||this.className.match("dt_grid_cell_1_.*");}).each(function(){var i=$(this);if(i[0].className.match("dt_grid_cell_.*_1")){if(k){i.addClass("dt_noleftborder");}}if(i[0].className.match("dt_grid_cell_1_.*")){if(g){i.addClass("dt_notopborder");}}});}});},_initLayout:function f(g,h){var i=true;if(!this._options.isEmpty){if(this._divTable){i=this._divTable.refresh(h);}else{if(!g){$.doTable(this._options);this._divTable=this.getContainer().data("divTable");}}}if(i){$.dtPostFilter({dom:this._container});}},_onSizeChangedBatch:function(g){if(this._divTable){this._divTable.reset({resetControls:true});}this._updateResizer();this._initLayout(true,{resetContainer:true});if(this._divTable){if(this._divTable.reset({resetControls:true,resetDependentHeightsOnly:true})){this._updateResizer();}}return true;},_setVisibility:function(g){if(this._isCorrectContainer()){this._container.toggleClass("ws-hidden",!g);this._isVisible=g;if(g&&this._isReady){this._initLayout(true);this._updateResizer();}this._notifyOnSizeChanged(this,this);}},destroy:function(){this.getContainer().data("divTable",null);$ws.proto.Grid.superclass.destroy.apply(this,arguments);},_redraw:function(){}});return $ws.proto.Grid;});