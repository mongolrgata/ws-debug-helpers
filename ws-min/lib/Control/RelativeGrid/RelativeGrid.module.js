$ws.declareModule({namespace:"SBIS3.CORE",name:"RelativeGrid",imports:["SBIS3.CORE.GridAbstract"]},function(b){$ws.proto.RelativeGrid=b.extend({$protected:{_options:{controlList:{},display:[],minSizes:{},columns:[],rows:[]}},$constructor:function(){if(!this._hasMarkup()){if(!$ws.proto.RelativeGrid.__markupTemplate){$ws.proto.RelativeGrid.__markupTemplate=doT.template(this._createMarkup());}this._options.horizontalAlignment=this._horizontalAlignment;this._options.verticalAlignment=this._verticalAlignment;var d=this._collectGridConfig(document,this._container.attr("id"),this._options);this._container.append($ws.proto.RelativeGrid.__markupTemplate(d));for(var f in d.controlsConfig){if(d.controlsConfig.hasOwnProperty(f)){var e=document.getElementById(f);var c=document.getElementById("place"+f);c.parentNode.replaceChild(e,c);}}$ws.helpers.insertCss(this._createStyles(d));}this._container.addClass("ws-relativegrid");},_createStyles:function(c){return c.styleData;},_collectGridConfig:function(i,c,m){var g={};var h=i.getElementById(c);var n=m.controlList;var j=h.getAttribute("junctionToNewGrid");var f="";for(var l in n){if(n.hasOwnProperty(l)){var k=n[l];for(var d=0;d<k.length;d++){g[k[d]]=this._getControlCfg(i.getElementById(k[d]));f+=this._createControlStyle(g[k[d]],k[d]);}}}var e={id:c,proto:$ws.proto.RelativeGrid.prototype,firstNewGrid:(j&&j=="true")||false,controlsConfig:g,parentId:h.getAttribute("parentId"),inTab:(h.parentNode.getAttribute("VerticalAlignment")=="Stretch")&&(h.parentNode.getAttribute("type")=="Control/Area:TabTemplatedArea")};e=$ws.core.merge(e,m);e=$ws.core.merge(e,this._getControlCfg(h));e.styleData=this._createGridStyle(e)+f;return e;},_isIE7:function(){return(jQuery&&jQuery.browser&&jQuery.browser.msie&&parseFloat(jQuery.browser.version)<8)?true:false;},_isPercent:function(c){if(typeof c==="string"){if(/.*%$/.test(c)){return true;}}return false;},_getControlCfg:function(e){var d={};if(e){var f=e.getAttribute("alignMargin");if(f){d.margins=f.split(",");}d.horizontalAlignment=e.getAttribute("HorizontalAlignment");if(!d.horizontalAlignment){delete d.horizontalAlignment;}d.verticalAlignment=e.getAttribute("VerticalAlignment");if(!d.verticalAlignment){delete d.verticalAlignment;}d.autoWidth=e.getAttribute("autoWidth")=="true";d.autoHeight=e.getAttribute("autoHeight")=="true";d.width=e.getAttribute("width");d.height=e.getAttribute("height");var c=e.getAttribute("class")||"";if(c.match(/.*ws-labeled-control.*ws-labeled-control-autosize.*/g)){if(e.getAttribute("width").toLowerCase()=="auto"){d.autoWidth=true;}if(e.getAttribute("height").toLowerCase()=="auto"){d.autoHeight=true;}}}return d;},_createControlStyle:function(c,h){var d=this;function e(j){var i=[];i.push("position:relative !important");if(j.autoWidth&&j.horizontalAlignment!="Stretch"){i.push("display:table");}else{i.push("display:block");}switch(j.horizontalAlignment){case"Center":i.push("margin-right:auto;margin-left:auto");break;case"Right":i.push("margin-left:auto");break;case"Left":i.push("margin-right:auto");break;}if(!j.autoHeight){i.push("height:"+j.height+"px");}else{i.push("height:auto");}if(!j.autoWidth){i.push("width:"+j.width+"px");}else{i.push("width:auto");}return i;}function g(n){var k=[],m=n.margins;k.push("position:absolute");var o=0,j=0,l=(!d._isPercent(n.width)&&parseInt(n.width,10))||n.width,i=(!d._isPercent(n.height)&&parseInt(n.height,10))||n.height;if(typeof l=="number"){o=l/2+"px";l+="px";}else{if(n.minWidth){o=n.minWidth/2+"px";}}if(typeof i=="number"){j=i/2+"px";i+="px";}else{if(n.minHeight){j=n.minHeight/2+"px";}}switch(n.horizontalAlignment){case"Left":k.push("left:"+m[3]+"px");k.push("width:"+l);break;case"Center":k.push("left:50%");k.push("margin-left:-"+o);k.push("width:"+l);break;case"Right":k.push("right:"+m[1]+"px");k.push("width:"+l);break;case"Stretch":k.push("right:"+m[1]+"px");k.push("left:"+m[3]+"px");k.push("width: auto");break;}switch(n.verticalAlignment){case"Top":k.push("top:"+m[0]+"px");k.push("height:"+i);break;case"Center":k.push("top:50%");k.push("margin-top:-"+j);k.push("height:"+i);break;case"Bottom":k.push("bottom:"+m[2]+"px");k.push("height:"+i);break;case"Stretch":k.push("bottom:"+m[2]+"px;top:"+m[0]+"px;height:auto");break;}return k;}var f=[];if(c.autoHeight||c.autoWidth){f=e(c);}else{f=g(c);}return"#"+h+"{"+f.join(";")+"}";},_genDisplay:function(d){var g=[];var h=[];for(var f=d.length-1;f>=0;f--){g[f]=[];h[f]=[];for(var e=d[f].length-1;e>=0;e--){if(d[f][e]==d[f][e+1]){g[f][e]=g[f][e+1]+1;g[f][e+1]=0;}else{g[f][e]=1;}if(d[f+1]&&d[f][e]==d[f+1][e]){h[f][e]=h[f+1][e]+1;h[f+1][e]=0;}else{h[f][e]=1;}}}return{r:h,c:g};},_createGridStyle:function(f){var d="auto",m="auto",k=false;for(var g=0;g<f.rows.length;g++){if(this._isPercent(f.rows[g])){k=true;}}if(f.horizontalAlignment=="Stretch"){d="100%";}if(k&&f.verticalAlignment=="Stretch"){m="100%";}else{if(!f.autoHeight){m=f.height+"px";}}var c="#"+f.id+" > table {width:"+d+(this._isIE7()?"":";height:"+m)+"}",e=(f.rows.length==1&&f.columns.length==1),l=0,j=0;if(e&&(f.verticalAlignment!="Stretch"||(f.autoWidth||f.autoHeight))){c+="#"+f.id+"{min-height: "+f.minSizes.rows[0]+"px;min-width: "+f.minSizes.columns[0]+"px;}";j=parseInt(this._isPercent(f.rows[0])?f.minSizes.rows[0]:f.rows[0],10);l=parseInt(this._isPercent(f.columns[0])?f.minSizes.columns[0]:f.columns[0],10);if(f.autoWidth&&f.autoHeight&&f.horizontalAlignment!="Stretch"){c+="#"+f.id+"{height: "+j+"px}";}}if(f.firstNewGrid||!f.parentId||f.inTab){var h=$ws.core.merge({},f);if(h.width===""){h.width="auto";}if(h.height===""){h.height="auto";}if(f.firstNewGrid){h.autoWidth=h.autoHeight=false;if(l!==0&&e&&h.horizontalAlignment!="Stretch"){h.width="auto";}if(j!==0&&e&&h.verticalAlignment!="Stretch"){h.height="auto";}h.minHeight=j;h.minWidth=l;}c+=this._createControlStyle(h,h.id);}return c;},_createMarkup:function(e){var f=this._createMarkupSingle();var c=this._isIE7()?this._createMarkupCommonIE7():this._createMarkupCommon();var d="         {{ var trans = {'Top' : 'top', 'Center' : 'middle', 'Bottom' : 'bottom', 'Stretch' : 'middle'}; }}         {{? (it.rows.length == 1 && it.columns.length == 1)}}"+f+"{{??}}"+c+"{{?}}         ";return this._extendMarkup(e,d);},_createMarkupSingle:function(){var c='{{ var controls = it.controlList[it.display[0][0]]; }}{{? controls && controls.length }}{{ for(var ctr = 0; ctr < controls.length; ctr++) { }}{{ var cfg = it.controlsConfig[controls[ctr]]; }}{{? ((cfg.autoWidth || cfg.autoHeight))}}<div class="ws-relativegrid-relativewrapperouter" style="width:100%;"><div class="ws-relativegrid-relativewrapperinner" style="vertical-align: {{=trans[cfg.verticalAlignment]}};padding:{{=cfg.margins.join(\'px \')+\'px\'}}"><div id="place{{=controls[ctr]}}">&nbsp;</div></div></div>{{??}}<div id="place{{=controls[ctr]}}">&nbsp;</div>{{?}}{{ } }}{{?}}';return c;},_createMarkupCommon:function(){var c='{{var displays = it.proto._genDisplay(it.display);}}<table><colgroup>{{ for(var i=0;i<it.columns.length;i++){ }}<col width="{{=(it.proto._isPercent(it.columns[i]) && it.autoWidth && it.horizontalAlignment != \'Stretch\' ) ? it.minSizes.columns[i] : it.columns[i]}}"/>{{ } }}</colgroup><tbody>{{ var cellNum = 0; }}{{ for(var r = 0; r < it.display.length; r++) { }}<tr {{? (it.proto._isPercent(it.rows[r])) }}class="ws-relativegrid-firefox_100_height ws-relativegrid-IEFix" {{?}}{{? !it.proto._isPercent(it.rows[r])}}height="{{=it.autoHeight ? it.minSizes.rows[r] : it.rows[r]}}"{{?}}>{{ for(var c = 0; c < it.display[r].length; c++) { }}{{ if (!(displays.c[r][c] && displays.r[r][c])) continue; }}{{ cellNum++; }}{{ var cell = it.display[r][c]; }}{{ var controls = it.controlList[cell]; }}{{ var verticalAlignment = \'top\'; }}{{ var hasStaticControls = false; }}{{ var margins = []; }}{{? controls && controls.length }}{{ for(var ctr = 0; ctr < controls.length; ctr++) { }}{{ var cfg = it.controlsConfig[controls[ctr]]; }}{{? ( !(cfg.autoHeight || cfg.autoWidth) )}}{{ hasStaticControls = true; }}{{??}}{{ verticalAlignment = cfg.verticalAlignment; }}{{ margins = cfg.margins; }}{{?}}{{ } }}{{?}}<td {{? (displays.r[r][c] != 1) }}rowspan="{{=displays.r[r][c]}}" {{?}}{{? (displays.c[r][c] != 1) }}colspan="{{=displays.c[r][c]}}" {{?}}class="ws-relativegrid-cell" id="{{=\'cell_\' + cellNum + \'_\' + it.id}}" style="vertical-align: {{=trans[verticalAlignment]}};{{? (!hasStaticControls) }} padding:{{=margins.join(\'px \')||0}}px; {{?}}">{{? hasStaticControls || !controls || !controls.length}}<div class="ws-relativegrid-cellwrapper ws-relativegrid-firefox_100_height" style="height:100%;{{? it.minSizes.rows[r]}}min-height:{{=it.minSizes.rows[r]}}px;{{?}}{{? it.minSizes.columns[c]}}min-width:{{=it.minSizes.columns[c]}}px;{{?}}">{{?}}{{? controls && controls.length }}{{ for(var ctr = 0; ctr < controls.length; ctr++) { }}{{ var cfg = it.controlsConfig[controls[ctr]]; }}{{? ((cfg.autoWidth || cfg.autoHeight) && hasStaticControls && verticalAlignment != \'Top\')}}<div class="ws-relativegrid-relativewrapperouter" style="width:100%;"><div class="ws-relativegrid-relativewrapperinner" style="vertical-align: {{=trans[cfg.verticalAlignment]}};padding:{{=cfg.margins.join(\'px \')+\'px\'}}"><div id="place{{=controls[ctr]}}">&nbsp;</div></div></div>{{??}}{{? ((cfg.autoWidth || cfg.autoHeight) && hasStaticControls) }}<div style="padding:{{=cfg.margins.join(\'px \')+\'px\'}}"><div id="place{{=controls[ctr]}}">&nbsp;</div></div>{{??}}<div id="place{{=controls[ctr]}}">&nbsp;</div>{{?}}{{?}}{{ } }}{{?}}{{? hasStaticControls || !controls || !controls.length}}</div>{{?}}</td>{{ } }}</tr>{{ } }}</tbody></table>';return c;},_createMarkupCommonIE7:function(){var c='{{var displays = it.proto._genDisplay(it.display);}}{{ var hasStarSizedRow = false;}}{{? (it.verticalAlignment == \'Stretch\') }}{{ for (var i=0; i<it.rows.length; i++){ }}{{ hasStarSizedRow |= it.proto._isPercent(it.rows[i]); }}{{ } }}{{?}}<table cellspacing="0" cellpaddding="0" {{? (it.verticalAlignment == \'Stretch\' && hasStarSizedRow) }}class="ws-relativegrid-ie100height" {{?}}style="table-layout: fixed;zoom:1"><colgroup>{{ for(var i=0;i<it.columns.length;i++){ }}<col width="{{=(it.proto._isPercent(it.columns[i]) && it.autoWidth && it.horizontalAlignment != \'Stretch\') ? it.minSizes.columns[i] : it.columns[i]}}"></col>{{ } }}</colgroup><tbody>{{ var cellNum = 0; }}{{ for(var r = 0; r < it.display.length; r++) { }}<tr {{? (it.proto._isPercent(it.rows[r])) }}class="ws-relativegrid-starsizedrowheight" {{?}}{{? !it.proto._isPercent(it.rows[r]) }}height="{{=it.autoHeight ? it.minSizes.rows[r] : it.rows[r] }}" {{?}}>{{ for(var c = 0; c < it.display[r].length; c++) { }}{{ if (!(displays.c[r][c] && displays.r[r][c])) continue; }}{{ cellNum++; }}{{ var cell = it.display[r][c]; }}{{ var controls = it.controlList[cell]; }}{{ var verticalAlignment = \'top\'; }}{{ var hasStaticControls = false; }}{{? controls && controls.length }}{{ for(var ctr = 0; ctr < controls.length; ctr++) { }}{{ var cfg = it.controlsConfig[controls[ctr]]; }}{{ if (! (cfg.autoHeight || cfg.autoWidth)) hasStaticControls = true; }}{{ } }}{{?}}<td {{? (displays.r[r][c] != 1) }}rowspan="{{=displays.r[r][c]}}" {{?}}{{? (displays.c[r][c] != 1) }}colspan="{{=displays.c[r][c]}}" {{?}}class="ws-relativegrid-cell" id="{{=\'cell_\' + cellNum + \'_\' + it.id}}" {{? !it.proto._isPercent(it.rows[r])}}style="height: {{=it.minSizes.rows[r]}}px"{{?}}>{{? hasStaticControls || !controls || !controls.length}}<div class="ws-relativegrid-cellwrapper ws-relativegrid-firefox_100_height" style="height:100%;{{? it.minSizes.rows[r]}}min-height:{{=it.minSizes.rows[r]}}px;{{?}}{{? it.minSizes.columns[c]}}min-width:{{=it.minSizes.columns[c]}}px;{{?}}">{{?}}{{? controls && controls.length }}{{ for(var ctr = 0; ctr < controls.length; ctr++) { }}{{ var cfg = it.controlsConfig[controls[ctr]]; }}{{ var nodeplace = \'<div id="place{{=controls[ctr]}}">&nbsp;</div>\'; }}{{? ((cfg.autoWidth || cfg.autoHeight) && cfg.horizontalAlignment != \'Stretch\')}}{{ nodeplace = \'<table id="ws-relativegrid-wrapper_\' + ctr + \'" cellspacing="0" cellpadding="0"><tr><td>\' + nodeplace + \'</td></tr></table>\';}}{{?}}{{? ((cfg.autoWidth || cfg.autoHeight))}}<div class="ws-relativegrid-relativewrapperouter" style="width:100%;"><div class="ws-relativegrid-relativewrapperinner" style="vertical-align: {{=trans[cfg.verticalAlignment]}};padding:{{=cfg.margins.join(\'px \')+\'px\'}}">{{=nodeplace}}</div></div>{{??}}{{=nodeplace}}{{?}}{{ } }}{{?}}{{? hasStaticControls || !controls || !controls.length}}</div>{{?}}</td>{{ } }}</tr>{{ } }}</tbody></table>';return c;},_updateResizer:function(){},_onResizeHandler:function a(d,e){if(this._skipOnResizeHandler()){return;}if(this!==e){this._resizeChilds();}if($.browser.msie&&parseFloat(jQuery.browser.version)>=8){var c=$(".ws-relativegrid-IEFix > td",this._container);c.each(function(){$(this).css("height","auto");});c.each(function(){var f=$(this);$(this).css("height",f.height()+"px");});}},_redraw:function(){}});return $ws.proto.RelativeGrid;});