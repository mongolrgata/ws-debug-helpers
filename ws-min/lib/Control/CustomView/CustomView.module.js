$ws.declareModule({namespace:"SBIS3.CORE",name:"CustomView",imports:["SBIS3.CORE.DataViewAbstract"]},function(a){$ws.proto.CustomView=a.extend({$protected:{_options:{display:{displayValue:""}}},_createContainer:function(){var e="",d="",c="";if(this._options.display.showRecordsCount||this._options.display.showPaging){if(this._options.display.showPaging){d='<div class="ws-browser-paging"></div>';}if(this._options.display.showRecordsCount){var b="";if(this._options.display.usePaging&&this._options.display.usePageSizeSelect){b='<span class="ws-browser-page-selector ws-browser-pager-select-text">&nbsp;(по&nbsp;</span><div  class="ws-browser-page-selector ws-browser-pager-select"></div><span class="ws-browser-page-selector ws-browser-pager-select-text">&nbsp;на странице)</span>';}c='<div class="ws-browser-pager ws-hidden"><span class="ws-browser-pager-text">&nbsp;</span>'+b+"</div>";}e='<div class="ws-browser-footer"><table class="ws-browser-foot" cellspacing="0"><tfoot><tr><td class="ws-browser-pager-cont">'+c+d+"</td></tr></tfoot></table></div>";}this._container.append('<div class="ws-browser-ajax-loader ws-hidden"><div class="ws-loading-indicator-outer"><div class="ws-loading-indicator-block"><div class="ws-loading-indicator ws-browser-loading-indicator">'+($ws._const.theme==="wi_scheme"?"":"Загрузка")+"</div></div></div></div>").append(this._rootElement=$('<div class="ws-browser-data-container ws-listview"><div><div class="ws-browser-container-wrapper"><div class="ws-browser-container" tabindex="-1"><div class="ws-browser"/><div class="ws-browser-empty ws-hidden">'+this._options.display.emptyHtml+"</div></div></div>"+e+"</div>"));$ws.proto.CustomView.superclass._createContainer.apply(this,arguments);this._body=this._rootElement.find(".ws-browser").height(this._isHeightGrowable()?"Auto":"100%");this._emptyDataBlock.addClass("listView");},_drawBodyCycle:function(){var d,g=0,c=$(document.createElement("div")),b=this._data.parent(),f,e;this._selectedRecords=[];this._currentRecordSet.rewind();while((d=this._currentRecordSet.next())!==false){f=this._renderElement(d);e=d.getKey();if(f){f.attr("rowkey",e);f.addClass("ws-visible");if(this._selected&&this._selected[e]!==undefined){f.addClass("ws-browser-selected");this._selectedRecords.push(d);}c.append(f);++g;}}this._count=g;this._body.remove();this._body=c.addClass("ws-browser").height(this._isHeightGrowable()?"Auto":"100%");this._data=this._body;b.append(c);this._notifyOnSizeChanged(this,this);},_renderElement:function(b){var c=this._options.display.displayValue.apply(this,[b]);if(c instanceof Object&&"jquery" in c){if(this._options.mode==="oneClickMode"){c.addClass("ws-browser-edit-link");}return c;}else{$ws.single.ioc.resolve("ILogger").log("ListView","element rendering function returned not a jQuery element");}return false;},_setWidth:function(){var b=this._options.display.width;this._container.width(b);},_initEvents:function(){var b=this,c;function e(i){var f=$(this),j=f.closest("[rowkey]"),h=j.attr("rowkey"),g=h&&b._currentRecordSet.contains(h)?b._currentRecordSet.getRecordByPrimaryKey(h):undefined;b._onClickHandler(i);if(b.isEnabled()){h=(h==="null"||!h)?null:h;if(i.type==="dblclick"){b._dblClickHandler.apply(b,[j,g]);}else{b._oneClickHandler.apply(b,[j,g]);}}return b._options.editMode=="thisWindow";}var d=$("[rowkey]",b._body.parent()[0]).live("mousedown",function(){if(b.isEnabled()){b.setActiveElement($(this),false,true);}});d.wsFixedLiveClick2(e,e);},_mapColumns:function(){},_refreshHead:function(){},_redraw:function(){}});return $ws.proto.CustomView;});