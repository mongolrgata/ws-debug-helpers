$ws.declareModule({namespace:"SBIS3.CORE",name:"SimpleDialogAbstract",imports:["SBIS3.CORE.AreaAbstract","SBIS3.CORE.ModalOverlay"]},function(b,a){$ws.proto.SimpleDialogAbstract=b.extend({$protected:{_options:{message:"",detail:"",buttons:[],html:""},_keysWeHandle:[$ws._const.key.esc,$ws._const.key.tab,$ws._const.key.enter],_isModal:true,_zIndex:0},$constructor:function(){var c=this;this._zIndex=$ws.single.WindowManager.acquireZIndex(true);this._publish("onBeforeClose","onAfterClose");this._container.addClass("ws-smp-dlg").append(this._inputControl=this._createControl());this._inputControl.addClass("shadow");$("body").append(this._container);this.show();if(this._options.html!==""){this.setHtml();}else{this.setMessage();}this._addButtons().addCallback(function(){c.setActive(true);});this._inputControl.bind("click",function(d){if($ws.helpers.getTextSelection()){d.stopImmediatePropagation();}});},init:function(){$ws.proto.SimpleDialogAbstract.superclass.init.apply(this,arguments);if($ws.single.WindowManager.getLastActiveWindow()!==this){$ws.single.WindowManager.disableLastActiveControl();this._notify("onActivate");}},setMessage:function(c,d){this._options.message=c?$ws.helpers.escapeTagsFromStr(c,["script"]):this._options.message;this._options.detail=d?$ws.helpers.escapeTagsFromStr(d,["script"]):this._options.detail;this.clear();this._inputControl.find("h2").show().html($ws.helpers.escapeTagsFromStr(this._options.message,["script"]));this._inputControl.find("p").show().html($ws.helpers.escapeTagsFromStr(this._options.detail,["script"]));this._resizeBox();this._reviewWhiteSpace();},setHtml:function(c){this._options.hmtl=c?c:this._options.html;this.clear();this._inputControl.find(".ws-smp-dlg-html").html($ws.helpers.escapeTagsFromStr(this._options.hmtl,["script"])).show();this._resizeBox();},clear:function(){this._inputControl.find(".ws-smp-dlg-html").empty().hide();this._inputControl.find("h2").empty().hide();this._inputControl.find("p").empty().hide();},show:function(){$ws.single.WindowManager.setVisible(this._zIndex);this._container.css("z-index",this._zIndex);a.adjust();SBIS3.CORE.SimpleDialogAbstract.superclass.show.apply(this,arguments);},close:function(){this._notify("onBeforeClose");this._notify("onAfterClose");this.destroy();a.adjust();},destroy:function(){$ws.single.WindowManager.releaseZIndex(this._zIndex);SBIS3.CORE.SimpleDialogAbstract.superclass.destroy.apply(this,arguments);},getZIndex:function(){return this._zIndex;},_reviewWhiteSpace:function(){var m=false,d=this._inputControl,e=d.find("p"),h=e.width();e.css("float","left");if(d.width()<e.outerWidth()){var k=e.html(),c=e.width()/h,f=[],l,j=parseInt(k.length/c,10);for(var g=0;g<c;g++){l=j*(g+1);f[0]=k.substring(0,l);f[1]=k.substr(l+1);k=f.join("<br/>");}e.html(k);m=true;}e.css("float","none");if(m){this._resizeBox();}},_resizeBox:function(){var i=this._inputControl.addClass("ws-smp-dlg-wrapper-in-resize"),d=i.get(0).scrollWidth,f=i.get(0).scrollHeight,e=d*f,h=Math.sqrt(e/0.75),g=$(window),c;this._container.width(h);if(d==i.get(0).scrollWidth){this._container.width(h=d);}c=i.outerHeight();this._container.height(c).css({left:(g.width()-h)/2,top:(g.height()<c?0:(g.height()-c)/2)+g.scrollTop()});i.removeClass("ws-smp-dlg-wrapper-in-resize");},_createControl:function(){return $(["<div class='ws-smp-dlg-wrapper'>","<div class='ws-smp-dlg-brd ws-smp-dlg-top'></div>","<h2 class='ws-smp-header'></h2>","<p class='ws-smp-message'></p>","<div class='ws-smp-dlg-html'></div>","<div class='ws-smp-dlg-btns'>","<div class='ws-smp-dlg-fiber ws-smp-dlg-fiber-left'></div>","<div class='ws-smp-dlg-fiber ws-smp-dlg-fiber-right'></div>","</div>","</div>"].join(""));},_addButtons:function(){var e=this,f=this._options.buttons,h=this._inputControl.find(".ws-smp-dlg-btns"),d=new $ws.proto.ParallelDeferred();if(f.length){h.show();for(var g=0,c=f.length;g<c;g++){h.append(f[g].element=$("<span class='ws-smp-dlg-button' sbisname='"+f[g].name+"'></span>"));if(f[g].width.indexOf("px")!==-1){f[g].element.width(parseInt(f[g].width,10));}f[g].parent=e;d.push($ws.core.attachInstance("Control/Button",f[g]));}}else{h.hide();}return d.done().getResult();},_keyboardHover:function(c){if(c.which in this._keysWeHandle){if(c.which==$ws._const.key.esc){this.close();return false;}return $ws.proto.SimpleDialogAbstract.superclass._keyboardHover.apply(this,arguments);}return true;}});return $ws.proto.SimpleDialogAbstract;});