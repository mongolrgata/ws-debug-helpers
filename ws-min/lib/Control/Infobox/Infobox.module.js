$ws.declareModule({namespace:"SBIS3.CORE",name:"Infobox",imports:[]},function(){var b=185,d=1/2,e=300,a=8,c=4;$ws.single.Infobox=new ($ws.proto.Abstract.extend({$protected:{_box:undefined,_content:undefined,_hideTimer:undefined,_showTimer:undefined,_checkTimer:undefined,_currentTarget:null,_closeBtn:null,_message:"",_width:"auto"},$constructor:function(){this._publish("onShow","onHide","onChangeTarget");},_build:function(){var f=this;(this._box=$('<div class="ws-info-box"><div class="ws-info-box-balloon"></div></div>')).append(this._closeBtn=$('<a class="ws-info-box-close-button" href="javascript:void(0)">Ã—</a>'));this._box.append(this._content=$("<div></div>",{"class":"ws-infobox-content"})).bind("mouseenter",function(){if(f._hideTimer){clearTimeout(f._hideTimer);}}).bind("mouseleave",this.hide.bind(this));this._closeBtn.click(function(g){f.hide(0);g.stopPropagation();return false;});$("body").append(this._box);},_redraw:function(){return true;},isCurrentTarget:function(f){if(this._currentTarget&&f){return this._currentTarget==(f.get?f.get(0):f);}else{return false;}},getCurrentTarget:function(){return this._currentTarget;},setText:function(f){this._message=""+f;if(this._content){this._content.empty().html($ws.helpers.escapeTagsFromStr(this._message,["script"]).replace(/\n/g,"<br>"));}this._resizeBox();},_clearShowTimer:function(){if(this._showTimer){clearTimeout(this._showTimer);this._showTimer=undefined;}},_clearHideTimer:function(){if(this._hideTimer){clearTimeout(this._hideTimer);this._hideTimer=undefined;}},_clearCheckTimer:function(){if(this._checkTimer){clearInterval(this._checkTimer);this._checkTimer=undefined;}},_clearTimers:function(){this._clearShowTimer();this._clearHideTimer();},hasTarget:function(){return !!this._currentTarget;},_getDirection:function(j,i,f,k,l){var m=c+a,n=f.height+m,g,h;g={vertical:{"1":function(){return j.top+i.height+m;},"-1":function(){return j.top-n;}},horizontal:{"1":function(){return j.left;},"-1":function(){return j.left+i.width-f.width;}}};h={vertical:j.top-l.top>n?-1:1,horizontal:j.left+i.width/2<k.width/2?1:-1};return{direction:h,offset:{left:g.horizontal[h.horizontal](),top:g.vertical[h.vertical]()}};},show:function(k,p,g,l,m,j){if(!k||!p){return;}this._message=p;this._width=g==undefined?"auto":g;if(!this._box){this._build();}this._clearShowTimer();var h=(l===undefined||typeof(l)!=="number")?200:l,o=this,f=$(k),n=function(){return f.closest("html").length==1&&f.closest(".ws-hidden").length===0;},i=function(){o._clearHideTimer();if(!n()){return;}o._notify("onChangeTarget",o._currentTarget,f.get(0));o._currentTarget=f.get(0);o.setText(o._message);o._box.stop().css("opacity",1).show();o._notify("onShow",f);o._clearCheckTimer();o._checkTimer=setInterval(function(){if(!n()){o.hide(0);}},126);if(m){o.hide(m);}};if(this.isCurrentTarget(k)){h=0;m=0;}if(h){this._showTimer=setTimeout(function(){if(typeof j=="function"){if(j()){i();}}else{i();}},h);}else{i();}},_resizeBox:function(){var h=$(this._currentTarget),m=h.offset(),i=$ws._const.$win.width(),f=$ws._const.$win.height(),o=h.width(),g=h.height(),j=this._width,l,n,k;this._box.width(j);l=this._box.outerWidth();if(j=="auto"){l=Math.max(b,Math.min(l,i*d));this._box.width(l);}n=this._box.outerHeight();k=this._getDirection(m,{width:o,height:g},{width:l,height:n},{width:i,height:f},{left:$ws._const.$win.scrollLeft(),top:$ws._const.$win.scrollTop()});k.offset["z-index"]=parseInt(h.parents("body > *").css("z-index"),10)+1;this._box.toggleClass("ws-infobox-direction-top",k.direction.vertical==1).toggleClass("ws-infobox-direction-bottom",k.direction.vertical==-1).toggleClass("ws-infobox-direction-left",k.direction.horizontal==1).toggleClass("ws-infobox-direction-right",k.direction.horizontal==-1).css(k.offset);},_hide:function(){this._clearCheckTimer();this._box.stop().css("opacity",1).fadeOut("fast",function(){this._notify("onChangeTarget",this._currentTarget,null);this._currentTarget=null;this._notify("onHide");}.bind(this));},hide:function(g){this._clearTimers();if(this._box){if(g===0){this._hide();}else{var f=this;this._hideTimer=setTimeout(function(){f._hide();},((g===undefined||typeof(g)!=="number")?e:g));}}}}));return $ws.single.Infobox;});