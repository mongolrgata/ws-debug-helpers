$ws.declareModule({namespace:"SBIS3.CORE",name:"FieldAbstract",imports:["SBIS3.CORE.Control"]},function(a){$ws.proto.FieldAbstract=a.DataBoundControl.extend({$protected:{_curval:"",_inputControl:null,_pasteProcessing:0,_changed:false,_options:{width:"120px","float":"none",margin:"",name:"",readonly:false,maxlength:null,maxLines:null,cssClass:"ws-field-abstract"}},$constructor:function(){var b=this;this._initConfig();if(!this._hasMarkup()){var c=doT.template(this._createMarkup());this._container.html(c(this._options));}this._bindInternals();b._publish("onActivated");if(b._options.name){b._inputControl.attr("id","fld-"+b._options.name);}b.setEnabled(b._options.enable);if(b._inputControl&&b._inputControl!==undefined){b._inputControl.bind("keyup change blur",function(d){if(b.isEnabled()){if(!b._pasteProcessing){b._onValueChangeHandler();}if(d.keyCode==13){b._notify("onActivated");}}});}this.subscribe("onChange",function(){b._changed=true;});},_initConfig:function(){},_createMarkup:function(b){return this._extendMarkup(b,"<div class='ws-field'><innerTpl></innerTpl></div>");},_bindInternals:function(){},_getDefaultValue:function(){if(this._options.value!==""&&(typeof this._options.value in {string:0,"function":0})){return(typeof this._options.value==="function"?this._options.value():this._options.value);}},_onContextValueReceived:function(b){if(b!==undefined){this._setValueInternal(b);if(this.isMarked()){this.validate();}this._notifyOnValueChange(this._notFormatedVal());}},_onValueChangeHandler:function(){this._curval=this._curValue();var d=this._notFormatedVal(),c=this.getValue(),b;if(d&&d.equals){b=d.equals(c);}else{b=(d==c);}if(!b){this._updateSelfContextValue(d);this._notify("onChange",d);this._notifyOnValueChange(d);this.clearMark();}},setEnabled:function(b){if(this._options.allowChangeEnable||b===this._options.enable){this._setDisableAttr(b);$ws.proto.Control.prototype.setEnabled.apply(this,arguments);}},_setDisableAttr:function(b){if(b===false){this._inputControl.attr("disabled","disabled");}else{this._inputControl.removeAttr("disabled");}},_notFormatedVal:function(){return this._curval;},_extractKey:function(b){return b.which||b.charCode||b.keyCode;},setValue:function(c,d,b){if(!this._options.readonly||d){this._setValueInternal(c);this._updateSelfContextValue(this._notFormatedVal());this._notifyOnValueChange(this.getValue());if(b!==true){this.validate();}}},_setValueInternal:function(b){this._curval=b;},_curValue:function(){return this._curval;},getStringValue:function(){return this._curValue();},setActive:function(b){if(!b&&this._changed){this.validate();}$ws.proto.FieldAbstract.superclass.setActive.apply(this,arguments);},_redraw:function(){}});return $ws.proto.FieldAbstract;});