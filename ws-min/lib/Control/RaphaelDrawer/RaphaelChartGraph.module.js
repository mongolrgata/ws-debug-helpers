$ws.declareModule({namespace:"SBIS3.CORE",name:"RaphaelChartGraph",imports:["SBIS3.CORE.RaphaelDrawerInternal"]},function(R){var u=0,s=0.0001,c=1e-12,b=Math.log(10),E=R.CommonGraphConst,I=R.helpers,h=R.ChartBaseElement,D=R.ChartLegend,p=I.clone,i=I.extend,M=I.extendStyle,o=I.ensureArray,z=I.readyDefWrapper,L=I.isSimpleValue,v=I.inBoundsBySideCalc,l=I.normalizeBounds,r=I.isArray,a=$ws.helpers.forEach,F=$ws.helpers.filter,w=$ws.helpers.map,k=$ws.helpers.reduce;function N(T){if(T.pageX===undefined){var S=document.body,U=document.documentElement;T.pageX=T.clientX+S.scrollLeft+U.scrollLeft;T.pageY=T.clientY+S.scrollTop+U.scrollTop;}}var t={defaultLegendStyle:E.defaultLegendStyle,hintOverRectAttrs:{opacity:0.01,stroke:"none",fill:"black",cursor:"pointer"},defaultAxisMarkStyleType:"default",defaultAxisMarkStyle:{axisTick:{length:5,pathStyle:{stroke:"black"}},gridTick:{length:5,pathStyle:{stroke:"black"}},gridLine:{pathStyle:{stroke:"gray"}},label:{textStyle:{}}},axisMarkStyleTypeMap:{"default":function(){return C;}},defaultChartStyle:{gridFrame:{pathStyle:{"stroke-width":1}},chartFrame:{pathStyle:{"stroke-width":1}},drawPhases:[{part:"axis",phases:["serieZonesBackground","gridLines"]},{part:"rangeAreas",phases:["back","description","custom"]},{part:"series",phases:["back","bars","line","points"]},{part:"axis",phases:["axisLine","ticks","labels","description","serieZones","custom"]},{part:"series",phases:["labels","custom"]},{part:"legend",phases:["default"]},{part:"axis",phases:["cleanupDraw"]}]},defaultAxisStyleType:"default",defaultAxisStyle:{labelPadding:undefined,descriptionPadding:5,width:undefined,widthH:30,widthV:50,showDescription:true,descriptionTextStyle:{"font-size":14},pathStyle:{},serieZone:{widthH:30,widthV:30,descriptionTextStyle:{"font-size":14},backPathStyle:undefined}},axisStyleTypeMap:{"default":function(){return m;}},defaultSerieType:"default",serieTypeMap:{"default":function(){return e;},line:function(){return e;},bar:function(){return e;}},defaultSerieStyle:{line:{hintPathStyle:{stroke:"hsl(120, 2%, 70%)",fill:"rgb(241, 241, 241)"},linePathStyle:{},backPathStyle:{stroke:"none",fill:"none"},pointStyle:{element:"_circle",elementStyle:{r:5,fill:"blue","fill-opacity":0.7}},barPathStyle:false,showInLegend:true,smooth:true},bar:{hintPathStyle:{stroke:"hsl(120, 2%, 70%)",fill:"rgb(241, 241, 241)"},barWidth:"30%",interBarPadding:10,barWidthMin:15,barPathStyle:{"stroke-width":1},pointStyle:false,linePathStyle:false,backPathStyle:false,smooth:true,showInLegend:true}},defaultSerieLabelStyle:{textStyle:{"font-size":12},overflowStyle:{"stroke-dasharray":".","stroke-width":2}},defaultRangeArea:{rangeX:{start:"min",end:"max"},style:{descriptionStyle:{side:"bottom",sidePosition:"center",sidePadding:5,textStyle:{"font-size":12}},backPathStyle:{"fill-opacity":0.2,stroke:"none"}}},axisFormatMap:{date:function(){return f;},number:function(){return y;},category:function(){return d;}},side:E.side,direction:{topBottom:"topBottom",bottomTop:"bottomTop",leftRight:"leftRight",rightLeft:"rightLeft"},defaultDirectionForSide:{left:"bottomTop",right:"bottomTop",top:"leftRight",bottom:"leftRight"},sideForDirection:{topBottom:{left:1,right:1},bottomTop:{left:1,right:1},leftRight:{top:1,bottom:1},rightLeft:{top:1,bottom:1}},directionHV:{topBottom:"V",bottomTop:"V",leftRight:"H",rightLeft:"H"},HV_BySide:{left:"V",right:"V",bottom:"H",top:"H"},chartMinHeight:10,chartMinWidth:10,axisLabelPaddingV:5,axisLabelPaddingH:3,minMargin:2,axisStartEndGap:{H:10,V:10},autoRangeIntervalWidth:40,autoRangeSignCount:3,autoRangeRoundNum:5};function j(S){return S===undefined||S===null||isNaN(S);}function Q(S){return $.isPlainObject(S);}function B(S){return Math.abs(S)<c;}function q(S){return S&&((S.fill&&S.fill!=="none")||(S.fill&&S.fill!=="none"));}function H(T,W,ac,X,af,Y){function S(ap,an,al,ak,aj,aB,az){function aD(aG){return Math.floor(Math.log(aG)/b);}function ar(aJ,aL,aP,aQ){function aK(aU,aT){return B(Math.abs(aU-aT));}function aM(aT){return aT/Math.pow(10,aD(aT));}var aS=aD(aJ),aO=aJ/Math.pow(10,aS),aI=Math.floor(aO*Math.pow(10,aL-1))/Math.pow(10,aL-1),aR=aI*Math.pow(10,aS);if(aQ&&!aK(aO,aI)){aR+=Math.pow(10,aS-aL+1);}var aH=aR,aN=-(aS-aL+1),aG=Math.floor(aR*Math.pow(10,aN)/aP);aR=aG*aP/Math.pow(10,aN);if(aQ&&!aK(aM(aR),aM(aH))){aR=(aG+1)*aP/Math.pow(10,aN);}return aR;}function aA(aR,aO,aT,aI,aN,aQ,aH){var aU=aD(Math.max(Math.abs(aI),Math.abs(aN))),aM=aT-aU-1,aL=aO/Math.pow(10,aM);if(!al&&(aQ-aI<(aL/2))){aI-=aL;}var aP=Math.round(((aN-aI)*Math.pow(10,aM))/aO),aG=Math.round((aR*4)/3),aS=2,aK;function aJ(){var aW=aR,aV=aR+1;while(aW>=aS||aV<=aG){if(aW>=aS&&aP%aW===0){return aW;}if(aV<=aG&&aP%aV===0){return aV;}aW--;aV++;}return undefined;}if(aP>aR){aK=aJ();if(aK===undefined){aP++;aK=aJ();if(al){aN+=aL;}else{if(ak){aI-=aL;}else{if((aN+aL-aH)<(aQ-(aI-aL))){aN+=aL;}else{aI-=aL;}}}}}else{aK=aP;}if(aK<aR){while(aK*2<aR){aK=aK*2;}}return{stepCount:aK,start:aI,end:aN,step:(aN-aI)/aK};}function ao(aL,aH,aI,aG){var aJ=[],aK=(aH-aL)/aI;while((aL<aH)||B(aH-aL)){aJ.push(parseFloat(aL.toPrecision(aG+2)));aL=aL+aK;}return aJ;}var ay=ap>=0?1:-1,at=an>=0?1:-1,aC=Math.abs(ap),aE=Math.abs(an),au=B(aC)?0:aD(aC),ax=B(aE)?0:aD(aE),aw=aB+au-Math.max(au,ax),aq=aB+ax-Math.max(au,ax),aF=B(aC)?0:ar(aC,aw,az,ay<0)*ay,am=B(aE)?0:ar(aE,aq,az,at>0)*at,av=B(aE-aC)?{stepCount:0,start:aF,end:am,step:0}:aA(aj,az,aB,aF,am,ap,an);av.steps=ao(av.start,av.end,av.stepCount,aB);return av;}var ai=null;if(ac===undefined){ai=S(T,W,false,false,X,af,Y);}else{if(B(ac-T)||(ac<T)){ai=S(ac,W,true,false,X,af,Y);}else{if(B(ac-W)||(ac>W)){ai=S(T,ac,false,true,X,af,Y);}else{var ah=(ac-T)<(W-ac),ae=ah?W-ac:ac-T,ag=Math.max(2,Math.round(X*ae/(W-T))),U=ah?ac:T,aa=ah?W:ac,ad,ab=[];ai=S(U,aa,ah,!ah,ag,af,Y);if(ai.stepCount>0){if(ah){ad=ai.start;while(ad>T){ad-=ai.step;ab.push(parseFloat(ad.toPrecision(af+2)));}ab.reverse();ai.stepCount+=ab.length;ai.start=ad;ai.steps=ab.concat(ai.steps);}else{ad=ai.end;while(ad<W){ad+=ai.step;ab.push(parseFloat(ad.toPrecision(af+2)));}ai.stepCount+=ab.length;ai.end=ad;ai.steps=ai.steps.concat(ab);}}}}}var Z,V;for(Z=0,V=ai.steps.length;Z<V;Z++){if(B(ai.steps[Z])){ai.steps[Z]=0;}}return ai;}function G(U,ag,Z,ad,T,af,X,ac){var ah=U+Z,S=ag+ad,ab=T+X,ae=af+ac,W=Math.max(U,T),V=Math.min(ah,ab),aa=Math.max(ag,af),Y=Math.min(S,ae);return{left:W,top:aa,width:V-W,height:Y-aa};}var C=$ws.proto.Abstract.extend({createLabel:function(V,W,T,U){var S=T.text(V.x,V.y,W);if(U){S.attr(U);}return S;},createAxisTick:function(T,X,U,W){var V=(W&&W.length)||t.defaultAxisMarkStyle.axisTick.length;var S=t.directionHV[X]==="H";var Z=S?{x:T.x,y:T.y-V}:{x:T.x-V,y:T.y};var Y=S?{x:T.x,y:T.y+V}:{x:T.x+V,y:T.y};var aa=U.path("M"+Z.x+","+Z.y+"L"+Y.x+","+Y.y);if(W&&W.pathStyle){aa.attr(W.pathStyle);}return aa;},createGridAxisTick:function(W,V,T,U){var S=this.createAxisTick(W,V,T,U);if(U&&U.pathStyle){S.attr(U);}return S;},createGridLine:function(W,V,T,U){var S=T.path("M"+W.x+","+W.y+"L"+V.x+","+V.y);if(U&&U.pathStyle){S.attr(U.pathStyle);}return S;}});var P=function(ac){var U=new RegExp("^(-)?P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+(?:\\.\\d+)?)S)?)?$");var X=ac.match(U);if(!X){return null;}var ad=!(X[6]||X[7]||X[8]);var S=ad&&!(X[2]||X[3]||X[4]);if(S||ad&&X[5]){return null;}var W=X[1];var Y=1970+(parseInt(X[2],10)||0);var T=parseInt(X[3],10)||0;if(T>11){throw new Error("Bad month part in value: "+ac);}var ae=1+(parseInt(X[4],10)||0);if(ae>31){throw new Error("Bad days part in value: "+ac);}var aa=parseInt(X[6],10)||0;if(aa>24){throw new Error("Bad hours part in value: "+ac);}var V=parseInt(X[7],10)||0;if(V>60){throw new Error("Bad minutes part in value: "+ac);}var ab=parseFloat(X[8])||0;if(ab>60){throw new Error("Bad seconds part in value: "+ac);}var Z=W?Date.UTC(-Y,-T,-ae,-aa,-V,-ab):Date.UTC(Y,T,ae,aa,V,ab);return new Date(Z);};var f=$ws.proto.Abstract.extend({parseValue:function(S){if(S instanceof Date){return S;}else{if(typeof S==="string"){return new Date(Date.parse(S));}else{return NaN;}}},parseInterval:function(S){return P(S)||NaN;},roundToInterval:function(S){return S;},compare:function(V,T,U){if(!U){U=0;}var S=V-T;return(Math.abs(S)<=U)?0:(S>0?1:-1);},generateSequence:function(V,W,U){var T=[];for(var S=V.valueOf();S<=W.valueOf();S=S+U.valueOf()){T.push(new Date(S));}return T;},formatValue:function(S,T){return T?S.strftime(T):S.toLocaleString();},minValue:function(){return new Date(-100000000*86400000);},maxValue:function(){return new Date(100000000*86400000);},normalizedToRange:function(Y,V,X,U){var T=(1/(V-Y))*(U.valueOf()-X.valueOf()),W=X.valueOf()-(Y*T),S=W+T;return{min:new Date(W),max:new Date(S)};},normalizedToValue:function(V,T){var U=T.min.valueOf(),S=T.max.valueOf();return U+(S-U)*V;},normalizedFromValueRange:function(V,T){var U=T.min.valueOf(),S=T.max.valueOf();V=V.valueOf();return(V-U)/(S-U);},prepareData:function(S){return S;},isBadInterval:function(S){return this.isBadValue(S)||(this.compare(S,u,s)===0)||S.valueOf()<0;},isBadValue:j});var J=$ws.render.defaultColumn;var g={real:function(T,S){return J.real(T,S.decimals,S.delimiters);},money:function(S){return J.money(S);},integer:function(T,S){return J.integer(T,!S.delimiters);},"default":function(S){return String(S);}};var O={parseValue:function(S){if(typeof S==="number"){return S;}else{if(typeof S==="string"){return parseFloat(S);}else{return NaN;}}},parseInterval:function(S){return this.parseValue(S);},parseRangeExtendInterval:function(S){return this.parseValue(S);},roundToInterval:function(V,S,U){var T=Math.floor(V/S)*S;if(this.compare(T,V)===0){return T;}else{return T+(U?S:0);}},generateSequence:function(V,W,U){var T,S=[];if(V<=W){for(T=V;T<W;T+=U){S.push(T);}}else{for(T=V;T>W;T-=U){S.push(T);}}if(this.compare(T,W)===0){S.push(T);}return S;},compare:function(V,T,U){if(!U){U=Math.abs(T-V)*s;}var S=V-T;return(Math.abs(S)<=U)?0:(S>0?1:-1);},formatValue:function(T,U){var S=(U&&g[U.type])||g["default"];return S(T,U);},minValue:function(){return Number.MIN_VALUE;},maxValue:function(){return Number.MAX_VALUE;},sub:function(T,S){return T-S;},add:function(T,S){return T+S;},normalizedToRange:function(Y,V,X,U){var T=(1/(V-Y))*(U-X),W=X-(Y*T),S=W+T;return{min:W,max:S};},normalizedToValue:function(V,T){var U=T.min,S=T.max;if(this.compare(U,S)===0){return U*V;}else{return U+(S-U)*V;}},normalizedFromValueRange:function(T,S){return this.compare(S.max,S.min)!==0?((T-S.min)/(S.max-S.min)):0;},createDataIntf:function(S){return{getCount:S.getCount,getFieldValue:function(T,U){return parseFloat(S.getFieldValue(T,U));}};},supportsAutoRange:function(){return true;},isBadValue:j,isBadInterval:function(S,T){if(T){return this.isBadValue(S);}else{return this.isBadValue(S)||(this.compare(S,0,s)===0)||(S<0);}}};var y=$ws.proto.Abstract.extend(O);var d=$ws.proto.Abstract.extend({parseValue:function(T){if(typeof T==="number"){return{idx:Math.floor(T),text:undefined};}else{if(typeof T==="string"){var S=parseInt(T,10);return isNaN(S)?NaN:{idx:S,text:undefined};}else{return NaN;}}},createDataIntf:function(U,S){var T=(S&&S.length>0)?S[0]:undefined;return{defaultField:T,getCount:U.getCount,getFieldValue:function(V,W){return{idx:V,text:U.getFieldValue(V,W)};},getDefaultFieldValue:T?function(V){return{idx:V,text:U.getFieldValue(V,this.defaultField)};}:function(V){return{idx:V,text:undefined};}};},parseInterval:function(S){return this.parseValue(S);},parseRangeExtendInterval:function(T){if(typeof T==="number"){return{idx:T,text:undefined};}else{if(typeof T==="string"){var S=parseFloat(T);return isNaN(S)?NaN:{idx:S,text:undefined};}else{return NaN;}}},roundToInterval:function(W,T,V){W=W.idx;T=T.idx;var U=parseInt((Math.floor(W/T)*T),10),S=U+((V&&(U!==W))?T:0);return{idx:parseInt(S,10),text:undefined};},generateSequence:function(W,X,U,Z){var Y=Z.getCount();W=W.idx;X=X.idx;U=U.idx;var T=[],S,V=function(aa){T.push((aa>=0&&aa<Y)?Z.getDefaultFieldValue(aa):{idx:aa,text:undefined});};if(W<=X){for(S=Math.round(W);S<=X;S+=U){V(Math.round(S));}}else{for(S=Math.round(W);S>=X;S-=U){V(Math.round(S));}}return T;},compare:function(T,S){if(this.isBadValue(T)||this.isBadValue(S)){throw new Error("Неправильные значения в compare");}return T.idx-S.idx;},sub:function(T,S){return{idx:T.idx-S.idx,text:undefined};},add:function(T,S){return{idx:T.idx+S.idx,text:undefined};},formatValue:function(S){return S.text?String(S.text):"";},minValue:function(){return{idx:Number.MIN_VALUE,text:undefined};},maxValue:function(){return{idx:Number.MAX_VALUE,text:undefined};},normalizedToRange:function(Y,V,X,U){var T=(1/(V-Y))*(U.idx-X.idx),W=X.idx-(Y*T),S=W+T;return{min:{idx:W,text:undefined},max:{idx:S,text:undefined}};},normalizedToValue:function(V,T){var U=T.min.idx,S=T.max.idx;if(U===S){return{idx:U*V,text:undefined};}else{return{idx:U+(S-U)*V,text:undefined};}},normalizedFromValueRange:function(T,S){return(S.max.idx>S.min.idx)?(T.idx-S.min.idx)/(S.max.idx-S.min.idx):0;},prepareData:function(S){return w(S,function(U,T){return{idx:parseInt(T,10),text:U};});},supportsAutoRange:function(){return false;},isBadValue:function(S){return S===undefined||S===null||(!(S instanceof Object)&&isNaN(S));},isBadInterval:function(S,T){if(T){return this.isBadValue(S);}else{return(this.isBadValue(S)||(S.idx<=0));}}});var n=$ws.proto.Abstract.extend({$constructor:function(S){i(this,S);this._publish("onDataFormat");if(this.onDataFormat){this.subscribe("onDataFormat",this.onDataFormat);}}});var x=h.extend({$protected:{_compiledStyle:null,_gridDrawBounds:null,_oppositeDrawBounds:null,_series:[],_rangeAreas:[],_headerVisible:true,_boundAxis:[]},$constructor:function(S){this._compiledStyle=S;},_addSerie:function(S){this._series.push(S);},_addRangeArea:function(S){this._rangeAreas.push(S);},_addBoundAxis:function(S){this._boundAxis.push(S);},_setGridDrawBounds:function(S){this._invalidateDrawBounds();this._gridDrawBounds=S;},_reduceSeries:function(T,S){return k(this._series,T,S,this);},_reduceRangeAreas:function(T,S){return k(this._rangeAreas,T,S,this);},_getGridDrawBounds:function(){return this._gridDrawBounds;},_setOppositeDrawBounds:function(S){this._oppositeDrawBounds=S;},_setHeaderVisible:function(S){this._headerVisible=S;},_getHeaderVisible:function(){return this._headerVisible;},_getOppositeDrawBounds:function(){return this._oppositeDrawBounds;},_getCompiledStyle:function(){return this._compiledStyle;}});x.parseZoneIdx=function(T,U){var S=parseInt(T||0,10);if(isNaN(S)||S<0){throw new Error(U+T);}return S;};var A=function(){function X(ab){var ac={min:0,max:100,start:0,end:100,center:50},Z=ac[ab],aa;if(Z===undefined){aa=String(ab).match(/(.+)%$/);if(aa){Z=parseFloat(String.trim(aa[1]));}else{Z=NaN;}}return Z;}function V(ac,aa,ab){if(ac.value===undefined){throw new Error("Не задано значение для точки диапазона: "+aa);}function ae(){throw new Error('Неправильный формат имени точки диапазона "'+aa+'": (надо min/max/center, или проценты, или абсолютное значение): '+ac.value);}var Z={valuePercent:undefined,value:undefined,name:aa},ad=X(ac.value);if(isNaN(ad)){ad=ab.parseValue(ac.value);if(ab.isBadValue(ad)){ae();}Z.value=ad;}else{Z.valuePercent=ad;}return Z;}function W(aa){var ab=this.getDataFormat();if(aa===undefined||aa===null){throw new Error("Не задано значение интервала");}var Z=ab.parseInterval(aa);if(ab.isBadInterval(Z)){throw new Error("Неправильный формат интервала: "+aa);}return Z;}function U(Z,ag){var ah,af=this.getDataFormat();function ac(aj,ak){var ai=undefined;if(aj[ak]!==undefined){ai=af.parseValue(aj[ak]);if(af.isBadValue(ai)){throw new Error("Неправильный формат абсолютного значения точки автодиапазона: "+aj[ak]);}}return ai;}if(Z&&(Z==="auto"||Z.auto===true)){if(ag&&ag.allowAuto===false){throw new Error(ag.allowAutoErrMsg);}if(af.supportsAutoRange()){if(Z==="auto"){Z={};}ah={auto:true};if(isNaN(ah.intervalWidth=parseFloat(Z.intervalWidth))){ah.intervalWidth=t.autoRangeIntervalWidth;}if(isNaN(ah.roundNum=parseInt(Z.roundNum,10))){ah.roundNum=t.autoRangeRoundNum;}if(isNaN(ah.signCount=parseInt(Z.signCount,10))){ah.signCount=t.autoRangeSignCount;}ah.max=ac(Z,"max");ah.min=ac(Z,"min");ah.fixedPoint=ac(Z,"fixedPoint");}else{throw new Error("Формат данных "+cfg.dataFormat+" не поддерживает автоподгонку диапазона");}}else{ah=[];Z=Z||{};if(Object.isEmpty(Z)){Z={min:"0%",max:"100%"};}var aa=k(Z,function(aj,ai,ak){aj.cnt++;if(aj.cnt>2){throw new Error("Можно задавать максимум две точки диапазона, задано же больше");}if(!Q(ai)){ai={value:ai};}var al=V(ai,ak,af);al.rangePercent=X(ak);if(isNaN(al.rangePercent)){throw new Error("Неправильный формат имени точки диапазона: (надо min/max/center или проценты): "+ak);}var am=ai.round;if(am!==undefined){am=af.parseInterval(am);if(af.isBadInterval(am)){throw new Error("Неправильный формат округления точки диапазона: "+ai.round);}al.round=am;}am=String(al.rangePercent.toFixed(2));aj.hash[am]=al;return aj;},{cnt:0,hash:{}}).hash;ah=ah.concat(w(aa,function(ai){return ai;}));if(ah.length<2){throw new Error("Нужно задавать две точки диапазона или не задавать диапазон вообще");}if(ah[0].rangePercent>ah[1].rangePercent){ah=ah.reverse();}if(ah.length===2){var ae,ad,ab="Стартовая точка диапазона должна быть меньше конечной";if((ae=ah[0].value)!==undefined&&(ad=ah[1].value)!==undefined){if(af.compare(ae,ad)>=0){throw new Error(ab);}}else{if((ae=ah[0].valuePercent)!==undefined&&(ad=ah[1].valuePercent)!==undefined){if(O.compare(ae,ad)>=0){throw new Error(ab);}}}}}return ah;}function Y(ab){var aa=this.getDataFormat();function ac(ad){if(ad!==undefined){ad=aa.parseRangeExtendInterval(ad);if(aa.isBadInterval(ad,true)){throw new Error("Неправильный формат значения в параметре rangeExtend: "+ad);}}return ad;}var Z=Q(ab)?ab:{min:ab,max:ab};return{min:ac(Z.min),max:ac(Z.max),forEmptyRangeOnly:ab&&ab.forEmptyRangeOnly};}function T(aa){var Z=[],ad=Q(aa.start)?aa.start:{value:aa.start},ab=Q(aa.end)?aa.end:{value:aa.end},ac=this.getDataFormat();if(ad===undefined){throw new Error("Не задан параметр start для диапазона");}if(ab===undefined){throw new Error("Не задан параметр end для диапазона");}Z[0]=V(ad,"start",ac);if(ad.round!==undefined){Z[0].round=W.call(this,ad.round);}Z[0].rangePercent=X("start");Z[1]=V(ab,"end",ac);if(ab.round!==undefined){Z[1].round=W.call(this,ab.round);}Z[1].rangePercent=X("end");return Z;}function S(ac,ab,af){var ae,ag,ad=this.getDataFormat(),aa=af;function Z(ai,ah){if(ai.round!==undefined&&ai.value!==undefined){ai.value=ad.roundToInterval(ai.value,ai.round,ah);}}if(ab){for(ae=0;ae<ac.length;ae++){ag=ac[ae];if(ag.valuePercent!==undefined){ag.value=ad.normalizedToValue(ag.valuePercent/100,ab);}}}if(ac.length>0){Z(ac[0],false);Z(ac[1],true);if(ac[0].value!==undefined&&ac[1].value!==undefined&&ac[0].rangePercent!==undefined&&ac[1].rangePercent!==undefined){aa=ad.normalizedToRange(ac[0].rangePercent/100,ac[1].rangePercent/100,ac[0].value,ac[1].value);}}return aa;}return function(Z){return{parseInterval:W.bind(Z),parseRangeLink:T.bind(Z),parseRangeExtend:Y.bind(Z),parseRange:U.bind(Z),parsedRangeToDataRange:S.bind(Z)};};}();var m=h.extend({$protected:{_chart:null,_side:null,_direction:null,_directionHV:null,_dataIntf:null,_dataIntfSrc:null,_dataFields:[],_cfgDataFields:[],_dataFormat:null,_dataFormatterParams:undefined,_boundToAxis:{name:undefined,axis:undefined,value:undefined,valuePercent:undefined,zone:0},_dataRangeParsed:[],_dataRangeExtend:{min:undefined,max:undefined,forEmptyRangeOnly:false},_dataRangeCalcSrc:{min:null,max:null},_dataRangeCalc:{min:null,max:null},_layout:{markers:[]},_zonesLayout:{},_drawElements:{},_drawBoundsInvalidateParts:["dataFinal"],_markDefs:[],_gridDrawBounds:null,_zonesDrawBounds:null,_validState:{dataSrc:false,dataFinal:false},_style:{},_styleCompiled:{},_serieZones:[],_seriesMargin:null,_secondaryRanges:[],_eventNames:{onElementCustomDraw:1,onElementMouseDown:1,onElementMouseUp:1,onElementMouseOver:1,onElementMouseOut:1,onPrepareData:1,onCustomGenerateMarks:1,onDataFormat:1}},$constructor:function(S){var Z,U;this._rangeParser=A(this);this._dataFields=o(S.dataField||S.dataFields);this._cfgDataFields=p(this._dataFields);this._style=S.style||{};var V=(typeof this._style==="string")?{baseName:this._style}:this._style;if(S.description){V.description=S.description;}this._styleCompiled=i(this._chart._getAxisStyleConfig(V.baseName),V);if((Z=this._styleCompiled.width)!==undefined){Z=parseInt(Z,10);if(isNaN(Z)||Z<=0){throw new Error("Неправильный параметр width: "+Z);}}if((Z=this._styleCompiled.labelPadding)!==undefined){Z=parseInt(Z,10);if(isNaN(Z)||Z<=0){throw new Error("Неправильный параметр labelPadding: "+Z);}}this._side=S.side;if(t.side[this._side]===undefined){throw new Error("Неправильный параметр side: "+this._side);}this._direction=S.direction;if(this._direction===undefined){this._direction=t.defaultDirectionForSide[this._side];}if(t.direction[this._direction]===undefined){throw new Error("Неправильный параметр direction: "+this._direction);}var W=t.sideForDirection[this._direction];if(W===undefined||W[this._side]===undefined){throw new Error("Неправильное сочетание параметров side и direction: "+this._side+"/"+this._direction);}this._directionHV=t.directionHV[this._direction];var X=t.axisFormatMap[S.dataFormat];if(X===undefined){throw new Error("Неизвестный формат данных для оси (dataFormat): "+S.dataFormat);}X=X();U=this._dataFormat=new X();this._dataFormatterParams=S.dataFormatterParams||{};this._dataRangeParsed=this._rangeParser.parseRange(S.range);this._dataRangeExtend=this._rangeParser.parseRangeExtend(S.rangeExtend);var T=(S.markDefinitions||[]);this._markDefs=this._markDefs.concat(w(T,function(ad,ab){var ac=new n(ad),ae,aa;ac.dataFormatterParams=ac.dataFormatterParams||this._dataFormatterParams;if((ac.interval===undefined&&ac.pointInterval===undefined)||(ac.interval!==undefined&&ac.pointInterval!==undefined)){throw new Error("Нужно задать один из параметров interval или pointInterval, но только один");}if(ac.interval!==undefined){if(ac.interval==="auto"){if(!U.supportsAutoRange()){throw new Error("Формат данных "+S.dataFormat+" не поддерживает авторазметку оси");}}else{ac.interval=this._rangeParser.parseInterval(ac.interval);}}if((ae=ac.pointInterval)!==undefined){ac.pointInterval=parseInt(ae,10);if(isNaN(ac.pointInterval)||ac.pointInterval<=0){throw new Error("Неправильный формат параметра pointInterval (нужно целое число больше нуля): "+ae);}}ac.priority=parseInt(ac.priority,10)||ab;ac.styleCompiled=this._getCompiledStyle(ac.style);ac.ranges=o(ac.ranges);if(ac.ranges.length===0){ac.ranges=[{start:"min",end:"max"}];}if(ac.round!==undefined){aa=(ac.round===true)?ac.interval:this._rangeParser.parseInterval(ac.round);ac.round=aa;}ac.ranges=k(ac.ranges,function(af,ag,ah){ag=this._rangeParser.parseRangeLink(ag);if(ag[0].round===undefined){ag[0].round=ac.round;}if(ag[1].round===undefined){ag[1].round=ac.round;}af[ah]=ag;return af;},{},this);return ac;},this));var Y=S.serieZones||[];if(!(Y instanceof Array)){throw new Error("Параметр оси serieZones должен быть массивом");}if(Y.length===0){Y.push({});}a(Y,function(aa,ab){this._initZone(ab,aa,true);},this);},_setupPointIntervals:function(){var S;if(this._cfgDataFields.length===1){S=this._cfgDataFields[0];}else{if(this._dataFields.length===1){S=this._dataFields[0];}}a(this._markDefs,function(T){if(T.pointInterval!==undefined){if(T.pointIntervalDataField===undefined){T.pointIntervalDataField=S;}if(!T.pointIntervalDataField){throw new Error("Не задано поле данных (параметр pointIntervalDataField) для параметра pointInterval, и нельзя использовать параметр dataField оси по умолчанию (он не задан, или в нём несколько полей).");}}},this);},_rangeParser:null,_addSecondaryRange:function(T){var S={min:T[0].value,max:T[1].value};if(S.min!==undefined||S.max!==undefined){this._secondaryRanges.push(S);}},_checkConfig:function(){if(this._dataFields.length===0){throw new Error("Не задан параметр dataField (он же dataFields) у оси, и не заданы соответствующие параметры axisYdataField/axisXdataField у серий, привязанных к оси");}this._setupPointIntervals();},_getSeriesZoneConfig:function(S){return i(p(t.defaultAxisStyle.serieZone),S||{});},_checkZoneIdx:function(S){return this._serieZones[S]||this._initZone(S,{},true);},_addObjectToZone:function(U,T){var S=this._checkZoneIdx(T);U(S);S._setVisibleImplicit(true);return S;},_addSerieToZone:function(S,T){return this._addObjectToZone(function(U){U._addSerie(S);},T);},_addRangeAreaToZones:function(W,U,T,X){function S(Y){Y._addRangeArea(W);}for(var V=U;V!==U+T;V++){this._addObjectToZone(S,V);}this._addSecondaryRange(X);},_addBoundAxisToZone:function(T,U){var S=this._checkZoneIdx(U);S._addBoundAxis(T);S._setVisibleImplicit(true);return S;},_initZone:function(W,V,U){var T=this._getSeriesZoneConfig(V),S=new x(T);this._serieZones[W]=S;S._setVisibleImplicit(U);return S;},_addDataField:function(U){var S=this._dataFields;for(var T in S){if(!S.hasOwnProperty(T)){continue;}if(S[T]===U){return;}}this._dataFields.push(U);},_getBoundAxis:function(){return this._boundToAxis.axis;},_getBoundAxisParams:function(){return this._boundToAxis;},_getAxisLineDiff:function(){var T=this._drawBounds,S={left:{x:T.width,y:0},right:{x:0,y:0},top:{x:0,y:T.height},bottom:{x:0,y:0}};return S[this._side];},_setBoundAxis:function(S){if(S.boundToAxis){var X=this._chart,W,U,Y,T,V;if(!(U=S.boundToAxis.name)){throw new Error("Не задано имя оси для привязки в параметре boundToAxis");}if(!(W=X.getAxis(U))){throw new Error("Не найдена ось для привязки, указанная в параметре boundToAxis: "+U);}if(this._directionHV===W._directionHV){throw new Error("Нельзя привязывать горизонтальную ось к горизонтальной или вертикальную к вертикальной");}V=W.getDataFormat();this._boundToAxis.axis=W;this._boundToAxis.name=U;this._boundToAxis.zoneIdx=x.parseZoneIdx(S.boundToAxis.zone,"Номер зоны в оси для привязанной оси должен быть числом >=0, задано же: ");W._addBoundAxisToZone(this._boundToAxis.zoneIdx,this);Y=S.boundToAxis.value;T=String(Y).match(/(.+)%$/);if(T){Y=parseFloat(String.trim(T[1]));if(isNaN(Y)){throw new Error("Неправильный относительный параметр value в boundToAxis: "+S.boundToAxis.value);}this._boundToAxis.valuePercent=Y;this._boundToAxis.value=undefined;}else{Y=V.parseValue(Y);if(V.isBadValue(Y)){throw new Error("Неправильный абсолютный параметр value в boundToAxis: "+S.boundToAxis.value);}this._boundToAxis.valuePercent=undefined;this._boundToAxis.value=Y;}Y=S.boundToAxis.round;if(Y!==undefined){Y=V.parseInterval(Y);if(V.isBadInterval(Y)){throw new Error("Неправильный формат округления в boundToAxis: "+S.boundToAxis.round);}this._boundToAxis.round=Y;}}},_getCompiledStyle:function(S){if(typeof S==="string"){return this._chart._getAxisMarkStyleConfig(S);}else{if(typeof S==="object"){var T=this._chart._getAxisMarkStyleConfig(S.baseName);return i(T,S);}else{return this._chart._getAxisMarkStyleConfig();}}},_setDataIntf:function(S){this._invalidate(["dataSrc","dataFinal"]);this._dataIntfSrc=S;this._dataIntf=this._dataFormat.createDataIntf(S,this._dataFields);},getChart:function(){return this._chart;},getDataFields:function(){return p(this._cfgDataFields);},getDataRange:function(){return p(this._dataRangeParsed);},getDataFormat:function(){return this._dataFormat;},getGridDrawBounds:function(){return p(this._gridDrawBounds);},getDrawBounds:function(){return p(this._drawBounds);},getDataRangeCalc:function(){this._getLayout();return p(this._dataRangeCalc);},getDescription:function(){return this._styleCompiled.description;},_getMaxBounds:function(){var S=this._styleCompiled;return this._directionHV==="V"?{width:(S.width||S.widthV)}:{height:(S.width||S.widthH)};},_setOppositeDrawBounds:function(S){this._zonesDrawBounds=S;this._updateSerieZonesBounds();},_reduceVisibleZones:function(T,S){return k(this._zonesLayout.zonesArr,T,S,this);},_setSeriesMargin:function(S){if(this._seriesMargin.left!==S.left||this._seriesMargin.right!==S.right||this._seriesMargin.top!==S.top||this._seriesMargin.bottom!==S.bottom){this._seriesMargin=p(S);this._invalidate(["dataFinal"]);}},_getOppositeMaxBounds:function(){var S={};S[this._getWidthDimension()]=this._zonesLayout.zonesWidth;return S;},_setGridDrawBounds:function(S){this._invalidate(["dataFinal"]);this._gridDrawBounds=S;},_getDataIntf:function(){return this._dataIntf;},_getAutoRangeStepCount:function(T){var S=this._drawBounds.width,U=this._drawBounds.height;var V={topBottom:U,bottomTop:U,leftRight:S,rightLeft:S};return Math.max(2,Math.round(V[this._direction]/T));},_updateSerieZonesBounds:function(){var S=this._zonesLayout.count;a(this._zonesLayout.zonesArr,function(T,U){T._setOppositeDrawBounds(this._getBoundsPart(this._zonesDrawBounds,U,S));},this);},_initSerieZoneDrawElemens:function(S){this._drawElements[S]={markers:[],axisLine:null,serieZone:null};},_preCalcLayout:function(U,Y){var X=this._styleCompiled.serieZone,T;this._seriesMargin={left:0,right:0,top:0,bottom:0};if(U){var W=(this._directionHV==="V"?X.widthV:X.widthH),S=this._serieZones.length;this._drawElements={};this._zonesLayout=k(this._serieZones,function(ab,aa,ac){if(aa.getVisible()){ab.zones[ac]=aa;ab.zonesArr.push(aa);ab.zoneIndexes.push(ac);ab.count++;var ad=aa._getCompiledStyle(),ae=ad.description||S>1;aa._setHeaderVisible(ae);if(!ad.description&&ae){ad.description=k(aa._series,function(af,ag){var ah=ag.getDescription();if(ah){af.push(ah);}return af;},[]).join(", ");}if(ae){ab.zonesWidth=W;}this._initSerieZoneDrawElemens(ac);}return ab;},{zones:{},zonesArr:[],zoneIndexes:[],zonesWidth:0,count:0},this);T=this._zonesLayout.zonesWidth;}else{var V=this._zonesLayout.count,Z=this._getWidthDimension();T=this._reduceVisibleZones(function(ab,aa,ac){var ad=0;if(aa._getHeaderVisible()){var ae=this._zonesLayout.zoneIndexes[ac],af;aa._setOppositeDrawBounds(this._getBoundsPart(this._zonesDrawBounds,ac,V));if(!Y){this._drawSerieZonePrepare(aa,ae);}af=this._drawElements[ae].serieZone.elBox;ad=Math.max(ab,af[Z]+t.defaultAxisStyle.descriptionPadding);}return ad;},0);}this._zonesLayout.zonesWidth=T;this._layout.displayZones=this._zonesLayout.zones;this._layout.displayZoneIndexes=this._zonesLayout.zoneIndexes;this._layout.displayZonesCount=this._zonesLayout.count;},_getLengthDimension:function(){return t.directionHV[this._direction]==="H"?"width":"height";},_getWidthDimension:function(){return t.directionHV[this._direction]==="H"?"height":"width";},_getLayout:function(){var aB,az,ay,ao,ad,av,aF,ah,V=this._dataFormat,S=this._dataFields,aq,ai,au,aD,al,W,aE,aa,aw,aj,aA,U=undefined;if(!this._validState.dataSrc||!this._validState.dataFinal){aq=this._getDataIntf();ai=aq.getCount();aw=this._dataRangeExtend;aa=p(this._dataRangeParsed);aj=this._zonesLayout;aA=aj.count-1;}if(!this._validState.dataSrc){this._validState.dataFinal=false;this._layout.markers=[];if(aa.auto||aa.length<2||aa[0].valuePercent!==undefined||aa[1].valuePercent!==undefined){aF=ah=null;for(az in S){if(!S.hasOwnProperty(az)){continue;}for(aB=0;aB<ai;aB++){if((typeof S[az]==="object")&&S[az].sum){al=undefined;aE=S[az].sum;for(ay in aE){if(!aE.hasOwnProperty(ay)){continue;}W=aq.getFieldValue(aB,aE[ay]);al=(al===undefined)?W:V.add(al,W);}if(aE.length>0){W=aq.getFieldValue(aB,aE[0]);if(!V.isBadValue(W)&&(aF===null||V.compare(W,aF)<0)){aF=W;}}}else{al=aq.getFieldValue(aB,S[az]);}if(!V.isBadValue(al)&&(aF===null||V.compare(al,aF)<0)){aF=al;}if(!V.isBadValue(al)&&(ah===null||V.compare(al,ah)>0)){ah=al;}}}a(this._secondaryRanges,function(aG){if(!V.isBadValue(aG.min)&&(aF===null||V.compare(aG.min,aF)<0)){aF=aG.min;}if(!V.isBadValue(aG.max)&&(ah===null||V.compare(aG.max,ah)>0)){ah=aG.max;}});au=aF!==null?{min:aF,max:ah}:null;}aD=au||{min:null,max:null};if(aa.auto){if(au){if(aa.min!==undefined){au.min=aa.min;}if(aa.max!==undefined){au.max=aa.max;}U=H(au.min,au.max,aa.fixedPoint,this._getAutoRangeStepCount(aa.intervalWidth),aa.signCount,aa.roundNum);aD={min:U.start,max:U.end};}}else{aD=this._rangeParser.parsedRangeToDataRange(aa,au,aD);}this._dataRangeCalcSrc=aD;this._dataRangeCalc=aD;if(aD.min!==null&&aD.max!==null){var ak,ab;if(V.compare(aD.min,aD.max)>0){ak=aD.max;aD.max=aD.min;aD.min=ak;}if(!aw.forEmptyRangeOnly||V.compare(aw.min,aw.max)!==0){if(aw.min!==undefined){aD.min=V.sub(aD.min,aw.min);}if(aw.max!==undefined){aD.max=V.add(aD.max,aw.max);}}ad=[];var ag=function(aJ){if(V.isBadValue(aJ.value)){return;}var aH=0,aI=ad.length,aG;while(aH<aI){aG=(aH+aI)>>1;if(V.compare(ad[aG].value,aJ.value)<0){aH=aG+1;}else{aI=aG;}}if(aH==ad.length){ad.push(aJ);}else{if(V.compare(ad[aH].value,aJ.value)===0){if(ad[aH].priority<aJ.priority){ad[aH]=aJ;}}else{ad.splice(aH,0,aJ);}}};var Y=function(aH,aG){return !V.isBadValue(aH)&&V.compare(aG.min,aH)<=0&&V.compare(aH,aG.max)<=0;};a(this._markDefs,function(aG){a(aG.ranges,function(aH){ak=aH[0].value!==undefined?aH[0].value:V.normalizedToValue(aH[0].valuePercent/100,aD);if(aH[0].round!==undefined){ak=V.roundToInterval(ak,aH[0].round,false);}ab=aH[1].value!==undefined?aH[1].value:V.normalizedToValue(aH[1].valuePercent/100,aD);if(aH[1].round!==undefined){ab=V.roundToInterval(ab,aH[1].round,true);}if(aG.interval==="auto"){ao=[];if(U){ao=U.steps;}}else{if(aG.interval!==undefined){ao=V.generateSequence(ak,ab,aG.interval,aq);}else{if(aG.pointInterval!==undefined){ao=[];var aJ=function(aK,aL){var aM=aq.getFieldValue(aK,aG.pointIntervalDataField);if(Y(aM,aL)){ao.push(aM);}};var aI;if(V.compare(ak,ab)<0){aI={min:ak,max:ab};for(ay=0;ay<ai;ay+=aG.pointInterval){aJ(ay,aI);}}else{aI={min:ab,max:ak};for(ay=ai-1;ay>=0;ay-=aG.pointInterval){aJ(ay,aI);}}}}}for(ay in ao){if(!ao.hasOwnProperty(ay)){continue;}if(!Y(ao[ay],aD)){continue;}av={value:ao[ay],text:undefined};av.text=aG._notify("onDataFormat",av.value,aG.dataFormatterParams);if(av.text===undefined){av.text=this._notify("onDataFormat",av.value,aG.dataFormatterParams);}if(av.text===undefined){av.text=V.formatValue(av.value,aG.dataFormatterParams);}av.styleCompiled=aG.styleCompiled;av.priority=aG.priority;av.gridLine=aG.gridLine;ag(av);}},this);},this);var T,X=this._markDefs.length,ae=o(this._notify("onCustomGenerateMarks",aD.min,aD.max,aq,V));for(aB in ae){if(!ae.hasOwnProperty(aB)){continue;}T=ae[aB];if(V.isBadValue(T.value)||!Y(T.value,aD)){continue;}if(T.text===undefined){T.text=this._notify("onDataFormat",T.value,this._dataFormatterParams);}if(T.text===undefined){T.text=V.formatValue(T.value,this._dataFormatterParams);}if(T.priority===undefined){T.priority=X;}T.styleCompiled=this._getCompiledStyle(T.style);ag(T);}this._layout.markers=ad;}this._validState.dataSrc=true;}if(!this._validState.dataFinal){aD=this._dataRangeCalcSrc;this._dataRangeCalc=aD;a(aj.zonesArr,function(aH,aI){var aK=aj.count,aJ=this._getBoundsPart(this._drawBounds,aI,aK),aG=this._getBoundsPart(this._gridDrawBounds,aI,aK);aH._setDrawBounds(aJ);aH._setGridDrawBounds(aG);},this);this._validState.dataFinal=true;var ar=p(this._seriesMargin);if(aj.count>1&&this._layout.markers.length>2){a(aj.zoneIndexes,function(aK,aN){var aI=aj.zones[aK],aJ=["labels"],aL=l(aI._getDrawBounds()),aM=this._layout.markers,aH=aM.length-1,aG;if(aN===0){this._layout.markers=[aM[aH]];}else{if(aN===aA){this._layout.markers=[aM[0]];}else{this._layout.markers=[aM[0],aM[aH]];}}aG=this._drawSerieZone(aK).bind(this);a(aJ,aG);a(this._drawElements[aK].markers,function(aO){return a(aO.elementsArray,function(aP){var aQ=aP.getBBox();ar.left=Math.max(aL.left-aQ.x,ar.left);ar.right=Math.max(aQ.x2-aL.right,ar.right);ar.top=Math.max(aL.top-aQ.y,ar.top);ar.bottom=Math.max(aQ.y2-aL.bottom,ar.bottom);},this);},this);a(this._drawElements[aK].markers,function(aO,aP){this._layout.markers[aP].drawMarker=aO;},this);this._drawElements[aK].markers=[];this._layout.markers=aM;},this);}if(aD.min!==null&&aD.max!==null){var an={leftRight:{min:"left",max:"right"},rightLeft:{min:"right",max:"left"}},af={topBottom:{min:"top",max:"bottom"},bottomTop:{min:"bottom",max:"top"}},am={bottom:an,top:an,left:af,right:af}[this._side][this._direction],ap=l(aj.zones[0]._getDrawBounds()),aC=ap[this._getLengthDimension()],ac=ar[am.min],ax=ar[am.max],at=ac/aC,Z=1-(ax/aC);this._dataRangeCalc=V.normalizedToRange(at,Z,aD.min,aD.max);}}return this._layout;},_getNotNullDataRange:function(){var T=this._dataFormat,S=p(this.getDataRangeCalc());if(T.isBadValue(S.min)){S.min=T.minValue();}if(T.isBadValue(S.max)){S.max=T.maxValue();}return S;},_getVisibleSerieZonesCount:function(){return this._layout.displayZonesCount;},_getVisibleSerieZone:function(S){var T=this._getLayout().displayZones;if(!(S in T)){throw new Error("Эта зона серий в оси не существует или невидима: "+S);}return T[S];},_getAxisInternalGridLineMapFn:function(X,ac,T){var ai=this._getVisibleSerieZone(X),W,Y;if(T===0){W=ai._getGridDrawBounds();Y=ai._getDrawBounds();}else{W=ac._getDrawBounds();Y=W;}var S=W.left,ah=S+W.width-1,af=W.top,aa=af+W.height-1,ag=Y.left,ab=ag+Y.width-1,Z=Y.top,U=Z+Y.height-1,ae=this._getBoundAxis();var ad={left:function(aj){return{x:S,y:aj.y};},right:function(aj){return{x:ah,y:aj.y};},top:function(aj){return{x:aj.x,y:af};},bottom:function(aj){return{x:aj.x,y:aa};}},V={left:function(aj){return{x:ab,y:aj.y};},right:function(aj){return{x:ag,y:aj.y};},top:function(aj){return{x:aj.x,y:U};},bottom:function(aj){return{x:aj.x,y:Z};}};return(ae?V:ad)[this._side];},_getAxisPosFromValueFunc:function(T){var Z=this._getVisibleSerieZone(T),U=Z._getDrawBounds(),Y=this._dataFormat,W=this._getNotNullDataRange(),X=U.width,aa=U.height;function V(ab){return Y.isBadValue(ab)?W.min:Y.normalizedFromValueRange(ab,W);}var S={topBottom:function(ab){return{y:V(ab)*aa,x:0};},bottomTop:function(ab){return{y:(1-V(ab))*aa,x:0};},leftRight:function(ab){return{x:V(ab)*X,y:0};},rightLeft:function(ab){return{x:(1-V(ab))*X,y:0};}};return S[this._direction];},_getMaxAxisPos:function(T){var W=T._getDrawBounds(),S=W.width,V=W.height;var U={topBottom:{y:V,x:0},bottomTop:{y:0,x:0},leftRight:{x:S,y:0},rightLeft:{x:0,y:0}};return U[this._direction];},_getBoundsPart:function(S,Z,T){var aa=Z/T,ab=1-((Z+1)/T),X=1/T,Y={leftRight:aa,rightLeft:ab,topBottom:aa,bottomTop:ab}[this._direction],V={left:Y,top:0,width:X,height:1},W={left:0,top:Y,width:1,height:X},U={bottom:V,top:V,left:W,right:W}[this._side];return{left:S.left+(S.width*U.left),top:S.top+(S.height*U.top),width:S.width*U.width,height:S.height*U.height};},_clearDraw:function(){var S=m.superclass._clearDraw;S.call(this);this._drawElements={};},_draw:function(){if(!this.getVisible()){return undefined;}var T=this._getLayout();var S=k(T.displayZones,function(W,U,V){W[V]=this._drawSerieZone(V);return W;},{},this);return function(V){function U(){a(S,function(X){X(V);});}function W(){var X=T.displayZoneIndexes;S[X[0]](V);}if(V==="description"){W();}else{U();}};},_addCustomDrawElements:function(T,S){var U=this.hasHandlersForEvent("onElementCustomDraw")&&this._notify.apply(this,["onElementCustomDraw"].concat(S));return U?T.concat(o(U)):T;},_drawDescrOnEdgeFn:function(U){var V=t.defaultAxisStyle.descriptionPadding,T=this._chart.getCanvas();var S={left:function(X,aa){var Y=T.text(X.left-V,(X.bottom+X.top)/2,aa.description).transform("r-90").attr(aa.descriptionTextStyle);var Z=Y.getBBox(),W=Z.x2-(X.left-V);if(W>0){Y.transform("t-"+W+",0r-90");}return Y;},right:function(X,aa){var Y=T.text(X.right+V,(X.bottom+X.top)/2,aa.description).transform("r90").attr(aa.descriptionTextStyle);var Z=Y.getBBox(),W=X.right+V-Z.x;if(W>0){Y.transform("t"+W+",0r90");}return Y;},top:function(X,aa){var Y=T.text((X.left+X.right)/2,X.top-V,aa.description).attr(aa.descriptionTextStyle);var Z=Y.getBBox(),W=Z.y2-(X.top-V);if(W>0){Y.transform("t0,-"+W);}return Y;},bottom:function(X,aa){var Y=T.text((X.left+X.right)/2,X.bottom+V,aa.description).attr(aa.descriptionTextStyle);var Z=Y.getBBox(),W=X.bottom+V-Z.y;if(W>0){Y.transform("t0,"+W);}return Y;}};return S[U];},_drawSerieZonePrepare:function(ad,Z){var T=ad._getOppositeDrawBounds(),U=T.top+T.height,af=T.left+T.width,Y=ad._getCompiledStyle(),W=this._chart.getCanvas(),aa={bottom:{left:T.left,right:af,top:U,bottom:U},left:{left:T.left,right:T.left,top:T.top,bottom:U},top:{left:T.left,right:af,top:T.top,bottom:T.top},right:{left:af,right:af,top:T.top,bottom:U}}[this._side],ae={left:"right",right:"left",bottom:"top",top:"bottom"},ac=({bottom:function(ah){return{dx:0,dy:ah.top+ah.height-U};},left:function(ah){return{dx:0,dy:T.left-ah.left};},right:function(ah){return{dx:0,dy:ah.left-T.left};},top:function(ah){return{dx:0,dy:U-ah.top-ah.height};}}[this._side]).bind(this);var V=this._drawDescrOnEdgeFn(ae[this._side])(aa,Y),ab=V.getBBox(),S={description:V},ag=["serieZoneDescription",{elements:S,serieZoneIndex:Z,style:Y},W,null];this._drawElements[Z].serieZone={drawEventArgs:ag,elBox:ab,moveFunc:ac,elements:S};var X=this._addCustomDrawElements([V],ag);this._registerElementsBindEvents(X,ag);return X;},_drawSerieZone:function(aC){var Z=this,aA=this._getVisibleSerieZone(aC),an=this._getBoundAxis(),S=this._styleCompiled,ac=this._getNotNullDataRange(),af=aA._getDrawBounds(),aH=aA._getGridDrawBounds(),ao=af.top,ap=af.width,V=af.height,ad=aH.top,Y=aH.left,aj=aH.width,aG=aH.height,ag=this._side,ae=S.labelPadding||t.axisLabelPaddingV,al=S.labelPadding||t.axisLabelPaddingH,aE=this._chart,X=aE.getCanvas(),ah={ticks:"tick",gridLines:"gridLine",labels:"labels"};function ai(){var aL=Z._getAxisPosFromValueFunc(aC),aK=af.width,aN=af.height,aJ=af.left,aM=af.top;var aO={left:function(aP){return{x:aK-1,y:aL(aP).y};},right:function(aP){return{x:0,y:aL(aP).y};},top:function(aP){return{x:aL(aP).x,y:aN-1};},bottom:function(aP){return{x:aL(aP).x,y:0};}};var aI=aO[ag];return function(aP){var aQ=aI(aP);return{x:Math.round(aQ.x+aJ),y:Math.round(aQ.y+aM)};};}var aF=ai();var aw=function(){var aJ=Z._getMaxAxisPos(aA),aI={left:{x:ap-1,y:aJ.y},right:{x:0,y:aJ.y},top:{x:aJ.x,y:V-1},bottom:{x:aJ.x,y:0}},aK=aI[ag];return{x:Math.round(aK.x+af.left),y:Math.round(aK.y+ao)};}();var ab=function(){var aI={left:function(aJ){return{x:Y,y:aJ.y};},right:function(aJ){return{x:Y+aj,y:aJ.y};},top:function(aJ){return{x:aJ.x,y:ad};},bottom:function(aJ){return{x:aJ.x,y:ad+aG};}}[ag];return function(aK){var aJ=aI(aK);return(aJ.x!==aK.x||aJ.y!==aK.y)?aJ:null;};}();var W={left:function(aI,aJ){return{x:aJ.x-ae-(aI.width>>1),y:aJ.y};},right:function(aI,aJ){return{x:aJ.x+ae+(aI.width>>1),y:aJ.y};},top:function(aI,aJ){return{x:aJ.x,y:aJ.y-(aI.height>>1)-al};},bottom:function(aI,aJ){return{x:aJ.x,y:aJ.y+(aI.height>>1)+al};}}[ag];var am={left:function(aI,aJ){aI.x=aJ.x-(aI.width>>1);},right:function(aI,aJ){aI.x=aJ.x-(aI.width>>1);},top:function(aI,aJ){aI.y=aJ.y-(aI.height>>1);},bottom:function(aI,aJ){aI.y=aJ.y-(aI.height>>1);}}[ag];var au=function(){var aJ=function(aL){return[{x:Y,y:aL.y},{x:Y+aj-1,y:aL.y}];},aK=function(aL){return[{x:aL.x,y:ad},{x:aL.x,y:ad+aG-1}];},aI={left:aJ,right:aJ,top:aK,bottom:aK};return aI[ag];}();var ar=this._getLayout().markers,ay=[],U=this._drawElements[aC].markers,aD={getGridLinePoints:au,getLabelPos:W,getGridTickPos:ab};function ak(aN,aJ){function aI(aQ){return["mark",{mark:ar[aQ],serieZoneIndex:aC,elements:ay[aQ].elements,style:ay[aQ].style,axisPoint:ay[aQ].pt},X,aD];}var aL,aM;for(aL=0,aM=ar.length;aL!==aM;aL++){var aP=ar[aL],aO=ay[aL],aK;if(!aO){ay[aL]=aO={style:aE._getAxisMarkStyle(aP.styleCompiled.type),pt:aF(aP.value),elements:{},elementsArray:[]};}aO.elements[ah[aJ]]=null;aK=aN(aP,aO.elements,aO.style,aO.pt,aL,aI);if(aK){aK=o(aK);aO.elementsArray=aO.elementsArray.concat(aK);if(!(aL in U)){U[aL]={drawEventArgs:aI(aL),elementsArray:aO.elementsArray};}Z._registerElementsBindEvents(aK,U[aL].drawEventArgs);}}}function aq(aO,aN){var aL=aO.drawMarker,aK=aL&&aL.drawEventArgs,aJ=aK&&aK[1],aM=aJ&&aJ.elements,aI=aM&&aM[aN];if(aI){aI.isOld=true;delete aM[aN];if(aI.removed){aI=null;}}return aI;}var aa={gridLines:function(aO,aL,aK,aN){var aM,aJ,aI;aM=aO.styleCompiled.gridLine;if(aM){aJ=au(aN);aI=aK.createGridLine(aJ[0],aJ[1],X,aM);aL.gridLine=aI;return aI;}else{return undefined;}},ticks:function(aP,aM,aL,aO){var aN,aK,aI=[],aJ;aN=aP.styleCompiled.axisTick;if(aN){aK=aL.createAxisTick(aO,Z._direction,X,aN);aI.push(aK);aM.tick=aM.tick||{};aM.tick.axis=aK;}if(!an&&(aN=aP.styleCompiled.gridTick)){aJ=ab(aO);if(aJ){aK=aL.createGridAxisTick(aJ,Z._direction,X,aN);aI.push(aK);aM.tick=aM.tick||{};aM.tick.grid=aK;}}return aI;},labels:function(aM,aI,aJ,aQ){var aO,aK,aN,aL,aP;aO=aM.styleCompiled.label;if(aO&&aM.text&&aM.text.length){aL=aq(aM,"label");if(aL){aK=aL;aP=aK.__bbox;}else{aK=aJ.createLabel(aQ,aM.text,X,aO);aP=aK.getBBox();aK.__bbox=aP;}aN=W(aP,aQ);aK.attr(aN);am(aP,aN);aP.x2=aP.x+aP.width;aP.y2=aP.y+aP.height;aI.label=aK;return aK;}else{return undefined;}},custom:function(aN,aL,aK,aM,aJ,aI){return Z.hasHandlersForEvent("onElementCustomDraw")&&Z._notify.apply(Z,["onElementCustomDraw"].concat(aI(aJ)));}};function at(){var aM=aF(ac.min),aL=aw,aK,aI,aJ;if(aM.x===aL.x&&aM.y===aL.y){aL={x:aM.x+1,y:aL.y+1};}aJ=X.path("M"+aM.x+","+aM.y+"L"+aL.x+","+aL.y);if((aK=S.pathStyle)){aJ.attr(aK);}aI=["axisLine",{pointStart:aM,pointEnd:aL,serieZoneIndex:aC,elements:{axisLine:aJ},style:S},X,aD];Z._drawElements[aC].axisLine={drawEventArgs:aI};Z._registerElementsBindEvents(Z._addCustomDrawElements([aJ],aI));}var az=Z._drawDescrOnEdgeFn(this._side);function av(){var aO=Z._drawBounds,aJ={left:aO.left,right:aO.left+aO.width,top:aO.top+aO.height,bottom:aO.top},aN={left:aO.left+aO.width,right:aO.left,top:aO.top,bottom:aO.top+aO.height},aL={left:aN,right:aN,top:aJ,bottom:aJ}[Z._side];function aI(aP){if(aP){var aQ=aP.__bbox||aP.getBBox();aL.left=Math.min(aL.left,aQ.x);aL.right=Math.max(aL.right,aQ.x2);aL.top=Math.min(aL.top,aQ.y);aL.bottom=Math.max(aL.bottom,aQ.y2);}}Z.enumerateElements(function(aP,aQ){if(aP==="mark"){var aR=aQ.elements;aI(aR.label);if(!aR.label){aI(aR.tick&&aR.tick.axis);}}else{if(aP==="axisLine"){aI(aQ.elements.axisLine);}}},aC);var aM=az(aL,S);if(aM){var aK=["description",{elements:{description:aM},serieZoneIndex:aC,style:S},X,aD];Z._drawElements[aC].description={drawEventArgs:aK};Z._registerElementsBindEvents(Z._addCustomDrawElements([aM],aK));}return aM;}function aB(){var aL=aA._getCompiledStyle(),aI;if(aL.backPathStyle){var aK=aA._getOppositeDrawBounds(),aJ=X.rect(aK.left,aK.top,aK.width,aK.height);aJ.attr(aL.backPathStyle);aI=["serieZoneBackground",{serieZoneIndex:aC,elements:{serieZoneBackground:aJ},style:aL.backPathStyle},X];Z._drawElements[aC].serieZoneBackground={drawEventArgs:aI};Z._registerElementsBindEvents(Z._addCustomDrawElements([aJ],aI));}}function ax(){if(aA._getHeaderVisible()){var aK=Z._drawElements[aC].serieZone,aI=aA._getOppositeDrawBounds(),aJ=aK.moveFunc(aI);a(aK.elements,function(aM){var aL=w(aM.transform().concat([["t",aJ.dx,aJ.dy]]),function(aN){return aN[0]+aN.slice(1).join(",");}).join("");aM.transform(aL);aM.toFront();Z._graphSet.push(aM);});}}function T(){for(var aI=0,aJ=ar.length;aI!==aJ;aI++){var aK=ar[aI];if(aK.drawMarker){delete aK.drawMarker;}}}return function(aJ){function aK(){ak(aa[aJ],aJ);}var aL={axisLine:S.pathStyle&&at,description:S.showDescription&&S.description&&av,gridLines:aK,ticks:aK,labels:aK,serieZonesBackground:aB,serieZones:ax,custom:aK,cleanupDraw:T};var aI=undefined;if(aL[aJ]){aI=aL[aJ]();}return aI;};},enumerateElements:function(T,U){var S=this._zonesLayout.zoneIndexes;if(U!==undefined&&!(U in this._drawElements)){throw new Error("Зоны серий в оси с таким индексом нет или она невидима (индекс: "+U+")");}var V=U!==undefined?[U]:S;a(V,function(W){var X=this._drawElements[W];var Y=[];if(X.axisLine){Y.push(X.axisLine);}if(X.serieZone){Y.push(X.serieZone);}a(Y.concat(X.markers),function(Z){T.apply(this,Z.drawEventArgs);},this);},this);}});var e=h.extend({$protected:{_type:undefined,_axisX:null,_axisXZone:0,_axisY:null,_axisYZone:0,_axisXdataField:null,_axisYdataField:null,_styleCompiled:null,_drawElements:{points:[],line:null,back:null},_drawBoundsInvalidateParts:["extraMargin"],_validState:{extraMargin:false,pointLabels:false},_layout:{pointLabels:null,extraMargin:{left:0,top:0,right:0,bottom:0}}},$constructor:function(Z){var aa=this._chart,ab=this;var W="Номер зоны в оси для серии должен быть числом >=0, задано же: ";this._publish("onCustomGenerateSerieLabels");if(Z.onCustomGenerateSerieLabels){this.subscribe("onCustomGenerateSerieLabels",Z.onCustomGenerateSerieLabels);}this._type=Z.type;if(!Z.type){throw new Error("Не задан тип серии (параметр type)");}if(!Z.axisX){throw new Error("Не задана ось X для серии");}if(!Z.axisY){throw new Error("Не задана ось Y для серии");}this._axisXZone=x.parseZoneIdx(Z.axisXZone,W);this._axisYZone=x.parseZoneIdx(Z.axisYZone,W);this._axisX=aa.getAxis(Z.axisX);if(!this._axisX){throw new Error("Задано имя несуществующей оси X для серии: "+Z.axisX);}this._axisY=aa.getAxis(Z.axisY);if(!this._axisY){throw new Error("Задано имя несуществующей оси Y для серии: "+Z.axisY);}this._style=Z.style||{};var S=(typeof this._style==="string")?{baseName:this._style}:this._style;if(Z.description){S.description=Z.description;}this._styleCompiled=aa._getSerieStyleConfig(S.baseName,S,this._type);if(this._type==="bar"){if(this._styleCompiled.linePathStyle){throw new Error('Для серии типа "bar" нельзя задавать свойство linePathStyle');}if(this._styleCompiled.backPathStyle){throw new Error('Для серии типа "bar" нельзя задавать свойство backPathStyle');}if(this._styleCompiled.pointStyle){throw new Error('Для серии типа "bar" нельзя задавать свойство pointStyle');}var T,U,X;T=this._styleCompiled.barWidth;X=String(T).match(/(.+)%$/);if(X){U=parseFloat(String.trim(X[1]));T=undefined;}else{T=parseInt(String.trim(String(T)),10);U=undefined;}if((isNaN(T)&&isNaN(U))||(T<=0||U<=0)){throw new Error("Задан неправильный формат ширины столбика: "+this._styleCompiled.barWidth+". Ширина должна задаваться либо в процентах, либо числом больше нуля.");}this._styleCompiled.barWidth=T;this._styleCompiled.barWidthPercent=U;T=this._styleCompiled.interBarPadding;T=parseInt(String.trim(String(T)),10);if(isNaN(T)||(T<0)){throw new Error("Задан неправильный формат столбика расстояния между столбиками в группе: "+this._styleCompiled.interBarPadding+". Тут должно быть целое число больше нуля.");}this._styleCompiled.interBarPadding=T;}else{if(this._type==="line"){if(this._styleCompiled.barPathStyle){throw new Error('Для серии типа "line" нельзя задавать свойство barPathStyle');}}}var ac,Y;if((ac=Z.axisXdataField)){if(typeof ac!=="string"){throw new Error('Параметр axisXdataField может быть только строчкой. Сложная конфигурация с группировкой столбиков возможна только для параметра axisYdataField для типа серии "bar"');}this._axisX._addDataField(ac);}Y=this._axisX.getDataFields();this._axisXdataField=Z.axisXdataField||(Y.length===1?Y[0]:undefined);if(!this._axisXdataField){throw new Error("Не задано поле данных по оси X для серии. Поле данных по умолчанию из оси X получить нельзя, поскольку там или не заданы поля данных, или их больше, чем одно");}function V(){var ak=ab._axisY,ai=ak.getDataFields(),ad,ah,aj,ag,af;function ae(al){if(typeof al==="string"){al={name:al};}if(typeof al.name!=="string"){throw new Error("Не задан параметр name у определения поля (он должен быть строкой): "+JSON.stringify(al));}if(al.style===undefined){al.style={};}else{if(typeof al.style==="string"){al.style={baseName:al.style};}}var an=al.style.baseName||ab._styleCompiled;al.style=aa._getSerieStyleConfig(an,al.style,ab._type);for(var am in al.style){if(!al.style.hasOwnProperty(am)){continue;}if(am!=="barPathStyle"&&am!=="legendPathStyle"){delete al.style[am];}}return al;}ac=(Z.axisYdataField||Z.axisYdataFields);if(ac){if(typeof ac!=="string"&&ab._type!=="bar"){throw new Error('Параметр axisYdataField для серии с типом "line" может быть только строчкой. Сложная конфигурация с группировкой столбиков возможна только для типа серии "bar"');}}else{ac=(ai.length===1?ai[0]:undefined);}ad=ab._axisYdataField=o(ac);for(ag in ad){if(!ad.hasOwnProperty(ag)){continue;}if(ad[ag].stack===undefined){ad[ag]=ae(ad[ag]);ak._addDataField(ad[ag].name);}else{ah=ad[ag].stack;if(!(ah instanceof Array)){throw new Error("Значение параметра stack должно быть массивом");}aj=[];for(af in ah){if(!ah.hasOwnProperty(af)){continue;}ah[af]=ae(ah[af]);aj.push(ah[af].name);}ak._addDataField({sum:aj});}}if(ab._axisYdataField.length===0){throw new Error("Не заданы настройки поля (полей) данных по оси Y для серии. Поле данных по умолчанию из оси Y получить нельзя, поскольку там или не заданы поля данных, или их больше, чем одно");}}V();this._axisX._addSerieToZone(this,this._axisXZone);this._axisY._addSerieToZone(this,this._axisYZone);},_clearDraw:function(){var S=e.superclass._clearDraw;S.call(this);this._drawElements.points=[];this._drawElements.bars=[];this._drawElements.labels=[];this._drawElements.line=null;this._drawElements.back=null;},_getSerieBounds:function(){var X=this._axisXZone,ab=this._axisX._getVisibleSerieZone(X),T=this._axisYZone,Z=this._axisY._getVisibleSerieZone(T),W=l(ab._getGridDrawBounds()),V=l(Z._getGridDrawBounds()),U=Math.max(W.left,V.left),aa=Math.min(W.right,V.right),Y=Math.max(W.top,V.top),S=Math.min(W.bottom,V.bottom);return{left:U,right:aa,top:Y,bottom:S,width:aa-U,height:S-Y};},_getLayout:function(){var S=this;function V(X){function W(Y){if(L(Y)||r(Y)){Y={top:Y};}a(["top","underTop","underTopHint","left","right"],function(aa){if(Y[aa]){var ab,ac,Z=o(Y[aa]);for(ab=0,ac=Z.length;ab!==ac;ab++){if(L(Z[ab])){Z[ab]={value:Z[ab]};}if(!Z[ab].style){Z[ab].style=t.defaultSerieLabelStyle;}else{if(typeof Z[ab].style==="string"){Z[ab].style=S._chart._getSerieLabelsStyleConfig(Z[ab].style);}else{Z[ab].style=S._chart._getSerieLabelsStyleConfig(Z[ab].style.baseName,Z[ab].style);}}}Y[aa]=Z;}});return Y;}return w(o(X),function(Y){return{stack:w(Y.stack||[Y],W)};});}if(!this._validState.pointLabels){var T=this._notify("onCustomGenerateSerieLabels",this._chart._chartData)||[];this._layout.pointLabels=w(T,V,this);this._validState.pointLabels=true;}if(!this._validState.extraMargin){var U=l(this._getSerieBounds());this._draw()("labelsPrepare");this._layout.extraMargin=k(this._drawElements.labels,function(X,W){var Y=W.elBox;X.left=Math.max(X.left,U.left-Y.x);X.top=Math.max(X.top,U.top-Y.y);X.right=Math.max(X.right,Y.x2-U.right);X.bottom=Math.max(X.bottom,Y.y2-U.bottom);return X;},{left:0,top:0,right:0,bottom:0});this._clearDraw();this._validState.extraMargin=true;}return this._layout;},_getExtraMargin:function(){return this._getLayout().extraMargin;},_draw:function(){if(!this.getVisible()){return undefined;}var ad=this,ab=this._chart.getCanvas(),Z=this._axisX,W=this._axisY,aG=this._axisXZone,aK=this._axisYZone,ak=this._axisX._getVisibleSerieZone(aG),X=this._axisY._getVisibleSerieZone(aK),ag=this._axisXdataField,V=this._axisYdataField,an=Z._getDataIntf(),am=W._getDataIntf(),aN=Z._getAxisPosFromValueFunc(aG),aC=W._getAxisPosFromValueFunc(aK),az=Z.getDataFormat(),ay=W.getDataFormat(),aH=Z._getAxisInternalGridLineMapFn(aG,X,aK),au=Number(X._getGridDrawBounds().top),T=Number(ak._getGridDrawBounds().left),aD=this._styleCompiled,ax=[],ac=[],Y,ae={x:undefined,y:undefined},aF={x:undefined,y:undefined},aA=t.defaultSerieStyle.bar.barWidthMin,aB=true,aj=this._layout.pointLabels||[],aM;var at=function(){var aQ=$(ab.canvas).parent(),aP=aQ.offset(),aR={left:aP.left,top:aP.top,width:aQ.width(),height:aQ.height()};at=function(){return aR;};return aR;};function aO(){var a9,a8,a7,aT,aX,aZ,a0,aP,aU,aV,ba,bb,aW,a3,aS,a6,aY,a2,aR,aQ;function a1(bh,bf){var bd=aN(bh),bc=aC(bf),bg=au+bd.y+bc.y,be=T+bd.x+bc.x;return{x:be,y:bg,xf:be,yf:bg};}a2=Math.min(an.getCount(),am.getCount());for(a9=0;a9<a2;a9++){aT=an.getFieldValue(a9,ag);a0=[];aP=[];a3=[];aS=[];aY=[];for(a8=0,aR=V.length;a8!==aR;a8++){aU=V[a8];if(aU.stack){aV=[];ba=[];bb=[];aW=[];aX=undefined;a6=aU.stack;for(a7=0,aQ=a6.length;a7!==aQ;a7++){aZ=am.getFieldValue(a9,a6[a7].name);if(!ay.isBadValue(aZ)){aX=(aX!==undefined)?ay.add(aX,aZ):aZ;aV.push(aZ);ba.push(a1(aT,aX));bb.push(a6[a7].name);aW.push(a6[a7].style);}}if(aV.length>0){a0.push(aV);aP.push(ba);a3.push(bb);aY.push(aW);}}else{aX=am.getFieldValue(a9,aU.name);if(!ay.isBadValue(aX)){a0.push(aX);aP.push(a1(aT,aX));a3.push(aU.name);aY.push(aU.style);}}}if(az.isBadValue(aT)||a0.length===0){continue;}ax.push(aP);ac.push({point:aP,dataPoint:{x:aT,y:a0},dataFields:{x:ag,y:a3},style:aY});}var a5=Z.getDataRangeCalc(),a4=W.getDataRangeCalc();ae=a1(a5.min,a4.max);aF=a1(a5.max,a4.max);}function aJ(aQ){Y=new Array(ax.length);for(var aP=0;aP<ax.length;aP++){Y[aP]=aP;}Y.sort(function(aS,aR){return ax[aS][0].x-ax[aR][0].x;});aJ=function(aR){return Y[aR];};return Y[aQ];}aO();if(ax.length>0){aB=(ax[0].x===aH(ax[0]).x);}function aq(aT,aR){if(aR.length<2){return aT;}var aU=aR[0][0],aP=aR[aR.length-1][0],aQ=aH(aU),aS=aH(aP);aT=["M",aQ.x,aQ.y,"L",aU.x,aU.y].concat(aT,"L",aS.x,aS.y,"L",aQ.x,aQ.y);return aT;}function aw(aR,aP){if(aR.length<2){return null;}var aQ,aS=["M",Math.round(aR[0][0].x),Math.round(aR[0][0].y)];for(aQ=1;aQ<aR.length;aQ++){aS=aS.concat(["L",Math.round(aR[aQ][0].x),Math.round(aR[aQ][0].y)]);}if(aP){aS=aq(aS,aR);}return ab.path(aS);}function ar(aW,aP){if(aW.length<3){return null;}var aX=["M",aW[0][0].x,aW[0][0].y,"C"],aQ,aT,aU,aS,aV,aR;for(aR=1;aR<aW.length;aR++){aQ=aW[aR-1][0].x;aT=aW[aR][0].x;aU=aW[aR-1][0].y;aS=aW[aR][0].y;aV=(aT-aQ)*0.5;aX=aX.concat([aQ+aV,aU,aT-aV,aS,aT,aS]);}if(aP){aX=aq(aX,aW);}return ab.path(aX);}var aa={circle:function(aQ,aP){return ab.circle(aQ.x,aQ.y,aP.r).attr(aP);}};function aI(aP,aQ,aS,aT){var aR=3;if(aB){return function(bd,bl,a2,aZ,aY,aW,aV,bh,ba){var bg,bf,be,a7,aX,a4,bj,bk,bb,a6,a1,aU,a0,a5,bi,a9,a8=[],a3,bc;bj=a2.x-(aW/2);for(bg=0,a7=bd.length;bg!==a7;bg++){a4=o(bd[bg]);a1=o(bl.dataPoint.y[bg]);aU=o(bl.dataFields.y[bg]);a0=o(bl.style[bg]);a3=[];bk=a2;bk.yf=bk.y;for(bf=0,aX=a4.length;bf!==aX;bf++){bb=a4[bf];bc=bb.yf<=bk.yf?1:-1;if((bk.yf-bb.yf)*bc<aR){a6=bb.yf-(bk.y-aR*bc);for(be=bf;be!==aX;be++){a4[be].yf-=a6;a4[be].y=a4[be].yf;}}a9=aP(ba,bg,bf,a0[bf],[{x:bj,y:bk.y},{x:bj,y:bb.y,yf:bb.yf},{x:bj+aZ,y:bb.y},{x:bj+aZ,y:bk.y}]);if(a9!==null){a5={x:bl.dataPoint.x,y:a1[bf]};bi={x:bl.dataFields.x,y:aU[bf]};a9.dataPoint=a5;a9.dataFields=bi;a9.style=a0[bf];a3.push(a9);}bk=bb;}a8=a8.concat(a3);if(aS){a8=a8.concat(aS(ba,bg,a3,aZ,bc));}bj+=(aZ+bh.interBarPadding);}return a8;};}else{return function(bc,bj,a2,aZ,aY,aW,aV,bf,a9){var be,bd,a6,aX,a4,bh,bi,bb,ba,a1,aU,a0,a5,bg,a8,a7=[],a3;bh=a2.y-(aV/2);for(be=0,a6=bc.length;be!==a6;be++){a4=o(bc[be]);a1=o(bj.dataPoint.y[be]);aU=o(bj.dataFields.y[be]);a0=o(bj.style[be]);bi=a2;a3=[];for(bd=0,aX=a4.length;bd!==aX;bd++){ba=a4[bd];bb=["M",bi.x,bh,"L",ba.x,bh,"L",ba.x,bh+aY,"L",bi.x,bh+aY];a8=aQ(a9,be,bd,a0[bd],[{x:bi.x,y:bh},{x:ba.x,xf:ba.xf,y:bh},{x:ba.x,y:bh+aY},{x:bi.x,y:bh+aY}]);if(a8!==null){a5={x:bj.dataPoint.x,y:a1[bd]};bg={x:bj.dataFields.x,y:aU[bd]};a3.push({el:a8.el,dataPoint:a5,dataFields:bg,elBox:a8.elBox,style:a8.style});}bi=ba;}a7=a7.concat(a3);if(aT){a7=a7.concat(aT(a3,aY));}bh+=(aY+bf.interBarPadding);}return a7;};}}function aE(aP,aW,aT,aS,aR){var aU=["M",aR[0].x,aR[0].y,"L",aR[1].x,aR[1].y,"L",aR[2].x,aR[2].y,"L",aR[3].x,aR[3].y],aQ=ab.path(aU),aV=aS.barPathStyle;aQ.attr(aV[aP]||aV[0]||aV);return{el:aQ,style:aS};}function av(aW,a0,aX,a2,aR){var aV=20,aS=aV/2;function aQ(a4,a5){var a3=k(a4,function(a7,bb,a6){var a9,ba=a7.length-1,a8=bb.bounds[a5];if(ba<0||a8>aV){a7.push({cnt:1,start:a6,overIds:bb.overflow?[a6]:[]});}else{a9=a7[ba];a9.cnt+=1;if(bb.overflow){a9.overIds.push(a6);}}return a7;},[]);return F(a3,function(a6){return a6.overIds.length>0;});}function aZ(a3){var a5=p(aX[a3.overIds[0]].elBox),a4=k(a3.overIds.slice(1),function(a6,a8){var a7=aX[a8].elBox;a6.x=Math.min(a6.x,a7.x);a6.x2=Math.max(a6.x2,a7.x2);a6.y=Math.min(a6.y,a7.y);a6.y2=Math.max(a6.y2,a7.y2);return a6;},a5);a4.width=a4.x2-a4.x;a4.height=a4.y2-a4.y;return a4;}function aP(ba,a9,bh){var a6=this,bb=10,a5,a4,a8,a7,bg,bf,bi,bd=at();if(a6.__hintSet){return;}a5=k(bh.overIds,function(bl,bm){var bk=aX[bm].getAllHeight();return bl+bk.top+bk.underTop;},bb/2);a4=k(bh.overIds,function(bk,bl){return Math.max(aX[bl].getAllWidth(),bk);},a2);ab.setStart();a7=a4+bb;a8=a5+bb;bg=ba;bf=a9;if(bd.width-bg<a7){bg=ba-a7;}if(bd.height-bf<a8){bf=a9-a8;}var a3=ab.rect(bg,bf,a7,a8-bb/2,5).attr(aD.hintPathStyle);bi={x:bg+bb/2,y:bf+(aR===1?a5:bb/2)};k(bh.overIds,function(bp,bq){var bl=aX[bq].getAllHeight(),bo=aX[bq].style,bk=bp.x+a4,bm=bp.y-bl.underTop*aR,bn=[bp,{x:bp.x,y:bm,yf:bm},{x:bk,y:bm},{x:bk,y:bp.y}];bp.yf=bp.y;aE(aW,a0,bq,bo,bn);U(aW,a0,bq,bo,bn,true);bp.y-=(bl.top+bl.underTop)*aR;return bp;},bi);a6.__hintSet=ab.setFinish();var bj=function(){a6.__hintShown=false;a6.__lastMouseMove=null;a6.__hintSet.remove();a6.__hintSet=null;};var bc=function(bk,bl){var bm=a6.getBBox(),bo=a3.getBBox(),bn=2;return(bk<bm.x||bk>bm.x2||bl<bm.y||bl>bm.y2)&&(bk<(bo.x+bn)||bk>(bo.x2-bn)||bl<(bo.y+bn)||bl>(bo.y2-bn));};a6.mouseout(function be(bm){if(a6.__hintShown){N(bm);if(a6.__lastMouseMove){clearTimeout(a6.__lastMouseMove);a6.__lastMouseMove=null;}var bk=bm.pageX-bd.left,bl=bm.pageY-bd.top;if(bc(bk,bl)){bj();a6.unmouseout(be);}}});a3.mouseout(function(bm){if(a6.__hintShown){N(bm);var bk=bm.pageX-bd.left,bl=bm.pageY-bd.top;if(bc(bk,bl)){bj();}}});}function aY(a3,a4){return k(a3,function(a6,a8){var a9=a8.overIds.length,a5,bc;if((a9===1)===a4){var bb=aZ(a8);if(bb.width<aV){a5=(bb.x2-bb.x)/2;bb.x=a5-aS;bb.x2=a5+aS;bb.width=bb.x2-bb.x;}if(bb.height<aV){bc=(bb.y+bb.y2)/2;bb.y=bc-aS;bb.y2=bc+aS;bb.height=bb.y2-bb.y;}var ba=ab.rect(bb.x,bb.y,bb.width,bb.height).attr(t.hintOverRectAttrs),a7=function(){if(ba.__lastMouseMove){clearTimeout(ba.__lastMouseMove);ba.__lastMouseMove=null;}};ba.mousemove(function(bd){N(bd);a7();ba.__lastMouseMove=setTimeout(function(){ba.__lastMouseMove=null;if(!ba.__hintShown){var bf=at(),be=bd.pageX-bf.left,bg=bd.pageY-bf.top;ba.__hintShown=true;aP.call(ba,be,bg,a8);}},200);});ba.mouseout(a7);a6.push({el:ba,elBox:bb,isHiddenForApi:true});}return a6;},[]);}var aT=aQ(aX,"height"),aU=aY(aT,true),a1=aY(aT,false);return aU.concat(a1);}function U(a3,aY,a6,a8,a9,aR){var aX={left:Math.min(a9[0].x,a9[1].x,a9[2].x,a9[3].x),right:Math.max(a9[0].x,a9[1].x,a9[2].x,a9[3].x),top:Math.min(a9[0].y,a9[1].y,a9[2].y,a9[3].y),bottom:Math.max(a9[0].y,a9[1].y,a9[2].y,a9[3].y)},be=aj[a3],a1=(be[aY]||be[0]).stack,aV=a1[a6]||a1[0],aU,a0=0,ba,aQ,bg,bd,aZ={x:aX.left,y:aX.top,x2:aX.right,y2:aX.bottom,width:0,height:0},a5=a9[1].yf<=(a9[0].yf||a9[0].y)?1:-1,aP=false,aW=5,bf=8,a2=12;aX.width=aX.right-aX.left;aX.height=aX.bottom-aX.top;aU=aX.width/2;bd=aX.width!==0;function aT(bi,bk,bj,bh){aZ.x=Math.min(bi,aZ.x);aZ.x2=Math.max(bi+bj,aZ.x2);aZ.y=Math.min(bk,aZ.y);aZ.y2=Math.max(bk+bh,aZ.y2);}function aS(){var bh={top:0,underTop:0},bk=0,bj;function bi(bn,bm){var bo,br,bl,bq,bp,bs;bn=bn||[];for(bo=0,br=bn.length;bo!==br;bo++){bl=bn[bo];bq=bl.style&&bl.style.textStyle;bp=ab.text(0,0,bl.value).attr(bq||{});bs=bp.getBBox();bh[bm]+=bs.height;bk=Math.max(bk,bs.width);bp.remove();}}bi(aV.top,"top");bi(aV.underTop,"underTop");bi(aV.underTopHint,"underTop");bj={height:bh,width:bk};aS=function(){return bj;};return bj;}function bc(){return aS().height;}function a4(){return aS().width;}function a7(bB,bw,bu,by,bx,bE,bF){var bD,bv,bi,bj,br,bG,bp,bh,bC,bl,bA,bn,bt,bH,bk,bJ,bo=0,bm=[],bq=bu;function bs(bK,bO,bL){var bM=bO+(bf*a5)/2,bN;if(bM<aX.bottom&&bM>aX.top){bN=ab.path("M"+(bK+1-a2/2)+","+bM+"L"+(bK+1+a2/2)+","+bM).attr(bL);bm.push(bN);}bA=bf/2;return bM;}function bI(bK){var bL=(bD!==bv-1)?bf:0;bu=bk;bj=bi.getBBox();bA=bj.height/2;bn=bj.width/2;bp=bK?a0+bA:0;bu=bu+bx*bp;bh=bF&&(bj.width>aX.width);bt=a5===1?aX.bottom-(bu-bA):(bu+bA)-aX.top;bC=bF&&(bt<(bj.height+bL));}function bz(){bu=bk;bA=0;bi.remove();if(bv>1){bu=bs(bw,bk,bJ);}}bl=0;for(bD=0,bv=bB.length;bD!==bv&&bl===0;bD++){br=bB[bD];bG=br.style&&br.style.textStyle;bJ=br.style&&br.style.overflowStyle;if(bG&&bG.fill){bJ.stroke=bG.fill;}bi=ab.text(bw,bu,br.value);if(bG){bi.attr(bG);}bk=bu;bI(true);if(bh||bC){aP=true;if(bC){bl++;}if(bt>=aW){if(bh){bz();}else{bH=br.value.split("\n");while(bH.length>0){bH=bH.slice(0,bH.length-1);if(bH.length>0){bi.attr({text:bH.join("\n")});bI(true);if(bt>=(bj.height+bf)){break;}}}bH=bH.join("\n");if(bH){bo++;bi.attr({x:bw,y:bu});bu=bs(bw,bu+bA,bJ);}else{bz();}}}else{bu=bk;bA=0;bi.remove();}}else{bo++;bi.attr({x:bw,y:bu});aT(bw-bn,bu-bA,bj.width,bj.height);}bu=bu+bx*bA;}if(bo===0){a(bm,function(bK){bK.remove();});bu=bq;}return bu;}function bb(bj,bq,bn,bs){var bi,bm,bp,bh,bl,bo=2,br,bk;bq+=(bs*bo);for(bi=0,bm=bj.length;bi!==bm;bi++){bp=bj[bi];aD=bp.style&&bp.style.textStyle;bh=ab.text(bq,bn,bp.value);if(aD){bh.attr(aD);}bl=bh.getBBox();br=bl.width/2;bk=bl.height/2;bh.attr({x:bq+bs*br});aT(bq+(bs*br*2),bn-bk,bl.width,bl.height);bq=bq+bs*(bl.width+bo);}return bq;}if(!aR){ab.setStart();}if(aB){ba=aX.left+aU;aQ=a5===1?aX.top:aX.bottom;a7(aV.top||[],ba,aQ,0,-a5,null,false);if(aR){aQ=a7(aV.underTopHint||[],ba,aQ,0,a5,null,bd);}a7(aV.underTop||[],ba,aQ,0,a5,null,bd);if(!aR){bb(aV.left||[],aZ.x,aQ,-1);bb(aV.right||[],aZ.x2,aQ,1);}}if(!aR){bg=ab.setFinish();}aZ.x-=a0;aZ.x2+=a0;if(a5===1){aZ.y-=a0;}else{aZ.y2+=a0;}aZ.width=aZ.x2-aZ.x;aZ.height=aZ.y2-aZ.y;return{el:bg,elBox:aZ,bounds:aX,overflow:aP,getAllHeight:bc,getAllWidth:a4};}var aL=aI(aE,aE);var ap=aI(U,U,av,av);function ao(aY,a3,aS){var a2=aJ(aY),a1=ax[a2],a8=ac[a2],aR,aQ,aV,aU,aZ,a6=ax.length-1,a9,a7,aT,aX,aW,a5,a4;function aP(bd,bc){var bb=Math.max(Math.min(Math.abs(bd),Math.abs(bc))*a3.barWidthPercent/100,aA);if(a1.length>1){return[bb,(bb-(a3.interBarPadding*(a1.length-1)))/a1.length];}else{return[bb,bb];}}function a0(bb){var bc=(bb[0] instanceof Array)?bb[0][0]:bb[0];return aH(bc);}aT=a0(a1);if(a3.barWidthPercent!==undefined){a9=(a2<a6)?a0(ax[a2+1]):null;a7=(a2>0)?a0(ax[a2-1]):null;if(a9===null&&a7===null){aX=aW=aF.x-ae.x;a5=a4=aF.y-ae.y;}else{if(a9===null){aX=aW=aT.x-a7.x;a5=a4=aT.y-a7.y;}else{if(a7===null){aX=aW=a9.x-aT.x;a5=a4=a9.y-aT.y;}else{aX=aT.x-a7.x;aW=a9.x-aT.x;a5=aT.y-a7.y;a4=a9.y-aT.y;}}}aZ=aP(aX,aW);aV=aZ[0];aR=aZ[1];aZ=aP(a5,a4);aU=aZ[0];aQ=aZ[1];}else{aV=aU=aR=aQ=(a3.barWidth||0);}var ba=o(aS(a1,a8,aT,aR,aQ,aV,aU,a3,aY));a(ba,function(bb){bb.idx=a2;});return ba;}var af={points:function(aQ,aS){var aT,aR,aP;if((aT=aa[aS.element])){aR=ac[aQ];aP=aS.elementStyle;return{el:aT(ax[aQ][0],aP[aQ]||aP[0]||aP),idx:aQ,style:aS,dataPoint:{x:aR.dataPoint.x,y:aR.dataPoint.y[0]},dataFields:{x:aR.dataFields.x,y:aR.dataFields.y[0]}};}else{return undefined;}},labels:function(aP,aQ){return ao(aP,aQ,ap);},bars:function(aP,aQ){return ao(aP,aQ,aL);}};function al(aQ,aS){var aP={points:"point",bars:"bar",labels:"label"},aT=af[aQ],aR=aP[aQ];return k(ax,function(aU,aV,aW){var aX=w(o(aT(aW,aS)),function(aZ){var aY={element:aZ.el,elBox:aZ.elBox};if(!aZ.isHiddenForApi){var a0={elements:{},index:aZ.idx};a0.elements[aR]=aZ.el;a0.dataPoint=aZ.dataPoint;a0.dataFields=aZ.dataFields;a0.style=aZ.style;aY.drawEventArgs=[aR,a0,ab,aM];}return aY;});return aU.concat(aX);},[]);}var ah=(aD.smooth&&ax.length>2)?ar:aw;function S(){var aP;if(aj.length>0){aP=al("labels",aD);}else{aP=[];}ad._drawElements.labels=aP;return aP;}var ai={line:aD.linePathStyle&&function(){var aQ=ah(ax,false);if(aQ){aQ.attr(aD.linePathStyle);var aP=["line",{elements:{line:aQ},style:aD},ab,aM];ad._drawElements.line={drawEventArgs:aP};return[{element:aQ,drawEventArgs:aP}];}else{return[];}},back:q(aD.backPathStyle)&&function(){var aQ=ah(ax,true);if(aQ){aQ.attr(aD.backPathStyle);var aP=["back",{elements:{back:aQ},style:aD},ab,aM];ad._drawElements.back={drawEventArgs:aP};return[{element:aQ,drawEventArgs:aP}];}else{return[];}},points:aD.pointStyle&&function(){var aP=al("points",aD.pointStyle);ad._drawElements.points=aP;return aP;},bars:aD.barPathStyle&&function(){var aP=al("bars",aD);ad._drawElements.bars=aP;return aP;},labelsPrepare:S,labels:function(){return S.call(this);},custom:ad._customDrawFn.bind(ad)};return function(aQ){var aP;if(ai[aQ]){aP=ai[aQ]();a(o(aP),function(aR){ad._registerElementsBindEvents([aR.element],aR.drawEventArgs);});}return aP;};},getDescription:function(){return this._styleCompiled.description;},getCompiledStyle:function(){return p(this._styleCompiled);},_getLegendProps:function(){var T=this,W=this._styleCompiled;function V(Y){if(!Y){return undefined;}var Z=Y.fill||Y.stroke;return i(p(Y),{stroke:Z});}function U(ab,Y){var aa,Z,ad,ac;aa=ab.description||T.getDescription();if(ab.style.legendPathStyle===false){Z=false;}else{ad=ab.style.barPathStyle;ac=ab.style.pointStyle;Z=i(ab.style.linePathStyle||V(ad[0]||ad||(ac[0]&&ac[0].elementStyle)||(ac&&ac.elementStyle)),ab.style.legendPathStyle||{});}if(aa&&Z){Y.push({description:aa,style:Z});}}if(this._type==="line"){if(W.legendPathStyle){return[{description:this.getDescription(),style:W.legendPathStyle}];}else{return[{description:this.getDescription(),style:W.linePathStyle||V(W.pointStyle&&W.pointStyle.elementStyle)}];}}else{if(this._type==="bar"){var X=this._axisYdataField,S=[];a(X,function(Y){if(Y.stack){a(Y.stack,function(Z){U(Z,S);});}else{U(Y,S);}});return S;}else{return[];}}},enumerateElements:function(S){var T=this._drawElements,U=[T.line,T.back].concat(T.points||[],T.bars||[]);a(U,function(V){if(V&&V.drawEventArgs){S.apply(this,V.drawEventArgs);}},this);}});var K=h.extend({$protected:{_axisX:null,_axisXZone:null,_axisXParsedRange:null,_axisY:null,_axisYZone:null,_axisYParsedRange:null,_styleCompiled:null,_drawElements:{back:null,description:null},_drawBoundsInvalidateParts:["ranges","drawing"],_validState:{ranges:false,drawing:false,permanentElements:false},_layout:{rangeX:null,rangeY:null,extraMargin:{left:0,top:0,right:0,bottom:0},drawer:null},_sideCalc:null,_description:null},$constructor:function(ab){var ad=this._chart;if(!ab.axisX){throw new Error("Не задана ось X для области");}if(!ab.axisY){throw new Error("Не задана ось Y для области");}var aa="Номер зоны в оси для области должен быть числом >=0, задано же: ";this._axisXZone=(ab.axisXZone!==undefined&&x.parseZoneIdx(ab.axisXZone,aa))||null;this._axisYZone=(ab.axisXZone!==undefined&&x.parseZoneIdx(ab.axisYZone,aa))||null;this._axisX=ad.getAxis(ab.axisX);if(!this._axisX){throw new Error("Задано имя несуществующей оси X для области: "+ab.axisX);}this._axisY=ad.getAxis(ab.axisY);if(!this._axisY){throw new Error("Задано имя несуществующей оси Y для области: "+ab.axisY);}this._style=ab.style||{};var S=(typeof this._style==="string")?{baseName:this._style}:this._style;this._description=ab.description;var W=ab.rangeX||t.defaultRangeArea.rangeX,V=ab.rangeY;this._axisXParsedRange=this._axisX._rangeParser.parseRangeLink(W);this._axisYParsedRange=this._axisY._rangeParser.parseRangeLink(V);var U=this._getStartZoneIdx(this._axisXZone),Z=this._getEndZoneIdx(this._axisXZone,this._axisX),T=this._getStartZoneIdx(this._axisYZone),Y=this._getEndZoneIdx(this._axisYZone,this._axisY);this._axisX._addRangeAreaToZones(this,U,Z-U+1,this._axisXParsedRange);this._axisY._addRangeAreaToZones(this,T,Y-T+1,this._axisYParsedRange);this._styleCompiled=ad._getRangeAreaStyleConfig(S.baseName,S);var ac=this._styleCompiled.descriptionStyle.side,X=this._styleCompiled.descriptionStyle.sidePosition;this._descrSide=ac;this._descrSideHV=t.directionHV[t.defaultDirectionForSide[ac]];this._sideCalc=v(ac,X,"Задан неправильный параметр side у области. "+ac+" Он должен быть одним из вариантов: left/right/top/bottom.","Задан неправильный параметр sidePosition у области. "+X+" Он должен быть одним из вариантов: start/center/end.");},_getStartZoneIdx:function(S){return S!==null?S:0;},_getEndZoneIdx:function(T,S){return T!==null?T:(S._getVisibleSerieZonesCount()-1);},_getLayout:function(V){var aa=this;function X(){function ac(aC,av,ap,ar){av=av!==null?av:0;var at=aa._getStartZoneIdx(aC),aH=aa._getEndZoneIdx(aC,ap),aG=ap._getVisibleSerieZone(at),aq=ap._getVisibleSerieZone(aH),aA=aG._getGridDrawBounds().top,au=aG._getGridDrawBounds().left,ao=aq._getGridDrawBounds().top,aF=aq._getGridDrawBounds().left,aB=ar._getVisibleSerieZone(av),ax=ap._getAxisPosFromValueFunc(at),aw=ap._getAxisInternalGridLineMapFn(at,aB,av),az=ap._getAxisPosFromValueFunc(aH),ay=ap._getAxisInternalGridLineMapFn(aH,aB,av),aE=function(aJ){var aI=ax(aJ);aI.x+=au;aI.y+=aA;return aw(aI);},aD=function(aJ){var aI=az(aJ);aI.x+=aF;aI.y+=ao;return ay(aI);};return{zoneStart:aG,zoneEnd:aq,startPosFn:aE,endPosFn:aD,idxStart:at,idxEnd:aH};}function al(aq,ap){var ar=aq.startPosFn(ap.min),ao=aq.endPosFn(ap.max);return{left:Math.min(ar.x,ao.x),width:Math.abs(ar.x-ao.x),top:Math.min(ar.y,ao.y),height:Math.abs(ar.y-ao.y)};}var ah=aa._layout,ad=aa._chart.getCanvas(),ak=ac(aa._axisXZone,aa._axisYZone,aa._axisX,aa._axisY),aj=ac(aa._axisYZone,aa._axisXZone,aa._axisY,aa._axisX),af=al(ak,ah.rangeX),ae=al(aj,ah.rangeY),ai={left:Math.min(af.left,ae.left),top:Math.min(af.top,ae.top),width:Math.max(af.width,ae.width),height:Math.max(af.height,ae.height)},ab=aa._styleCompiled,an={descriptionPrepare:true},ag=aa._sideCalc.getSideRotate(),am={back:q(ab.backPathStyle)&&function(){var ap=ad.rect(ai.left,ai.top,ai.width,ai.height).attr(ab.backPathStyle),ao=["back",{elements:{back:ap},style:ab},ad];aa._drawElements.back={drawEventArgs:ao};return{element:ap,drawEventArgs:ao};},descriptionPrepare:aa._description&&ab.descriptionStyle&&function(){var ap=ad.text(0,0,aa._description).attr(ab.descriptionStyle.textStyle),ao=["description",{elements:{description:ap},style:ab},ad];if(ag){ap.transform("r"+ag);}ap.__bbox=ap.getBBox();ap.__pt0={x:0,y:0};aa._drawElements.description={element:ap,drawEventArgs:ao};return aa._drawElements.description;},description:function(){aa._getLayout({permanentElements:true});if(aa._drawElements.description){var aq=aa._drawElements.description.element,au=aq.__pt0,at=aa._sideCalc.getStartPoint(ai),ao=aq.__bbox.width,ap=aq.__bbox.height,ar;aq.__bbox.x=at.x-ao/2;aq.__bbox.y=at.y-ap/2;aq.__bbox.x2=aq.__bbox.x+ao;aq.__bbox.y2=aq.__bbox.y+ap;ar=aa._sideCalc.getPositionElementOnSideDiff(aq.__bbox,ai,ab.descriptionStyle.sidePadding||0);at.x+=ar.x;at.y+=ar.y;if(au.x!==at.x||au.y!==at.y){aq.attr({x:at.x,y:at.y});aq.__pt0=at;}}},custom:aa._customDrawFn.bind(aa)};ah.coordBounds=ai;return function(ap){var ao=am[ap]&&am[ap](),aq=an[ap];if(ao){a(o(ao),function(ar){aa._registerElementsBindEvents([ar.element],ar.drawEventArgs,aq);});}};}function S(ac,ab){var ad=ac.getDataRangeCalc();return ac._rangeParser.parsedRangeToDataRange(ab,ad,ad);}if(this._needValidatePart(V,"permanentElements")){this._getLayout({ranges:true}).drawer("descriptionPrepare");this._validState.permanentElements=true;}if(this._needValidatePart(V,"ranges")){this._layout.rangeX=S(this._axisX,this._axisXParsedRange);this._layout.rangeY=S(this._axisY,this._axisYParsedRange);this._layout.drawer=X();this._validState.ranges=true;}if(this._needValidatePart(V,"drawing")){this._getLayout({ranges:true}).drawer("description");var U=this._layout.extraMargin,W=this._axisYParsedRange;if(aa._drawElements.description&&(W[0].valuePercent===0||W[1].valuePercent===100)){var T=aa._drawElements.description.element.__bbox,Y=this._layout.coordBounds,Z=Math.max(0,T.y2-(Y.top+Y.height))+Math.max(0,Y.top-T.y);if(W[0].valuePercent===0){U.bottom=Z;}else{U.top=Z;}}else{U.top=0;U.bottom=0;U.left=0;U.right=0;}this._validState.drawing=true;}return this._layout;},_getExtraMargin:function(){return this._getLayout({drawing:true}).extraMargin;},_draw:function(){return this._getLayout({ranges:true}).drawer;}});$ws.proto.RaphaelChartGraph=$ws.proto.RaphaelAbstractGraph.extend({$protected:{_gridDrawBounds:null,_defaultObjects:{_axesBySide:{left:[],bottom:[],top:[],right:[]},_axes:[],_axesByName:{},_axisMarkStyles:{},_axisMarkStyleConfigs:{},_axisStyleConfigs:{},_serieStyleConfigs:{},_seriesByName:{},_series:[],_legend:null,_style:{},_styleCompiled:{},_rangeAreas:[],_rangeAreaStyleConfigs:{},_serieLabelStyleConfigs:{}},_defaultMarkStyle:null,_chartData:[],_chartDataIntf:null,_stdDataIntf:null,_graphSet:[],_haveObjects:false},$constructor:function(S){this._chartDataIntf=this._getStdDataIntf();this.setConfig(S);},_onComponentChange:function(T,X){if(this._inInternalChange()){return;}var S=this,V;function W(){S.draw();}var U={element:{data:W,visible:W}};V=(U[T]&&U[T][X]);if(V){V();}},setConfig:z(function(S){$ws.core.merge(this._options,S);this._runInternalChange(function(){this._reset();var W,X,T,U=this;this._style=S.style||{};this._styleCompiled=i(p(t.defaultChartStyle),this._style);if(S.margin){this._options.margin.left=parseFloat(S.margin.left)||0;this._options.margin.right=parseFloat(S.margin.right)||0;this._options.margin.top=parseFloat(S.margin.top)||0;this._options.margin.bottom=parseFloat(S.margin.bottom)||0;}a(S.axisMarkStyles,function(Y,Z){T=t.axisMarkStyleTypeMap[Y.type||t.defaultAxisMarkStyleType];if(T===undefined){throw new Error("Неизвестный тип у стиля меток "+Z+": "+Y.type);}if(this._axisMarkStyles[Z]){throw new Error("Стиль меток с именем "+Z+" уже есть в конфиге стилей меток");}X=T();this._axisMarkStyles[Z]=new X(Y);this._axisMarkStyleConfigs[Z]=Y||{};},this);this._defaultMarkStyle=new C();a(S.axisStyles,function(Y,Z){this._axisStyleConfigs[Z]=Y||{};},this);S.axes=S.axes||[];a(S.axes,function(Y){Y.chart=this;T=t.axisStyleTypeMap[Y.type||t.defaultAxisStyleType];if(T===undefined){throw new Error("Неизвестный тип у оси: "+Y.type);}if(Y.name&&this._axesByName[Y.name]){throw new Error("Ось с именем "+Y.name+" уже есть");}X=T();var Z=new X(Y);Z._setDataIntf(this._chartDataIntf);this._axesByName[Y.name]=Z;this._axesBySide[Y.side].push(Z);this._axes.push(Z);},this);S.serieStyles=S.serieStyles||{};a(S.serieStyles,function(Y,Z){this._serieStyleConfigs[Z]=Y;},this);S.serieLabelStyles=S.serieLabelStyles||{};a(S.serieLabelStyles,function(Y,Z){this._serieLabelStyleConfigs[Z]=Y;},this);a(S.series,function(Y){Y.chart=this;T=t.serieTypeMap[Y.type||t.defaultSerieType];if(T===undefined){throw new Error("Неизвестный тип у серии: "+Y.type);}if(Y.name&&this._seriesByName[Y.name]){throw new Error("Серия с именем "+W+" уже есть");}X=T();var Z=new X(Y);if(Z.name){this._seriesByName[Z.name]=Z;}this._series.push(Z);},this);a(this._axes,function(Z,Y){Z._setBoundAxis(S.axes[Y]);Z._checkConfig();Z._preCalcLayout(true);},this);S.rangeAreaStyles=S.rangeAreaStyles||{};a(S.rangeAreaStyles,function(Y,Z){this._rangeAreaStyleConfigs[Z]=Y;},this);this._rangeAreas=w(S.rangeAreas||[],function(Y){Y.chart=this;return new K(Y);},this);this._publish("onPrepareData");if(S.onPrepareData){this.subscribe("onPrepareData",S.onPrepareData);}function V(ab){var aa=U._getLegendConfig(ab,t.defaultLegendStyle);var Z=[];a(U._series,function(ae){var ad=ae.getCompiledStyle();if(ad.showInLegend){var ac=ae._getLegendProps();a(ac,function(af){Z.push(af);});}});var Y=p(aa);Y.legends=Z;Y.chart=U;return new D(Y);}this._legend=V(S.legend);if(S.data){this.setData(S.data);}else{if(this._options.recordSet){this.setRecordSet(this._options.recordSet);}else{if(this._options.dataSource){this.setDataSource(this._options.dataSource,{filterParams:S.filterParams});}}}});this.draw();}),getAxis:function(S){return this._axesByName[S];},getSeries:function(S){return this._seriesByName[S];},_forEachAxes:function(S){a(this._axes,S,this);},_reduceAxes:function(S,T){return k(this._axes,S,T);},_reduceSeries:function(T,S){return k(this._series,T,S);},_invalidateBoundsForAll:function(S){a(S,function(T){T._invalidateDrawBounds();});},_layout:function(){var S=this;this._runInternalChange(function(){a(this._axes,function(Y){Y._preCalcLayout(true);});function V(aj,ac){var ab=!ac,Z=!!ac,Y={left:1,right:1,top:1,bottom:1},ah={left:-1,right:1,top:-1,bottom:1};ac=ac||{left:0,right:0,top:0,bottom:0};function aa(ar,an,at){var aq=S._axesBySide[ar],al=ah[ar],ao=(al===1?[0,aq.length]:[aq.length-1,-1]),ak,ap,am;for(am=ao[0];am!=ao[1];am+=al){ak=aq[am];ap=ak._getBoundAxis();if(an&&ap){ak._setVisibleImplicit(true);at(ak,ap);}else{if(an===undefined||(!an&&!ap)){at(ak,ap);}}}}var ae=function(){var am={left:0,right:0,top:0,bottom:0},an={left:"width",right:"width",top:"height",bottom:"height"},ap={left:"right",right:"left",top:"bottom",bottom:"top"},al={left:{top:1,bottom:1},right:{top:1,bottom:1},top:{left:1,right:1},bottom:{left:1,right:1}},ao={left:aj.left,top:aj.top,width:Math.max(0,aj.width-ac.left-ac.right),height:Math.max(0,aj.height-ac.top-ac.bottom)};S._forEachAxes(function(ar){ar._setVisibleImplicit(true);});a(Y,function(ar,at){aa(at,false,function(aw){var av=aw._getMaxBounds(),ax=an[at],au=av[ax]-1,ay=(am[ap[at]]+am[at]+au)<ao[ax];if(ay&&aw.getVisible()){am[at]+=au;}aw._setVisibleImplicit(ay);});});a(Y,function(ar,at){aa(at,undefined,function(au){var aw=au._getOppositeMaxBounds(),av=an[at];am[ap[at]]+=(aw[av]-1);});});a(Y,function(ar,at){if(S._legend.getSide()!==at){var av=al[at];for(var au in av){if(!av.hasOwnProperty(au)){continue;}if(S._axesBySide[au].length>0){am[at]=Math.max(am[at],t.axisStartEndGap[t.HV_BySide[au]]);break;}}}});ao.left=aj.left+am.left+ac.left;ao.top=aj.top+am.top+ac.top;ao.width=Math.max(0,ao.width-am.left-am.right);ao.height=Math.max(0,ao.height-am.top-am.bottom);var ak,aq;ak=ao.left+1;aa("right",undefined,function(at){var ar=at._getOppositeMaxBounds().width;at._setOppositeDrawBounds({left:ak-ar,top:ao.top,width:ar,height:ao.height});if(at.getVisible()&&ar>0){ak-=(ar-1);}});aa("left",undefined,function(au,ar){var at=au._getMaxBounds().width;au._setDrawBounds({left:ak-at,top:ao.top,width:at,height:ao.height});if(au.getVisible()&&at>0&&!ar){ak-=(at-1);}});ak=ao.left+ao.width;aa("left",undefined,function(at){var ar=at._getOppositeMaxBounds().width;at._setOppositeDrawBounds({left:ak,top:ao.top,width:ar,height:ao.height});if(at.getVisible()&&ar>0){ak+=(ar-1);}});aa("right",undefined,function(au,ar){var at=au._getMaxBounds().width;au._setDrawBounds({left:ak,top:ao.top,width:at,height:ao.height});if(au.getVisible()&&at>0&&!ar){ak+=(at-1);}});aq=ao.top+1;aa("bottom",undefined,function(at){var ar=at._getOppositeMaxBounds().height;at._setOppositeDrawBounds({left:ao.left,top:aq-ar,width:ao.width,height:ar});if(at.getVisible()&&ar>0){aq-=(ar-1);}});aa("top",undefined,function(au,at){var ar=au._getMaxBounds().height;au._setDrawBounds({left:ao.left,top:aq-ar,width:ao.width,height:ar});if(au.getVisible()&&ar>0&&!at){aq-=(ar-1);}});aq=ao.top+ao.height;aa("top",undefined,function(at){var ar=at._getOppositeMaxBounds().height;at._setOppositeDrawBounds({left:ao.left,top:aq,width:ao.width,height:ar});if(at.getVisible()&&ar>0){aq+=(ar-1);}});aa("bottom",undefined,function(au,at){var ar=au._getMaxBounds().height;au._setDrawBounds({left:ao.left,top:aq,width:ao.width,height:ar});if(au.getVisible()&&ar>0&&!at){aq+=(ar-1);}});return{chartR:ao};}.bind(this);ae();S._forEachAxes(function(ak){ak._preCalcLayout(false,Z);});var ai=ae().chartR;S._gridDrawBounds=ai;S._forEachAxes(function(ak){ak._setGridDrawBounds(ai);});var ad=function(){a(Y,function(ak,al){aa(al,true,function(ap,ar){var au=ap._getBoundAxisParams(),an=au.zoneIdx,at=ar._getAxisPosFromValueFunc(an),aq=ar.getDataRangeCalc(),ax=ar.getDataFormat(),ao,av,aw,am;if(aq.min!==null&&aq.max!==null){if(au.valuePercent!==undefined){ao=ax.normalizedToValue(au.valuePercent/100,aq);}else{ao=au.value;}if(au.round!==undefined){ao=ax.roundToInterval(ao,au.round,false);}av=at(ao);aw=ap._getAxisLineDiff();av.x-=aw.x;av.y-=aw.y;}else{av={x:0,y:0};}am=i({left:ai.left+av.x,top:ai.top+av.y,width:ai.width,height:ai.height},ap._getMaxBounds());if(am.left<0){ac.left=Math.max(-am.left,ac.left);}if(am.top<0){ac.top=Math.max(-am.top,ac.top);}ao=ai.left+ai.width-am.left-am.width;if(ao<0){ac.right=Math.max(-ao,ac.right);}ao=ai.top+ai.height-am.top-am.height;if(ao<0){ac.bottom=Math.max(-ao,ac.bottom);}ap._setDrawBounds(am);});},this);}.bind(this);ad();S._invalidateBoundsForAll(S._series);S._invalidateBoundsForAll(S._rangeAreas);var af=function(al,am){var ak=am._getExtraMargin();return{left:Math.max(al.left,ak.left),right:Math.max(al.right,ak.right),top:Math.max(al.top,ak.top),bottom:Math.max(al.bottom,ak.bottom)};};var ag=S._reduceAxes(function(am,al){var ak=al._reduceVisibleZones(function(ao,ap){var an=ap._reduceSeries(af,ao);return ap._reduceRangeAreas(af,an);},{left:0,right:0,top:0,bottom:0});al._setSeriesMargin(ak);return am||(ak.left!==0||ak.right!==0||ak.top!==0||ak.bottom!==0);},false);if(ag){ad();}if(ab&&(ac.left>0||ac.top>0||ac.top>0||ac.bottom>0)){V(aj,ac);}}var W=p(S._options.margin);W.left=Math.max(t.minMargin,W.left);W.right=Math.max(t.minMargin,W.right);W.top=Math.max(t.minMargin,W.top);W.bottom=Math.max(t.minMargin,W.bottom);var T={left:W.left,top:W.top,width:Math.max(0,S._options.width-W.left-W.right),height:Math.max(0,S._options.height-W.top-W.bottom)},U=S._legend._getInsideChart(),X;if(!U){S._legend._setDrawBounds(T);X=S._legend._getLayoutMargin();T.left+=X.left;T.top+=X.top;T.width-=(X.left+X.right);T.height-=(X.top+X.bottom);}V(T);S._invalidateBoundsForAll(S._rangeAreas);if(U){S._legend._setDrawBounds(S._gridDrawBounds);}});},_clearDraw:function(){a(this._graphSet,function(S){S.remove();});this._graphSet=[];a([this._axes,this._series,this._rangeAreas,[this._legend]],function(S){a(S,function(T){T._clearDraw();});});},_clearData:function(){this._chartData=[];},_drawEachVisible:function(T){var S=[];a(T,function(U){if(U.getVisible()){S.push(U._draw());}});return S;},_drawChart:function(){this._clearDraw();this._layout();var Z=this,U=this.getCanvas(),V=this._gridDrawBounds,X=this._styleCompiled,T,S;S=(X.gridFrame&&X.gridFrame.pathStyle);if(S){T=U.rect(V.left,V.top,V.width,V.height);T.attr(S);this._graphSet.push(T);}S=(X.chartFrame&&X.chartFrame.pathStyle);if(S&&this._options.width>0&&this._options.height>0){T=U.rect(0,0,this._options.width-1,this._options.height-1);T.attr(S);this._graphSet.push(T);}var Y={},aa={axis:function(){return Z._drawEachVisible(Z._axes);},series:function(){return Z._drawEachVisible(Z._series);},rangeAreas:function(){return Z._drawEachVisible(Z._rangeAreas);},legend:function(){return[function(){Z._legend._draw();}];}};var W=X.drawPhases;a(W,function(ad){var ab=ad.part;if(!(ab in Y)){Y[ab]=aa[ab]?aa[ab]():[];}var ae=Y[ab],ac=ad.phases;a(ac,function(af){a(ae,function(ag){ag(af);});});});},_getAxisMarkStyle:function(S){var T=this._defaultMarkStyle;return(S?this._axisMarkStyles[S]:T)||T;},_getAxisMarkStyleConfig:function(T){var S;if(!(T&&(S=this._axisMarkStyleConfigs[T]))){S={};}return i(p(t.defaultAxisMarkStyle),S);},_getAxisStyleConfig:function(T){var S;if(!(T&&(S=this._axisStyleConfigs[T]))){S={};}return i(p(t.defaultAxisStyle),S);},_getSerieStyleConfig:function(U,T,S){var V;if(!U||typeof U==="string"){V=(U&&this._serieStyleConfigs[U])||{};V=M(t.defaultSerieStyle[S],V);}else{V=U;}return M(V,T);},_getRangeAreaStyleConfig:function(T,S){var U;if(!T||typeof T==="string"){U=(T&&this._rangeAreaStyleConfigs[T])||{};U=M(t.defaultRangeArea.style,U);}else{U=T;}return M(U,S);},_getSerieLabelsStyleConfig:function(T,S){var U;if(!T||typeof T==="string"){U=(T&&this._serieLabelStyleConfigs[T])||{};U=M(t.defaultSerieLabelStyle,U);}else{U=T;}return M(U,S);},_reset:function(){if(this._haveObjects){this._clearDraw();this._removeAxes();this._removeSeries();this._removeLegend();}for(var S in this._defaultObjects){if(!this._defaultObjects.hasOwnProperty(S)){continue;}this[S]=p(this._defaultObjects[S]);}if(this._options.onPrepareData){this.unsubscribe("onPrepareData",this._options.onPrepareData);}this._haveObjects=true;},_removeAxes:function(){a(this._axes,function(S){S._remove();});},_removeSeries:function(){a(this._series,function(S){S._remove();});},_removeRangeAreas:function(){a(this._rangeAreas,function(S){S._remove();});},_removeLegend:function(){if(this._legend){this._legend._remove();}},_remove:function(){this._clearDraw();this._clearData();this._removeAxes();this._removeSeries();this._removeRangeAreas();this._removeLegend();},_getStdDataIntf:function(){var S=this;if(!this._stdDataIntf){this._stdDataIntf={getCount:function(){return S._chartData.length;},getFieldValue:function(T,U){return S._chartData[T][U];}};}return this._stdDataIntf;},setData:z(function(T){var S;S=this._notify("onPrepareData",T);if(S!==undefined){T=S;}this._chartData=T;if(T instanceof Array){this._chartDataIntf=this._getStdDataIntf();}else{if(typeof T.getCount!=="function"||typeof T.getFieldValue!=="function"){throw new Error("Неправильный аргумент data: он не является ни массивом, ни объектом-интерфейсом к данным (у такого объекта должны быть функции getCount и getFieldValue)");}this._chartDataIntf=this._chartData;}this._runInternalChange(function(){a(this._axes,function(U){U._setDataIntf(this._chartDataIntf);},this);a(this._series,function(U){U._invalidate("pointLabels");});});if(!this._inInternalChange()){this.draw();}this._notify("onAfterLoad");})});return $ws.proto.RaphaelChartGraph;});