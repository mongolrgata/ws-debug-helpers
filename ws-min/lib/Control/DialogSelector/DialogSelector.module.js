$ws.declareModule({namespace:"SBIS3.CORE",name:"DialogSelector",imports:["SBIS3.CORE.Dialog"]},function(a){$ws.proto.DialogSelector=a.extend({$protected:{_browser:null,_data:null,_afterRenderHandler:undefined,_beforeLoadHandler:undefined,_loaded:false,_selectionConfirmHandler:undefined,_options:{selectionType:"all",currentValue:[],multiSelect:false}},$constructor:function(){var b=this;this._publish("onChange");this._afterRenderHandler=function(){var e=this;if(this.isLoading()&&b._options.currentValue&&b._options.currentValue instanceof Array){var d=b._options.currentValue;if(this.getRecordSet().getRecords().length>0||this.getContainer().find(".ws-browser-empty").is(":visible")){b._options.currentValue=undefined;if(d[0]!==undefined&&this.isHierarchyMode()){var c=this.showBranch(d[0]);if(c instanceof $ws.proto.Deferred){c.addCallback(function(){e.setSelection(d);});}}if(d&&c===undefined){this.setSelection(d);}}}};this._beforeLoadHandler=function(){b._loaded=true;};this._selectionConfirmHandler=function(d,c){b._notify("onChange",c);};this._dRender.addCallback(function(d){var f=b.getChildControls();for(var e=0,c=f.length;e<c;e++){var g=f[e];if($ws.proto.DataView&&g instanceof $ws.proto.DataView||$ws.proto.DataViewAbstract&&g instanceof $ws.proto.DataViewAbstract){b.setBrowser(g);break;}}return d;});},_refreshBrowser:function(){if(this._browser&&this._data instanceof $ws.proto.RecordSet){this._browser.setData(this._data);}},setData:function(b){this._data=b;this._refreshBrowser();},setBrowser:function(b){if(this._browser){try{this._browser.unsubscribe("onBeforeLoad",this._beforeLoadHandler);this._browser.unsubscribe("onAfterRender",this._afterRenderHandler);this._browser.unsubscribe("onSelectionConfirm",this._selectionConfirmHandler);}catch(c){}}this._browser=b;if(b){this._browser.setSelectionType(this._options.selectionType);this._browser.setSelectionMode(true);this._browser.setMultiSelect(this._options.multiSelect);this._refreshBrowser();this._browser.subscribe("onAfterRender",this._afterRenderHandler);this._browser.subscribe("onBeforeLoad",this._beforeLoadHandler);this._browser.subscribe("onSelectionConfirm",this._selectionConfirmHandler);}},getBrowser:function(){return this._browser;},setResult:function(b){this._notify("onChange",b);}});return $ws.proto.DialogSelector;});