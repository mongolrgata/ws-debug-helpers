$ws.declareModule({namespace:"SBIS3.CORE",name:"TemplatedArea",imports:["SBIS3.CORE.TemplatedAreaAbstract"]},function(a){$ws.proto.TemplatedArea=a.extend({$protected:{_width:"",_height:""},$constructor:function(){this._publish("onBeforeClose","onAfterClose");},init:function(){$ws.proto.TemplatedArea.superclass.init.apply(this,arguments);var b=this,c=function(){if(!b._parent||b._parent._activeChildControl===-1){b._activateFirstCtrl();}};this._notify("onStateChanged");if(this._options.template){this._prepareTemplate().addCallback(c);}else{c();}},_templateInnerCallback:function(){$ws.proto.TemplatedArea.superclass._templateInnerCallback.apply(this);var b=this.getCurrentTemplateName();if(b){this._notify("onStateChanged",b);}},applyState:function(b){if(b!=this.getCurrentTemplateName()){if(this.isReady()){this.setTemplate(b);}else{this._options.template=b;}}},_setTemplateDimensions:function(c){var b=arguments;if(!this._options.keepSize){b=[{width:"",height:""}];}$ws.proto.TemplatedArea.superclass._setTemplateDimensions.apply(this,b);},_prepareTemplate:function(b){return this._runInBatchUpdate("_prepareTemplate",function(){var c=this;return this._loadTemplate(b).addCallback(function(){c._notify("onBeforeShow");c._notifyBatchDelayed("onAfterShow");});});},setTemplate:function(b){return this._runInBatchUpdate("setTemplate - "+b,function(){var d=this._dChildReady?this._dChildReady.getResult():null;if(!d||d.isReady()){return this._setTemplate(b);}else{var c=this;return d.addCallback(function(){return c._setTemplate(b);});}});},clearTemplate:function(){return this.setTemplate("");},_cleanupCurrentTemplate:function(){if(this._currentTemplateInstance){var d=this._currentTemplateInstance.getDeclaredHandlers();for(var f in d){if(d.hasOwnProperty(f)){var b=d[f];for(var e=0,c=b.length;e<c;e++){this.unsubscribe(f,b[e]);}}}this.unbind("onResize");this._currentTemplateInstance=null;}this._removeControls();this._container.attr("hasMarkup","false").children().not(".r").empty().remove();this._restoreTemplateOverridenOptions();this._options.template="";this._options.children=[];},_setTemplate:function(b){return this._runInBatchUpdate("_setTemplate",function(){this._cleanupCurrentTemplate();this._dChildReady=new $ws.proto.ParallelDeferred();if(b instanceof $ws.proto.Deferred){this._options.template="";}else{this._options.template=b;}return this._prepareTemplate(b);});},getCurrentTemplateName:function(){var b=this._options.template;return b instanceof $ws.proto.Template?b.getName():b;},destroy:function(){this._notify("onBeforeClose");$ws.proto.TemplatedArea.superclass.destroy.apply(this,arguments);this._notify("onAfterClose");},_restoreSize:function(){if(this._isPage&&!this.getParent()){var c=this._container.parent();var e=this._margins.left+this._margins.right;var b=c.width()-e;this._container.css({width:(this._horizontalAlignment==="Stretch"?"100%":(this._options.autoWidth?"auto":this._width)),height:(this._verticalAlignment==="Stretch"?"100%":(this._options.autoHeight?"auto":this._height))});var d=c.width()-e;if(b!=d){this._container.css({width:d});}}else{$ws.proto.TemplatedArea.superclass._restoreSize.apply(this,arguments);}}});return $ws.proto.TemplatedArea;});