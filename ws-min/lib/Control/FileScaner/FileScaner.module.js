$ws.declareModule({namespace:"SBIS3.CORE",name:"FileScaner",imports:["SBIS3.CORE.FileButton"]},function(a){$ws.proto.FileScaner=a.extend({$protected:{_options:{filterParams:[],paramsMapping:{},queryFilter:{},method:"",otherUrl:"",createZip:true,showInterface:true},_dialog:null,_imagesCount:0},$constructor:function(){var b=this;this.subscribe("onActivated",function(d){if(b._options.showInterface){$ws.core.attachInstance("SBIS3.CORE.Dialog",{template:"scanApplet",handlers:{onAfterLoad:function(){b._dialog=this;this.getLinkedContext().setValue("FileScanner",b);}}});}else{var c=$ws.java.runApplet("scannerAppletHidden",{sendSingleFile:!this._options.createZip+""},false).addCallbacks(function(e){b._applet=e;b._notify("onAppletReady",b._id,b._applet);},function(e){$ws.single.ioc.resolve("ILogger").error("FileScanner",e.message||"Апплету сканирования не удалось корректно запуститься!");b._applet=null;b._notify("onAppletReady",b._id,b._applet,e);});d.setResult(c);}});},_setImagesCount:function(b){this._imagesCount=b||0;},_imageUpload:function(c){var b=this;if(c!=="undefined"){this._notify("onChange",this._curval=decodeURIComponent(c));}this._upload(function(){if(b._applet&&"uploadFile" in b._applet){b._applet.uploadFile(JSON.stringify(b._getRequestParameters()),c);}});},_loaded:function(c){var b;try{b=$.parseJSON(c);}catch(d){}if(!b){b={error:{code:"500",message:"Внутренняя ошибка сервера!"}};}this._imagesCount--;this._notify("onLoaded",b,this._imagesCount<=0);if(this._imagesCount<=0&&this._dialog instanceof SBIS3.CORE.Dialog){this._dialog.close();}}});return $ws.proto.FileScaner;});