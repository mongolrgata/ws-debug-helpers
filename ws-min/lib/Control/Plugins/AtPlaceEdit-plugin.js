$ws._const.Browser.editAtPlaceWait=350;$ws.proto.TableView.AtPlaceEditPlugin=$ws.proto.TableView.extendPlugin({$protected:{_options:{display:{askConfirmSaving:false,editAtThePlaceOnly:false,editAtThePlaceTemplate:"",allowAddAtThePlace:false,atPlaceLinkText:"Новая запись",atPlaceBranchLinkText:"Новая папка"}},_editAtPlaceField:undefined,_editAtPlaceRecord:undefined,_editAtPlaceTimer:undefined,_editAtPlaceChanges:false,_editAtPlaceCell:undefined,_editAtPlaceFocusCallback:undefined,_editAtPlaceCellIndex:undefined,_editAtPlaceValidationErrors:0,_editAtPlaceValidationMap:{},_editAtPlaceWithValidationError:false,_editAtPlacePreviousValue:undefined,_addAtPlace:false,_addAtPlaceRow:undefined,_addAtPlaceRecordId:undefined,_addAtPlaceRecord:undefined,_addAtPlaceLinkRow:undefined,_editAtPlaceRecordArea:null,_firstEditAtPlaceColumn:"",_nextEditFieldId:"",_fieldTypesForEdit:{"Число целое":"Field:FieldInteger","Число вещественное":"Field:FieldNumeric","Деньги":"Field:FieldMoney","Дата":"Field:FieldDate","Дата и время":"Field:FieldDate","Время":"Field:FieldDate","Логическое":"Field:FieldCheckbox","Строка":"Field:FieldString","Текст":"Field:FieldText","Перечисляемое":"Field:FieldDropdown","Флаги":"Area:GroupCheckBox"},_disabledEditCells:{},_allowEditAtThePlace:undefined,_rowTemplates:[undefined,undefined],_waitDestroyEditControl:null},$condition:function(){if(this._allowEditAtThePlace===undefined){return true;}return this._allowEditAtThePlace;},$constructor:function(){this._publish("onBeforeEditColumn","onFieldChange");if(this.isHierarchyMode()){if(this.isHierarchy()){this.subscribe("onAfterRender",this._afterRender);}if(this._options.display.allowAddAtThePlace){this.subscribe("onAfterRender",this._afterRenderHandler);}}if(this._columnMap.length>0){this._checkEditAtThePlace();}if(this._options.display.editAtThePlaceOnly){delete this._menuButtons.edit;}this.subscribe("onDestroy",this._editTdDestroy.bind(this));},_editTdDestroy:function(){if(this._editAtPlaceTimer||this._editAtPlaceField){if(this._editAtPlaceField){this._editTdDestroyField();}if(this._editAtPlaceTimer){clearTimeout(this._editAtPlaceTimer);this._editAtPlaceTimer=undefined;}this._editTdUpdateRecord();}},_afterRender:function(){if(this._allowEditAtThePlace){var m=this._body.children();for(var d=0,g=m.length;d<g;++d){var f=m.eq(d),k=f.attr("rowkey"),c=f.children(),e=f.hasClass("ws-browser-folder");for(var b=0,l=c.length;b<l;b++){if(c[b].hasAttribute("coldefindex")){var a=this._columnMap[c[b].getAttribute("coldefindex")],h=this._checkAllowEditAtThePlace(e,a.allowEditAtThePlace);if(!h&&a.field!==""){this.setCellsEditEnabled(k,false,a.title,c.eq(b));}}}}}},_afterRenderHandler:function(){this._createAddAtPlaceLinkRow(this._body.get(0));},_beforeDrawActions:function(){this._editTdCancel();this._editAtPlaceValidationErrors=0;this._editAtPlaceValidationMap={};this._editAtPlaceChanges=false;},_initDataSource:function(){if(this._allowEditAtThePlace===true){this.subscribe("onKeyPressed",this._onKeyPressedOnBrowser);}var b=this,d=this._body.parent()[0],a=(this._options.display.editAtThePlaceTemplate?"td":"td.ws-browser-edit-column")+" > div",e=function(g){if(b.isEnabled()){b._onEditColumnClick(g,$(this).closest("td"));}g.preventDefault();g.stopPropagation();return false;};$(a,d).live("click",e);if(this._options.display.editAtThePlaceTemplate){$("td",d).live("click",e);var f=b.getTopParent(),c=$ws.proto.RecordFloatArea&&f instanceof $ws.proto.RecordFloatArea?"hide":"close";f[c]=f[c].callIf(function(){if($ws.proto.RecordArea&&b._editAtPlaceRecordArea instanceof $ws.proto.RecordArea){b._editAreaSaveRecord.apply(b);}return true;});}},_checkMoveRowOptions:function(){return(this._editAtPlaceRecordArea===null||this._allowEditAtThePlace===undefined);},_deleteEditButton:function(c){c=c||[];if(c&&this._options.display.editAtThePlaceOnly){for(var b=0,a=c.length;b<a;b++){if(c[b][0]==="Редактировать (F3)"){c.splice(b,1);break;}}}return c;},_getRowOptions:function(a){this._deleteEditButton(a);},_rowOptionsFilterConcat:function(d){var b=false;if(this._options.display.editAtThePlaceOnly&&!this._selectMode){for(var c=0,a=d.length;c<a;++c){if(d[c]==="edit"){b=true;break;}}if(!b){d.push("edit");}}return d;},_initActionsFlags:function(){if(!this._options.display.readOnly&&this._options.display.allowAddAtThePlace){var a=this;if(!this._actions.addItem){this._actions.addItem=function(){a._createRowAtThePlace(a._currentRootId,false);};}if(!this._actions.addFolder){this._actions.addFolder=function(){a._createRowAtThePlace(a._currentRootId,true);};}}},_checkShowDialog:function(b,a,c){if(this._editAtPlaceValidationErrors||this._editAtPlaceField){return true;}if(b===undefined){if(this._options.display.allowAddAtThePlace&&this._options.allowAdd){this._createRowAtThePlace(c||null,a);return true;}}else{if(this._allowEditAtThePlace&&this._options.allowEdit&&!(a===true&&this._options.editBranchDialogTemplate||this._options.editDialogTemplate)){this.editCell(b,this._firstEditAtPlaceColumn);return true;}}return arguments[3]||(b!==undefined&&this._options.display.editAtThePlaceOnly);},_onEditColumnClick:function(a,b){this._onClickHandler(a);if(this._options.allowEdit){this._startEditTd(b,a);}a.stopImmediatePropagation();a.preventDefault();return false;},_startEditAtPlace:function(a,c){var b=this;this._runInBatchUpdate("",function(){var d=new $ws.proto.Deferred(),g=this.getId()+a.getKey(),f=$('<div id="'+g+'" />'),e=new $ws.proto.Context();(function(){if(b._editAtPlaceRecordArea!==null){return b._endComplexEditAtPlace(true,true);}else{return new $ws.proto.Deferred().callback();}})().addCallback(function(){if(b._disabledEditCells[a.getKey()]!==false){if(!b.isActive()){b.setActive(true);}b._toggleFixHover(true);e.setContextData(a);$ws.core.attachInstance("Control/Area:RecordArea",{template:b._options.display.editAtThePlaceTemplate,horizontalAlignment:"Stretch",verticalAlignment:"Stretch",autoWidth:false,autoHeight:false,context:e,element:f,isNewRecord:b._addAtPlace,enable:true,page:false,reports:{},handlers:{onReady:function(){b._editAtPlaceRecord=a;var h=b._body.find("tr[rowkey='"+a.getKey()+"']"),i=h.find("td").length;h.html($('<td colspan = "'+i+'"/>').append(f));h.addClass("ws-browser-edit-row");b._onResizeHandler();d.callback();},onAfterShow:function(){b._editAreaInitControls.apply(b);$ws.core.setCursor(true);},onKeyPressed:$.proxy(b._editAreaKeyPressed,b),onDestroy:function(){b._editAreaDestroyed=true;b.setActive(true);}}}).addCallbacks(function(h){b._editAtPlaceRecordArea=h;h.detectNextActiveChildControl=function(){if(b._nextEditFieldId){try{this.getChildControlById(b._nextEditFieldId).setActive(true,false);b._nextEditFieldId="";}catch(i){}return true;}else{return $ws.proto.RecordArea.superclass.detectNextActiveChildControl.apply(this,arguments);}};h.getZIndex=function(){return b.getTopParent().getZIndex();};if(b._waitDestroyEditControl!==null&&!b._waitDestroyEditControl.isReady()){b._waitDestroyEditControl.callback();}b._waitDestroyEditControl=new $ws.proto.Deferred();b.getTopParent().addPendingOperation(b._waitDestroyEditControl);b._editAreaDestroyed=false;},function(h){$ws.core.setCursor(true);d.errback(h);return h;});}});return d;});},_toggleFixHover:function(a){if(this._options.display.editAtThePlaceTemplate){this._data.find("tr.ws-browser-item-over").removeClass("ws-browser-item-over");this._useKeyboard=a;this._data.toggleClass("ws-browser-hover",!a);if(a){this._hideRowOptions();}}else{this._data.find("tr.ws-browser-editable-row").toggleClass("hover",a);}},_editAreaKeyPressed:function(a,b){if([$ws._const.key.enter,$ws._const.key.esc,$ws._const.key.up,$ws._const.key.down].indexOf(b.which)!==-1){switch(b.which){case $ws._const.key.enter:this._editAreaSaveRecord(true);break;case $ws._const.key.esc:if(this._addAtPlace){this._addAtPlaceCancel();}this._complexEditAtPlaceDestroyArea();this._editAtPlaceRecord=false;break;case $ws._const.key.up:this._editNextRow(false,false);break;case $ws._const.key.down:this._editNextRow(true,false);break;}b.stopPropagation();b.preventDefault();a.setResult(false);}},_keyTabOnLastField:function(a,b){if(b.which==$ws._const.key.tab){this._editNextRow(true,true);b.stopPropagation();b.preventDefault();a.setResult(false);}},_editNextRow:function(d,c){var b=this,a=this._editAtPlaceRecordArea.getContainer().closest("tr.ws-browser-table-row"),e=new $ws.proto.Deferred();e.addCallback(function(){var f=a[d===false?"prev":"next"]("tr.ws-browser-table-row");if(f.length&&!f.hasClass("ws-browser-add-at-place-link-row")){b.editCell(f.attr("rowkey"));}else{b._nextEditFieldId="";if(c===true&&b._options.display.allowAddAtThePlace){b._createRowAtThePlace();}else{if(b._options.display.reload||b._addAtPlace){b.reload();}else{b.refresh();}}}});b.getTopParent().waitAllPendingOperations(e);b._editAreaSaveRecord(false,b._addAtPlace);},_editAreaInitControls:function(){if(this._editAtPlaceRecordArea!==null){var g=this._editAtPlaceRecordArea.getChildControls(),j=this,a,c,e,f,h;for(var d=0,b=g.length;d<b;d++){g[d].subscribe("onFocusOut",function(l,i,k){var m=this.getName();if(!j._editAreaDestroyed&&j._editAtPlaceRecord&&j._editAtPlaceRecord.hasColumn(m)&&j._editAtPlaceRecord.isChanged(m)){j._editAtPlaceCellIndex=j._columnIndex(m);if(j._editAtPlaceCellIndex!==-1){j._editTdFieldValueChange();}}h=k&&k.getTopParent();if(h instanceof $ws.proto.AreaAbstract&&h.getOpener() instanceof $ws.proto.Control){f=h.getOpener();}else{f=k;}if(!j._editAreaDestroyed){j._editAtPlaceValidationErrors=(j._editAtPlaceRecordArea.validate(false)?0:1);if(!k||(k!==j&&f&&f.getTopParent()!==j._editAtPlaceRecordArea)){j._editAreaSaveRecord.apply(j);}}});if($ws.proto.Suggest&&g[d] instanceof $ws.proto.Suggest){g[d].subscribe("onKeyPressed",function(i,k){if(k.which==$ws._const.key.enter){i.setResult(false);}});}if($ws.proto.FieldAbstract&&g[d] instanceof $ws.proto.FieldAbstract){g[d].subscribe("onKeyPressed",function(i,k){if(k.which==$ws._const.key.up||k.which==$ws._const.key.down){j._nextEditFieldId=this.getId();}});e=g[d].getTabindex();if(e&&(c===undefined||e>=c)){c=e;a=d;}}}g[a].subscribe("onKeyPressed",$.proxy(j._keyTabOnLastField,j));}},_editAreaSaveRecord:function(c,b){var a=this;a._editAtPlaceChanges=a._editAtPlaceRecord&&(c||a._editAtPlaceRecord.isChanged());if(a._editAtPlaceRecordArea.validate()){a._editAtPlaceValidationErrors=0;(function(){if(a._editAtPlaceChanges||a._addAtPlace){return a._editTdSaveRecord();}else{return new $ws.proto.Deferred().callback();}})().addCallback(function(d){a._editAreaDestroyed=true;a._endComplexEditAtPlace(true,true,b);return d;});}else{a._editAtPlaceValidationErrors=1;}},_moveChanges:function(g,h){var k=g.getKey(),f=this._currentRecordSet.contains(k)?this._currentRecordSet.getRecordByPrimaryKey(k):false,d=g.getColumns(),b,j,a;for(var e=0,c=d.length;e<c;e++){b=d[e];a=this._columnIndex(b);if(a!==-1){j=this._columnMap[a];this._notify("onFieldChange",g,j.field,j.title,g.get(j.field),f&&f.hasColumn(j.field)?f.get(j.field):null);}if(f&&f.hasColumn(b)&&h){f.set(b,g.get(b));}}},_endComplexEditAtPlace:function(d,f,c){var a=new $ws.proto.Deferred();if(this._editAtPlaceRecordArea){if(f!==true||this._editAtPlaceRecordArea.validate(false)){var e=this._editAtPlaceRecordArea.getRecord(),b=this;if(!d){e.rollback();}this._moveChanges(e,d);(function(){if((c!==false&&b._options.display.reload&&b._editAtPlaceChanges)||b._addAtPlace){return b.reload();}else{b.refresh();return new $ws.proto.Deferred().callback();}})().addCallback(function(){b._complexEditAtPlaceDestroyArea.apply(b);b._editAtPlaceRecord=false;a.callback();});}else{a.errback();}}else{a.callback();}return a;},_complexEditAtPlaceDestroyArea:function(){if(this._editAtPlaceRecordArea!==null){this._editAtPlaceRecordArea.destroy();}this._editAtPlaceRecordArea=null;this._toggleFixHover(false);if(this._waitDestroyEditControl&&!this._waitDestroyEditControl.isReady()){this._waitDestroyEditControl.callback();}},_onKeyPressedOnBrowser:function(a,b){if(b.which===$ws._const.key.enter&&this._editAtPlaceField!==null){b.preventDefault();b.stopPropagation();return false;}},_mapColumns:function(){this._firstEditAtPlaceColumn="";this._checkEditAtThePlace();},_checkEditAtThePlace:function(){if(this._options.display.readOnly===true){this._allowEditAtThePlace=false;}if(!this._options.display.editAtThePlaceTemplate){var a=this._options.display.columns,e=this._currentRecordSet&&this._currentRecordSet.getColumns(),b=a?a:e,c=e?this._currentRecordSet.getPkColumnIndex():undefined;this._allowEditAtThePlace=false;for(var f=0,d=b.length;f<d;f++){var k=b[f],j=k.field?k.field:k.title,h=e&&e[j]?e[j].type:(k.type||null),g=false;if(a&&a[f]){g=a[f].allowEditAtThePlace||false;}if(g){if(e&&e[j]&&e[j].index===c){g=false;}}if(g&&h in {"Связь":0,"Файл":0,"Двоичное":0,"Символ":0}){g=false;}if(!this._allowEditAtThePlace&&g){this._allowEditAtThePlace=true;if(!this._firstEditAtPlaceColumn){this._firstEditAtPlaceColumn=b[f].title;}}this._columnMap[f].allowEditAtThePlace=g;this._columnMap[f].validators=b[f].validators?b[f].validators:[];this._columnMap[f].decimals=b[f].decimals?b[f].decimals:9;if(this._allowEditAtThePlace&&(h in {"Дата":0,"Дата и время":0,"Время":0})){this._columnMap[f].maskField=b[f].maskField?b[f].maskField:null;}if(this._columnMap[f].allowEditAtThePlace&&!this._options.display.editAtThePlaceTemplate){this._columnMap[f].className+=" ws-browser-edit-column";}}}else{this._allowEditAtThePlace=true;}},_renderTD:function(b,a,c){if(!this.isReadOnly()&&this._options.allowEdit&&this._options.display.editAtThePlaceTemplate&&!b.render){return"<span class='ws-browser-template-edit'>"+c+"</span>";}else{return c;}},_enableEditCells:function(b){var a=this;b.each(function(d,c){$(c).addClass("ws-browser-edit-column").attr("coldefindex",a._getCellIndex($(c)));});},_disableEditCells:function(a){a.removeClass("ws-browser-edit-column");},setCellsEditEnabled:function(e,d,a,g){var c=this._disabledEditCells[e];if(this._options.display.editAtThePlaceTemplate){this._disabledEditCells[e]=d;return;}if(a){var h=g?g:this._findCell(e,a);if(d){if(c!==undefined){if(Object.isEmpty(c)){for(var f in this._columnMap){if(this._columnMap.hasOwnProperty(f)&&this._columnMap[f].title!==a){c[this._columnMap[f].title]=true;}}}else{delete c[a];if(Object.isEmpty(c)){delete this._disabledEditCells[e];}}this._enableEditCells(h);}}else{if(c===undefined||!Object.isEmpty(c)){if(c===undefined){this._disabledEditCells[e]=c={};}c[a]=true;this._disableEditCells(h);}}}else{var b=this._findRow(e).children();if(d){delete this._disabledEditCells[e];this._enableEditCells(b);}else{this._disabledEditCells[e]={};this._disableEditCells(b);}}},editCell:function(b,a){if(!this.isReadOnly()&&this._options.allowEdit&&(!this._options.display.editAtThePlaceTemplate||this._disabledEditCells[b]!==false)){a=this._options.display.editAtThePlaceTemplate?this._columnMap[0].title:a;var c=this._findCell(b,a);if(c.length){if(this._options.display.editAtThePlaceTemplate||c.hasClass("ws-browser-edit-column")){this._startEditTd(c);}}else{$ws.single.ioc.resolve("ILogger").error("Browser","Cannot find cell with rowkey "+b+" and column name "+a);}}},_getCellIndex:function(a){return a.attr("coldefindex")?parseInt(a.attr("coldefindex"),10):a.length?a[0].cellIndex:0;},_startEditTd:function(g,e){var a=this,f=g.parent(),c=f.attr("rowkey"),b=a._getCellIndex(g),d=function(){$ws.core.setCursor(false);return $ws.helpers.callbackWrapper(function(){if(a._editAtPlaceRecord&&a._isIdEqual(c,a._editAtPlaceRecord.getKey())){return a._editAtPlaceRecord;}var h=a._notify("onBeforeRead",c);if(h instanceof $ws.proto.Deferred||h instanceof $ws.proto.Record){return h;}else{if(c==a._addAtPlaceRecordId&&a._addAtPlace){return a._addAtPlaceRecord;}else{return a._currentRecordSet.readRecord(c);}}}(),function(h){if(a._options.display.editAtThePlaceTemplate){a._startEditAtPlace(h,g);}else{$ws.core.setCursor(true);a._editTdAtPlace(h,g,b,e);}});};this._runInBatchUpdate("",function(){var h=undefined;a._toggleFixHover(true);if(this._editAtPlaceRecord){clearTimeout(this._editAtPlaceTimer);this._editAtPlaceTimer=undefined;if(!this._isIdEqual(this._editAtPlaceRecord.getKey(),c)){if(!this._editAtPlaceValidationErrors){h=this._editTdUpdateRecord().addCallback(d).addErrback(function(){if(a._editAtPlaceField){a._editAtPlaceField.setActive(true);}});}}else{this._editTdDestroyField();h=d();}}else{if(!this._editAtPlaceValidationErrors){h=d();}}return h;});},_editTdHideContents:function(b){for(var d=0,a=b[0].childNodes,c=a.length;d<c;d++){if(a[d].nodeType==$ws._const.nodeType.TEXT_NODE){a[d].data="";}else{var e=$(a[d]);if(e.hasClass("ws-browser-expander-container")||e.hasClass("ws-browser-text-no-render")||e.hasClass("ws-browser-text-container")){e.css({display:"none"});}else{e.remove();--d;--c;}}}},_editTdKeyEnter:function(f){if(this._editTdRecordCanSetData()){var g=this._editAtPlaceCell,e=g.closest("tr"),b=e,a=undefined,d=this._getCellIndex(g);while(!a||!a.length){b=f===true?b.prev():b.next();if(!b.length){break;}a=b.find("td[coldefindex="+d+"]");}if(!this._editAtPlaceValidationErrors){if(a&&a.length){this._startEditTd(a);}else{var c=this;c._editTdDestroyField();this._editTdSaveRecord().addBoth(function(){if(c._editAtPlaceChanges){if(c._options.display.reload){c.reload();}else{if(!a){c.refresh();}}}});}}}},_editTdCancel:function(){if(this._editAtPlaceField&&this._editAtPlaceRecord){this._runInBatchUpdate("",function(){this._editAtPlaceRecord.rollback();var a=this._editAtPlaceRecord.get(this._columnMap[this._getCellIndex(this._editAtPlaceCell)].field);this._editAtPlaceField.setValue(a);this._editTdDestroyField();this._editAtPlaceValidationErrors=0;if(this._isIdEqual(this._editAtPlaceRecord.getKey(),this._addAtPlaceRecordId)&&this._addAtPlace){this._addAtPlaceCancel();}else{if(this._options.display.reload&&this._editAtPlaceChanges){this.reload();}}this._getElementToFocus().focus();});}else{if(this._options.display.editAtThePlaceTemplate&&this._editAtPlaceRecordArea!==null){this._complexEditAtPlaceDestroyArea();if(this._waitDestroyEditControl!==null&&!this._waitDestroyEditControl.isReady()){this._waitDestroyEditControl.callback();}}}},_editTdKeyTab:function(c){var f=!c.shiftKey,a,d=this._editAtPlaceCell;a=d;var b=false;while(true){if(a.length){a=a[f?"next":"prev"]("td");}else{b=true;a=d.closest("tr")[f?"nextAll":"prevAll"](".ws-visible:first").find(f?"td:first":"td:last");if(!a.length){break;}}if(a.length){d=a;}if(a.hasClass("ws-browser-edit-column")){break;}}if(this._editTdRecordCanSetData()||!b){if(a&&a.length){this._startEditTd(a,c);}else{this._editTdUpdateRecordAndReload();}}},_editTdFieldConfig:function(g,f,a){var e={name:g.field,width:f,linkedContext:new $ws.proto.Context().setPrevious(this.getLinkedContext()),parent:this.getParent(),validators:g.validators,tabindex:-1};if(g.type==="Текст"){e.height=a;}else{if(g.type==="Число целое"||g.type==="Число вещественное"||g.type==="Деньги"){e.maxlength=255;e.delimiters=g.type==="Деньги";if(g.type==="Число вещественное"){e.decimals=g.decimals||9;}else{if(g.type==="Деньги"){e.decimals=2;}}}else{if(g.type==="Дата и время"){e.mask=g.maskField?g.maskField:"DD.MM.YY HH:II";}else{if(g.type==="Дата"){e.mask=g.maskField?g.maskField:"DD.MM.YY";}else{if(g.type==="Время"){e.mask=g.maskField?g.maskField:"HH:II";}else{if(g.type==="Логическое"){e.caption="";}else{if(g.type==="Флаги"){var h=this.getActiveRecord().get(g.field).getColumns(),b={};for(var d=0,c=h.length;d<c;d++){b[h[d]]={caption:h[d],isThirdPosition:true};}e.elements=b;}else{e.maxlength=255;e.inputFilter=g.inputFilter;}}}}}}}return e;},_editTdInitField:function(b,g){var c=b.getContainer(),a=c.closest("td"),f=a.parent();c.height("").addClass("clearfix");var e=c.outerHeight();a.find("div.ws-browser-cell-container").height(e);f.height(e);b.getContainer().height(e);b.setActive(true);b.getLinkedContext().setContextData(this._editAtPlaceRecord);var i=b.getContainer().find(".ws-field :first-child")[0];if($.browser.msie&&i.createTextRange){i.createTextRange().select();}else{if($.browser.opera){var d=document.createRange();d.selectNode(i);window.getSelection().addRange(d);}else{if(typeof(i.select)=="function"){i.select();}}}this._editAtPlaceField=b;this._notifyOnSizeChanged(this,this,true);},_editTdAtPlace:function(a,d,b,c){this._runInBatchUpdate("",function(){var o=this,l=$("<div class='ws-browser-edit-field' />"),m=this._columnMap[b],j=d.find("div.ws-browser-cell-container"),i=d.closest("tr"),f=d.find(".ws-browser-cell-container").width(),n=j.height(),g=i.attr("rowkey");if(j.hasClass("ws-browser-validation-error")){o._editAtPlaceWithValidationError=true;j.removeClass("ws-browser-validation-error");}else{o._editAtPlaceWithValidationError=false;}j.removeClass("ws-browser-div-cut").addClass("ws-browser-has-edit-field");this._editAtPlaceCellIndex=b;this._editAtPlaceRecord=a;this._editAtPlaceCell=d;this._editAtPlacePreviousValue=a.get(m.field);i.addClass("ws-browser-editable-row");o._toggleFixHover(true);l.css({width:f,height:n,position:"relative"});this._editTdHideContents(j);l.data("fieldIndex",b);l.data("oldFieldContainerHeight",j.height());l.data("oldTrHeight",i.height());j.prepend(l);if(!this._editAtPlaceFocusCallback){this._editAtPlaceFocusCallback=$.proxy(this._editTdFocusLost,this);$("body").bind("click.edit_"+this.getId(),this._editAtPlaceFocusCallback);}var h=this._editTdFieldConfig(m,f,n),k=o._fieldTypesForEdit[m.type]?o._fieldTypesForEdit[m.type]:o._fieldTypesForEdit["Строка"];h.element=l;h.handlers={onKeyPressed:function(p,q){if(q.which===$ws._const.key.insert&&!q.shiftKey&&!q.altKey&&!q.ctrlKey){q.stopPropagation();q.preventDefault();}if([$ws._const.key.enter,$ws._const.key.esc,$ws._const.key.tab,$ws._const.key.up,$ws._const.key.down].indexOf(q.which)!==-1){q.stopPropagation();q.preventDefault();switch(q.which){case $ws._const.key.enter:case $ws._const.key.up:case $ws._const.key.down:o._editTdKeyEnter(q.which===$ws._const.key.down);break;case $ws._const.key.esc:o._editTdCancel();break;case $ws._const.key.tab:o._editTdKeyTab(q);break;}p.setResult(false);}},onFocusOut:this._editAtPlaceFocusCallback};var e=o._notify("onBeforeEditColumn",a,k,h);if(e&&e instanceof Array&&e.length==2){k=e[0];h=e[1];}return $ws.core.attachInstance("Control/"+k,h).addCallback(function(p){o._editTdInitField(p,c);});});},_editTdFocusLost:function(){if(this._editAtPlaceField){var a=this;this._editTdDestroyField();if(!this._editAtPlaceValidationErrors){if(this._editWaitForDialog&&!this._editWaitForDialog.isReady()){this._editWaitForDialog.callback();}this._editWaitForDialog=new $ws.proto.Deferred();var b=this.getTopParent();if(b instanceof $ws.proto.AreaAbstract){b.addPendingOperation(this._editWaitForDialog);}this._editAtPlaceTimer=setTimeout(function(){a._editTdUpdateRecordAndReload();},$ws._const.Browser.editAtPlaceWait);}}this._showEmptyDataBlock();},_editTdFieldValueChange:function(){if(this._editAtPlaceRecord){var a=this._columnMap[this._editAtPlaceCellIndex],b=this._editAtPlaceRecord.get(a.field);if(this._editAtPlacePreviousValue!==b){this._notify("onFieldChange",this._editAtPlaceRecord,a.field,a.title,b,this._editAtPlacePreviousValue);}}},_editTdRecordCanSetData:function(){if(this._editAtPlaceField){if(this._editAtPlaceField.validate()){return true;}}else{return true;}return false;},_editTdSaveRecord:function(){var d=this,c=this._editAtPlaceRecord;if(this._editAtPlaceValidationErrors===0){var b=this._notify("onBeforeUpdate",c);if(c){if(typeof(b)!=="boolean"){if(this._addAtPlace&&this._isIdEqual(this._addAtPlaceRecordId,c.getKey())){return this._addAtPlaceOk();}else{$ws.core.setCursor(false);this._isUpdatingRecords=true;this._editAtPlaceChanges=true;var f=new $ws.proto.Deferred(),a=this._container.find(".ws-browser-ajax-loader").removeClass("ws-hidden");$ws.helpers.clearSelection();if(!this._editWaitForDialog){var e=this.getTopParent();if(e instanceof $ws.proto.AreaAbstract){e.addPendingOperation(f);}}c.update().addCallbacks(function(g){d._editAtPlaceRecord=undefined;d._notify("onRecordsChanged");f.callback();return g;},function(g){c.rollback();if(g instanceof HTTPError&&g.httpError!==0){$ws.core.alert(g.message);}d._editAtPlaceRecord=undefined;f.errback(g);}).addBoth(function(g){a.addClass("ws-hidden");$ws.core.setCursor(true);d._isUpdatingRecords=false;return g;});return f;}}else{this._editAtPlaceRecord=undefined;}}if(b===true){this._editAtPlaceChanges=true;this._addAtPlaceRecordId=undefined;return new $ws.proto.Deferred().callback();}}if(b===true){this._endAddAtPlace();return new $ws.proto.Deferred().callback();}else{return new $ws.proto.Deferred().errback();}},_editTdUpdateRecordAndReload:function(){var a=this;return this._editTdUpdateRecord().addCallbacks(function(){if(a._options.display.reload&&a._editAtPlaceChanges===true&&!a._isDestroyed){return a.reload().addCallback(function(){if(a._options.display.editAtThePlaceTemplate){a._complexEditAtPlaceDestroyArea.apply(a);}});}return undefined;},function(){if(a._editAtPlaceField){a._editAtPlaceField.setActive(true);}});},_editTdUpdateRecord:function(){if(this._editTdRecordCanSetData()){this._editTdDestroyField();clearTimeout(this._editAtPlaceTimer);this._editAtPlaceTimer=undefined;if(this._editAtPlaceRecord&&(this._addAtPlace||this._editAtPlaceRecord.isChanged())){var a=this,b=new $ws.proto.Deferred();if(a._editWaitForDialog&&!a._editWaitForDialog.isReady()){a._editWaitForDialog.dependOn(b);}if(this._options.display.askConfirmSaving){$ws.core.attachInstance("SBIS3.CORE.DialogConfirm",{resizable:false,message:"Сохранить изменения?",handlers:{onConfirm:function(d,c){if(c){a._editTdSaveRecord().addCallback(function(){b.callback();});}else{a._editTdCancelEdit();}}}});return b;}else{b.dependOn(this._editTdSaveRecord());return b;}}else{if(this._editWaitForDialog&&!this._editWaitForDialog.isReady()){this._editWaitForDialog.callback();}this._editTdCancelEdit();return new $ws.proto.Deferred().callback();}}return new $ws.proto.Deferred().errback();},_editTdDestroyField:function(){if(!this._editAtPlaceField){return;}this._editTdFieldValueChange();this._runInBatchUpdate("",function(){var k=this._editAtPlaceField.getContainer(),g=k.closest("tr"),h=k.parent(),o=parseInt(k.data("fieldIndex"),10),n=isNaN(o)?false:this._columnMap[o];this._toggleFixHover(false);g.removeClass("ws-browser-editable-row");k.parent().height(k.data("oldFieldContainerHeight"));g.height(k.data("oldTrHeight"));k.height(k.data("oldFieldContainerHeight"));if(!this._options.display.cutLongRows){h.removeClass("ws-browser-div-cut");}var c=this._editAtPlaceField.validate(),a=this._editAtPlaceWithValidationError;if(!a&&!c){if(++this._editAtPlaceValidationErrors===1&&this._addAtPlaceLinkRow){this._addAtPlaceLinkRow.addClass("ws-browser-add-disabled");}this._editAtPlaceValidationMap[o]=true;}else{if(a&&c){if(--this._editAtPlaceValidationErrors===0&&this._addAtPlaceLinkRow){this._addAtPlaceLinkRow.removeClass("ws-browser-add-disabled");}delete this._editAtPlaceValidationMap[o];}}this._editAtPlaceField.unsubscribe("onFocusOut",this._editAtPlaceFocusCallback);this._editAtPlaceField.destroy();this._editAtPlaceField=null;if(this._options.display.ladder&&this._options.display.ladder.length!==0){this.refresh();}else{if(this._editAtPlaceRecord&&n){var f=this._renderTD(n,this._editAtPlaceRecord),m=(f instanceof Object&&"jquery" in f)?f.text():((f===null||f===undefined)?"":f.toString());m=$ws.helpers.escapeTagsFromStr(m,[]).replace(/'/g,"&#039;");h.attr("title",m);h.removeClass("ws-browser-has-edit-field");for(var e=0,p=h.children(),d=p.length;e<d;e++){var b=$(p[e]);if(b.hasClass("ws-browser-expander-container")||b.hasClass("ws-browser-text-no-render")||b.hasClass("ws-browser-text-container")){b.css({display:"block"});}}if(this._editAtPlaceValidationMap[o]){h.addClass("ws-browser-validation-error");}if(this.isHierarchyMode()&&o<=0){h=g.find(".ws-browser-text-container");}var j=this._options.editMode=="newDialog"&&(this.isHierarchyMode()?this._options.editBranchMode:true),q=j?false:this.isHierarchyMode()&&this._editAtPlaceRecord.get(this._hierColumnIsLeaf)===true;this._appendDataToCellContainer(h,f,q,!!n.render,n.allowEditAtThePlace,g.attr("rowkey"),g.attr("parentid"));}}});},_editTdCancelEdit:function(){if(this._editAtPlaceRecord){this._editAtPlaceRecord.rollback();this._editAtPlaceValidationErrors=0;if(this._options.display.editAtThePlaceTemplate){this._endComplexEditAtPlace();}else{var b=this._editAtPlaceCell.closest("tr"),d,a=this._columnMap[this._editAtPlaceCellIndex],c=this._renderTD(a,this._editAtPlaceRecord);if(this.isHierarchyMode()&&this._editAtPlaceCellIndex===0){d=this._editAtPlaceCell.find(".ws-browser-text-container");}else{d=this._editAtPlaceCell.find(".ws-browser-cell-container");}this._appendDataToCellContainer(d,c,this._hierColumnIsLeaf!==undefined?this._editAtPlaceRecord.get(this._hierColumnIsLeaf)===true:false,!!a.render,a.allowEditAtThePlace,b.attr("rowkey"),b.attr("parentid"));if(this._isIdEqual(this._editAtPlaceRecord.getKey(),this._addAtPlaceRecordId)&&this._addAtPlace){this._addAtPlaceCancel();}else{if(this._options.display.reload&&this._editAtPlaceChanges){this.reload();}}}}this._getElementToFocus().focus();},destroy:function(){if(this._editAtPlaceFocusCallback){$("body").unbind("click.edit_"+this.getId(),this._editAtPlaceFocusCallback);}},_createRowAtThePlace:function(d,c){if(this._editAtPlaceValidationErrors){return;}var b=this;var a=this._notify("onBeforeInsert",d);if(a!==false){$ws.helpers.callbackWrapper(this._beforeCreateRowAtThePlace(d),function(){var f=function(){$ws.core.setCursor(false);b._readRecord(undefined,d,c).addCallback(function(g){if(g instanceof $ws.proto.Record){$ws.core.setCursor(true);var h=false;if(b.isHierarchyMode()){var i=g.get(b._hierColumnParentId);if(i!=d){d=i;h=true;}}$ws.helpers.callbackWrapper(h&&b.showBranch(d),function(){if(a!==true){b._addAtPlace=true;b._addAtPlaceRecord=g;b._addAtPlaceRecordId=g.getKey();if(b._addAtPlaceRecordId===null){b._addAtPlaceRecordId="null";}var m,l=0;if(b.isTree()){m=b._body.find('tr[rowkey="'+d+'"]:first');l=m.length?(parseInt(m.attr($ws._const.Browser.treeLevelAttribute),10)+1):0;}if(!m||!m.length){m=b._body.find(".ws-browser-add-at-place-link-row").prev("tr[rowkey]");}var k=$(b._createTrAtPlace(g,l,m));k.addClass("ws-add-at-place");if(c){k.find(".ws-browser-expander").removeClass("ws-browser-expander minus").addClass("folder");}if(m&&m.length){k.insertAfter(m);}else{b._body.prepend(k);}if(b._count===0){b._emptyDataBlock.addClass("ws-hidden");b._data.removeClass("ws-indent-top");b._emptyDataBlock.removeClass("ws-back");}b._heightChangedIfVisible();b.zebraBody(b._options.display.hasZebra);b._addAtPlaceRow=k;b.setActiveRow(k);if(b._options.display.editAtThePlaceTemplate){b._startEditAtPlace(b._addAtPlaceRecord,k.find("td:first"));}else{for(var j in b._columnMap){if(b._columnMap.hasOwnProperty(j)){if(b._columnMap[j].allowEditAtThePlace){var n=k.find("td[coldefindex="+j+"]");if(n.length){b._editTdAtPlace(g,n,j);break;}}}}}}});}});};var e=(b._editAtPlaceRecord&&b._editTdRecordCanSetData()&&b._editTdUpdateRecordAndReload())||!b._editAtPlaceField;if(e){$ws.helpers.callbackWrapper(e,f);}else{if(b._editAtPlaceField){b._editAtPlaceField.setActive(true);}}});}},_addAtPlaceOk:function(){var c=this._options.dataSource.readerParams.format!==undefined?this._options.dataSource.readerParams.format:this._options.dataSource.readerParams.queryName,a=this._addAtPlaceRecord.update(),b=this,d=this.getTopParent();if(d instanceof $ws.proto.AreaAbstract){d.addPendingOperation(a);}this._isUpdatingRecords=true;this._editAtPlaceChanges=true;a.addCallback(function(e){b._currentRecordSet.readRecord(e,c).addCallback(function(g){b._isUpdatingRecords=false;var f=b._body.find(".ws-add-at-place"),j=f.attr($ws._const.Browser.treeLevelAttribute),i=$(b._createTrAtPlace(g,j));i.insertAfter(f);var h=f.find(".ws-browser-row-selection");if(h.length){b.setActiveElement(i);}f.remove();return g;});return e;});this._endAddAtPlace();return a;},_addAtPlaceCancel:function(){this._addAtPlaceRecord.destroy();this._addAtPlaceRow.empty().remove();this._endAddAtPlace();},_endAddAtPlace:function(){if(this._count===0){this._emptyDataBlock.removeClass("ws-hidden");this._data.addClass("ws-indent-top");this._emptyDataBlock.addClass("ws-back");}this._addAtPlace=false;this._addAtPlaceRecord=undefined;this._addAtPlaceRow=undefined;this._editAtPlaceValidationErrors=0;this._editAtPlaceValidationMap={};this._editAtPlaceRecord=null;this._editTdDestroyField();if(!this._options.display.reload){this._createAddAtPlaceLinkRow(this._body);}},_beforeCreateRowAtThePlace:function(b){var a=this._isIdEqual(this._rootNode,b);if(this.isTree()&&!this._expanded[b]&&(a&&this._options.display.showRoot||!a)){return this._processTreeClick(b,false);}return null;},_addAtPlaceLinkRowClick:function(b,a){if(b){this._onClickHandler(b);b.stopPropagation();}this._createRowAtThePlace(this._currentRootId,a,false);},_createAddAtPlaceLinkRow:function(e){var d=$('<td class="ws-browser-add-at-place-cell"></td>'),b=this,a,c;this._addAtPlaceLinkRow=$('<tr class="ws-browser-table-row ws-visible ws-browser-add-at-place-link-row" rowkey=""></tr>');if(this._options.display.viewMode!=="foldersTree"){c=$('<span class="ws-browser-add-at-place-link item">'+this._options.display.atPlaceLinkText+"</span>");c.appendTo(d).click(function(f){b._addAtPlaceLinkRowClick(f,false);});}if(this.isHierarchyMode()){a=$('<span class="ws-browser-add-at-place-link folder">'+this._options.display.atPlaceBranchLinkText+"</span>");a.appendTo(d).click(function(f){b._addAtPlaceLinkRowClick(f,true);});if(this._options.display.viewMode!=="foldersTree"){a.addClass("withItem");}}d.get(0).colSpan=this._getColumnsCount();d.appendTo(this._addAtPlaceLinkRow);if(this._options.display.hasZebra){this._addAtPlaceLinkRow.addClass("rE");}if(this._options.display.readOnly){this._addAtPlaceLinkRow.hide();}this._data.toggleClass("ws-indent-top",this._count===0);this._emptyDataBlock.toggleClass("ws-back",this._count===0);this._addAtPlaceLinkRow.appendTo(e);},_drawBodyCycle:function(){if(this._options.display.allowAddAtThePlace){this._afterRenderHandler();}},_createRowTemplateAtPlace:function(k){var m=document.createElement("tr"),d,c,j;if(this.isHierarchyMode()&&k){d=document.createElement("span");d.className="ws-browser-expander-container";if(this.isTree()&&this._turn===""){if(this._options.display.hierarchyIcons&&this._options.display.hierarchyIcons!==$ws._const.Browser.hierarchyIcons){d.style.backgroundImage=["url(",$ws._const.wsRoot,this._options.display.hierarchyIcons,")"].join("");}d.className+=" ws-browser-icon ws-browser-expander";}}if(this._options.display.showSelectionCheckbox&&this._options.useSelection!==false){c=document.createElement("td");c.className="ws-browser-checkbox-holder";if(!this.isHierarchyMode()||(this.isHierarchyMode()&&!(this._options.selectionType==="leaf"&&k)&&!(this._options.selectionType==="node"&&!k))){var a=document.createElement("div"),b=document.createElement("div"),g=document.createElement("span");a.className="ws-browser-cell-paddings";b.className="ws-browser-cell-container";g.className="ws-browser-checkbox";b.appendChild(g);a.appendChild(b);c.appendChild(a);}m.appendChild(c);}j=k&&((this.isTree()&&this._turn!=="")||this.isHierarchy());var f=0,l;for(var e=0,h=this._columnMap.length;e<h;++e,d=undefined){c=false;f=(e===0&&j)?-1:e;l=this._columnMap[e];if(j){if(f===-1||l.useForFolder){c=this._createTdTemplateAtPlace(f,d);c.className+=k?" ws-browser-bold":"";}}else{c=this._createTdTemplateAtPlace(f,d);}if(c){m.appendChild(c);}}return m;},_getColumnsCount:function(){return this._columnMap.length+(this._options.display.showSelectionCheckbox?1:0);},_createTrAtPlace:function(c,a,x){var s=(this.isHierarchyMode()?c.get(this._hierColumnIsLeaf):null),t=this._options.display.viewMode==="foldersTree"?c.get(this._hierColumnHasChild):null,y=s?1:0,z=c.getKey(),w=["ws-browser-table-row"],j=0,l="ws-visible",b,f,e;if(this._rowTemplates[y]===undefined){this._rowTemplates[y]=this._createRowTemplateAtPlace(s);}e=this._rowTemplates[y].cloneNode(true);f=$(e).find(".ws-browser-expander-container")[0];if(this.isHierarchyMode()){b=!!this._expanded[z];}if(z===null){z="null";}e.setAttribute("rowkey",z);if(this.isHierarchyMode()){e.setAttribute($ws._const.Browser.treeLevelAttribute,a);}if(this._options.display.hasZebra){w.push("rE");}if(this._selected[z]!==undefined){w.push("ws-browser-selected");}if(this._selectedPart&&this._selectedPart[z]!==undefined){w.push("ws-browser-selected-part");}if(this.isHierarchyMode()){if(this.isTree()&&this._turn===""&&s){if(this._options.display.viewMode!=="foldersTree"||t===true){$(f).addClass(b?"minus":"plus");}else{if($ws._const.theme!=="wi_scheme"){var h=$ws._const.theme?"img/themes/"+$ws._const.theme+"/browser/":"img/browser/";$(f).css("background",["url(",$ws._const.wsRoot,h+"bullet.png",") no-repeat scroll center center transparent"].join(""));}}}var m=$ws._const.Browser.iconWidth;j+=m*a;j+=$ws._const.Browser.defaultCellPadding;j+=!s&&this.isTree()&&this._turn!==""?m:0;e.setAttribute("parentId",c.get(this._hierColumnParentId));if(s&&(this._options.display.viewMode!=="foldersTree"||t)){w.push("ws-browser-tree-branch","ws-browser-folder");}if(s){if(!this.isTree()||!s||this._turn!==""||(this._options.display.viewMode==="foldersTree"&&!t&&$ws._const.theme==="wi_scheme")){if(this._options.display.hierarchyIcons&&this._options.display.hierarchyIcons!==$ws._const.Browser.hierarchyIcons){f.style.backgroundImage=["url(",$ws._const.wsRoot,this._options.display.hierarchyIcons,")"].join("");}f.className+=" "+((t||this.isTree()||this._turn!=="")?((b&&this.isTree())||this._turn!==""?"icon-16 icon-OpenedFolder icon-primary":"icon-16 icon-Folder icon-primary"):"ws-browser-icon item item");}if(this._options.display.folderIcon){$(f).css("background",["url(",$ws.helpers.processImagePath(this._options.display.folderIcon),") no-repeat scroll center center transparent"].join(""));}}}w.push(l);if(w.length>0){e.className=w.join(" ");}var d=e.childNodes;if((this.isHierarchy()||(this.isTree()&&this._turn!==""))&&s){var p=false,v=0,n=1,u,g=this._createTdAtPlace(d[0],-1,c,j);for(var o=1,r=this._columnMap.length;o<r;++o){if(this._columnMap[o].useForFolder){u=this._createTdAtPlace(d[n++],o,c,j);if(!p){v=o;p=true;}}}if(p){g.colSpan=v;u.colSpan=this._getColumnsCount()-v;}else{g.colSpan=this._getColumnsCount();}}else{var q=this._options.display.showSelectionCheckbox===true?1:0;for(o=0,r=this._columnMap.length;o<r;++o){this._createTdAtPlace(d[o+q],o,c,j);}}this._rowsMap[z]=$(e);if(typeof(this._options.display.rowRender)=="function"){this._options.display.rowRender.apply(this,[c,$(e)]);}return e;},_createTdAtPlace:function(b,i,e,g,j){var h=i>=0?this._columnMap[i]:{type:"Строка",render:null,field:this._options.display.titleColumn,title:this._options.display.titleColumn,allowEditAtThePlace:this._titleColumnIndex==-1?false:this._columnMap[this._titleColumnIndex].allowEditAtThePlace,textAlign:"left",fixedSize:false},d=this._renderTD(h,e),a=$(b).find(".ws-browser-cell-container")[0],c=this.isHierarchyMode()&&e.get(this._hierColumnIsLeaf)===true;if(i<=0&&g>0){a.style.paddingLeft=g+"px";}if(this.isHierarchyMode()&&i<=0){a=$(a).children(".ws-browser-text-container")[0];}d=this._appendDataToCellContainer($(a),d,c,h.render,h.allowEditAtThePlace,e.getKey(),this.isHierarchyMode()?e.get(this._hierColumnParentId):undefined);if(!h.render){if(!(d instanceof Object&&"jquery" in d)){a.className+=" ws-browser-text-no-render";}}var f=this._disabledEditCells[e.getKey()];if(f!==undefined&&(Object.isEmpty(f)||f[h.title]!==undefined)){this._disableEditCells($(b));}return b;},_createTdTemplateAtPlace:function(b,g){var h=document.createElement("td"),f=b>=0?this._columnMap[b]:{type:"Строка",render:null,field:this._options.display.titleColumn,title:this._options.display.titleColumn,className:"",allowEditAtThePlace:this._titleColumnIndex==-1?false:this._columnMap[this._titleColumnIndex].allowEditAtThePlace,textAlign:"left",fixedSize:false},d=$ws._const.Browser.type2ClassMap[f.type]||f.type,c=[];if(this._options.display.cutLongRows){c.push("ws-browser-cell-cut");}if(f.textAlign!=="auto"){c.push("ws-browser-"+f.textAlign);}else{if($ws.render.defaultColumn.isNumeric(f.type)){c.push("ws-browser-type-numeric");}if(d){c.push("ws-browser-type-"+d);}}if(f.className){c.push(f.className);}if(f.allowEditAtThePlace){c.push("ws-browser-edit-column");}if(c.length>0){h.className=c.join(" ");}var a=document.createElement("div");a.className="ws-browser-cell-container"+(this._options.display.cutLongRows?" ws-browser-div-cut":"");if(g){a.appendChild(g);}if(this.isHierarchyMode()&&b<=0){var e=document.createElement("div");e.className="ws-browser-text-container";a.appendChild(e);}h.appendChild(a);if(f.allowEditAtThePlace){$(h).attr("coldefindex",b<0?this._titleColumnIndex:b);}return h;},_appendDataToCellContainer:function(j,c,d,h,g,l,f){if(!g&&!h&&(c!==null&&c!==undefined)){if(!this._options.useHoverRowAsActive&&this._options.mode=="oneClickMode"){var a=d?this._options.editBranchMode:this._options.editMode,k=(a=="thisWindow")?this.generateEditPageURL(l,d,f):false,e=(a=="thisWindow")&&k!==false?' class="ws-browser-link" href="'+k+'"':'class="ws-browser-'+(d?"folder":"edit")+'-link" href="javascript:void(0)"';if(c instanceof Object&&"jquery" in c){c=$("<a "+e+" />").append(c);}else{if(c instanceof Array){c=$("<a "+e+'><span class="ws-invisible ws-browser-ladder-element">'+c[0]+" </span>"+c[1]+"</a>");}else{c=$("<a "+e+">"+c+"</a>");}}}else{if(this._options.mode!=="oneClickMode"){if(c instanceof Object&&"jquery" in c){c=$("<span/>").append(c);}else{c=$("<span>"+c+"</span>");}}}}if(c instanceof Array){c=$('<span style="visibility:hidden">'+c[0]+"</span><span>"+c[1]+"</span>");}j[0].innerHTML="";if(c instanceof Object&&"jquery" in c){j.append(c);}else{if(this._highlight){j.html(c);}else{j[0].innerHTML=(c===null||c===undefined)?"":c;}}if(!h){if(c instanceof Object&&"jquery" in c){c.addClass("ws-browser-text-no-render");}}if(this._options.display.cutLongRows){var b=j[0];if(!h||!(c instanceof Object&&"jquery" in c)){var i=(c instanceof Object&&"jquery" in c)?c.text():(b.textContent!==undefined?b.textContent:b.innerText);b.title=$ws.helpers.escapeTagsFromStr(i,[]).replace(/'/g,"&#039;");}}return c;},_showEmptyDataBlock:function(){if(this._options.display.allowAddAtThePlace){var a=this._container.find(".ws-browser");if(a.find("tr").size()===1){this._emptyDataBlock.toggleClass("ws-hidden",true);}}},_checkAllowEditAtThePlace:function(a,b){if(typeof(b)==="string"){if((b==="BranchesAndLeaves"||(a&&(b==="Branches")))||(!a&&b==="Leaves")){return true;}else{return false;}}return b;}});