$ws.proto.DataViewAbstract.MergePlugin=$ws.proto.DataViewAbstract.extendPlugin({$protected:{_options:{}},$condition:function(){return this._options.useMergeRecords===true&&!this._options.display.readOnly;},$constructor:function(){this._keysWeHandle[$ws._const.key.o]=true;},mergeSelectedRecords:function(){if(!Object.isEmpty(this._selected)){var d=this.getActiveRecord().getKey(),e=true,g=this._columnMap&&this._columnMap.length!==0?this._columnMap:this._currentRecordSet.getColumns(),f=this.getSelection(),b=this;for(var c=0,a=f.length;c<a;c++){if(f[c].getKey()===d){e=false;}}if(e){this._useKeyboard=true;$ws.core.setCursor(false);$ws.core.attachInstance("Source:RecordSetStatic",{defaultColumns:g,usePages:"full",rowsPerPage:100,records:f}).addCallback(function(h){$ws.core.attachInstance("SBIS3.CORE.Dialog",{template:"mergeRecordsDialog",context:new $ws.proto.Context().setPrevious(b.getLinkedContext()),handlers:{onReady:function(){var j=this.getChildControlByName("ws-browser-merge");j.recordSetReady().addCallback(function(){j.setData(h);j.setColumns(b.getColumns());});var i=this.getChildControlByName("ws-browser-merge-mainRow");$ws.core.attachInstance("Source:RecordSetStatic",{defaultColumns:g,records:[b.getActiveRecord()]}).addCallback(function(k){i.recordSetReady().addCallback(function(){i.setData(k);i.setColumns(b.getColumns());});});},onAfterClose:function(){b.removeSelection();b._mouseMonitor.apply(b);b.reload();},onAfterShow:function(){$ws.core.setCursor(true);}}});});}else{$ws.core.alert("Запись, с которой будет проведено объединение не должна входить в выбранные записи.");}}},_keyboardHover:function(b,a){if(this.isActive()&&b.ctrlKey&&b.altKey&&b.shiftKey&&b.which===$ws._const.key.o){this.mergeSelectedRecords();return false;}return a;}});