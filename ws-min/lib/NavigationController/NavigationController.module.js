$ws.declareModule({namespace:"SBIS3.CORE",name:"NavigationController",imports:[]},function(){$ws.single.NavigationController={_storage:[],init:function(){var a=this;this._parseHash();$ws.single.HashManager.subscribe("onChange",function(){var f=true,e=$ws.single.HashManager.get("ws-nc"),b,d;e=e?e.split(";"):[];if(e.length==a._storage.length){f=false;for(var c=e.length-1;c>=0;c--){b=e[c].split("=");d=String(a._storage[c]["state"]).replace(/;|=|%/g,function(g){return{";":":s:","=":":e:","%":":p:"}[g];});if(a._storage[c]["name"]!=b[0]||d!=b[1]){f=true;break;}}}if(f){a._parseHash();}});},updateState:function(b,e,d){for(var c=0,a=this._storage.length;c<a;c++){if(this._storage[c]["name"]==b){if(!this._storage[c]["applied"]){return;}this._storage[c]["state"]=e;this._updateHash(d);return;}}this._pushState(b,e,true);this._updateHash(true);},_pushState:function(a,c,b){this._storage.push({name:a,state:c,applied:b});},_updateHash:function(c){var d=[];for(var b=0,a=this._storage.length;b<a;b++){d.push([this._storage[b]["name"],(""+this._storage[b]["state"]).replace(/;|=|%/g,function(e){return{";":":s:","=":":e:","%":":p:"}[e];})].join("="));}$ws.single.HashManager.set("ws-nc",d.join(";"),c);},_parseHash:function(){var d=decodeURI($ws.single.HashManager.get("ws-nc")),b;if(d=="undefined"){return;}d=d?d.split(";"):[];this._storage=[];for(var c=0,a=d.length;c<a;c++){b=d[c].split("=");this._pushState(b[0],b[1].replace(/:(s|e|p):/g,function(g,f){return{s:";",e:"=",p:"%"}[f];}),false);}this._buildChain();},getStateByName:function(b){for(var c=0,a=this._storage.length;c<a;c++){if(this._storage[c]["name"]==b){return this._storage[c];}}},_buildChain:function(){var b=this,e;for(var d=0,a=this._storage.length;d<a;d++){e=this._storage[d];if($ws.single.ControlStorage.containsByName(e.name)){var f=$ws.single.ControlStorage.getByName(e.name);e.applied=true;f.applyState(e.state);}else{$ws.single.ControlStorage.waitChildByName(e.name).addCallback(function(g){function c(){var h=b.getStateByName(g.getName());h.applied=true;g.unsubscribe("onStateChanged",c);g.applyState(h.state);}g.subscribe("onStateChanged",c);return g;});}}},removeState:function(c){var b=c.getName();for(var a=this._storage.length-1;a>=0;a--){if(this._storage[a]["name"]==b){this._storage.splice(a,1);this._updateHash(true);break;}}}};return $ws.proto.NavigationController;});