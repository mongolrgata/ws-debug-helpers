$ws.declareModule({namespace:"SBIS3.CORE",name:"Marker",imports:[]},function(){var a=32;$ws.single.Marker=new ($ws.core.extend({},{$protected:{_offset:{top:0,left:0},_size:{classic:{top:{height:1},bottom:{height:2},left:{width:20,height:34},right:{width:20,height:34},topLeft:{width:69,height:10},topRight:{width:76,height:10},bottomLeft:{width:75,height:8},bottomRight:{width:68,height:8}},big:{top:{height:2},bottom:{height:2},left:{width:20,height:56},right:{width:20,height:56},topLeft:{width:92,height:11},topRight:{width:92,height:11},bottomLeft:{width:92,height:10},bottomRight:{width:92,height:10}}},_elements:{classic:{topLeft:null,topRight:null,bottomLeft:null,bottomRight:null,top:null,right:null,bottom:null,left:null},big:{topLeft:null,topRight:null,bottomLeft:null,bottomRight:null,top:null,right:null,bottom:null,left:null}},_type:"classic",_ready:{big:false,classic:false},_target:null,_correctPos:{},_visible:true},_repositionIfVisible:function(){if(this._target&&$("body").hasClass("ws-marker-visible-"+this._type)){this.positionToElement(this._target,this._correctPos,this._type);}},_init:function(){if(!this._ready[this._type]){var c=this._repositionIfVisible.bind(this),b=this;this._ready[this._type]=true;this._createMarker();if($.browser.msie&&$.browser.version<9){$(document).keyup(function(h){var g=[187,189,107,109,96,48];if(h.ctrlKey){for(var f=0,d=g.length;f<d;f++){if(h.which==g[f]){c();break;}}}});document.attachEvent("onmousewheel",(function(d){if(d.ctrlKey){c();}}).throttle(500));}$ws._const.$win.resize(c.throttle(42));setInterval(function(){if(b._target){b.toggle(b._elemIsVisible(b._target));}},50);}},_elemIsVisible:function(b){return !b.hasClass("ws-hidden")&&!b.parents().hasClass("ws-hidden");},toggle:function(b){if(this._visible!=b){this._visible=b;this[b?"show":"hide"]();}},_createMarker:function(){var c=document.createDocumentFragment();for(var b in this._elements[this._type]){if(this._elements[this._type].hasOwnProperty(b)){var d=document.createElement("div");d.className="ws-marker-"+this._type+" ws-marker ws-marker-"+b;this._elements[this._type][b]=$(d);c.appendChild(d);}}document.body.appendChild(c);},_setWidth:function(e){var d=this._size[this._type].left.width+this._size[this._type].right.width;var h=e-this._size[this._type].topLeft.width-this._size[this._type].topRight.width-d;var g=e-this._size[this._type].bottomLeft.width-this._size[this._type].bottomRight.width-d;var f,c;this._elements[this._type].top.width(f=(h>0?h:0));this._elements[this._type].bottom.width(c=(g>0?g:2));return[f,c];},setWidth:function(b){this._init();this._setWidth(b);this.setPosition(this._offset);},_getMarkerType:function(b){return b.height()<a?"classic":"big";},positionToElement:function(d,h,i){var b=0;i=i||this._getMarkerType(d);if(this._type!=i){this.hide();this._type=i;}this._init();if(d&&this._elemIsVisible(d)){this._target=d;this._correctPos=h||{};var f,g=d.offset(),j=d.outerHeight(),k=d.outerWidth(),e=parseInt(d.parents("body > *").css("z-index"),10);g.left+=(this._correctPos.left||0);g.top+=(j-this._size[this._type].left.height)/2+(this._correctPos.top||0);this.show();f=this._setWidth(k+b+(this._correctPos.width||0));this.setPosition(g,f);this.setZIndex(isNaN(e)?1:e+1);}},_prepareOffset:function(c){for(var b in c){if(c.hasOwnProperty(b)){c[b]=Math.round(c[b]);}}return c;},setPosition:function(g,f){this._init();g=this._prepareOffset(g);var e=g.top,d=g.left,c=g.left,b;this._elements[this._type].left.css({top:e,left:d});c+=this._size[this._type].left.width;b=c;this._elements[this._type].topLeft.css({top:e,left:c});this._elements[this._type].bottomLeft.css({top:e+(this._size[this._type].left.height-this._size[this._type].bottomLeft.height),left:b});c+=this._size[this._type].topLeft.width;b+=this._size[this._type].bottomLeft.width;this._elements[this._type].top.css({top:e,left:c});this._elements[this._type].bottom.css({top:e+(this._size[this._type].left.height-this._size[this._type].bottom.height),left:b});c+=f?f[0]:this._elements[this._type].top.width();b+=f?f[1]:this._elements[this._type].bottom.width();this._elements[this._type].topRight.css({top:e,left:c});this._elements[this._type].bottomRight.css({top:e+(this._size[this._type].left.height-this._size[this._type].bottomRight.height),left:b});g.left=c+this._size[this._type].topRight.width;this._elements[this._type].right.css(g);this._offset={top:e,left:d};},setZIndex:function(b){for(var c in this._elements[this._type]){this._elements[this._type][c].css("z-index",b);}},show:function(){$("body").addClass("ws-marker-visible-"+this._type);},hide:function(){$("body").removeClass("ws-marker-visible-"+this._type);}}))();return $ws.single.Marker;});